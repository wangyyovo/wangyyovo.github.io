<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>行为模式-命令模式 | Blank</title><meta name="author" content="Blank"><meta name="copyright" content="Blank"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="https:&#x2F;&#x2F;refactoringguru.cn&#x2F;design-patterns&#x2F;command  行为模式-命令模式亦称： 动作、事务、Action、Transaction、Command 意图命令模式是一种行为设计模式， 它可将请求转换为一个包含与请求相关的所有信息的独立对象。 该转换让你能根据不同的请求将方法参数化、 延迟请求执行或将其放入队列中， 且能实现可撤销操作。  问题假如你">
<meta property="og:type" content="article">
<meta property="og:title" content="行为模式-命令模式">
<meta property="og:url" content="https://wangyyovo.github.io/posts/670f2ad5/">
<meta property="og:site_name" content="Blank">
<meta property="og:description" content="https:&#x2F;&#x2F;refactoringguru.cn&#x2F;design-patterns&#x2F;command  行为模式-命令模式亦称： 动作、事务、Action、Transaction、Command 意图命令模式是一种行为设计模式， 它可将请求转换为一个包含与请求相关的所有信息的独立对象。 该转换让你能根据不同的请求将方法参数化、 延迟请求执行或将其放入队列中， 且能实现可撤销操作。  问题假如你">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/ca60644a6f657c61b4eab925d07d685f.jpg">
<meta property="article:published_time" content="2021-05-04T09:50:43.000Z">
<meta property="article:modified_time" content="2021-05-04T09:50:43.000Z">
<meta property="article:author" content="Blank">
<meta property="article:tag" content="pattern">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/ca60644a6f657c61b4eab925d07d685f.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "行为模式-命令模式",
  "url": "https://wangyyovo.github.io/posts/670f2ad5/",
  "image": "https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/ca60644a6f657c61b4eab925d07d685f.jpg",
  "datePublished": "2021-05-04T09:50:43.000Z",
  "dateModified": "2021-05-04T09:50:43.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Blank",
      "url": "https://wangyyovo.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/theme/favicon.ico"><link rel="canonical" href="https://wangyyovo.github.io/posts/670f2ad5/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400,"highlightFullpage":true,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":150,"languages":{"author":"作者: Blank","link":"链接: ","source":"来源: Blank","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '行为模式-命令模式',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="alternate" href="/atom.xml" title="Blank" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/theme/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">352</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">46</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">58</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-comment-dots"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-image"></i><span> 相册</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-book"></i><span> 教程</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/posts/21cfbf15/"><span> 🚀 快速開始</span></a></li><li><a class="site-page child" href="/posts/dc584b87/"><span> 📑 主題頁面</span></a></li><li><a class="site-page child" href="/posts/4aa8abbe/"><span> 🛠 主題配置</span></a></li><li><a class="site-page child" href="/posts/ceeb73f/"><span> ⚔️ 標簽外挂</span></a></li><li><a class="site-page child" href="/posts/98d20436/"><span> ❓ 主題問答</span></a></li><li><a class="site-page child" href="/posts/4073eda/"><span> ⚡️ 進階教程</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-language"></i><span> 语言</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/"><i class="fa-fw fas fa-c"></i><span> 中文</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/ca60644a6f657c61b4eab925d07d685f.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Blank</span></a><a class="nav-page-title" href="/"><span class="site-name">行为模式-命令模式</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-comment-dots"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-image"></i><span> 相册</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-book"></i><span> 教程</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/posts/21cfbf15/"><span> 🚀 快速開始</span></a></li><li><a class="site-page child" href="/posts/dc584b87/"><span> 📑 主題頁面</span></a></li><li><a class="site-page child" href="/posts/4aa8abbe/"><span> 🛠 主題配置</span></a></li><li><a class="site-page child" href="/posts/ceeb73f/"><span> ⚔️ 標簽外挂</span></a></li><li><a class="site-page child" href="/posts/98d20436/"><span> ❓ 主題問答</span></a></li><li><a class="site-page child" href="/posts/4073eda/"><span> ⚡️ 進階教程</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-language"></i><span> 语言</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/"><i class="fa-fw fas fa-c"></i><span> 中文</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">行为模式-命令模式</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-05-04T09:50:43.000Z" title="发表于 2021-05-04 17:50:43">2021-05-04</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-05-04T09:50:43.000Z" title="更新于 2021-05-04 17:50:43">2021-05-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/pattern/">pattern</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">12.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>57分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><script src="\assets\js\APlayer.min.js"> </script><blockquote>
<p><a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/command">https://refactoringguru.cn/design-patterns/command</a></p>
</blockquote>
<h1 id="行为模式-命令模式"><a href="#行为模式-命令模式" class="headerlink" title="行为模式-命令模式"></a>行为模式-命令模式</h1><p><strong>亦称：</strong> 动作、事务、Action、Transaction、Command</p>
<h2 id="意图"><a href="#意图" class="headerlink" title="意图"></a>意图</h2><p><strong>命令模式</strong>是一种行为设计模式， 它可将请求转换为一个包含与请求相关的所有信息的独立对象。 该转换让你能根据不同的请求将方法参数化、 延迟请求执行或将其放入队列中， 且能实现可撤销操作。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/blog/pattern/command-zh.png"></p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>假如你正在开发一款新的文字编辑器， 当前的任务是创建一个包含多个按钮的工具栏， 并让每个按钮对应编辑器的不同操作。 你创建了一个非常简洁的 <code>按钮</code>类， 它不仅可用于生成工具栏上的按钮， 还可用于生成各种对话框的通用按钮。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/blog/pattern/problem1-command.png" alt="应用中的所有按钮都可以继承相同的类"></p>
<p>尽管所有按钮看上去都很相似， 但它们可以完成不同的操作 （打开、 保存、 打印和应用等）。 你会在哪里放置这些按钮的点击处理代码呢？ 最简单的解决方案是在使用按钮的每个地方都创建大量的子类。 这些子类中包含按钮点击后必须执行的代码。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/blog/pattern/problem2-command.png" alt="大量的按钮子类。 没关系的。"></p>
<p>你很快就意识到这种方式有严重缺陷。 首先， 你创建了大量的子类， 当每次修改基类 <code>按钮</code>时， 你都有可能需要修改所有子类的代码。 简单来说， GUI 代码以一种拙劣的方式依赖于业务逻辑中的不稳定代码。你很快就意识到这种方式有严重缺陷。 首先， 你创建了大量的子类， 当每次修改基类 <code>按钮</code>时， 你都有可能需要修改所有子类的代码。 简单来说， GUI 代码以一种拙劣的方式依赖于业务逻辑中的不稳定代码。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/blog/pattern/problem3-zh-command.png" alt="多个类实现同一功能。"></p>
<p>还有一个部分最难办。 复制&#x2F;粘贴文字等操作可能会在多个地方被调用。 例如用户可以点击工具栏上小小的 “复制” 按钮， 或者通过上下文菜单复制一些内容， 又或者直接使用键盘上的 <code>Ctrl+C</code> 。</p>
<p>我们的程序最初只有工具栏， 因此可以使用按钮子类来实现各种不同操作。 换句话来说，  <code>复制按钮</code>Copy­Button子类包含复制文字的代码是可行的。 在实现了上下文菜单、 快捷方式和其他功能后， 你要么需要将操作代码复制进许多个类中， 要么需要让菜单依赖于按钮， 而后者是更糟糕的选择。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>优秀的软件设计通常会将关注点进行分离， 而这往往会导致软件的分层。 最常见的例子： 一层负责用户图像界面； 另一层负责业务逻辑。 GUI 层负责在屏幕上渲染美观的图形， 捕获所有输入并显示用户和程序工作的结果。 当需要完成一些重要内容时 （比如计算月球轨道或撰写年度报告）， GUI 层则会将工作委派给业务逻辑底层。</p>
<p>这在代码中看上去就像这样： 一个 GUI 对象传递一些参数来调用一个业务逻辑对象。 这个过程通常被描述为一个对象发送<em>请求</em>给另一个对象。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/blog/pattern/solution1-zh-command.png" alt="GUI 层可以直接访问业务逻辑层。"></p>
<p>命令模式建议 GUI 对象不直接提交这些请求。 你应该将请求的所有细节 （例如调用的对象、 方法名称和参数列表） 抽取出来组成<em>命令</em>类， 该类中仅包含一个用于触发请求的方法。</p>
<p>命令对象负责连接不同的 GUI 和业务逻辑对象。 此后， GUI 对象无需了解业务逻辑对象是否获得了请求， 也无需了解其对请求进行处理的方式。 GUI 对象触发命令即可， 命令对象会自行处理所有细节工作。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/blog/pattern/solution2-zh-command.png" alt="通过命令访问业务逻辑层。"></p>
<p>下一步是让所有命令实现相同的接口。 该接口通常只有一个没有任何参数的执行方法， 让你能在不和具体命令类耦合的情况下使用同一请求发送者执行不同命令。 此外还有额外的好处， 现在你能在运行时切换连接至发送者的命令对象， 以此改变发送者的行为。</p>
<p>你可能会注意到遗漏的一块拼图——请求的参数。 GUI 对象可以给业务层对象提供一些参数。 但执行命令方法没有任何参数， 所以我们如何将请求的详情发送给接收者呢？ 答案是： 使用数据对命令进行预先配置， 或者让其能够自行获取数据。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/blog/pattern/solution3-zh-command.png" alt="GUI 对象将命令委派给命令对象。"></p>
<p>让我们回到文本编辑器。 应用命令模式后， 我们不再需要任何按钮子类来实现点击行为。 我们只需在 <code>按钮</code>Button基类中添加一个成员变量来存储对于命令对象的引用， 并在点击后执行该命令即可。</p>
<p>你需要为每个可能的操作实现一系列命令类， 并且根据按钮所需行为将命令和按钮连接起来。</p>
<p>其他菜单、 快捷方式或整个对话框等 GUI 元素都可以通过相同方式来实现。 当用户与 GUI 元素交互时， 与其连接的命令将会被执行。 现在你很可能已经猜到了， 与相同操作相关的元素将会被连接到相同的命令， 从而避免了重复代码。</p>
<p>最后， 命令成为了减少 GUI 和业务逻辑层之间耦合的中间层。 而这仅仅是命令模式所提供的一小部分好处！</p>
<h2 id="真实世界类比"><a href="#真实世界类比" class="headerlink" title="真实世界类比"></a>真实世界类比</h2><p><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/blog/pattern/command-comic-1.png" alt="在餐厅里点餐。"></p>
<p>在市中心逛了很久的街后， 你找到了一家不错的餐厅， 坐在了临窗的座位上。 一名友善的服务员走近你， 迅速记下你点的食物， 写在一张纸上。 服务员来到厨房， 把订单贴在墙上。 过了一段时间， 厨师拿到了订单， 他根据订单来准备食物。 厨师将做好的食物和订单一起放在托盘上。 服务员看到托盘后对订单进行检查， 确保所有食物都是你要的， 然后将食物放到了你的桌上。</p>
<p>那张纸就是一个命令， 它在厨师开始烹饪前一直位于队列中。 命令中包含与烹饪这些食物相关的所有信息。 厨师能够根据它马上开始烹饪， 而无需跑来直接和你确认订单详情。</p>
<h2 id="命令模式结构"><a href="#命令模式结构" class="headerlink" title="命令模式结构"></a>命令模式结构</h2><p><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/blog/pattern/structure-indexed-command.png"></p>
<ol>
<li><p><strong>发送者</strong> （Sender）——亦称 “触发者 （Invoker）”——类负责对请求进行初始化， 其中必须包含一个成员变量来存储对于命令对象的引用。 发送者触发命令， 而不向接收者直接发送请求。 注意， 发送者并不负责创建命令对象： 它通常会通过构造函数从客户端处获得预先生成的命令。</p>
</li>
<li><p><strong>命令</strong> （Command） 接口通常仅声明一个执行命令的方法。</p>
</li>
<li><p><strong>具体命令</strong> （Concrete Commands） 会实现各种类型的请求。 具体命令自身并不完成工作， 而是会将调用委派给一个业务逻辑对象。 但为了简化代码， 这些类可以进行合并。</p>
<p>接收对象执行方法所需的参数可以声明为具体命令的成员变量。 你可以将命令对象设为不可变， 仅允许通过构造函数对这些成员变量进行初始化。</p>
</li>
<li><p><strong>接收者</strong> （Receiver） 类包含部分业务逻辑。 几乎任何对象都可以作为接收者。 绝大部分命令只处理如何将请求传递到接收者的细节， 接收者自己会完成实际的工作。</p>
</li>
<li><p><strong>客户端</strong> （Client） 会创建并配置具体命令对象。 客户端必须将包括接收者实体在内的所有请求参数传递给命令的构造函数。 此后， 生成的命令就可以与一个或多个发送者相关联了。</p>
</li>
</ol>
<h2 id="伪代码"><a href="#伪代码" class="headerlink" title="伪代码"></a>伪代码</h2><p>在本例中， <strong>命令</strong>模式会记录已执行操作的历史记录， 以在需要时撤销操作。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/blog/pattern/example-command.png" alt="文本编辑器中的可撤销操作。"></p>
<p>有些命令会改变编辑器的状态 （例如剪切和粘贴）， 它们可在执行相关操作前对编辑器的状态进行备份。 命令执行后会和当前点备份的编辑器状态一起被放入命令历史 （命令对象栈）。 此后， 如果用户需要进行回滚操作， 程序可从历史记录中取出最近的命令， 读取相应的编辑器状态备份， 然后进行恢复。</p>
<p>客户端代码 （GUI 元素和命令历史等） 没有和具体命令类相耦合， 因为它通过命令接口来使用命令。 这使得你能在无需修改已有代码的情况下在程序中增加新的命令。</p>
<figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 命令基类会为所有具体命令定义通用接口。</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> Command <span class="keyword">is</span></span><br><span class="line">    <span class="keyword">protected</span> field app: Application</span><br><span class="line">    <span class="keyword">protected</span> field editor: Editor</span><br><span class="line">    <span class="keyword">protected</span> field backup: text</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">constructor</span> <span class="title">Command</span><span class="params">(app: Application, editor: Editor)</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">this</span>.<span class="title">app</span> = <span class="title">app</span></span></span><br><span class="line"><span class="function">        <span class="title">this</span>.<span class="title">editor</span> = <span class="title">editor</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="comment">// 备份编辑器状态。</span></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">saveBackup</span><span class="params">()</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">backup</span> = <span class="title">editor</span>.<span class="title">text</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="comment">// 恢复编辑器状态。</span></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">undo</span><span class="params">()</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">editor</span>.<span class="title">text</span> = <span class="title">backup</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="comment">// 执行方法被声明为抽象以强制所有具体命令提供自己的实现。该方法必须根</span></span></span><br><span class="line"><span class="function">    <span class="comment">// 据命令是否更改编辑器的状态返回 true 或 false。</span></span></span><br><span class="line"><span class="function">    <span class="title">abstract</span> <span class="title">method</span> <span class="title">execute</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// 这里是具体命令。</span></span></span><br><span class="line"><span class="function"><span class="title">class</span> <span class="title">CopyCommand</span> <span class="title">extends</span> <span class="title">Command</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">    <span class="comment">// 复制命令不会被保存到历史记录中，因为它没有改变编辑器的状态。</span></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">execute</span><span class="params">()</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">app</span>.<span class="title">clipboard</span> = <span class="title">editor</span>.<span class="title">getSelection</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        <span class="title">return</span> <span class="title">false</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">class</span> <span class="title">CutCommand</span> <span class="title">extends</span> <span class="title">Command</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">    <span class="comment">// 剪切命令改变了编辑器的状态，因此它必须被保存到历史记录中。只要方法</span></span></span><br><span class="line"><span class="function">    <span class="comment">// 返回 true，它就会被保存。</span></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">execute</span><span class="params">()</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">saveBackup</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        <span class="title">app</span>.<span class="title">clipboard</span> = <span class="title">editor</span>.<span class="title">getSelection</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        <span class="title">editor</span>.<span class="title">deleteSelection</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        <span class="title">return</span> <span class="title">true</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">class</span> <span class="title">PasteCommand</span> <span class="title">extends</span> <span class="title">Command</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">execute</span><span class="params">()</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">saveBackup</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        <span class="title">editor</span>.<span class="title">replaceSelection</span><span class="params">(app.clipboard)</span></span></span><br><span class="line"><span class="function">        <span class="title">return</span> <span class="title">true</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// 撤销操作也是一个命令。</span></span></span><br><span class="line"><span class="function"><span class="title">class</span> <span class="title">UndoCommand</span> <span class="title">extends</span> <span class="title">Command</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">execute</span><span class="params">()</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">app</span>.<span class="title">undo</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        <span class="title">return</span> <span class="title">false</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// 全局命令历史记录就是一个堆桟。</span></span></span><br><span class="line"><span class="function"><span class="title">class</span> <span class="title">CommandHistory</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">    <span class="title">private</span> <span class="title">field</span> <span class="title">history</span>:</span> <span class="keyword">array</span> <span class="keyword">of</span> Command</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 后进...</span></span><br><span class="line">    method push(c: Command) <span class="keyword">is</span></span><br><span class="line">        <span class="comment">// 将命令压入历史记录数组的末尾。</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...先出</span></span><br><span class="line">    method pop():Command <span class="keyword">is</span></span><br><span class="line">        <span class="comment">// 从历史记录中取出最近的命令。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 编辑器类包含实际的文本编辑操作。它会担任接收者的角色：最后所有命令都会</span></span><br><span class="line"><span class="comment">// 将执行工作委派给编辑器的方法。</span></span><br><span class="line"><span class="keyword">class</span> Editor <span class="keyword">is</span></span><br><span class="line">    field text: <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">    method getSelection() <span class="keyword">is</span></span><br><span class="line">        <span class="comment">// 返回选中的文字。</span></span><br><span class="line"></span><br><span class="line">    method deleteSelection() <span class="keyword">is</span></span><br><span class="line">        <span class="comment">// 删除选中的文字。</span></span><br><span class="line"></span><br><span class="line">    method replaceSelection(text) <span class="keyword">is</span></span><br><span class="line">        <span class="comment">// 在当前位置插入剪贴板中的内容。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 应用程序类会设置对象之间的关系。它会担任发送者的角色：当需要完成某些工</span></span><br><span class="line"><span class="comment">// 作时，它会创建并执行一个命令对象。</span></span><br><span class="line"><span class="keyword">class</span> Application <span class="keyword">is</span></span><br><span class="line">    field clipboard: <span class="keyword">string</span></span><br><span class="line">    field editors: <span class="keyword">array</span> <span class="keyword">of</span> Editors</span><br><span class="line">    field activeEditor: Editor</span><br><span class="line">    field history: CommandHistory</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将命令分派给 UI 对象的代码可能会是这样的。</span></span><br><span class="line">    method createUI() <span class="keyword">is</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        copy = <span class="function"><span class="keyword">function</span><span class="params">()</span> <span class="comment">&#123; executeCommand(</span></span></span><br><span class="line"><span class="comment"><span class="function">            new CopyCommand(this, activeEditor)) &#125;</span></span></span><br><span class="line"><span class="function">        <span class="title">copyButton</span>.<span class="title">setCommand</span><span class="params">(copy)</span></span></span><br><span class="line"><span class="function">        <span class="title">shortcuts</span>.<span class="title">onKeyPress</span><span class="params">(&quot;Ctrl+C&quot;, copy)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">        <span class="title">cut</span> = <span class="title">function</span><span class="params">()</span> <span class="comment">&#123; executeCommand(</span></span></span><br><span class="line"><span class="comment"><span class="function">            new CutCommand(this, activeEditor)) &#125;</span></span></span><br><span class="line"><span class="function">        <span class="title">cutButton</span>.<span class="title">setCommand</span><span class="params">(cut)</span></span></span><br><span class="line"><span class="function">        <span class="title">shortcuts</span>.<span class="title">onKeyPress</span><span class="params">(&quot;Ctrl+X&quot;, cut)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">        <span class="title">paste</span> = <span class="title">function</span><span class="params">()</span> <span class="comment">&#123; executeCommand(</span></span></span><br><span class="line"><span class="comment"><span class="function">            new PasteCommand(this, activeEditor)) &#125;</span></span></span><br><span class="line"><span class="function">        <span class="title">pasteButton</span>.<span class="title">setCommand</span><span class="params">(paste)</span></span></span><br><span class="line"><span class="function">        <span class="title">shortcuts</span>.<span class="title">onKeyPress</span><span class="params">(&quot;Ctrl+V&quot;, paste)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">        <span class="title">undo</span> = <span class="title">function</span><span class="params">()</span> <span class="comment">&#123; executeCommand(</span></span></span><br><span class="line"><span class="comment"><span class="function">            new UndoCommand(this, activeEditor)) &#125;</span></span></span><br><span class="line"><span class="function">        <span class="title">undoButton</span>.<span class="title">setCommand</span><span class="params">(undo)</span></span></span><br><span class="line"><span class="function">        <span class="title">shortcuts</span>.<span class="title">onKeyPress</span><span class="params">(&quot;Ctrl+Z&quot;, undo)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="comment">// 执行一个命令并检查它是否需要被添加到历史记录中。</span></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">executeCommand</span><span class="params">(command)</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">if</span> <span class="params">(command.execute)</span></span></span><br><span class="line"><span class="function">            <span class="title">history</span>.<span class="title">push</span><span class="params">(command)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="comment">// 从历史记录中取出最近的命令并运行其 undo（撤销）方法。请注意，你并</span></span></span><br><span class="line"><span class="function">    <span class="comment">// 不知晓该命令所属的类。但是我们不需要知晓，因为命令自己知道如何撤销</span></span></span><br><span class="line"><span class="function">    <span class="comment">// 其动作。</span></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">undo</span><span class="params">()</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">command</span> = <span class="title">history</span>.<span class="title">pop</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        <span class="title">if</span> <span class="params">(command != null)</span></span></span><br><span class="line"><span class="function">            <span class="title">command</span>.<span class="title">undo</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>

<h2 id="命令模式适合应用场景"><a href="#命令模式适合应用场景" class="headerlink" title="命令模式适合应用场景"></a>命令模式适合应用场景</h2><p><strong>如果你需要通过操作来参数化对象，可使用命令模式。</strong></p>
<p>命令模式可将特定的方法调用转化为独立对象。 这一改变也带来了许多有趣的应用： 你可以将命令作为方法的参数进行传递、 将命令保存在其他对象中， 或者在运行时切换已连接的命令等。</p>
<p>举个例子： 你正在开发一个 GUI 组件 （例如上下文菜单）， 你希望用户能够配置菜单项， 并在点击菜单项时触发操作。</p>
<p><strong>如果你想要将操作放入队列中、操作的执行或者远程执行操作，可使用命令模式。</strong></p>
<p>同其他对象一样， 命令也可以实现序列化 （序列化的意思是转化为字符串）， 从而能方便地写入文件或数据库中。 一段时间后， 该字符串可被恢复成为最初的命令对象。 因此， 你可以延迟或计划命令的执行。 但其功能远不止如此！ 使用同样的方式， 你还可以将命令放入队列、 记录命令或者通过网络发送命令。</p>
<p><strong>如果你想要实现操作回滚功能，可使用命令模式。</strong></p>
<p>尽管有很多方法可以实现撤销和恢复功能， 但命令模式可能是其中最常用的一种。</p>
<p>为了能够回滚操作， 你需要实现已执行操作的历史记录功能。 命令历史记录是一种包含所有已执行命令对象及其相关程序状态备份的栈结构。</p>
<p>这种方法有两个缺点。 首先， 程序状态的保存功能并不容易实现， 因为部分状态可能是私有的。 你可以使用<a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/memento">备忘录</a>模式来在一定程度上解决这个问题。</p>
<p>其次， 备份状态可能会占用大量内存。 因此， 有时你需要借助另一种实现方式： 命令无需恢复原始状态， 而是执行反向操作。 反向操作也有代价： 它可能会很难甚至是无法实现。</p>
<h2 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h2><ol>
<li><p>声明仅有一个执行方法的命令接口。</p>
</li>
<li><p>抽取请求并使之成为实现命令接口的具体命令类。 每个类都必须有一组成员变量来保存请求参数和对于实际接收者对象的引用。 所有这些变量的数值都必须通过命令构造函数进行初始化。</p>
</li>
<li><p>找到担任<em>发送者</em>职责的类。 在这些类中添加保存命令的成员变量。 发送者只能通过命令接口与其命令进行交互。 发送者自身通常并不创建命令对象， 而是通过客户端代码获取。</p>
</li>
<li><p>修改发送者使其执行命令， 而非直接将请求发送给接收者。</p>
</li>
<li><p>客户端必须按照以下顺序来初始化对象：</p>
<ul>
<li>创建接收者。</li>
<li>创建命令， 如有需要可将其关联至接收者。</li>
<li>创建发送者并将其与特定命令关联。</li>
</ul>
</li>
</ol>
<h2 id="命令模式优缺点"><a href="#命令模式优缺点" class="headerlink" title="命令模式优缺点"></a>命令模式优缺点</h2><p>优点</p>
<ul>
<li><em>单一职责原则</em>。 你可以解耦触发和执行操作的类。</li>
<li><em>开闭原则</em>。 你可以在不修改已有客户端代码的情况下在程序中创建新的命令。</li>
<li>你可以实现撤销和恢复功能。</li>
<li>你可以实现操作的延迟执行。</li>
<li>你可以将一组简单命令组合成一个复杂命令。</li>
</ul>
<p>缺点</p>
<ul>
<li>代码可能会变得更加复杂， 因为你在发送者和接收者之间增加了一个全新的层次。</li>
</ul>
<h2 id="与其他模式的关系"><a href="#与其他模式的关系" class="headerlink" title="与其他模式的关系"></a>与其他模式的关系</h2><ul>
<li><p><a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/chain-of-responsibility">责任链模式</a>、 <a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/command">命令模式</a>、 <a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/mediator">中介者模式</a>和<a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/observer">观察者模式</a>用于处理请求发送者和接收者之间的不同连接方式：</p>
<ul>
<li><em>责任链</em>按照顺序将请求动态传递给一系列的潜在接收者， 直至其中一名接收者对请求进行处理。</li>
<li><em>命令</em>在发送者和请求者之间建立单向连接。</li>
<li><em>中介者</em>清除了发送者和请求者之间的直接连接， 强制它们通过一个中介对象进行间接沟通。</li>
<li><em>观察者</em>允许接收者动态地订阅或取消接收请求。</li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/chain-of-responsibility">责任链</a>的管理者可使用<a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/command">命令模式</a>实现。 在这种情况下， 你可以对由请求代表的同一个上下文对象执行许多不同的操作。</p>
<p>还有另外一种实现方式， 那就是请求自身就是一个<em>命令</em>对象。 在这种情况下， 你可以对由一系列不同上下文连接而成的链执行相同的操作。</p>
</li>
<li><p>你可以同时使用<a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/command">命令</a>和<a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/memento">备忘录模式</a>来实现 “撤销”。 在这种情况下， 命令用于对目标对象执行各种不同的操作， 备忘录用来保存一条命令执行前该对象的状态。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/command">命令</a>和<a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/strategy">策略模式</a>看上去很像， 因为两者都能通过某些行为来参数化对象。 但是， 它们的意图有非常大的不同。</p>
<ul>
<li>你可以使用<em>命令</em>来将任何操作转换为对象。 操作的参数将成为对象的成员变量。 你可以通过转换来延迟操作的执行、 将操作放入队列、 保存历史命令或者向远程服务发送命令等。</li>
<li>另一方面， <em>策略</em>通常可用于描述完成某件事的不同方式， 让你能够在同一个上下文类中切换算法。</li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/prototype">原型模式</a>可用于保存<a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/command">命令</a>的历史记录。</p>
</li>
<li><p>你可以将<a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/visitor">访问者模式</a>视为<a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/command">命令模式</a>的加强版本， 其对象可对不同类的多种对象执行操作。</p>
</li>
</ul>
<h2 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h2><p><strong>命令</strong>是一种行为设计模式， 它可将请求或简单操作转换为一个对象。</p>
<p>此类转换让你能够延迟进行或远程执行请求， 还可将其放入队列中。</p>
<div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">C#</button><button type="button" class="tab">C++</button><button type="button" class="tab">JAVA</button><button type="button" class="tab">PHP</button><button type="button" class="tab">Python</button><button type="button" class="tab">Ruby</button><button type="button" class="tab">Swift</button><button type="button" class="tab">TypeScrit</button><button type="button" class="tab">Golang</button></div><div class="tab-contents"><div class="tab-item-content active"><p><strong>在 C# 中使用模式</strong></p>
<p><strong>复杂度：</strong> ★☆☆</p>
<p><strong>流行度：</strong> ★★★</p>
<p><strong>使用示例：</strong> 命令模式在 C# 代码中很常见。 大部分情况下， 它被用于代替包含行为的参数化 UI 元素的回调函数， 此外还被用于对任务进行排序和记录操作历史记录等。</p>
<p><strong>识别方法：</strong> 命令模式可以通过抽象或接口类型 （发送者） 中的行为方法来识别， 该类型调用另一个不同的抽象或接口类型 （接收者） 实现中的方法， 该实现则是在创建时由命令模式的实现封装。 命令类通常仅限于一些特殊行为。</p>
<p><strong>概念示例</strong></p>
<p>本例说明了<strong>命令</strong>设计模式的结构并重点回答了下面的问题：</p>
<ul>
<li>它由哪些类组成？</li>
<li>这些类扮演了哪些角色？</li>
<li>模式中的各个元素会以何种方式相互关联？</li>
</ul>
<p><strong>Program.cs:</strong> 概念示例</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">RefactoringGuru.DesignPatterns.Command.Conceptual</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// The Command interface declares a method for executing a command.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ICommand</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Execute</span>()</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Some commands can implement simple operations on their own.</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title">SimpleCommand</span> : <span class="title">ICommand</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">string</span> _payload = <span class="built_in">string</span>.Empty;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">SimpleCommand</span>(<span class="params"><span class="built_in">string</span> payload</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">this</span>._payload = payload;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Execute</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">$&quot;SimpleCommand: See, I can do simple things like printing (<span class="subst">&#123;<span class="keyword">this</span>._payload&#125;</span>)&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// However, some commands can delegate more complex operations to other</span></span><br><span class="line">    <span class="comment">// objects, called &quot;receivers.&quot;</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title">ComplexCommand</span> : <span class="title">ICommand</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> Receiver _receiver;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Context data, required for launching the receiver&#x27;s methods.</span></span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">string</span> _a;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">string</span> _b;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Complex commands can accept one or several receiver objects along</span></span><br><span class="line">        <span class="comment">// with any context data via the constructor.</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ComplexCommand</span>(<span class="params">Receiver receiver, <span class="built_in">string</span> a, <span class="built_in">string</span> b</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">this</span>._receiver = receiver;</span><br><span class="line">            <span class="keyword">this</span>._a = a;</span><br><span class="line">            <span class="keyword">this</span>._b = b;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Commands can delegate to any methods of a receiver.</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Execute</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;ComplexCommand: Complex stuff should be done by a receiver object.&quot;</span>);</span><br><span class="line">            <span class="keyword">this</span>._receiver.DoSomething(<span class="keyword">this</span>._a);</span><br><span class="line">            <span class="keyword">this</span>._receiver.DoSomethingElse(<span class="keyword">this</span>._b);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The Receiver classes contain some important business logic. They know how</span></span><br><span class="line">    <span class="comment">// to perform all kinds of operations, associated with carrying out a</span></span><br><span class="line">    <span class="comment">// request. In fact, any class may serve as a Receiver.</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title">Receiver</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DoSomething</span>(<span class="params"><span class="built_in">string</span> a</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">$&quot;Receiver: Working on (<span class="subst">&#123;a&#125;</span>.)&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DoSomethingElse</span>(<span class="params"><span class="built_in">string</span> b</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">$&quot;Receiver: Also working on (<span class="subst">&#123;b&#125;</span>.)&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The Invoker is associated with one or several commands. It sends a</span></span><br><span class="line">    <span class="comment">// request to the command.</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title">Invoker</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> ICommand _onStart;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> ICommand _onFinish;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Initialize commands.</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetOnStart</span>(<span class="params">ICommand command</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">this</span>._onStart = command;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetOnFinish</span>(<span class="params">ICommand command</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">this</span>._onFinish = command;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// The Invoker does not depend on concrete command or receiver classes.</span></span><br><span class="line">        <span class="comment">// The Invoker passes a request to a receiver indirectly, by executing a</span></span><br><span class="line">        <span class="comment">// command.</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DoSomethingImportant</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Invoker: Does anybody want something done before I begin?&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>._onStart <span class="keyword">is</span> ICommand)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">this</span>._onStart.Execute();</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Invoker: ...doing something really important...&quot;</span>);</span><br><span class="line">            </span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Invoker: Does anybody want something done after I finish?&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>._onFinish <span class="keyword">is</span> ICommand)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">this</span>._onFinish.Execute();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// The client code can parameterize an invoker with any commands.</span></span><br><span class="line">            Invoker invoker = <span class="keyword">new</span> Invoker();</span><br><span class="line">            invoker.SetOnStart(<span class="keyword">new</span> SimpleCommand(<span class="string">&quot;Say Hi!&quot;</span>));</span><br><span class="line">            Receiver receiver = <span class="keyword">new</span> Receiver();</span><br><span class="line">            invoker.SetOnFinish(<span class="keyword">new</span> ComplexCommand(receiver, <span class="string">&quot;Send email&quot;</span>, <span class="string">&quot;Save report&quot;</span>));</span><br><span class="line"></span><br><span class="line">            invoker.DoSomethingImportant();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Invoker: Does anybody want something done before I begin?</span><br><span class="line">SimpleCommand: See, I can do simple things like printing (Say Hi!)</span><br><span class="line">Invoker: ...doing something really important...</span><br><span class="line">Invoker: Does anybody want something done after I finish?</span><br><span class="line">ComplexCommand: Complex stuff should be done by a receiver object.</span><br><span class="line">Receiver: Working on (Send email.)</span><br><span class="line">Receiver: Also working on (Save report.)</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><strong>在 C++ 中使用模式</strong></p>
<p><strong>复杂度：</strong> ★☆☆</p>
<p><strong>流行度：</strong> ★★★</p>
<p><strong>使用示例：</strong> 命令模式在 C++ 代码中很常见。 大部分情况下， 它被用于代替包含行为的参数化 UI 元素的回调函数， 此外还被用于对任务进行排序和记录操作历史记录等。</p>
<p><strong>识别方法：</strong> 命令模式可以通过抽象或接口类型 （发送者） 中的行为方法来识别， 该类型调用另一个不同的抽象或接口类型 （接收者） 实现中的方法， 该实现则是在创建时由命令模式的实现封装。 命令类通常仅限于一些特殊行为。</p>
<p><strong>概念示例</strong></p>
<p>本例说明了<strong>命令</strong>设计模式的结构并重点回答了下面的问题：</p>
<ul>
<li>它由哪些类组成？</li>
<li>这些类扮演了哪些角色？</li>
<li>模式中的各个元素会以何种方式相互关联？</li>
</ul>
<p><strong>main.cc:</strong> 概念示例</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Command interface declares a method for executing a command.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Command</span> &#123;</span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="keyword">virtual</span> ~<span class="built_in">Command</span>() &#123;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Execute</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Some commands can implement simple operations on their own.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleCommand</span> : <span class="keyword">public</span> Command &#123;</span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">  std::string pay_load_;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">explicit</span> <span class="title">SimpleCommand</span><span class="params">(std::string pay_load)</span> : pay_load_(pay_load) &#123;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">Execute</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;SimpleCommand: See, I can do simple things like printing (&quot;</span> &lt;&lt; <span class="keyword">this</span>-&gt;pay_load_ &lt;&lt; <span class="string">&quot;)\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Receiver classes contain some important business logic. They know how to</span></span><br><span class="line"><span class="comment"> * perform all kinds of operations, associated with carrying out a request. In</span></span><br><span class="line"><span class="comment"> * fact, any class may serve as a Receiver.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Receiver</span> &#123;</span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">DoSomething</span><span class="params">(<span class="type">const</span> std::string &amp;a)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Receiver: Working on (&quot;</span> &lt;&lt; a &lt;&lt; <span class="string">&quot;.)\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">DoSomethingElse</span><span class="params">(<span class="type">const</span> std::string &amp;b)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Receiver: Also working on (&quot;</span> &lt;&lt; b &lt;&lt; <span class="string">&quot;.)\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * However, some commands can delegate more complex operations to other objects,</span></span><br><span class="line"><span class="comment"> * called &quot;receivers.&quot;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ComplexCommand</span> : <span class="keyword">public</span> Command &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * @var Receiver</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">  Receiver *receiver_;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Context data, required for launching the receiver&#x27;s methods.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  std::string a_;</span><br><span class="line">  std::string b_;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Complex commands can accept one or several receiver objects along with any</span></span><br><span class="line"><span class="comment">   * context data via the constructor.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">ComplexCommand</span>(Receiver *receiver, std::string a, std::string b) : <span class="built_in">receiver_</span>(receiver), <span class="built_in">a_</span>(a), <span class="built_in">b_</span>(b) &#123;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Commands can delegate to any methods of a receiver.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">Execute</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;ComplexCommand: Complex stuff should be done by a receiver object.\n&quot;</span>;</span><br><span class="line">    <span class="keyword">this</span>-&gt;receiver_-&gt;<span class="built_in">DoSomething</span>(<span class="keyword">this</span>-&gt;a_);</span><br><span class="line">    <span class="keyword">this</span>-&gt;receiver_-&gt;<span class="built_in">DoSomethingElse</span>(<span class="keyword">this</span>-&gt;b_);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Invoker is associated with one or several commands. It sends a request to</span></span><br><span class="line"><span class="comment"> * the command.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Invoker</span> &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * @var Command</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">  Command *on_start_;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * @var Command</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  Command *on_finish_;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Initialize commands.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  ~<span class="built_in">Invoker</span>() &#123;</span><br><span class="line">    <span class="keyword">delete</span> on_start_;</span><br><span class="line">    <span class="keyword">delete</span> on_finish_;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">SetOnStart</span><span class="params">(Command *command)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;on_start_ = command;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">SetOnFinish</span><span class="params">(Command *command)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;on_finish_ = command;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * The Invoker does not depend on concrete command or receiver classes. The</span></span><br><span class="line"><span class="comment">   * Invoker passes a request to a receiver indirectly, by executing a command.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">DoSomethingImportant</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Invoker: Does anybody want something done before I begin?\n&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>-&gt;on_start_) &#123;</span><br><span class="line">      <span class="keyword">this</span>-&gt;on_start_-&gt;<span class="built_in">Execute</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Invoker: ...doing something really important...\n&quot;</span>;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Invoker: Does anybody want something done after I finish?\n&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>-&gt;on_finish_) &#123;</span><br><span class="line">      <span class="keyword">this</span>-&gt;on_finish_-&gt;<span class="built_in">Execute</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The client code can parameterize an invoker with any commands.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  Invoker *invoker = <span class="keyword">new</span> Invoker;</span><br><span class="line">  invoker-&gt;<span class="built_in">SetOnStart</span>(<span class="keyword">new</span> <span class="built_in">SimpleCommand</span>(<span class="string">&quot;Say Hi!&quot;</span>));</span><br><span class="line">  Receiver *receiver = <span class="keyword">new</span> Receiver;</span><br><span class="line">  invoker-&gt;<span class="built_in">SetOnFinish</span>(<span class="keyword">new</span> <span class="built_in">ComplexCommand</span>(receiver, <span class="string">&quot;Send email&quot;</span>, <span class="string">&quot;Save report&quot;</span>));</span><br><span class="line">  invoker-&gt;<span class="built_in">DoSomethingImportant</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">delete</span> invoker;</span><br><span class="line">  <span class="keyword">delete</span> receiver;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Invoker: Does anybody want something done before I begin?</span><br><span class="line">SimpleCommand: See, I can do simple things like printing (Say Hi!)</span><br><span class="line">Invoker: ...doing something really important...</span><br><span class="line">Invoker: Does anybody want something done after I finish?</span><br><span class="line">ComplexCommand: Complex stuff should be done by a receiver object.</span><br><span class="line">Receiver: Working on (Send email.)</span><br><span class="line">Receiver: Also working on (Save report.)</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><strong>在 Java 中使用模式</strong></p>
<p><strong>复杂度：</strong> ★☆☆</p>
<p><strong>流行度：</strong> ★★★</p>
<p><strong>使用示例：</strong> 命令模式在 Java 代码中很常见。 大部分情况下， 它被用于代替包含行为的参数化 UI 元素的回调函数， 此外还被用于对任务进行排序和记录操作历史记录等。</p>
<p>以下是在核心 Java 程序库中的一些示例：</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://docs.oracle.com/javase/8/docs/api/java/lang/Runnable.html"><code>java.lang.Runnable</code></a> 的所有实现</li>
<li><a target="_blank" rel="noopener" href="http://docs.oracle.com/javase/8/docs/api/javax/swing/Action.html"><code>javax.swing.Action</code></a> 的所有实现</li>
</ul>
<p><strong>识别方法：</strong> 命令模式可以通过抽象或接口类型 （发送者） 中的行为方法来识别， 该类型调用另一个不同的抽象或接口类型 （接收者） 实现中的方法， 该实现则是在创建时由命令模式的实现封装。 命令类通常仅限于一些特殊行为。</p>
<p><strong>文字编辑器和撤销</strong></p>
<p>本例中的文字编辑器在每次用户与其互动时， 都会创建一个新的命令对象。 命令执行其行为后会被压入历史堆栈。</p>
<p>现在， 当程序执行撤销操作时， 它就需要从历史记录中取出最近执行的命令， 然后执行反向操作或者恢复由该命令保存的编辑器历史状态。</p>
<p><strong>commands</strong></p>
<p><strong>commands&#x2F;Command.java:</strong> 抽象基础命令</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.command.example.commands;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.command.example.editor.Editor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Command</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Editor editor;</span><br><span class="line">    <span class="keyword">private</span> String backup;</span><br><span class="line"></span><br><span class="line">    Command(Editor editor) &#123;</span><br><span class="line">        <span class="built_in">this</span>.editor = editor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">backup</span><span class="params">()</span> &#123;</span><br><span class="line">        backup = editor.textField.getText();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">undo</span><span class="params">()</span> &#123;</span><br><span class="line">        editor.textField.setText(backup);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">boolean</span> <span class="title function_">execute</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>commands&#x2F;CopyCommand.java:</strong> 将所选文字复制到剪贴板</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.command.example.commands;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.command.example.editor.Editor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CopyCommand</span> <span class="keyword">extends</span> <span class="title class_">Command</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CopyCommand</span><span class="params">(Editor editor)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(editor);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">execute</span><span class="params">()</span> &#123;</span><br><span class="line">        editor.clipboard = editor.textField.getSelectedText();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>commands&#x2F;PasteCommand.java:</strong> 从剪贴板粘贴文字</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.command.example.commands;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.command.example.editor.Editor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PasteCommand</span> <span class="keyword">extends</span> <span class="title class_">Command</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PasteCommand</span><span class="params">(Editor editor)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(editor);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">execute</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (editor.clipboard == <span class="literal">null</span> || editor.clipboard.isEmpty()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        backup();</span><br><span class="line">        editor.textField.insert(editor.clipboard, editor.textField.getCaretPosition());</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>commands&#x2F;CutCommand.java:</strong> 将文字剪切到剪贴板</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.command.example.commands;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.command.example.editor.Editor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CutCommand</span> <span class="keyword">extends</span> <span class="title class_">Command</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CutCommand</span><span class="params">(Editor editor)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(editor);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">execute</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (editor.textField.getSelectedText().isEmpty()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        backup();</span><br><span class="line">        <span class="type">String</span> <span class="variable">source</span> <span class="operator">=</span> editor.textField.getText();</span><br><span class="line">        editor.clipboard = editor.textField.getSelectedText();</span><br><span class="line">        editor.textField.setText(cutString(source));</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">cutString</span><span class="params">(String source)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">start</span> <span class="operator">=</span> source.substring(<span class="number">0</span>, editor.textField.getSelectionStart());</span><br><span class="line">        <span class="type">String</span> <span class="variable">end</span> <span class="operator">=</span> source.substring(editor.textField.getSelectionEnd());</span><br><span class="line">        <span class="keyword">return</span> start + end;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>commands&#x2F;CommandHistory.java:</strong> 命令历史</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.command.example.commands;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Stack;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommandHistory</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Stack&lt;Command&gt; history = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">push</span><span class="params">(Command c)</span> &#123;</span><br><span class="line">        history.push(c);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Command <span class="title function_">pop</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> history.pop();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123; <span class="keyword">return</span> history.isEmpty(); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>editor</strong></p>
<p><strong>editor&#x2F;Editor.java:</strong> 文字编辑器的 GUI</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.command.example.editor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.command.example.commands.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionEvent;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionListener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Editor</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> JTextArea textField;</span><br><span class="line">    <span class="keyword">public</span> String clipboard;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">CommandHistory</span> <span class="variable">history</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CommandHistory</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">JFrame</span> <span class="variable">frame</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JFrame</span>(<span class="string">&quot;Text editor (type &amp; use buttons, Luke!)&quot;</span>);</span><br><span class="line">        <span class="type">JPanel</span> <span class="variable">content</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JPanel</span>();</span><br><span class="line">        frame.setContentPane(content);</span><br><span class="line">        frame.setDefaultCloseOperation(WindowConstants.EXIT_ON_CLOSE);</span><br><span class="line">        content.setLayout(<span class="keyword">new</span> <span class="title class_">BoxLayout</span>(content, BoxLayout.Y_AXIS));</span><br><span class="line">        textField = <span class="keyword">new</span> <span class="title class_">JTextArea</span>();</span><br><span class="line">        textField.setLineWrap(<span class="literal">true</span>);</span><br><span class="line">        content.add(textField);</span><br><span class="line">        <span class="type">JPanel</span> <span class="variable">buttons</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JPanel</span>(<span class="keyword">new</span> <span class="title class_">FlowLayout</span>(FlowLayout.CENTER));</span><br><span class="line">        <span class="type">JButton</span> <span class="variable">ctrlC</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JButton</span>(<span class="string">&quot;Ctrl+C&quot;</span>);</span><br><span class="line">        <span class="type">JButton</span> <span class="variable">ctrlX</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JButton</span>(<span class="string">&quot;Ctrl+X&quot;</span>);</span><br><span class="line">        <span class="type">JButton</span> <span class="variable">ctrlV</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JButton</span>(<span class="string">&quot;Ctrl+V&quot;</span>);</span><br><span class="line">        <span class="type">JButton</span> <span class="variable">ctrlZ</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JButton</span>(<span class="string">&quot;Ctrl+Z&quot;</span>);</span><br><span class="line">        <span class="type">Editor</span> <span class="variable">editor</span> <span class="operator">=</span> <span class="built_in">this</span>;</span><br><span class="line">        ctrlC.addActionListener(<span class="keyword">new</span> <span class="title class_">ActionListener</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">actionPerformed</span><span class="params">(ActionEvent e)</span> &#123;</span><br><span class="line">                executeCommand(<span class="keyword">new</span> <span class="title class_">CopyCommand</span>(editor));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        ctrlX.addActionListener(<span class="keyword">new</span> <span class="title class_">ActionListener</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">actionPerformed</span><span class="params">(ActionEvent e)</span> &#123;</span><br><span class="line">                executeCommand(<span class="keyword">new</span> <span class="title class_">CutCommand</span>(editor));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        ctrlV.addActionListener(<span class="keyword">new</span> <span class="title class_">ActionListener</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">actionPerformed</span><span class="params">(ActionEvent e)</span> &#123;</span><br><span class="line">                executeCommand(<span class="keyword">new</span> <span class="title class_">PasteCommand</span>(editor));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        ctrlZ.addActionListener(<span class="keyword">new</span> <span class="title class_">ActionListener</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">actionPerformed</span><span class="params">(ActionEvent e)</span> &#123;</span><br><span class="line">                undo();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        buttons.add(ctrlC);</span><br><span class="line">        buttons.add(ctrlX);</span><br><span class="line">        buttons.add(ctrlV);</span><br><span class="line">        buttons.add(ctrlZ);</span><br><span class="line">        content.add(buttons);</span><br><span class="line">        frame.setSize(<span class="number">450</span>, <span class="number">200</span>);</span><br><span class="line">        frame.setLocationRelativeTo(<span class="literal">null</span>);</span><br><span class="line">        frame.setVisible(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">executeCommand</span><span class="params">(Command command)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (command.execute()) &#123;</span><br><span class="line">            history.push(command);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">undo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (history.isEmpty()) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">Command</span> <span class="variable">command</span> <span class="operator">=</span> history.pop();</span><br><span class="line">        <span class="keyword">if</span> (command != <span class="literal">null</span>) &#123;</span><br><span class="line">            command.undo();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Demo.java:</strong> 客户端代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.command.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.command.example.editor.Editor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Editor</span> <span class="variable">editor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Editor</span>();</span><br><span class="line">        editor.init();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>OutputDemo.png:</strong> 执行结果</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/blog/pattern/OutputDemo-commad.png"></p></div><div class="tab-item-content"><p><strong>在 PHP 中使用模式</strong></p>
<p><strong>复杂度：</strong> ★☆☆</p>
<p><strong>流行度：</strong> ★★★</p>
<p><strong>使用示例：</strong> 命令模式在 Java 代码中很常见。 它被用于对任务进行排序、 记录任务执行历史以及执行 “撤销” 操作。</p>
<p><strong>识别方法：</strong> 命令模式可以通过抽象或接口类型 （发送者） 中的行为方法来识别， 该类型调用另一个不同的抽象或接口类型 （接收者） 实现中的方法， 该实现则是在创建时由命令模式的实现封装。 命令类通常仅限于一些特殊行为。</p>
<div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">概念示例</button><button type="button" class="tab">真实世界示例</button></div><div class="tab-contents"><div class="tab-item-content active"><p><strong>概念示例</strong></p>
<p>本例说明了<strong>命令</strong>设计模式的结构并重点回答了下面的问题：</p>
<ul>
<li>它由哪些类组成？</li>
<li>这些类扮演了哪些角色？</li>
<li>模式中的各个元素会以何种方式相互关联？</li>
</ul>
<p>了解该模式的结构后， 你可以更容易地理解下面基于真实世界的 PHP 应用案例。</p>
<p><strong>index.php:</strong> 概念示例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">RefactoringGuru</span>\<span class="title class_">Command</span>\<span class="title class_">Conceptual</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Command interface declares a method for executing a command.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Command</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">execute</span>(<span class="params"></span>): <span class="title">void</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Some commands can implement simple operations on their own.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SimpleCommand</span> <span class="keyword">implements</span> <span class="title">Command</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$payload</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$payload</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;payload = <span class="variable">$payload</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">execute</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;SimpleCommand: See, I can do simple things like printing (&quot;</span> . <span class="variable language_">$this</span>-&gt;payload . <span class="string">&quot;)\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * However, some commands can delegate more complex operations to other objects,</span></span><br><span class="line"><span class="comment"> * called &quot;receivers.&quot;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ComplexCommand</span> <span class="keyword">implements</span> <span class="title">Command</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> Receiver</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$receiver</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Context data, required for launching the receiver&#x27;s methods.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$a</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$b</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Complex commands can accept one or several receiver objects along with</span></span><br><span class="line"><span class="comment">     * any context data via the constructor.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">Receiver <span class="variable">$receiver</span>, <span class="keyword">string</span> <span class="variable">$a</span>, <span class="keyword">string</span> <span class="variable">$b</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;receiver = <span class="variable">$receiver</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a = <span class="variable">$a</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;b = <span class="variable">$b</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Commands can delegate to any methods of a receiver.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">execute</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ComplexCommand: Complex stuff should be done by a receiver object.\n&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;receiver-&gt;<span class="title function_ invoke__">doSomething</span>(<span class="variable">$this</span>-&gt;a);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;receiver-&gt;<span class="title function_ invoke__">doSomethingElse</span>(<span class="variable">$this</span>-&gt;b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Receiver classes contain some important business logic. They know how to</span></span><br><span class="line"><span class="comment"> * perform all kinds of operations, associated with carrying out a request. In</span></span><br><span class="line"><span class="comment"> * fact, any class may serve as a Receiver.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Receiver</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">doSomething</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$a</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Receiver: Working on (&quot;</span> . <span class="variable">$a</span> . <span class="string">&quot;.)\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">doSomethingElse</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$b</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Receiver: Also working on (&quot;</span> . <span class="variable">$b</span> . <span class="string">&quot;.)\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Invoker is associated with one or several commands. It sends a request to</span></span><br><span class="line"><span class="comment"> * the command.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Invoker</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> Command</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$onStart</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> Command</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$onFinish</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Initialize commands.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setOnStart</span>(<span class="params">Command <span class="variable">$command</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;onStart = <span class="variable">$command</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setOnFinish</span>(<span class="params">Command <span class="variable">$command</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;onFinish = <span class="variable">$command</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The Invoker does not depend on concrete command or receiver classes. The</span></span><br><span class="line"><span class="comment">     * Invoker passes a request to a receiver indirectly, by executing a</span></span><br><span class="line"><span class="comment">     * command.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">doSomethingImportant</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Invoker: Does anybody want something done before I begin?\n&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;onStart <span class="keyword">instanceof</span> Command) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;onStart-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Invoker: ...doing something really important...\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Invoker: Does anybody want something done after I finish?\n&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;onFinish <span class="keyword">instanceof</span> Command) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;onFinish-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The client code can parameterize an invoker with any commands.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="variable">$invoker</span> = <span class="keyword">new</span> <span class="title class_">Invoker</span>();</span><br><span class="line"><span class="variable">$invoker</span>-&gt;<span class="title function_ invoke__">setOnStart</span>(<span class="keyword">new</span> <span class="title class_">SimpleCommand</span>(<span class="string">&quot;Say Hi!&quot;</span>));</span><br><span class="line"><span class="variable">$receiver</span> = <span class="keyword">new</span> <span class="title class_">Receiver</span>();</span><br><span class="line"><span class="variable">$invoker</span>-&gt;<span class="title function_ invoke__">setOnFinish</span>(<span class="keyword">new</span> <span class="title class_">ComplexCommand</span>(<span class="variable">$receiver</span>, <span class="string">&quot;Send email&quot;</span>, <span class="string">&quot;Save report&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="variable">$invoker</span>-&gt;<span class="title function_ invoke__">doSomethingImportant</span>();</span><br></pre></td></tr></table></figure>

<p><strong>Output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Invoker: Does anybody want something done before I begin?</span><br><span class="line">SimpleCommand: See, I can do simple things like printing (Say Hi!)</span><br><span class="line">Invoker: ...doing something really important...</span><br><span class="line">Invoker: Does anybody want something done after I finish?</span><br><span class="line">ComplexCommand: Complex stuff should be done by a receiver object.</span><br><span class="line">Receiver: Working on (Send email.)</span><br><span class="line">Receiver: Also working on (Save report.)</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><strong>真实世界示例</strong></p>
<p>在本例中， <strong>命令</strong>模式被用于对 IMDB 网站的网页抓取操作进行排序， 使它们能依次执行。 队列本身保存在数据库中， 这有助于在脚本运行时保存命令。</p>
<p><strong>index.php:</strong> 真实世界示例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">RefactoringGuru</span>\<span class="title class_">Command</span>\<span class="title class_">RealWorld</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Command interface declares the main execution method as well as several</span></span><br><span class="line"><span class="comment"> * helper methods for retrieving a command&#x27;s metadata.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Command</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">execute</span>(<span class="params"></span>): <span class="title">void</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getId</span>(<span class="params"></span>): <span class="title">int</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getStatus</span>(<span class="params"></span>): <span class="title">int</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The base web scraping Command defines the basic downloading infrastructure,</span></span><br><span class="line"><span class="comment"> * common to all concrete web scraping commands.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">WebScrapingCommand</span> <span class="keyword">implements</span> <span class="title">Command</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$id</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$status</span> = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> string URL for scraping.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$url</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$url</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;url = <span class="variable">$url</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getId</span>(<span class="params"></span>): <span class="title">int</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getStatus</span>(<span class="params"></span>): <span class="title">int</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getURL</span>(<span class="params"></span>): <span class="title">string</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Since the execution methods for all web scraping commands are very</span></span><br><span class="line"><span class="comment">     * similar, we can provide a default implementation and let subclasses</span></span><br><span class="line"><span class="comment">     * override them if needed.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Psst! An observant reader may spot another behavioral pattern in action</span></span><br><span class="line"><span class="comment">     * here.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">execute</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$html</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">download</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">parse</span>(<span class="variable">$html</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">complete</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">download</span>(<span class="params"></span>): <span class="title">string</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$html</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">getURL</span>());</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;WebScrapingCommand: Downloaded <span class="subst">&#123;$this-&gt;url&#125;</span>\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$html</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">parse</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$html</span></span>): <span class="title">void</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">complete</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;status = <span class="number">1</span>;</span><br><span class="line">        <span class="title class_">Queue</span>::<span class="title function_ invoke__">get</span>()-&gt;<span class="title function_ invoke__">completeCommand</span>(<span class="variable">$this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Concrete Command for scraping the list of movie genres.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IMDBGenresScrapingCommand</span> <span class="keyword">extends</span> <span class="title">WebScrapingCommand</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;url = <span class="string">&quot;https://www.imdb.com/feature/genre/&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Extract all genres and their search URLs from the page:</span></span><br><span class="line"><span class="comment">     * https://www.imdb.com/feature/genre/</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">parse</span>(<span class="params"><span class="variable">$html</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">preg_match_all</span>(<span class="string">&quot;|href=\&quot;(https://www.imdb.com/search/title\?genres=.*?)\&quot;|&quot;</span>, <span class="variable">$html</span>, <span class="variable">$matches</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;IMDBGenresScrapingCommand: Discovered &quot;</span> . <span class="title function_ invoke__">count</span>(<span class="variable">$matches</span>[<span class="number">1</span>]) . <span class="string">&quot; genres.\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$matches</span>[<span class="number">1</span>] <span class="keyword">as</span> <span class="variable">$genre</span>) &#123;</span><br><span class="line">            <span class="title class_">Queue</span>::<span class="title function_ invoke__">get</span>()-&gt;<span class="title function_ invoke__">add</span>(<span class="keyword">new</span> <span class="title class_">IMDBGenrePageScrapingCommand</span>(<span class="variable">$genre</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Concrete Command for scraping the list of movies in a specific genre.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IMDBGenrePageScrapingCommand</span> <span class="keyword">extends</span> <span class="title">WebScrapingCommand</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$page</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$url</span>, <span class="keyword">int</span> <span class="variable">$page</span> = <span class="number">1</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">parent</span>::<span class="title function_ invoke__">__construct</span>(<span class="variable">$url</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;page = <span class="variable">$page</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getURL</span>(<span class="params"></span>): <span class="title">string</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;url . <span class="string">&#x27;?page=&#x27;</span> . <span class="variable language_">$this</span>-&gt;page;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Extract all movies from a page like this:</span></span><br><span class="line"><span class="comment">     * https://www.imdb.com/search/title?genres=sci-fi&amp;explore=title_type,genres</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">parse</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$html</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">preg_match_all</span>(<span class="string">&quot;|href=\&quot;(/title/.*?/)\?ref_=adv_li_tt\&quot;|&quot;</span>, <span class="variable">$html</span>, <span class="variable">$matches</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;IMDBGenrePageScrapingCommand: Discovered &quot;</span> . <span class="title function_ invoke__">count</span>(<span class="variable">$matches</span>[<span class="number">1</span>]) . <span class="string">&quot; movies.\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$matches</span>[<span class="number">1</span>] <span class="keyword">as</span> <span class="variable">$moviePath</span>) &#123;</span><br><span class="line">            <span class="variable">$url</span> = <span class="string">&quot;https://www.imdb.com&quot;</span> . <span class="variable">$moviePath</span>;</span><br><span class="line">            <span class="title class_">Queue</span>::<span class="title function_ invoke__">get</span>()-&gt;<span class="title function_ invoke__">add</span>(<span class="keyword">new</span> <span class="title class_">IMDBMovieScrapingCommand</span>(<span class="variable">$url</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Parse the next page URL.</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;|Next &amp;#187;&lt;/a&gt;|&quot;</span>, <span class="variable">$html</span>)) &#123;</span><br><span class="line">            <span class="title class_">Queue</span>::<span class="title function_ invoke__">get</span>()-&gt;<span class="title function_ invoke__">add</span>(<span class="keyword">new</span> <span class="title class_">IMDBGenrePageScrapingCommand</span>(<span class="variable">$this</span>-&gt;url, <span class="variable">$this</span>-&gt;page + <span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Concrete Command for scraping the movie details.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IMDBMovieScrapingCommand</span> <span class="keyword">extends</span> <span class="title">WebScrapingCommand</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Get the movie info from a page like this:</span></span><br><span class="line"><span class="comment">     * https://www.imdb.com/title/tt4154756/</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">parse</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$html</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;|&lt;h1 itemprop=\&quot;name\&quot; class=\&quot;\&quot;&gt;(.*?)&lt;/h1&gt;|&quot;</span>, <span class="variable">$html</span>, <span class="variable">$matches</span>)) &#123;</span><br><span class="line">            <span class="variable">$title</span> = <span class="variable">$matches</span>[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;IMDBMovieScrapingCommand: Parsed movie <span class="subst">$title</span>.\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Queue class acts as an Invoker. It stacks the command objects and</span></span><br><span class="line"><span class="comment"> * executes them one by one. If the script execution is suddenly terminated, the</span></span><br><span class="line"><span class="comment"> * queue and all its commands can easily be restored, and you won&#x27;t need to</span></span><br><span class="line"><span class="comment"> * repeat all of the executed commands.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Note that this is a very primitive implementation of the command queue, which</span></span><br><span class="line"><span class="comment"> * stores commands in a local SQLite database. There are dozens of robust queue</span></span><br><span class="line"><span class="comment"> * solution available for use in real apps.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Queue</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$db</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;db = <span class="keyword">new</span> <span class="title class_">\SQLite3</span>(<span class="keyword">__DIR__</span> . <span class="string">&#x27;/commands.sqlite&#x27;</span>,</span><br><span class="line">            SQLITE3_OPEN_CREATE | SQLITE3_OPEN_READWRITE);</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">query</span>(<span class="string">&#x27;CREATE TABLE IF NOT EXISTS &quot;commands&quot; (</span></span><br><span class="line"><span class="string">            &quot;id&quot; INTEGER PRIMARY KEY AUTO_INCREMENT NOT NULL,</span></span><br><span class="line"><span class="string">            &quot;command&quot; TEXT,</span></span><br><span class="line"><span class="string">            &quot;status&quot; INTEGER</span></span><br><span class="line"><span class="string">        )&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isEmpty</span>(<span class="params"></span>): <span class="title">bool</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$query</span> = <span class="string">&#x27;SELECT COUNT(&quot;id&quot;) FROM &quot;commands&quot; WHERE status = 0&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">querySingle</span>(<span class="variable">$query</span>) === <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">Command <span class="variable">$command</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$query</span> = <span class="string">&#x27;INSERT INTO commands (command, status) VALUES (:command, :status)&#x27;</span>;</span><br><span class="line">        <span class="variable">$statement</span> = <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">prepare</span>(<span class="variable">$query</span>);</span><br><span class="line">        <span class="variable">$statement</span>-&gt;<span class="title function_ invoke__">bindValue</span>(<span class="string">&#x27;:command&#x27;</span>, <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$command</span>)));</span><br><span class="line">        <span class="variable">$statement</span>-&gt;<span class="title function_ invoke__">bindValue</span>(<span class="string">&#x27;:status&#x27;</span>, <span class="variable">$command</span>-&gt;<span class="title function_ invoke__">getStatus</span>());</span><br><span class="line">        <span class="variable">$statement</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getCommand</span>(<span class="params"></span>): <span class="title">Command</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$query</span> = <span class="string">&#x27;SELECT * FROM &quot;commands&quot; WHERE &quot;status&quot; = 0 LIMIT 1&#x27;</span>;</span><br><span class="line">        <span class="variable">$record</span> = <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">querySingle</span>(<span class="variable">$query</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="variable">$command</span> = <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$record</span>[<span class="string">&quot;command&quot;</span>]));</span><br><span class="line">        <span class="variable">$command</span>-&gt;id = <span class="variable">$record</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$command</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">completeCommand</span>(<span class="params">Command <span class="variable">$command</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$query</span> = <span class="string">&#x27;UPDATE commands SET status = :status WHERE id = :id&#x27;</span>;</span><br><span class="line">        <span class="variable">$statement</span> = <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">prepare</span>(<span class="variable">$query</span>);</span><br><span class="line">        <span class="variable">$statement</span>-&gt;<span class="title function_ invoke__">bindValue</span>(<span class="string">&#x27;:status&#x27;</span>, <span class="variable">$command</span>-&gt;<span class="title function_ invoke__">getStatus</span>());</span><br><span class="line">        <span class="variable">$statement</span>-&gt;<span class="title function_ invoke__">bindValue</span>(<span class="string">&#x27;:id&#x27;</span>, <span class="variable">$command</span>-&gt;<span class="title function_ invoke__">getId</span>());</span><br><span class="line">        <span class="variable">$statement</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">work</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (!<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">isEmpty</span>()) &#123;</span><br><span class="line">            <span class="variable">$command</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getCommand</span>();</span><br><span class="line">            <span class="variable">$command</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * For our convenience, the Queue object is a Singleton.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"></span>): <span class="title">Queue</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">static</span> <span class="variable">$instance</span>;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable">$instance</span>) &#123;</span><br><span class="line">            <span class="variable">$instance</span> = <span class="keyword">new</span> <span class="title class_">Queue</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$instance</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The client code.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$queue</span> = <span class="title class_">Queue</span>::<span class="title function_ invoke__">get</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$queue</span>-&gt;<span class="title function_ invoke__">isEmpty</span>()) &#123;</span><br><span class="line">    <span class="variable">$queue</span>-&gt;<span class="title function_ invoke__">add</span>(<span class="keyword">new</span> <span class="title class_">IMDBGenresScrapingCommand</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$queue</span>-&gt;<span class="title function_ invoke__">work</span>();</span><br></pre></td></tr></table></figure>

<p><strong>Output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">WebScrapingCommand: Downloaded https://www.imdb.com/feature/genre/</span><br><span class="line">IMDBGenresScrapingCommand: Discovered 14 genres.</span><br><span class="line">WebScrapingCommand: Downloaded https://www.imdb.com/search/title?genres=comedy</span><br><span class="line">IMDBGenrePageScrapingCommand: Discovered 50 movies.</span><br><span class="line">WebScrapingCommand: Downloaded https://www.imdb.com/search/title?genres=sci-fi</span><br><span class="line">IMDBGenrePageScrapingCommand: Discovered 50 movies.</span><br><span class="line">WebScrapingCommand: Downloaded https://www.imdb.com/search/title?genres=horror</span><br><span class="line">IMDBGenrePageScrapingCommand: Discovered 50 movies.</span><br><span class="line">WebScrapingCommand: Downloaded https://www.imdb.com/search/title?genres=romance</span><br><span class="line">IMDBGenrePageScrapingCommand: Discovered 50 movies.</span><br><span class="line">...</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><div class="tab-item-content"><p><strong>在 Python 中使用模式</strong></p>
<p><strong>复杂度：</strong> ★☆☆</p>
<p><strong>流行度：</strong> ★★★</p>
<p><strong>使用示例：</strong> 命令模式在 Python 代码中很常见。 大部分情况下， 它被用于代替包含行为的参数化 UI 元素的回调函数， 此外还被用于对任务进行排序和记录操作历史记录等。</p>
<p><strong>识别方法：</strong> 命令模式可以通过抽象或接口类型 （发送者） 中的行为方法来识别， 该类型调用另一个不同的抽象或接口类型 （接收者） 实现中的方法， 该实现则是在创建时由命令模式的实现封装。 命令类通常仅限于一些特殊行为。</p>
<p><strong>概念示例</strong></p>
<p>本例说明了<strong>命令</strong>设计模式的结构并重点回答了下面的问题：</p>
<ul>
<li>它由哪些类组成？</li>
<li>这些类扮演了哪些角色？</li>
<li>模式中的各个元素会以何种方式相互关联？</li>
</ul>
<p><strong>main.py:</strong> 概念示例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> annotations</span><br><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Command</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Command interface declares a method for executing a command.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleCommand</span>(<span class="title class_ inherited__">Command</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Some commands can implement simple operations on their own.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, payload: <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self._payload = payload</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;SimpleCommand: See, I can do simple things like printing&quot;</span></span><br><span class="line">              <span class="string">f&quot;(<span class="subst">&#123;self._payload&#125;</span>)&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ComplexCommand</span>(<span class="title class_ inherited__">Command</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    However, some commands can delegate more complex operations to other</span></span><br><span class="line"><span class="string">    objects, called &quot;receivers.&quot;</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, receiver: Receiver, a: <span class="built_in">str</span>, b: <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Complex commands can accept one or several receiver objects along with</span></span><br><span class="line"><span class="string">        any context data via the constructor.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        self._receiver = receiver</span><br><span class="line">        self._a = a</span><br><span class="line">        self._b = b</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Commands can delegate to any methods of a receiver.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ComplexCommand: Complex stuff should be done by a receiver object&quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        self._receiver.do_something(self._a)</span><br><span class="line">        self._receiver.do_something_else(self._b)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Receiver</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Receiver classes contain some important business logic. They know how to</span></span><br><span class="line"><span class="string">    perform all kinds of operations, associated with carrying out a request. In</span></span><br><span class="line"><span class="string">    fact, any class may serve as a Receiver.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">do_something</span>(<span class="params">self, a: <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\nReceiver: Working on (<span class="subst">&#123;a&#125;</span>.)&quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">do_something_else</span>(<span class="params">self, b: <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\nReceiver: Also working on (<span class="subst">&#123;b&#125;</span>.)&quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Invoker</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Invoker is associated with one or several commands. It sends a request</span></span><br><span class="line"><span class="string">    to the command.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    _on_start = <span class="literal">None</span></span><br><span class="line">    _on_finish = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Initialize commands.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_on_start</span>(<span class="params">self, command: Command</span>):</span><br><span class="line">        self._on_start = command</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_on_finish</span>(<span class="params">self, command: Command</span>):</span><br><span class="line">        self._on_finish = command</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">do_something_important</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        The Invoker does not depend on concrete command or receiver classes. The</span></span><br><span class="line"><span class="string">        Invoker passes a request to a receiver indirectly, by executing a</span></span><br><span class="line"><span class="string">        command.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Invoker: Does anybody want something done before I begin?&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(self._on_start, Command):</span><br><span class="line">            self._on_start.execute()</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Invoker: ...doing something really important...&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Invoker: Does anybody want something done after I finish?&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(self._on_finish, Command):</span><br><span class="line">            self._on_finish.execute()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The client code can parameterize an invoker with any commands.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    invoker = Invoker()</span><br><span class="line">    invoker.set_on_start(SimpleCommand(<span class="string">&quot;Say Hi!&quot;</span>))</span><br><span class="line">    receiver = Receiver()</span><br><span class="line">    invoker.set_on_finish(ComplexCommand(</span><br><span class="line">        receiver, <span class="string">&quot;Send email&quot;</span>, <span class="string">&quot;Save report&quot;</span>))</span><br><span class="line"></span><br><span class="line">    invoker.do_something_important()</span><br></pre></td></tr></table></figure>

<p><strong>Output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Invoker: Does anybody want something done before I begin?</span><br><span class="line">SimpleCommand: See, I can do simple things like printing (Say Hi!)</span><br><span class="line">Invoker: ...doing something really important...</span><br><span class="line">Invoker: Does anybody want something done after I finish?</span><br><span class="line">ComplexCommand: Complex stuff should be done by a receiver object</span><br><span class="line">Receiver: Working on (Send email.)</span><br><span class="line">Receiver: Also working on (Save report.)</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><strong>在 Ruby 中使用模式</strong></p>
<p><strong>复杂度：</strong> ★☆☆</p>
<p><strong>流行度：</strong> ★★★</p>
<p><strong>使用示例：</strong> 命令模式在 Ruby 代码中很常见。 大部分情况下， 它被用于代替包含行为的参数化 UI 元素的回调函数， 此外还被用于对任务进行排序和记录操作历史记录等。</p>
<p><strong>识别方法：</strong> 命令模式可以通过抽象或接口类型 （发送者） 中的行为方法来识别， 该类型调用另一个不同的抽象或接口类型 （接收者） 实现中的方法， 该实现则是在创建时由命令模式的实现封装。 命令类通常仅限于一些特殊行为。</p>
<p><strong>概念示例</strong></p>
<p>本例说明了<strong>命令</strong>设计模式的结构并重点回答了下面的问题：</p>
<ul>
<li>它由哪些类组成？</li>
<li>这些类扮演了哪些角色？</li>
<li>模式中的各个元素会以何种方式相互关联？</li>
</ul>
<p><strong>main.rb:</strong> 概念示例</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The Command interface declares a method for executing a command.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Command</span></span><br><span class="line">  <span class="comment"># <span class="doctag">@abstract</span></span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">execute</span></span><br><span class="line">    raise NotImplementedError, <span class="string">&quot;<span class="subst">#&#123;<span class="variable language_">self</span>.<span class="keyword">class</span>&#125;</span> has not implemented method &#x27;<span class="subst">#&#123;__method__&#125;</span>&#x27;&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Some commands can implement simple operations on their own.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleCommand</span> &lt; <span class="title class_ inherited__">Command</span></span><br><span class="line">  <span class="comment"># <span class="doctag">@param</span> [String] payload</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">initialize</span>(<span class="params">payload</span>)</span><br><span class="line">    <span class="variable">@payload</span> = payload</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">execute</span></span><br><span class="line">    puts <span class="string">&quot;SimpleCommand: See, I can do simple things like printing (<span class="subst">#&#123;<span class="variable">@payload</span>&#125;</span>)&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># However, some commands can delegate more complex operations to other objects,</span></span><br><span class="line"><span class="comment"># called &quot;receivers&quot;.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ComplexCommand</span> &lt; <span class="title class_ inherited__">Command</span></span><br><span class="line">  <span class="comment"># Complex commands can accept one or several receiver objects along with any</span></span><br><span class="line">  <span class="comment"># context data via the constructor.</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">initialize</span>(<span class="params">receiver, a, b</span>)</span><br><span class="line">    <span class="variable">@receiver</span> = receiver</span><br><span class="line">    <span class="variable">@a</span> = a</span><br><span class="line">    <span class="variable">@b</span> = b</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Commands can delegate to any methods of a receiver.</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">execute</span></span><br><span class="line">    print <span class="string">&#x27;ComplexCommand: Complex stuff should be done by a receiver object&#x27;</span></span><br><span class="line">    <span class="variable">@receiver</span>.do_something(<span class="variable">@a</span>)</span><br><span class="line">    <span class="variable">@receiver</span>.do_something_else(<span class="variable">@b</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The Receiver classes contain some important business logic. They know how to</span></span><br><span class="line"><span class="comment"># perform all kinds of operations, associated with carrying out a request. In</span></span><br><span class="line"><span class="comment"># fact, any class may serve as a Receiver.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Receiver</span></span><br><span class="line">  <span class="comment"># <span class="doctag">@param</span> [String] a</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">do_something</span>(<span class="params">a</span>)</span><br><span class="line">    print <span class="string">&quot;\nReceiver: Working on (<span class="subst">#&#123;a&#125;</span>.)&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># <span class="doctag">@param</span> [String] b</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">do_something_else</span>(<span class="params">b</span>)</span><br><span class="line">    print <span class="string">&quot;\nReceiver: Also working on (<span class="subst">#&#123;b&#125;</span>.)&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The Invoker is associated with one or several commands. It sends a request to</span></span><br><span class="line"><span class="comment"># the command.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Invoker</span></span><br><span class="line">  <span class="comment"># Initialize commands.</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># <span class="doctag">@param</span> [Command] command</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">on_start=</span>(<span class="params">command</span>)</span><br><span class="line">    <span class="variable">@on_start</span> = command</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># <span class="doctag">@param</span> [Command] command</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">on_finish=</span>(<span class="params">command</span>)</span><br><span class="line">    <span class="variable">@on_finish</span> = command</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># The Invoker does not depend on concrete command or receiver classes. The</span></span><br><span class="line">  <span class="comment"># Invoker passes a request to a receiver indirectly, by executing a command.</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">do_something_important</span></span><br><span class="line">    puts <span class="string">&#x27;Invoker: Does anybody want something done before I begin?&#x27;</span></span><br><span class="line">    <span class="variable">@on_start</span>.execute <span class="keyword">if</span> <span class="variable">@on_start</span>.is_a? Command</span><br><span class="line"></span><br><span class="line">    puts <span class="string">&#x27;Invoker: ...doing something really important...&#x27;</span></span><br><span class="line"></span><br><span class="line">    puts <span class="string">&#x27;Invoker: Does anybody want something done after I finish?&#x27;</span></span><br><span class="line">    <span class="variable">@on_finish</span>.execute <span class="keyword">if</span> <span class="variable">@on_finish</span>.is_a? Command</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The client code can parameterize an invoker with any commands.</span></span><br><span class="line">invoker = Invoker.new</span><br><span class="line">invoker.on_start = <span class="title class_">SimpleCommand</span>.new(<span class="string">&#x27;Say Hi!&#x27;</span>)</span><br><span class="line">receiver = Receiver.new</span><br><span class="line">invoker.on_finish = <span class="title class_">ComplexCommand</span>.new(receiver, <span class="string">&#x27;Send email&#x27;</span>, <span class="string">&#x27;Save report&#x27;</span>)</span><br><span class="line"></span><br><span class="line">invoker.do_something_important</span><br></pre></td></tr></table></figure>

<p><strong>output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Invoker: Does anybody want something done before I begin?</span><br><span class="line">SimpleCommand: See, I can do simple things like printing (Say Hi!)</span><br><span class="line">Invoker: ...doing something really important...</span><br><span class="line">Invoker: Does anybody want something done after I finish?</span><br><span class="line">ComplexCommand: Complex stuff should be done by a receiver object</span><br><span class="line">Receiver: Working on (Send email.)</span><br><span class="line">Receiver: Also working on (Save report.)</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><strong>在 Swift 中使用模式</strong></p>
<p><strong>复杂度：</strong> ★☆☆</p>
<p><strong>流行度：</strong> ★★★</p>
<p><strong>使用示例：</strong> 命令模式在 Swift 代码中很常见。 大部分情况下， 它被用于代替包含行为的参数化 UI 元素的回调函数， 此外还被用于对任务进行排序和记录操作历史记录等。</p>
<p><strong>识别方法：</strong> 命令模式可以通过抽象或接口类型 （发送者） 中的行为方法来识别， 该类型调用另一个不同的抽象或接口类型 （接收者） 实现中的方法， 该实现则是在创建时由命令模式的实现封装。 命令类通常仅限于一些特殊行为。</p>
<div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">概念示例</button><button type="button" class="tab">真实世界示例</button></div><div class="tab-contents"><div class="tab-item-content active"><p><strong>概念示例</strong></p>
<p>本例说明了<strong>命令</strong>设计模式的结构并重点回答了下面的问题：</p>
<ul>
<li>它由哪些类组成？</li>
<li>这些类扮演了哪些角色？</li>
<li>模式中的各个元素会以何种方式相互关联？</li>
</ul>
<p>了解该模式的结构后， 你可以更容易地理解下面基于真实世界的 Swift 应用案例。</p>
<p><strong>Example.swift:</strong> 概念示例</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> XCTest</span><br><span class="line"></span><br><span class="line"><span class="comment">/// The Command interface declares a method for executing a command.</span></span><br><span class="line"><span class="keyword">protocol</span> <span class="title class_">Command</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">execute</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Some commands can implement simple operations on their own.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleCommand</span>: <span class="title class_">Command</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> payload: <span class="type">String</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">payload</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.payload <span class="operator">=</span> payload</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">execute</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;SimpleCommand: See, I can do simple things like printing (&quot;</span> <span class="operator">+</span> payload <span class="operator">+</span> <span class="string">&quot;)&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// However, some commands can delegate more complex operations to other</span></span><br><span class="line"><span class="comment">/// objects, called &quot;receivers.&quot;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ComplexCommand</span>: <span class="title class_">Command</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> receiver: <span class="type">Receiver</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Context data, required for launching the receiver&#x27;s methods.</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> a: <span class="type">String</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> b: <span class="type">String</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Complex commands can accept one or several receiver objects along with</span></span><br><span class="line">    <span class="comment">/// any context data via the constructor.</span></span><br><span class="line">    <span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">receiver</span>: <span class="type">Receiver</span>, <span class="keyword">_</span> <span class="params">a</span>: <span class="type">String</span>, <span class="keyword">_</span> <span class="params">b</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.receiver <span class="operator">=</span> receiver</span><br><span class="line">        <span class="keyword">self</span>.a <span class="operator">=</span> a</span><br><span class="line">        <span class="keyword">self</span>.b <span class="operator">=</span> b</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Commands can delegate to any methods of a receiver.</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">execute</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ComplexCommand: Complex stuff should be done by a receiver object.<span class="subst">\n</span>&quot;</span>)</span><br><span class="line">        receiver.doSomething(a)</span><br><span class="line">        receiver.doSomethingElse(b)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// The Receiver classes contain some important business logic. They know how to</span></span><br><span class="line"><span class="comment">/// perform all kinds of operations, associated with carrying out a request. In</span></span><br><span class="line"><span class="comment">/// fact, any class may serve as a Receiver.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Receiver</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">doSomething</span>(<span class="keyword">_</span> <span class="params">a</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Receiver: Working on (&quot;</span> <span class="operator">+</span> a <span class="operator">+</span> <span class="string">&quot;)<span class="subst">\n</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">doSomethingElse</span>(<span class="keyword">_</span> <span class="params">b</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Receiver: Also working on (&quot;</span> <span class="operator">+</span> b <span class="operator">+</span> <span class="string">&quot;)<span class="subst">\n</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// The Invoker is associated with one or several commands. It sends a request</span></span><br><span class="line"><span class="comment">/// to the command.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Invoker</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> onStart: <span class="type">Command</span>?</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> onFinish: <span class="type">Command</span>?</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Initialize commands.</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">setOnStart</span>(<span class="keyword">_</span> <span class="params">command</span>: <span class="type">Command</span>) &#123;</span><br><span class="line">        onStart <span class="operator">=</span> command</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">setOnFinish</span>(<span class="keyword">_</span> <span class="params">command</span>: <span class="type">Command</span>) &#123;</span><br><span class="line">        onFinish <span class="operator">=</span> command</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// The Invoker does not depend on concrete command or receiver classes. The</span></span><br><span class="line">    <span class="comment">/// Invoker passes a request to a receiver indirectly, by executing a</span></span><br><span class="line">    <span class="comment">/// command.</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">doSomethingImportant</span>() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Invoker: Does anybody want something done before I begin?&quot;</span>)</span><br><span class="line"></span><br><span class="line">        onStart<span class="operator">?</span>.execute()</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Invoker: ...doing something really important...&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Invoker: Does anybody want something done after I finish?&quot;</span>)</span><br><span class="line"></span><br><span class="line">        onFinish<span class="operator">?</span>.execute()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Let&#x27;s see how it all comes together.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CommandConceptual</span>: <span class="title class_">XCTestCase</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">test</span>() &#123;</span><br><span class="line">        <span class="comment">/// The client code can parameterize an invoker with any commands.</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> invoker <span class="operator">=</span> <span class="type">Invoker</span>()</span><br><span class="line">        invoker.setOnStart(<span class="type">SimpleCommand</span>(<span class="string">&quot;Say Hi!&quot;</span>))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> receiver <span class="operator">=</span> <span class="type">Receiver</span>()</span><br><span class="line">        invoker.setOnFinish(<span class="type">ComplexCommand</span>(receiver, <span class="string">&quot;Send email&quot;</span>, <span class="string">&quot;Save report&quot;</span>))</span><br><span class="line">        invoker.doSomethingImportant()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Invoker: Does anybody want something done before I begin?</span><br><span class="line">SimpleCommand: See, I can do simple things like printing (Say Hi!)</span><br><span class="line">Invoker: ...doing something really important...</span><br><span class="line">Invoker: Does anybody want something done after I finish?</span><br><span class="line">ComplexCommand: Complex stuff should be done by a receiver object.</span><br><span class="line"></span><br><span class="line">Receiver: Working on (Send email)</span><br><span class="line"></span><br><span class="line">Receiver: Also working on (Save report)</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><strong>真实世界示例</strong></p>
<p><strong>Example.swift:</strong> 真实世界示例</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"><span class="keyword">import</span> XCTest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DelayedOperation</span>: <span class="title class_">Operation</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> delay: <span class="type">TimeInterval</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">delay</span>: <span class="type">TimeInterval</span> <span class="operator">=</span> <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.delay <span class="operator">=</span> delay</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> isExecuting : <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123; <span class="keyword">return</span> _executing &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            willChangeValue(forKey: <span class="string">&quot;isExecuting&quot;</span>)</span><br><span class="line">            _executing <span class="operator">=</span> newValue</span><br><span class="line">            didChangeValue(forKey: <span class="string">&quot;isExecuting&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> _executing : <span class="type">Bool</span> <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> isFinished : <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123; <span class="keyword">return</span> _finished &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            willChangeValue(forKey: <span class="string">&quot;isFinished&quot;</span>)</span><br><span class="line">            _finished <span class="operator">=</span> newValue</span><br><span class="line">            didChangeValue(forKey: <span class="string">&quot;isFinished&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> _finished : <span class="type">Bool</span> <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">start</span>() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">guard</span> delay <span class="operator">&gt;</span> <span class="number">0</span> <span class="keyword">else</span> &#123;</span><br><span class="line">            _start()</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> deadline <span class="operator">=</span> <span class="type">DispatchTime</span>.now() <span class="operator">+</span> delay</span><br><span class="line">        <span class="type">DispatchQueue</span>(label: <span class="string">&quot;&quot;</span>).asyncAfter(deadline: deadline) &#123;</span><br><span class="line">            <span class="keyword">self</span>._start()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">_start</span>() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">guard</span> <span class="operator">!</span><span class="keyword">self</span>.isCancelled <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(<span class="keyword">self</span>)</span>: operation is canceled&quot;</span>)</span><br><span class="line">            <span class="keyword">self</span>.isFinished <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">self</span>.isExecuting <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">        <span class="keyword">self</span>.main()</span><br><span class="line">        <span class="keyword">self</span>.isExecuting <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">        <span class="keyword">self</span>.isFinished <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WindowOperation</span>: <span class="title class_">DelayedOperation</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(<span class="keyword">self</span>)</span>: Windows are closed via HomeKit.&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> description: <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="string">&quot;WindowOperation&quot;</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DoorOperation</span>: <span class="title class_">DelayedOperation</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(<span class="keyword">self</span>)</span>: Doors are closed via HomeKit.&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> description: <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="string">&quot;DoorOperation&quot;</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TaxiOperation</span>: <span class="title class_">DelayedOperation</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(<span class="keyword">self</span>)</span>: Taxi is ordered via Uber&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> description: <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="string">&quot;TaxiOperation&quot;</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CommandRealWorld</span>: <span class="title class_">XCTestCase</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">testCommandRealWorld</span>() &#123;</span><br><span class="line">        prepareTestEnvironment &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">let</span> siri <span class="operator">=</span> <span class="type">SiriShortcuts</span>.shared</span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;User: Hey Siri, I am leaving my home&quot;</span>)</span><br><span class="line">            siri.perform(.leaveHome)</span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;User: Hey Siri, I am leaving my work in 3 minutes&quot;</span>)</span><br><span class="line">            siri.perform(.leaveWork, delay: <span class="number">3</span>) <span class="comment">/// for simplicity, we use seconds</span></span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;User: Hey Siri, I am still working&quot;</span>)</span><br><span class="line">            siri.cancel(.leaveWork)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">CommandRealWorld</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">ExecutionTime</span> &#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">let</span> max: <span class="type">TimeInterval</span> <span class="operator">=</span> <span class="number">5</span></span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">let</span> waiting: <span class="type">TimeInterval</span> <span class="operator">=</span> <span class="number">4</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">prepareTestEnvironment</span>(<span class="keyword">_</span> <span class="params">execution</span>: () -&gt; ()) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/// This method tells Xcode to wait for async operations. Otherwise the</span></span><br><span class="line">        <span class="comment">/// main test is done immediately.</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> expectation <span class="operator">=</span> <span class="keyword">self</span>.expectation(description: <span class="string">&quot;Expectation for async operations&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> deadline <span class="operator">=</span> <span class="type">DispatchTime</span>.now() <span class="operator">+</span> <span class="type">ExecutionTime</span>.waiting</span><br><span class="line">        <span class="type">DispatchQueue</span>.main.asyncAfter(deadline: deadline) &#123; expectation.fulfill() &#125;</span><br><span class="line"></span><br><span class="line">        execution()</span><br><span class="line"></span><br><span class="line">        wait(for: [expectation], timeout: <span class="type">ExecutionTime</span>.max)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SiriShortcuts</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">let</span> shared <span class="operator">=</span> <span class="type">SiriShortcuts</span>()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">var</span> queue <span class="operator">=</span> <span class="type">OperationQueue</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">init</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">enum</span> <span class="title class_">Action</span>: <span class="title class_">String</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> leaveHome</span><br><span class="line">        <span class="keyword">case</span> leaveWork</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">perform</span>(<span class="keyword">_</span> <span class="params">action</span>: <span class="type">Action</span>, <span class="params">delay</span>: <span class="type">TimeInterval</span> <span class="operator">=</span> <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Siri: performing <span class="subst">\(action)</span>-action<span class="subst">\n</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">switch</span> action &#123;</span><br><span class="line">        <span class="keyword">case</span> .leaveHome:</span><br><span class="line">            add(operation: <span class="type">WindowOperation</span>(delay))</span><br><span class="line">            add(operation: <span class="type">DoorOperation</span>(delay))</span><br><span class="line">        <span class="keyword">case</span> .leaveWork:</span><br><span class="line">            add(operation: <span class="type">TaxiOperation</span>(delay))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">cancel</span>(<span class="keyword">_</span> <span class="params">action</span>: <span class="type">Action</span>) &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Siri: canceling <span class="subst">\(action)</span>-action<span class="subst">\n</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">switch</span> action &#123;</span><br><span class="line">        <span class="keyword">case</span> .leaveHome:</span><br><span class="line">            cancelOperation(with: <span class="type">WindowOperation</span>.<span class="keyword">self</span>)</span><br><span class="line">            cancelOperation(with: <span class="type">DoorOperation</span>.<span class="keyword">self</span>)</span><br><span class="line">        <span class="keyword">case</span> .leaveWork:</span><br><span class="line">            cancelOperation(with: <span class="type">TaxiOperation</span>.<span class="keyword">self</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">cancelOperation</span>(<span class="params">with</span> <span class="params">operationType</span>: <span class="type">Operation</span>.<span class="keyword">Type</span>) &#123;</span><br><span class="line">        queue.operations.filter &#123; operation <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">type</span>(of: operation) <span class="operator">==</span> operationType</span><br><span class="line">        &#125;.forEach(&#123; <span class="variable">$0</span>.cancel() &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">add</span>(<span class="params">operation</span>: <span class="type">Operation</span>) &#123;</span><br><span class="line">        queue.addOperation(operation)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">User: Hey Siri, I am leaving my home</span><br><span class="line">Siri: performing leaveHome-action</span><br><span class="line"></span><br><span class="line">User: Hey Siri, I am leaving my work in 3 minutes</span><br><span class="line">Siri: performing leaveWork-action</span><br><span class="line"></span><br><span class="line">User: Hey Siri, I am still working</span><br><span class="line">Siri: canceling leaveWork-action</span><br><span class="line"></span><br><span class="line">DoorOperation: Doors are closed via HomeKit.</span><br><span class="line">WindowOperation: Windows are closed via HomeKit.</span><br><span class="line">TaxiOperation: operation is canceled</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><div class="tab-item-content"><p><strong>在 TypeScript 中使用模式</strong></p>
<p><strong>复杂度：</strong> ★☆☆</p>
<p><strong>流行度：</strong> ★★★</p>
<p><strong>使用示例：</strong> 命令模式在 TypeScript 代码中很常见。 大部分情况下， 它被用于代替包含行为的参数化 UI 元素的回调函数， 此外还被用于对任务进行排序和记录操作历史记录等。</p>
<p><strong>识别方法：</strong> 命令模式可以通过抽象或接口类型 （发送者） 中的行为方法来识别， 该类型调用另一个不同的抽象或接口类型 （接收者） 实现中的方法， 该实现则是在创建时由命令模式的实现封装。 命令类通常仅限于一些特殊行为。</p>
<p><strong>概念示例</strong></p>
<p>本例说明了<strong>命令</strong>设计模式的结构并重点回答了下面的问题：</p>
<ul>
<li>它由哪些类组成？</li>
<li>这些类扮演了哪些角色？</li>
<li>模式中的各个元素会以何种方式相互关联？</li>
</ul>
<p><strong>index.ts:</strong> 概念示例</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Command interface declares a method for executing a command.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Command</span> &#123;</span><br><span class="line">    <span class="title function_">execute</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Some commands can implement simple operations on their own.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleCommand</span> <span class="keyword">implements</span> <span class="title class_">Command</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">payload</span>: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">payload: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">payload</span> = payload;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">execute</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`SimpleCommand: See, I can do simple things like printing (<span class="subst">$&#123;<span class="variable language_">this</span>.payload&#125;</span>)`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * However, some commands can delegate more complex operations to other objects,</span></span><br><span class="line"><span class="comment"> * called &quot;receivers.&quot;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ComplexCommand</span> <span class="keyword">implements</span> <span class="title class_">Command</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">receiver</span>: <span class="title class_">Receiver</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Context data, required for launching the receiver&#x27;s methods.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="attr">a</span>: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="attr">b</span>: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Complex commands can accept one or several receiver objects along with</span></span><br><span class="line"><span class="comment">     * any context data via the constructor.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">receiver: Receiver, a: <span class="built_in">string</span>, b: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">receiver</span> = receiver;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">a</span> = a;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">b</span> = b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Commands can delegate to any methods of a receiver.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">execute</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ComplexCommand: Complex stuff should be done by a receiver object.&#x27;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">receiver</span>.<span class="title function_">doSomething</span>(<span class="variable language_">this</span>.<span class="property">a</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">receiver</span>.<span class="title function_">doSomethingElse</span>(<span class="variable language_">this</span>.<span class="property">b</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Receiver classes contain some important business logic. They know how to</span></span><br><span class="line"><span class="comment"> * perform all kinds of operations, associated with carrying out a request. In</span></span><br><span class="line"><span class="comment"> * fact, any class may serve as a Receiver.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Receiver</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">doSomething</span>(<span class="attr">a</span>: <span class="built_in">string</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Receiver: Working on (<span class="subst">$&#123;a&#125;</span>.)`</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">doSomethingElse</span>(<span class="attr">b</span>: <span class="built_in">string</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Receiver: Also working on (<span class="subst">$&#123;b&#125;</span>.)`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Invoker is associated with one or several commands. It sends a request to</span></span><br><span class="line"><span class="comment"> * the command.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Invoker</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">onStart</span>: <span class="title class_">Command</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="attr">onFinish</span>: <span class="title class_">Command</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Initialize commands.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">setOnStart</span>(<span class="attr">command</span>: <span class="title class_">Command</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">onStart</span> = command;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">setOnFinish</span>(<span class="attr">command</span>: <span class="title class_">Command</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">onFinish</span> = command;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The Invoker does not depend on concrete command or receiver classes. The</span></span><br><span class="line"><span class="comment">     * Invoker passes a request to a receiver indirectly, by executing a</span></span><br><span class="line"><span class="comment">     * command.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">doSomethingImportant</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Invoker: Does anybody want something done before I begin?&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">isCommand</span>(<span class="variable language_">this</span>.<span class="property">onStart</span>)) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">onStart</span>.<span class="title function_">execute</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Invoker: ...doing something really important...&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Invoker: Does anybody want something done after I finish?&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">isCommand</span>(<span class="variable language_">this</span>.<span class="property">onFinish</span>)) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">onFinish</span>.<span class="title function_">execute</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">isCommand</span>(<span class="built_in">object</span>): <span class="built_in">object</span> is <span class="title class_">Command</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">object</span>.<span class="property">execute</span> !== <span class="literal">undefined</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The client code can parameterize an invoker with any commands.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> invoker = <span class="keyword">new</span> <span class="title class_">Invoker</span>();</span><br><span class="line">invoker.<span class="title function_">setOnStart</span>(<span class="keyword">new</span> <span class="title class_">SimpleCommand</span>(<span class="string">&#x27;Say Hi!&#x27;</span>));</span><br><span class="line"><span class="keyword">const</span> receiver = <span class="keyword">new</span> <span class="title class_">Receiver</span>();</span><br><span class="line">invoker.<span class="title function_">setOnFinish</span>(<span class="keyword">new</span> <span class="title class_">ComplexCommand</span>(receiver, <span class="string">&#x27;Send email&#x27;</span>, <span class="string">&#x27;Save report&#x27;</span>));</span><br><span class="line"></span><br><span class="line">invoker.<span class="title function_">doSomethingImportant</span>();</span><br></pre></td></tr></table></figure>

<p><strong>Output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Invoker: Does anybody want something done before I begin?</span><br><span class="line">SimpleCommand: See, I can do simple things like printing (Say Hi!)</span><br><span class="line">Invoker: ...doing something really important...</span><br><span class="line">Invoker: Does anybody want something done after I finish?</span><br><span class="line">ComplexCommand: Complex stuff should be done by a receiver object.</span><br><span class="line">Receiver: Working on (Send email.)</span><br><span class="line">Receiver: Also working on (Save report.)</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><strong>概念示例</strong></p>
<p>下面我们通过电视机的例子来了解命令模式。 你可通过一下方式打开电视机：</p>
<ul>
<li>按下遥控器上的 ON 开关；</li>
<li>按下电视机上的 ON 开关。</li>
</ul>
<p>我们可以从实现 ON 命令对象并以电视机作为接收者入手。 当在此命令上调用 <code>execute</code>执行方法时， 方法会调用 <code>TV.on</code>打开电视函数。 最后的工作是定义请求者： 这里实际上有两个请求者： 遥控器和电视机。 两者都将嵌入 ON 命令对象。</p>
<p>注意我们是如何将相同请求封装进多个请求者的。 我们也可以采用相同的方式来处理其他命令。 创建独立命令对象的优势在于可将 UI 逻辑与底层业务逻辑解耦。 这样就无需为每个请求者开发不同的处理者了。 命令对象中包含执行所需的全部信息， 所以也可用于延迟执行。</p>
<p><strong>button.go:</strong> 请求者</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> button <span class="keyword">struct</span> &#123;</span><br><span class="line">    command command</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *button)</span></span> press() &#123;</span><br><span class="line">    b.command.execute()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>command.go:</strong> 命令接口</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> command <span class="keyword">interface</span> &#123;</span><br><span class="line">    execute()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>onCommand.go:</strong> 具体接口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">type onCommand struct &#123;</span><br><span class="line">    device device</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (c *onCommand) execute() &#123;</span><br><span class="line">    c.device.on()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>offCommand.go:</strong> 具体接口</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> offCommand <span class="keyword">struct</span> &#123;</span><br><span class="line">    device device</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *offCommand)</span></span> execute() &#123;</span><br><span class="line">    c.device.off()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>device.go:</strong> 接收者接口</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> device <span class="keyword">interface</span> &#123;</span><br><span class="line">    on()</span><br><span class="line">    off()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>tv.go:</strong> 具体接收者</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> tv <span class="keyword">struct</span> &#123;</span><br><span class="line">    isRunning <span class="type">bool</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *tv)</span></span> on() &#123;</span><br><span class="line">    t.isRunning = <span class="literal">true</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;Turning tv on&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *tv)</span></span> off() &#123;</span><br><span class="line">    t.isRunning = <span class="literal">false</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;Turning tv off&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>main.go:</strong> 客户端代码</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    tv := &amp;tv&#123;&#125;</span><br><span class="line"></span><br><span class="line">    onCommand := &amp;onCommand&#123;</span><br><span class="line">        device: tv,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    offCommand := &amp;offCommand&#123;</span><br><span class="line">        device: tv,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    onButton := &amp;button&#123;</span><br><span class="line">        command: onCommand,</span><br><span class="line">    &#125;</span><br><span class="line">    onButton.press()</span><br><span class="line"></span><br><span class="line">    offButton := &amp;button&#123;</span><br><span class="line">        command: offCommand,</span><br><span class="line">    &#125;</span><br><span class="line">    offButton.press()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Turning tv on</span><br><span class="line">Turning tv off</span><br></pre></td></tr></table></figure>

<p><em>根据： <a target="_blank" rel="noopener" href="https://golangbyexample.com/command-design-pattern-in-golang/">Golang By Example</a></em></p></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://wangyyovo.github.io">Blank</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://wangyyovo.github.io/posts/670f2ad5/">https://wangyyovo.github.io/posts/670f2ad5/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://wangyyovo.github.io" target="_blank">Blank</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/pattern/">pattern</a></div><div class="post-share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/ca60644a6f657c61b4eab925d07d685f.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/bc8c1ba/" title="行为模式-迭代器模式"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/148cd369e625b1aa204865cc8c48911b.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">行为模式-迭代器模式</div></div><div class="info-2"><div class="info-item-1">  https://refactoringguru.cn/design-patterns/iterator  行为模式-迭代器模式亦称： Iterator 意图迭代器模式是一种行为设计模式， 让你能在不暴露集合底层表现形式 （列表、 栈和树等） 的情况下遍历集合中所有的元素。  问题集合是编程中最常使用的数据类型之一。 尽管如此， 集合只是一组对象的容器而已。  大部分集合使用简单列表存储元素。 但有些集合还会使用栈、 树、 图和其他复杂的数据结构。 无论集合的构成方式如何， 它都必须提供某种访问元素的方式， 便于其他代码使用其中的元素。 集合应提供一种能够遍历元素的方式， 且保证它不会周而复始地访问同一个元素。 如果你的集合基于列表， 那么这项工作听上去仿佛很简单。 但如何遍历复杂数据结构 （例如树） 中的元素呢？ 例如， 今天你需要使用深度优先算法来遍历树结构， 明天可能会需要广度优先算法； 下周则可能会需要其他方式 （比如随机存取树中的元素）。  不断向集合中添加遍历算法会模糊其 “高效存储数据” 的主要职责。 此外， 有些算法可能是根据特定应用订制的， 将其加入泛型集合类...</div></div></div></a><a class="pagination-related" href="/posts/f99571d3/" title="行为模式-责任链模式"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/bcc39c9742d7b0c3e7244a38e8a2f358.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">行为模式-责任链模式</div></div><div class="info-2"><div class="info-item-1">  https://refactoringguru.cn/design-patterns/chain-of-responsibility  行为模式-责任链模式亦称： 职责链模式、命令链、CoR、Chain of Command、Chain of Responsibility 意图责任链模式是一种行为设计模式， 允许你将请求沿着处理者链进行发送。 收到请求后， 每个处理者均可对请求进行处理， 或将其传递给链上的下个处理者。  问题假如你正在开发一个在线订购系统。 你希望对系统访问进行限制， 只允许认证用户创建订单。 此外， 拥有管理权限的用户也拥有所有订单的完全访问权限。 简单规划后， 你会意识到这些检查必须依次进行。 只要接收到包含用户凭据的请求， 应用程序就可尝试对进入系统的用户进行认证。 但如果由于用户凭据不正确而导致认证失败， 那就没有必要进行后续检查了。  在接下来的几个月里， 你实现了后续的几个检查步骤。  一位同事认为直接将原始数据传递给订购系统存在安全隐患。 因此你新增了额外的验证步骤来清理请求中的数据。 过了一段时间， 有人注意到系统无法抵御暴力密码破解方式的攻...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/37f0d8f/" title="创建型模式-单例模式"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/6cc78f9be0372c0d330f2c7d326f7d9e.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-03</div><div class="info-item-2">创建型模式-单例模式</div></div><div class="info-2"><div class="info-item-1">  https://refactoringguru.cn/design-patterns/singleton  创建型模式-单例模式亦称： 单件模式、Singleton 意图单例模式是一种创建型设计模式， 让你能够保证一个类只有一个实例， 并提供一个访问该实例的全局节点。  问题单例模式同时解决了两个问题， 所以违反了_单一职责原则_：  保证一个类只有一个实例。 为什么会有人想要控制一个类所拥有的实例数量？ 最常见的原因是控制某些共享资源 （例如数据库或文件） 的访问权限。 它的运作方式是这样的： 如果你创建了一个对象， 同时过一会儿后你决定再创建一个新对象， 此时你会获得之前已创建的对象， 而不是一个新对象。 注意， 普通构造函数无法实现上述行为， 因为构造函数的设计决定了它必须总是返回一个新对象。   为该实例提供一个全局访问节点。 还记得你 （好吧， 其实是我自己） 用过的那些存储重要对象的全局变量吗？ 它们在使用上十分方便， 但同时也非常不安全， 因为任何代码都有可能覆盖掉那些变量的内容， 从而引发程序崩溃。 和全局变量一样， 单例模式也允许在程序的任何地方访问特定对象...</div></div></div></a><a class="pagination-related" href="/posts/63b28d52/" title="创建型模式-原型模式"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/01b549d5aec9f475e74b2781486eed2d.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-03</div><div class="info-item-2">创建型模式-原型模式</div></div><div class="info-2"><div class="info-item-1">  https://refactoringguru.cn/design-patterns/prototype  创建型模式-原型模式亦称： 克隆、Clone、Prototype 意图原型模式是一种创建型设计模式， 使你能够复制已有对象， 而又无需使代码依赖它们所属的类。  问题如果你有一个对象， 并希望生成与其完全相同的一个复制品， 你该如何实现呢？ 首先， 你必须新建一个属于相同类的对象。 然后， 你必须遍历原始对象的所有成员变量， 并将成员变量值复制到新对象中。 不错！ 但有个小问题。 并非所有对象都能通过这种方式进行复制， 因为有些对象可能拥有私有成员变量， 它们在对象本身以外是不可见的。  直接复制还有另外一个问题。 因为你必须知道对象所属的类才能创建复制品， 所以代码必须依赖该类。 即使你可以接受额外的依赖性， 那还有另外一个问题： 有时你只知道对象所实现的接口， 而不知道其所属的具体类， 比如可向方法的某个参数传入实现了某个接口的任何对象。 解决方案原型模式将克隆过程委派给被克隆的实际对象。 模式为所有支持克隆的对象声明了一个通用接口， 该接口让你能够克隆对象， 同时...</div></div></div></a><a class="pagination-related" href="/posts/a951f0f7/" title="创建型模式-抽象工厂模式"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/40d08d3b2ae8dc4074a9f3a7942a0b5a.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-03</div><div class="info-item-2">创建型模式-抽象工厂模式</div></div><div class="info-2"><div class="info-item-1">  https://refactoringguru.cn/design-patterns/abstract-factory  创建型模式-抽象工厂模式亦称： Abstract Factory 意图抽象工厂模式是一种创建型设计模式， 它能创建一系列相关的对象， 而无需指定其具体类。  问题假设你正在开发一款家具商店模拟器。 你的代码中包括一些类， 用于表示：  一系列相关产品， 例如 椅子Chair 、  沙发Sofa和 咖啡桌Coffee­Table 。 系列产品的不同变体。 例如， 你可以使用 现代Modern 、  维多利亚Victorian 、  装饰风艺术Art­Deco等风格生成 椅子 、  沙发和 咖啡桌 。   你需要设法单独生成每件家具对象， 这样才能确保其风格一致。 如果顾客收到的家具风格不一样， 他们可不会开心。  此外， 你也不希望在添加新产品或新风格时修改已有代码。 家具供应商对于产品目录的更新非常频繁， 你不会想在每次更新时都去修改核心代码的。 解决方案首先， 抽象工厂模式建议为系列中的每件产品明确声明接口 （例如椅子、 沙发或咖啡桌）。 然后， 确保所...</div></div></div></a><a class="pagination-related" href="/posts/63b2a10f/" title="工厂模式比较"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/dd999ecec29f3590f23c26fbb79bb612.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-04</div><div class="info-item-2">工厂模式比较</div></div><div class="info-2"><div class="info-item-1">  https://refactoringguru.cn/design-patterns/factory-comparison  工厂模式比较本文将对下列概念之间的差异进行说明：  工厂 构建方法 静态构建 （或工厂） 方法 简单工厂 工厂方法 抽象工厂  你可以在网上找到这些术语的参考信息。 尽管它们看上去相似， 但其含义都不一样。 许多人没有意识到这一点， 从而出现了混淆和误解。 因此让我们搞清楚其中的不同之处， 一劳永逸地解决这个问题。 1. 工厂工厂是一个含义模糊的术语， 表示可以创建一些东西的函数、 方法或类。 最常见的情况下， 工厂创建的是对象。 但是它们也可以创建文件和数据库记录等其他东西。 例如， 下面这些东西都可以非正式地被称为 “工厂”：  创建程序 GUI 的函数或方法； 创建用户的类； 以特定方式调用类构造函数的静态方法。 一种创建型设计模式。  当某人说到 “工厂” 这个词时， 其具体含义通常可以根据上下文来确定。 但如果你有疑问， 可以直接提问。 毕竟作者本人有时候也没有搞清楚。 2. 构建方法构建方法在 《重构与模式》 中被定义为 “创建对象的方法”...</div></div></div></a><a class="pagination-related" href="/posts/e59e3a52/" title="创建型模式-生成器模式"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/43a23affdea04c9c39e82f19a8ff21d8.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-03</div><div class="info-item-2">创建型模式-生成器模式</div></div><div class="info-2"><div class="info-item-1">  https://refactoringguru.cn/design-patterns/builder  创建型模式-生成器模式亦称： 建造者模式、Builder 意图生成器模式是一种创建型设计模式， 使你能够分步骤创建复杂对象。 该模式允许你使用相同的创建代码生成不同类型和形式的对象。  问题假设有这样一个复杂对象， 在对其进行构造时需要对诸多成员变量和嵌套对象进行繁复的初始化工作。 这些初始化代码通常深藏于一个包含众多参数且让人基本看不懂的构造函数中； 甚至还有更糟糕的情况， 那就是这些代码散落在客户端代码的多个位置。  例如， 我们来思考如何创建一个 房屋House对象。 建造一栋简单的房屋， 首先你需要建造四面墙和地板， 安装房门和一套窗户， 然后再建造一个屋顶。 但是如果你想要一栋更宽敞更明亮的房屋， 还要有院子和其他设施 （例如暖气、 排水和供电设备）， 那又该怎么办呢？ 最简单的方法是扩展 房屋基类， 然后创建一系列涵盖所有参数组合的子类。 但最终你将面对相当数量的子类。 任何新增的参数 （例如门廊类型） 都会让这个层次结构更加复杂。 另一种方法则无需生成子类。 ...</div></div></div></a><a class="pagination-related" href="/posts/7a751a0c/" title="创建型模式-工厂方法模式"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/2cc53835314eae7d55be8b341557ddb0.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-03</div><div class="info-item-2">创建型模式-工厂方法模式</div></div><div class="info-2"><div class="info-item-1">  https://refactoringguru.cn/design-patterns/factory-method  创建型模式-工厂方法模式**亦称：**虚拟构造函数、Virtual Constructor、Factory Method 意图工厂方法模式是一种创建型设计模式， 其在父类中提供一个创建对象的方法， 允许子类决定实例化对象的类型。  问题假设你正在开发一款物流管理应用。 最初版本只能处理卡车运输， 因此大部分代码都在位于名为 卡车的类中。 一段时间后， 这款应用变得极受欢迎。 你每天都能收到十几次来自海运公司的请求， 希望应用能够支持海上物流功能。  这可是个好消息。 但是代码问题该如何处理呢？ 目前， 大部分代码都与 卡车类相关。 在程序中添加 轮船类需要修改全部代码。 更糟糕的是， 如果你以后需要在程序中支持另外一种运输方式， 很可能需要再次对这些代码进行大幅修改。 最后， 你将不得不编写繁复的代码， 根据不同的运输对象类， 在应用中进行不同的处理。 解决方案工厂方法模式建议使用特殊的工厂方法代替对于对象构造函数的直接调用 （即使用 new运算符）。 不用担...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/theme/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Blank</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">352</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">46</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">58</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>主题 GitHub</span></a><div class="card-info-social-icons"><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fas fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A1%8C%E4%B8%BA%E6%A8%A1%E5%BC%8F-%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.</span> <span class="toc-text">行为模式-命令模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%84%8F%E5%9B%BE"><span class="toc-number">1.1.</span> <span class="toc-text">意图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98"><span class="toc-number">1.2.</span> <span class="toc-text">问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">1.3.</span> <span class="toc-text">解决方案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9C%9F%E5%AE%9E%E4%B8%96%E7%95%8C%E7%B1%BB%E6%AF%94"><span class="toc-number">1.4.</span> <span class="toc-text">真实世界类比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F%E7%BB%93%E6%9E%84"><span class="toc-number">1.5.</span> <span class="toc-text">命令模式结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%AA%E4%BB%A3%E7%A0%81"><span class="toc-number">1.6.</span> <span class="toc-text">伪代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F%E9%80%82%E5%90%88%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.7.</span> <span class="toc-text">命令模式适合应用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F"><span class="toc-number">1.8.</span> <span class="toc-text">实现方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-number">1.9.</span> <span class="toc-text">命令模式优缺点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8E%E5%85%B6%E4%BB%96%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">1.10.</span> <span class="toc-text">与其他模式的关系</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.11.</span> <span class="toc-text">代码示例</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/d14168d/" title="虚拟机问题合集"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/hexo/090cfe4e9e60b0ad0de05db822f3ae97.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="虚拟机问题合集"/></a><div class="content"><a class="title" href="/posts/d14168d/" title="虚拟机问题合集">虚拟机问题合集</a><time datetime="2022-07-16T13:30:36.000Z" title="发表于 2022-07-16 21:30:36">2022-07-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/f540045f/" title="用go语言编写移动端sdk和app开发"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/golang/941ed1ec2925719a0c92e76f4f786b6a.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="用go语言编写移动端sdk和app开发"/></a><div class="content"><a class="title" href="/posts/f540045f/" title="用go语言编写移动端sdk和app开发">用go语言编写移动端sdk和app开发</a><time datetime="2022-07-04T12:14:21.000Z" title="发表于 2022-07-04 20:14:21">2022-07-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/5faac006/" title="在线编程IDE"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/hexo/090cfe4e9e60b0ad0de05db822f3ae97.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="在线编程IDE"/></a><div class="content"><a class="title" href="/posts/5faac006/" title="在线编程IDE">在线编程IDE</a><time datetime="2022-06-12T13:30:36.000Z" title="发表于 2022-06-12 21:30:36">2022-06-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/7594185d/" title="即时性能分析工具Pyroscope"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/golang/3bfb3279740bc9a5b5ef436fa887ef07.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="即时性能分析工具Pyroscope"/></a><div class="content"><a class="title" href="/posts/7594185d/" title="即时性能分析工具Pyroscope">即时性能分析工具Pyroscope</a><time datetime="2022-06-12T08:07:36.000Z" title="发表于 2022-06-12 16:07:36">2022-06-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/82a7aa7c/" title="golang性能调试优化方法"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="golang性能调试优化方法"/></a><div class="content"><a class="title" href="/posts/82a7aa7c/" title="golang性能调试优化方法">golang性能调试优化方法</a><time datetime="2022-06-12T03:00:36.000Z" title="发表于 2022-06-12 11:00:36">2022-06-12</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By Blank</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 5.4.2</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.3</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = {"placeholder":"请留下你的脚印","pageSize":10,"lang":"zh-CN","requiredFields":["nick","mail","link"]}

  const initValine = (el, path) => {
    if (isShuoshuo) {
      window.shuoshuoComment.destroyValine = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    const valineConfig = {
      el: '#vcomment',
      appId: 'BSfgwCPLOvPHVPaSoBCGSENf-MdYXbMMI',
      appKey: '2Q8qq5060qxycL6FPL26LnMG',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      visitor: false,
      ...option,
      path: isShuoshuo ? path : (option && option.path) || window.location.pathname
    }

    new Valine(valineConfig)
  }

  const loadValine = async (el, path) => {
    if (typeof Valine === 'function') {
      initValine(el, path)
    } else {
      await btf.getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js')
      initValine(el, path)
    }
  }

  if (isShuoshuo) {
    'Valine' === 'Valine'
      ? window.shuoshuoComment = { loadComment: loadValine }
      : window.loadOtherComment = loadValine
    return
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>