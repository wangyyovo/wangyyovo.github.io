<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>NATSå’ŒNATS Streaming | Blank</title><meta name="author" content="Blank"><meta name="copyright" content="Blank"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="NATSå’ŒNATS StreamingNATSæºç å®‰è£… 12345# Go clientgo get github.com&#x2F;nats-io&#x2F;nats.go&#x2F;# Servergo get github.com&#x2F;nats-io&#x2F;nats-server  äºŒè¿›åˆ¶ï¼šhttps:&#x2F;&#x2F;nats.io&#x2F;download&#x2F;nats-io&#x2F;gnatsd&#x2F; When using or transitioning t">
<meta property="og:type" content="article">
<meta property="og:title" content="NATSå’ŒNATS Streaming">
<meta property="og:url" content="https://wangyyovo.github.io/posts/cd0e56c9/">
<meta property="og:site_name" content="Blank">
<meta property="og:description" content="NATSå’ŒNATS StreamingNATSæºç å®‰è£… 12345# Go clientgo get github.com&#x2F;nats-io&#x2F;nats.go&#x2F;# Servergo get github.com&#x2F;nats-io&#x2F;nats-server  äºŒè¿›åˆ¶ï¼šhttps:&#x2F;&#x2F;nats.io&#x2F;download&#x2F;nats-io&#x2F;gnatsd&#x2F; When using or transitioning t">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/nats/939916bec37ea8f169680b4d133f4a86.jpg">
<meta property="article:published_time" content="2019-09-27T08:15:36.000Z">
<meta property="article:modified_time" content="2019-09-27T08:15:36.000Z">
<meta property="article:author" content="Blank">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/nats/939916bec37ea8f169680b4d133f4a86.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "NATSå’ŒNATS Streaming",
  "url": "https://wangyyovo.github.io/posts/cd0e56c9/",
  "image": "https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/nats/939916bec37ea8f169680b4d133f4a86.jpg",
  "datePublished": "2019-09-27T08:15:36.000Z",
  "dateModified": "2019-09-27T08:15:36.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Blank",
      "url": "https://wangyyovo.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/theme/favicon.ico"><link rel="canonical" href="https://wangyyovo.github.io/posts/cd0e56c9/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"æœªæ‰¾åˆ°ç¬¦åˆæ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}","hits_stats":"å…±æ‰¾åˆ° ${hits} ç¯‡æ–‡ç« "}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"ç¹","msgToSimplifiedChinese":"ç®€"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400,"highlightFullpage":true,"highlightMacStyle":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶å¤±è´¥',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: {"limitCount":150,"languages":{"author":"ä½œè€…: Blank","link":"é“¾æ¥: ","source":"æ¥æº: Blank","info":"è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚"}},
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'NATSå’ŒNATS Streaming',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="alternate" href="/atom.xml" title="Blank" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/theme/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">352</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">46</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">58</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> ä¸»é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-comment-dots"></i><span> ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> å¨±ä¹</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> éŸ³ä¹</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> ç”µå½±</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-image"></i><span> ç›¸å†Œ</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-book"></i><span> æ•™ç¨‹</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/posts/21cfbf15/"><span> ğŸš€ å¿«é€Ÿé–‹å§‹</span></a></li><li><a class="site-page child" href="/posts/dc584b87/"><span> ğŸ“‘ ä¸»é¡Œé é¢</span></a></li><li><a class="site-page child" href="/posts/4aa8abbe/"><span> ğŸ›  ä¸»é¡Œé…ç½®</span></a></li><li><a class="site-page child" href="/posts/ceeb73f/"><span> âš”ï¸ æ¨™ç°½å¤–æŒ‚</span></a></li><li><a class="site-page child" href="/posts/98d20436/"><span> â“ ä¸»é¡Œå•ç­”</span></a></li><li><a class="site-page child" href="/posts/4073eda/"><span> âš¡ï¸ é€²éšæ•™ç¨‹</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-language"></i><span> è¯­è¨€</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/"><i class="fa-fw fas fa-c"></i><span> ä¸­æ–‡</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/nats/939916bec37ea8f169680b4d133f4a86.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Blank</span></a><a class="nav-page-title" href="/"><span class="site-name">NATSå’ŒNATS Streaming</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  è¿”å›é¦–é¡µ</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> ä¸»é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-comment-dots"></i><span> ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> å¨±ä¹</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> éŸ³ä¹</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> ç”µå½±</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-image"></i><span> ç›¸å†Œ</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-book"></i><span> æ•™ç¨‹</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/posts/21cfbf15/"><span> ğŸš€ å¿«é€Ÿé–‹å§‹</span></a></li><li><a class="site-page child" href="/posts/dc584b87/"><span> ğŸ“‘ ä¸»é¡Œé é¢</span></a></li><li><a class="site-page child" href="/posts/4aa8abbe/"><span> ğŸ›  ä¸»é¡Œé…ç½®</span></a></li><li><a class="site-page child" href="/posts/ceeb73f/"><span> âš”ï¸ æ¨™ç°½å¤–æŒ‚</span></a></li><li><a class="site-page child" href="/posts/98d20436/"><span> â“ ä¸»é¡Œå•ç­”</span></a></li><li><a class="site-page child" href="/posts/4073eda/"><span> âš¡ï¸ é€²éšæ•™ç¨‹</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-language"></i><span> è¯­è¨€</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/"><i class="fa-fw fas fa-c"></i><span> ä¸­æ–‡</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">NATSå’ŒNATS Streaming</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2019-09-27T08:15:36.000Z" title="å‘è¡¨äº 2019-09-27 16:15:36">2019-09-27</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2019-09-27T08:15:36.000Z" title="æ›´æ–°äº 2019-09-27 16:15:36">2019-09-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/microservice/">microservice</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/microservice/nats/">nats</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">æ€»å­—æ•°:</span><span class="word-count">5.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>26åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">æµè§ˆé‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><script src="\assets\js\APlayer.min.js"> </script><h1 id="NATSå’ŒNATS-Streaming"><a href="#NATSå’ŒNATS-Streaming" class="headerlink" title="NATSå’ŒNATS Streaming"></a>NATSå’ŒNATS Streaming</h1><h2 id="NATS"><a href="#NATS" class="headerlink" title="NATS"></a>NATS</h2><p>æºç å®‰è£…</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Go client</span></span><br><span class="line">go get github.com/nats-io/nats.go/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Server</span></span><br><span class="line">go get github.com/nats-io/nats-server</span><br></pre></td></tr></table></figure>

<p>äºŒè¿›åˆ¶ï¼š<a target="_blank" rel="noopener" href="https://nats.io/download/nats-io/gnatsd/">https://nats.io/download/nats-io/gnatsd/</a></p>
<p>When using or transitioning to Go modules support:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Go client latest or explicit version</span></span><br><span class="line">go get github.com/nats-io/nats.go/@latest</span><br><span class="line">go get github.com/nats-io/nats.go/@v1.9.1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">For latest NATS Server, add /v2 at the end</span></span><br><span class="line">go get github.com/nats-io/nats-server/v2</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">NATS Server v1 is installed otherwise</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">go get github.com/nats-io/nats-server</span></span><br></pre></td></tr></table></figure>

<h3 id="åŸºæœ¬ç”¨æ³•"><a href="#åŸºæœ¬ç”¨æ³•" class="headerlink" title="åŸºæœ¬ç”¨æ³•"></a>åŸºæœ¬ç”¨æ³•</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> nats <span class="string">&quot;github.com/nats-io/nats.go&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Connect to a server</span></span><br><span class="line">nc, _ := nats.Connect(nats.DefaultURL)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Simple Publisher</span></span><br><span class="line">nc.Publish(<span class="string">&quot;foo&quot;</span>, []<span class="type">byte</span>(<span class="string">&quot;Hello World&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// Simple Async Subscriber</span></span><br><span class="line">nc.Subscribe(<span class="string">&quot;foo&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(m *nats.Msg)</span></span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Received a message: %s\n&quot;</span>, <span class="type">string</span>(m.Data))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Responding to a request message</span></span><br><span class="line">nc.Subscribe(<span class="string">&quot;request&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(m *nats.Msg)</span></span> &#123;</span><br><span class="line">    m.Respond([]<span class="type">byte</span>(<span class="string">&quot;answer is 42&quot;</span>))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Simple Sync Subscriber</span></span><br><span class="line">sub, err := nc.SubscribeSync(<span class="string">&quot;foo&quot;</span>)</span><br><span class="line">m, err := sub.NextMsg(timeout)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Channel Subscriber</span></span><br><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> *nats.Msg, <span class="number">64</span>)</span><br><span class="line">sub, err := nc.ChanSubscribe(<span class="string">&quot;foo&quot;</span>, ch)</span><br><span class="line">msg := &lt;- ch</span><br><span class="line"></span><br><span class="line"><span class="comment">// Unsubscribe</span></span><br><span class="line">sub.Unsubscribe()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Drain</span></span><br><span class="line">sub.Drain()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Requests</span></span><br><span class="line">msg, err := nc.Request(<span class="string">&quot;help&quot;</span>, []<span class="type">byte</span>(<span class="string">&quot;help me&quot;</span>), <span class="number">10</span>*time.Millisecond)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Replies</span></span><br><span class="line">nc.Subscribe(<span class="string">&quot;help&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(m *nats.Msg)</span></span> &#123;</span><br><span class="line">    nc.Publish(m.Reply, []<span class="type">byte</span>(<span class="string">&quot;I can help!&quot;</span>))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Drain connection (Preferred for responders)</span></span><br><span class="line"><span class="comment">// Close() not needed if this is called.</span></span><br><span class="line">nc.Drain()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Close connection</span></span><br><span class="line">nc.Close()</span><br></pre></td></tr></table></figure>

<h3 id="ç¼–ç è¿æ¥"><a href="#ç¼–ç è¿æ¥" class="headerlink" title="ç¼–ç è¿æ¥"></a>ç¼–ç è¿æ¥</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">nc, _ := nats.Connect(nats.DefaultURL)</span><br><span class="line">c, _ := nats.NewEncodedConn(nc, nats.JSON_ENCODER)</span><br><span class="line"><span class="keyword">defer</span> c.Close()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Simple Publisher</span></span><br><span class="line">c.Publish(<span class="string">&quot;foo&quot;</span>, <span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Simple Async Subscriber</span></span><br><span class="line">c.Subscribe(<span class="string">&quot;foo&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(s <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Received a message: %s\n&quot;</span>, s)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// EncodedConn can Publish any raw Go type using the registered Encoder</span></span><br><span class="line"><span class="keyword">type</span> person <span class="keyword">struct</span> &#123;</span><br><span class="line">     Name     <span class="type">string</span></span><br><span class="line">     Address  <span class="type">string</span></span><br><span class="line">     Age      <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Go type Subscriber</span></span><br><span class="line">c.Subscribe(<span class="string">&quot;hello&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(p *person)</span></span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Received a person: %+v\n&quot;</span>, p)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">me := &amp;person&#123;Name: <span class="string">&quot;derek&quot;</span>, Age: <span class="number">22</span>, Address: <span class="string">&quot;140 New Montgomery Street, San Francisco, CA&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Go type Publisher</span></span><br><span class="line">c.Publish(<span class="string">&quot;hello&quot;</span>, me)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Unsubscribe</span></span><br><span class="line">sub, err := c.Subscribe(<span class="string">&quot;foo&quot;</span>, <span class="literal">nil</span>)</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">sub.Unsubscribe()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Requests</span></span><br><span class="line"><span class="keyword">var</span> response <span class="type">string</span></span><br><span class="line">err = c.Request(<span class="string">&quot;help&quot;</span>, <span class="string">&quot;help me&quot;</span>, &amp;response, <span class="number">10</span>*time.Millisecond)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Request failed: %v\n&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Replying</span></span><br><span class="line">c.Subscribe(<span class="string">&quot;help&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(subj, reply <span class="type">string</span>, msg <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">    c.Publish(reply, <span class="string">&quot;I can help!&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Close connection</span></span><br><span class="line">c.Close();</span><br></pre></td></tr></table></figure>

<h3 id="æ–°èº«ä»½éªŒè¯-Nkeys-å’Œç”¨æˆ·å‡­æ®"><a href="#æ–°èº«ä»½éªŒè¯-Nkeys-å’Œç”¨æˆ·å‡­æ®" class="headerlink" title="æ–°èº«ä»½éªŒè¯ (Nkeys å’Œç”¨æˆ·å‡­æ®)"></a>æ–°èº«ä»½éªŒè¯ (Nkeys å’Œç”¨æˆ·å‡­æ®)</h3><p>è¿™éœ€è¦æœåŠ¡å™¨çš„ç‰ˆæœ¬&gt; &#x3D;2.0.0</p>
<p>NATS æœåŠ¡å™¨æœ‰ä¸€ä¸ªæ–°çš„å®‰å…¨å’Œèº«ä»½éªŒè¯æœºåˆ¶æ¥ä½¿ç”¨ç”¨æˆ·å‡­æ®å’Œ Nkeys è®¤è¯ã€‚ æœ€ç®€å•çš„å½¢å¼æ˜¯ä½¿ç”¨æ–¹æ³• usercilesï¼ˆcredsFilepathï¼‰ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc, err := nats.Connect(url, nats.UserCredentials(<span class="string">&quot;user.creds&quot;</span>))</span><br></pre></td></tr></table></figure>

<p>The helper methods creates two callback handlers to present the user  JWT and sign the nonce challenge from the server. The core client library never has direct access to your private key and  simply performs the callback for signing the server challenge. The helper will load and wipe and erase memory it uses for each connect  or reconnect.</p>
<p>The helper also can take two entries, one for the JWT and one for the NKey seed file.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc, err := nats.Connect(url, nats.UserCredentials(<span class="string">&quot;user.jwt&quot;</span>, <span class="string">&quot;user.nk&quot;</span>))</span><br></pre></td></tr></table></figure>

<p>You can also set the callback handlers directly and manage challenge signing directly.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc, err := nats.Connect(url, nats.UserJWT(jwtCB, sigCB))</span><br></pre></td></tr></table></figure>

<p>Bare Nkeys are also supported. The nkey seed should be in a read only file, e.g. seed.txt</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="built_in">cat</span> seed.txt</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">This is my seed nkey!</span></span><br><span class="line">SUAGMJH5XLGZKQQWAWKRZJIGMOU4HPFUYLXJMXOO5NLFEO2OOQJ5LPRDPM</span><br></pre></td></tr></table></figure>

<p>This is a helper function which will load and decode and do the proper signing for the server nonce. It will clear memory in between invocations. You can choose to use the low level option and provide the public key and a signature callback on your own.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">opt, err := nats.NkeyOptionFromSeed(<span class="string">&quot;seed.txt&quot;</span>)</span><br><span class="line">nc, err := nats.Connect(serverUrl, opt)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Direct</span></span><br><span class="line">nc, err := nats.Connect(serverUrl, nats.Nkey(pubNkey, sigCB))</span><br></pre></td></tr></table></figure>

<h3 id="TLS"><a href="#TLS" class="headerlink" title="TLS"></a>TLS</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// tls as a scheme will enable secure connections by default. This will also verify the server name.</span></span><br><span class="line">nc, err := nats.Connect(<span class="string">&quot;tls://nats.demo.io:4443&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// If you are using a self-signed certificate, you need to have a tls.Config with RootCAs setup.</span></span><br><span class="line"><span class="comment">// We provide a helper method to make this case easier.</span></span><br><span class="line">nc, err = nats.Connect(<span class="string">&quot;tls://localhost:4443&quot;</span>, nats.RootCAs(<span class="string">&quot;./configs/certs/ca.pem&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// If the server requires client certificate, there is an helper function for that too:</span></span><br><span class="line">cert := nats.ClientCert(<span class="string">&quot;./configs/certs/client-cert.pem&quot;</span>, <span class="string">&quot;./configs/certs/client-key.pem&quot;</span>)</span><br><span class="line">nc, err = nats.Connect(<span class="string">&quot;tls://localhost:4443&quot;</span>, cert)</span><br><span class="line"></span><br><span class="line"><span class="comment">// You can also supply a complete tls.Config</span></span><br><span class="line"></span><br><span class="line">certFile := <span class="string">&quot;./configs/certs/client-cert.pem&quot;</span></span><br><span class="line">keyFile := <span class="string">&quot;./configs/certs/client-key.pem&quot;</span></span><br><span class="line">cert, err := tls.LoadX509KeyPair(certFile, keyFile)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    t.Fatalf(<span class="string">&quot;error parsing X509 certificate/key pair: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">config := &amp;tls.Config&#123;</span><br><span class="line">    ServerName: 	opts.Host,</span><br><span class="line">    Certificates: 	[]tls.Certificate&#123;cert&#125;,</span><br><span class="line">    RootCAs:    	pool,</span><br><span class="line">    MinVersion: 	tls.VersionTLS12,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">nc, err = nats.Connect(<span class="string">&quot;nats://localhost:4443&quot;</span>, nats.Secure(config))</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">	t.Fatalf(<span class="string">&quot;Got an error on Connect with Secure Options: %+v\n&quot;</span>, err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="ä½¿ç”¨-Go-é€šé“"><a href="#ä½¿ç”¨-Go-é€šé“" class="headerlink" title="ä½¿ç”¨ Go é€šé“"></a>ä½¿ç”¨ Go é€šé“</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">nc, _ := nats.Connect(nats.DefaultURL)</span><br><span class="line">ec, _ := nats.NewEncodedConn(nc, nats.JSON_ENCODER)</span><br><span class="line"><span class="keyword">defer</span> ec.Close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> person <span class="keyword">struct</span> &#123;</span><br><span class="line">     Name     <span class="type">string</span></span><br><span class="line">     Address  <span class="type">string</span></span><br><span class="line">     Age      <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">recvCh := <span class="built_in">make</span>(<span class="keyword">chan</span> *person)</span><br><span class="line">ec.BindRecvChan(<span class="string">&quot;hello&quot;</span>, recvCh)</span><br><span class="line"></span><br><span class="line">sendCh := <span class="built_in">make</span>(<span class="keyword">chan</span> *person)</span><br><span class="line">ec.BindSendChan(<span class="string">&quot;hello&quot;</span>, sendCh)</span><br><span class="line"></span><br><span class="line">me := &amp;person&#123;Name: <span class="string">&quot;derek&quot;</span>, Age: <span class="number">22</span>, Address: <span class="string">&quot;140 New Montgomery Street&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Send via Go channels</span></span><br><span class="line">sendCh &lt;- me</span><br><span class="line"></span><br><span class="line"><span class="comment">// Receive via Go channels</span></span><br><span class="line">who := &lt;- recvCh</span><br></pre></td></tr></table></figure>



<h3 id="é€šé…ç¬¦è®¢é˜…"><a href="#é€šé…ç¬¦è®¢é˜…" class="headerlink" title="é€šé…ç¬¦è®¢é˜…"></a>é€šé…ç¬¦è®¢é˜…</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &quot;*&quot; matches any token, at any level of the subject.</span></span><br><span class="line">nc.Subscribe(<span class="string">&quot;foo.*.baz&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(m *Msg)</span></span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Msg received on [%s] : %s\n&quot;</span>, m.Subject, <span class="type">string</span>(m.Data));</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">nc.Subscribe(<span class="string">&quot;foo.bar.*&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(m *Msg)</span></span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Msg received on [%s] : %s\n&quot;</span>, m.Subject, <span class="type">string</span>(m.Data));</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// &quot;&gt;&quot; matches any length of the tail of a subject, and can only be the last token</span></span><br><span class="line"><span class="comment">// E.g. &#x27;foo.&gt;&#x27; will match &#x27;foo.bar&#x27;, &#x27;foo.bar.baz&#x27;, &#x27;foo.foo.bar.bax.22&#x27;</span></span><br><span class="line">nc.Subscribe(<span class="string">&quot;foo.&gt;&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(m *Msg)</span></span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Msg received on [%s] : %s\n&quot;</span>, m.Subject, <span class="type">string</span>(m.Data));</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Matches all of the above</span></span><br><span class="line">nc.Publish(<span class="string">&quot;foo.bar.baz&quot;</span>, []<span class="type">byte</span>(<span class="string">&quot;Hello World&quot;</span>))</span><br></pre></td></tr></table></figure>



<h3 id="é˜Ÿåˆ—ç»„"><a href="#é˜Ÿåˆ—ç»„" class="headerlink" title="é˜Ÿåˆ—ç»„"></a>é˜Ÿåˆ—ç»„</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// All subscriptions with the same queue name will form a queue group.</span></span><br><span class="line"><span class="comment">// Each message will be delivered to only one subscriber per queue group,</span></span><br><span class="line"><span class="comment">// using queuing semantics. You can have as many queue groups as you wish.</span></span><br><span class="line"><span class="comment">// Normal subscribers will continue to work as expected.</span></span><br><span class="line"></span><br><span class="line">nc.QueueSubscribe(<span class="string">&quot;foo&quot;</span>, <span class="string">&quot;job_workers&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(_ *Msg)</span></span> &#123;</span><br><span class="line">  received += <span class="number">1</span>;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="é«˜çº§ç”¨æ³•"><a href="#é«˜çº§ç”¨æ³•" class="headerlink" title="é«˜çº§ç”¨æ³•"></a>é«˜çº§ç”¨æ³•</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Flush connection to server, returns when all messages have been processed.</span></span><br><span class="line">nc.Flush()</span><br><span class="line">fmt.Println(<span class="string">&quot;All clear!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// FlushTimeout specifies a timeout value as well.</span></span><br><span class="line">err := nc.FlushTimeout(<span class="number">1</span>*time.Second)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;All clear!&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Flushed timed out!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Auto-unsubscribe after MAX_WANTED messages received</span></span><br><span class="line"><span class="keyword">const</span> MAX_WANTED = <span class="number">10</span></span><br><span class="line">sub, err := nc.Subscribe(<span class="string">&quot;foo&quot;</span>)</span><br><span class="line">sub.AutoUnsubscribe(MAX_WANTED)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Multiple connections</span></span><br><span class="line">nc1 := nats.Connect(<span class="string">&quot;nats://host1:4222&quot;</span>)</span><br><span class="line">nc2 := nats.Connect(<span class="string">&quot;nats://host2:4222&quot;</span>)</span><br><span class="line"></span><br><span class="line">nc1.Subscribe(<span class="string">&quot;foo&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(m *Msg)</span></span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Received a message: %s\n&quot;</span>, <span class="type">string</span>(m.Data))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">nc2.Publish(<span class="string">&quot;foo&quot;</span>, []<span class="type">byte</span>(<span class="string">&quot;Hello World!&quot;</span>));</span><br></pre></td></tr></table></figure>



<h3 id="é›†ç¾¤"><a href="#é›†ç¾¤" class="headerlink" title="é›†ç¾¤"></a>é›†ç¾¤</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> servers = <span class="string">&quot;nats://localhost:1222, nats://localhost:1223, nats://localhost:1224&quot;</span></span><br><span class="line"></span><br><span class="line">nc, err := nats.Connect(servers)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Optionally set ReconnectWait and MaxReconnect attempts.</span></span><br><span class="line"><span class="comment">// This example means 10 seconds total per backend.</span></span><br><span class="line">nc, err = nats.Connect(servers, nats.MaxReconnects(<span class="number">5</span>), nats.ReconnectWait(<span class="number">2</span> * time.Second))</span><br><span class="line"></span><br><span class="line"><span class="comment">// Optionally disable randomization of the server pool</span></span><br><span class="line">nc, err = nats.Connect(servers, nats.DontRandomize())</span><br><span class="line"></span><br><span class="line"><span class="comment">// Setup callbacks to be notified on disconnects, reconnects and connection closed.</span></span><br><span class="line">nc, err = nats.Connect(servers,</span><br><span class="line">	nats.DisconnectErrHandler(<span class="function"><span class="keyword">func</span><span class="params">(nc *nats.Conn, err <span class="type">error</span>)</span></span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;Got disconnected! Reason: %q\n&quot;</span>, err)</span><br><span class="line">	&#125;),</span><br><span class="line">	nats.ReconnectHandler(<span class="function"><span class="keyword">func</span><span class="params">(nc *nats.Conn)</span></span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;Got reconnected to %v!\n&quot;</span>, nc.ConnectedUrl())</span><br><span class="line">	&#125;),</span><br><span class="line">	nats.ClosedHandler(<span class="function"><span class="keyword">func</span><span class="params">(nc *nats.Conn)</span></span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;Connection closed. Reason: %q\n&quot;</span>, nc.LastError())</span><br><span class="line">	&#125;)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// When connecting to a mesh of servers with auto-discovery capabilities,</span></span><br><span class="line"><span class="comment">// you may need to provide a username/password or token in order to connect</span></span><br><span class="line"><span class="comment">// to any server in that mesh when authentication is required.</span></span><br><span class="line"><span class="comment">// Instead of providing the credentials in the initial URL, you will use</span></span><br><span class="line"><span class="comment">// new option setters:</span></span><br><span class="line">nc, err = nats.Connect(<span class="string">&quot;nats://localhost:4222&quot;</span>, nats.UserInfo(<span class="string">&quot;foo&quot;</span>, <span class="string">&quot;bar&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// For token based authentication:</span></span><br><span class="line">nc, err = nats.Connect(<span class="string">&quot;nats://localhost:4222&quot;</span>, nats.Token(<span class="string">&quot;S3cretT0ken&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// You can even pass the two at the same time in case one of the server</span></span><br><span class="line"><span class="comment">// in the mesh requires token instead of user name and password.</span></span><br><span class="line">nc, err = nats.Connect(<span class="string">&quot;nats://localhost:4222&quot;</span>,</span><br><span class="line">    nats.UserInfo(<span class="string">&quot;foo&quot;</span>, <span class="string">&quot;bar&quot;</span>),</span><br><span class="line">    nats.Token(<span class="string">&quot;S3cretT0ken&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// Note that if credentials are specified in the initial URLs, they take</span></span><br><span class="line"><span class="comment">// precedence on the credentials specified through the options.</span></span><br><span class="line"><span class="comment">// For instance, in the connect call below, the client library will use</span></span><br><span class="line"><span class="comment">// the user &quot;my&quot; and password &quot;pwd&quot; to connect to localhost:4222, however,</span></span><br><span class="line"><span class="comment">// it will use username &quot;foo&quot; and password &quot;bar&quot; when (re)connecting to</span></span><br><span class="line"><span class="comment">// a different server URL that it got as part of the auto-discovery.</span></span><br><span class="line">nc, err = nats.Connect(<span class="string">&quot;nats://my:pwd@localhost:4222&quot;</span>, nats.UserInfo(<span class="string">&quot;foo&quot;</span>, <span class="string">&quot;bar&quot;</span>))</span><br></pre></td></tr></table></figure>

<h3 id="ä¸Šä¸‹æ–‡æ”¯æŒ-Go1-7"><a href="#ä¸Šä¸‹æ–‡æ”¯æŒ-Go1-7" class="headerlink" title="ä¸Šä¸‹æ–‡æ”¯æŒ (+ Go1.7)"></a>ä¸Šä¸‹æ–‡æ”¯æŒ (+ Go1.7)</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">ctx, cancel := context.WithTimeout(context.Background(), <span class="number">2</span>*time.Second)</span><br><span class="line"><span class="keyword">defer</span> cancel()</span><br><span class="line"></span><br><span class="line">nc, err := nats.Connect(nats.DefaultURL)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Request with context</span></span><br><span class="line">msg, err := nc.RequestWithContext(ctx, <span class="string">&quot;foo&quot;</span>, []<span class="type">byte</span>(<span class="string">&quot;bar&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// Synchronous subscriber with context</span></span><br><span class="line">sub, err := nc.SubscribeSync(<span class="string">&quot;foo&quot;</span>)</span><br><span class="line">msg, err := sub.NextMsgWithContext(ctx)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Encoded Request with context</span></span><br><span class="line">c, err := nats.NewEncodedConn(nc, nats.JSON_ENCODER)</span><br><span class="line"><span class="keyword">type</span> request <span class="keyword">struct</span> &#123;</span><br><span class="line">	Message <span class="type">string</span> <span class="string">`json:&quot;message&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> response <span class="keyword">struct</span> &#123;</span><br><span class="line">	Code <span class="type">int</span> <span class="string">`json:&quot;code&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line">req := &amp;request&#123;Message: <span class="string">&quot;Hello&quot;</span>&#125;</span><br><span class="line">resp := &amp;response&#123;&#125;</span><br><span class="line">err := c.RequestWithContext(ctx, <span class="string">&quot;foo&quot;</span>, req, resp)</span><br></pre></td></tr></table></figure>

<h2 id="NATS-Streaming"><a href="#NATS-Streaming" class="headerlink" title="NATS Streaming"></a>NATS Streaming</h2><p>æºç å®‰è£…</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Go client</span></span><br><span class="line">go get github.com/nats-io/stan.go/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Server</span></span><br><span class="line">go get github.com/nats-io/nats-streaming-server</span><br></pre></td></tr></table></figure>

<p>äºŒè¿›åˆ¶ï¼š<a target="_blank" rel="noopener" href="https://nats.io/download/nats-io/nats-streaming-server/">https://nats.io/download/nats-io/nats-streaming-server/</a></p>
<p>When using or transitioning to Go modules support:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Go client latest or explicit version</span></span><br><span class="line">go get github.com/nats-io/stan.go/@latest</span><br><span class="line">go get github.com/nats-io/stan.go/@v0.5.0</span><br></pre></td></tr></table></figure>

<h3 id="åŸºæœ¬ç”¨æ³•-1"><a href="#åŸºæœ¬ç”¨æ³•-1" class="headerlink" title="åŸºæœ¬ç”¨æ³•"></a>åŸºæœ¬ç”¨æ³•</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> stan <span class="string">&quot;github.com/nats-io/stan.go&quot;</span></span><br><span class="line"></span><br><span class="line">sc, _ := stan.Connect(clusterID, clientID)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Simple Synchronous Publisher</span></span><br><span class="line">sc.Publish(<span class="string">&quot;foo&quot;</span>, []<span class="type">byte</span>(<span class="string">&quot;Hello World&quot;</span>)) <span class="comment">// does not return until an ack has been received from NATS Streaming</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Simple Async Subscriber</span></span><br><span class="line">sub, _ := sc.Subscribe(<span class="string">&quot;foo&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(m *stan.Msg)</span></span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Received a message: %s\n&quot;</span>, <span class="type">string</span>(m.Data))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Unsubscribe</span></span><br><span class="line">sub.Unsubscribe()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Close connection</span></span><br><span class="line">sc.Close()</span><br></pre></td></tr></table></figure>

<h4 id="è®¢é˜…å¯åŠ¨-i-e-é‡æ’­-é€‰é¡¹"><a href="#è®¢é˜…å¯åŠ¨-i-e-é‡æ’­-é€‰é¡¹" class="headerlink" title="è®¢é˜…å¯åŠ¨ (i.e.é‡æ’­)é€‰é¡¹"></a>è®¢é˜…å¯åŠ¨ (i.e.é‡æ’­)é€‰é¡¹</h4><p>NATS Streaming subscriptions are similar to NATS subscriptions, but  clients may start their subscription at an earlier point in the message  stream, allowing them to receive messages that were published before  this client registered interest.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Subscribe starting with most recently published value</span></span><br><span class="line">sub, err := sc.Subscribe(<span class="string">&quot;foo&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(m *stan.Msg)</span></span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Received a message: %s\n&quot;</span>, <span class="type">string</span>(m.Data))</span><br><span class="line">&#125;, stan.StartWithLastReceived())</span><br><span class="line"></span><br><span class="line"><span class="comment">// Receive all stored values in order</span></span><br><span class="line">sub, err := sc.Subscribe(<span class="string">&quot;foo&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(m *stan.Msg)</span></span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Received a message: %s\n&quot;</span>, <span class="type">string</span>(m.Data))</span><br><span class="line">&#125;, stan.DeliverAllAvailable())</span><br><span class="line"></span><br><span class="line"><span class="comment">// Receive messages starting at a specific sequence number</span></span><br><span class="line">sub, err := sc.Subscribe(<span class="string">&quot;foo&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(m *stan.Msg)</span></span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Received a message: %s\n&quot;</span>, <span class="type">string</span>(m.Data))</span><br><span class="line">&#125;, stan.StartAtSequence(<span class="number">22</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// Subscribe starting at a specific time</span></span><br><span class="line"><span class="keyword">var</span> startTime time.Time</span><br><span class="line">...</span><br><span class="line">sub, err := sc.Subscribe(<span class="string">&quot;foo&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(m *stan.Msg)</span></span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Received a message: %s\n&quot;</span>, <span class="type">string</span>(m.Data))</span><br><span class="line">&#125;, stan.StartAtTime(startTime))</span><br><span class="line"></span><br><span class="line"><span class="comment">// Subscribe starting a specific amount of time in the past (e.g. 30 seconds ago)</span></span><br><span class="line">sub, err := sc.Subscribe(<span class="string">&quot;foo&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(m *stan.Msg)</span></span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Received a message: %s\n&quot;</span>, <span class="type">string</span>(m.Data))</span><br><span class="line">&#125;, stan.StartAtTimeDelta(time.ParseDuration(<span class="string">&quot;30s&quot;</span>)))</span><br></pre></td></tr></table></figure>

<h4 id="æŒä¹…è®¢é˜…"><a href="#æŒä¹…è®¢é˜…" class="headerlink" title="æŒä¹…è®¢é˜…"></a>æŒä¹…è®¢é˜…</h4><p>Replay of messages offers great flexibility for clients wishing to  begin processing at some earlier point in the data stream. However, some clients just need to pick up where they left off from an  earlier session, without having to manually track their position in the  stream of messages. Durable subscriptions allow clients to assign a durable name to a  subscription when it is created. Doing this causes the NATS Streaming server to track the last  acknowledged message for that clientID + durable name, so that only  messages since the last acknowledged message will be delivered to the  client.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">sc, _ := stan.Connect(<span class="string">&quot;test-cluster&quot;</span>, <span class="string">&quot;client-123&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Subscribe with durable name</span></span><br><span class="line">sc.Subscribe(<span class="string">&quot;foo&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(m *stan.Msg)</span></span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Received a message: %s\n&quot;</span>, <span class="type">string</span>(m.Data))</span><br><span class="line">&#125;, stan.DurableName(<span class="string">&quot;my-durable&quot;</span>))</span><br><span class="line">...</span><br><span class="line"><span class="comment">// client receives message sequence 1-40</span></span><br><span class="line">...</span><br><span class="line"><span class="comment">// client disconnects for an hour</span></span><br><span class="line">...</span><br><span class="line"><span class="comment">// client reconnects with same clientID &quot;client-123&quot;</span></span><br><span class="line">sc, _ := stan.Connect(<span class="string">&quot;test-cluster&quot;</span>, <span class="string">&quot;client-123&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// client re-subscribes to &quot;foo&quot; with same durable name &quot;my-durable&quot;</span></span><br><span class="line">sc.Subscribe(<span class="string">&quot;foo&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(m *stan.Msg)</span></span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Received a message: %s\n&quot;</span>, <span class="type">string</span>(m.Data))</span><br><span class="line">&#125;, stan.DurableName(<span class="string">&quot;my-durable&quot;</span>))</span><br><span class="line">...</span><br><span class="line"><span class="comment">// client receives messages 41-current</span></span><br></pre></td></tr></table></figure>

<h4 id="é˜Ÿåˆ—ç»„-1"><a href="#é˜Ÿåˆ—ç»„-1" class="headerlink" title="é˜Ÿåˆ—ç»„"></a>é˜Ÿåˆ—ç»„</h4><p>æ‰€æœ‰å…·æœ‰ç›¸åŒé˜Ÿåˆ—åç§°çš„è®¢é˜…ï¼ˆä¸ç®¡è¿æ¥æ˜¯ä»€ä¹ˆï¼‰ å®ƒä»¬èµ·æºäº)å°†å½¢æˆä¸€ä¸ªé˜Ÿåˆ—ç»„ã€‚ æ¯æ¡æ¶ˆæ¯å°†è¢«ä¼ é€’ç»™æ¯ä¸ªé˜Ÿåˆ—ç»„åªæœ‰ä¸€ä¸ªè®¢é˜…è€…ï¼Œ ä½¿ç”¨é˜Ÿåˆ—è¯­ä¹‰ã€‚æ‚¨å¯ä»¥å¸Œæœ›æœ‰å¤šå°‘é˜Ÿåˆ—ç»„ã€‚</p>
<p>æ­£å¸¸çš„è®¢æˆ·å°†ç»§ç»­æŒ‰é¢„æœŸå·¥ä½œã€‚</p>
<h5 id="åˆ›å»ºé˜Ÿåˆ—ç»„"><a href="#åˆ›å»ºé˜Ÿåˆ—ç»„" class="headerlink" title="åˆ›å»ºé˜Ÿåˆ—ç»„"></a>åˆ›å»ºé˜Ÿåˆ—ç»„</h5><p>å½“ç¬¬ä¸€ä¸ªé˜Ÿåˆ—è®¢é˜…è€…æ˜¯è‡ªåŠ¨åˆ›å»ºé˜Ÿåˆ—ç»„ åˆ›å»ºã€‚å¦‚æœç»„å·²ç»å­˜åœ¨ï¼Œåˆ™å°†æˆå‘˜æ·»åŠ åˆ°ç»„ã€‚ </p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sc, _ := stan.Connect(<span class="string">&quot;test-cluster&quot;</span>, <span class="string">&quot;clientid&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a queue subscriber on &quot;foo&quot; for group &quot;bar&quot;</span></span><br><span class="line">qsub1, _ := sc.QueueSubscribe(<span class="string">&quot;foo&quot;</span>, <span class="string">&quot;bar&quot;</span>, qcb)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add a second member</span></span><br><span class="line">qsub2, _ := sc.QueueSubscribe(<span class="string">&quot;foo&quot;</span>, <span class="string">&quot;bar&quot;</span>, qcb)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Notice that you can have a regular subscriber on that subject</span></span><br><span class="line">sub, _ := sc.Subscribe(<span class="string">&quot;foo&quot;</span>, cb)</span><br><span class="line"></span><br><span class="line"><span class="comment">// A message on &quot;foo&quot; will be received by sub and qsub1 or qsub2.</span></span><br></pre></td></tr></table></figure>

<h5 id="èµ·å§‹ä½ç½®"><a href="#èµ·å§‹ä½ç½®" class="headerlink" title="èµ·å§‹ä½ç½®"></a>èµ·å§‹ä½ç½®</h5><p>æ³¨æ„ï¼Œä¸€æ—¦å½¢æˆé˜Ÿåˆ—ç»„ï¼Œæˆå‘˜çš„èµ·å§‹ä½ç½®å°±ä¼šè¢«å¿½ç•¥ å½“åŠ å…¥å°ç»„æ—¶ã€‚å®ƒå°†å¼€å§‹æ¥æ”¶æ¶ˆæ¯ä»æœ€å åœ¨å°ç»„ä¸­çš„ä½ç½®ã€‚</p>
<p>å‡è®¾é¢‘é“<code>foo</code>å­˜åœ¨ä¸å­˜åœ¨<code>500</code>å­˜å‚¨çš„æ¶ˆæ¯ç»„<code>bar</code>å·²ç»åˆ›å»ºæœ‰ä¸¤ä¸ªæˆå‘˜å’Œæœ€åä¸€ä¸ª æ¶ˆæ¯åºåˆ—å‘é€<code>100</code>.å¢åŠ äº†ä¸€ä¸ªæ–°æˆå‘˜ã€‚æ³¨æ„å®ƒçš„èµ·å§‹ä½ç½®ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc.QueueSubscribe(<span class="string">&quot;foo&quot;</span>, <span class="string">&quot;bar&quot;</span>, qcb, stan.StartAtSequence(<span class="number">200</span>))</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ä¼šäº§ç”Ÿé”™è¯¯ï¼Œä½†æ˜¯å¼€å§‹ä½ç½®å°†è¢«å¿½ç•¥ã€‚å‡å®šçš„ è¿™ä¸ªæˆå‘˜å°†æ˜¯æ¥æ”¶ä¸‹ä¸€ä¸ªæ¶ˆæ¯çš„äººå®ƒå°†æ¥æ”¶æ¶ˆæ¯ åºåˆ—<code>101</code>. </p>
<h5 id="ç¦»å¼€é˜Ÿåˆ—ç»„"><a href="#ç¦»å¼€é˜Ÿåˆ—ç»„" class="headerlink" title="ç¦»å¼€é˜Ÿåˆ—ç»„"></a>ç¦»å¼€é˜Ÿåˆ—ç»„</h5><p> ç¦»å¼€ç»„çš„æ–¹æ³•æœ‰ä¸¤ç§ï¼šå…³é—­è®¢é˜…è€…çš„è¿æ¥æˆ–è°ƒç”¨<code>Unsubscribe</code>ï¼š </p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Have qsub leave the queue group</span></span><br><span class="line">qsub.Unsubscribe()</span><br></pre></td></tr></table></figure>

<p>å¦‚æœç¦»å¼€æˆå‘˜æœ‰æœªç¡®è®¤çš„æ¶ˆæ¯ï¼Œåˆ™é‡æ–°åˆ†é…è¿™äº›æ¶ˆæ¯ è‡´å…¶ä½™çš„æˆå‘˜ã€‚ </p>
<h5 id="å…³é—­é˜Ÿåˆ—ç»„"><a href="#å…³é—­é˜Ÿåˆ—ç»„" class="headerlink" title="å…³é—­é˜Ÿåˆ—ç»„"></a>å…³é—­é˜Ÿåˆ—ç»„</h5><p>è¿™æ–¹é¢æ²¡æœ‰ç‰¹åˆ«çš„ APIã€‚ä¸€æ—¦æ‰€æœ‰æˆå‘˜éƒ½ç¦»å¼€äº†<code>Unsubscribe</code>, æˆ–è€…ä»–ä»¬çš„è¿æ¥æ˜¯å…³é—­çš„ï¼‰ï¼Œç»„ä»æœåŠ¡å™¨ä¸­åˆ é™¤ã€‚</p>
<p>ä¸‹ä¸€ä¸ªè¦æ±‚<code>QueueSubscribe</code>ä½¿ç”¨ç›¸åŒçš„ç»„åå°†åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„ç»„ ä¹Ÿå°±æ˜¯è¯´ï¼Œå¼€å§‹ä½ç½®å°†ç”Ÿæ•ˆï¼Œäº¤ä»˜å°†ä»é‚£é‡Œå¼€å§‹ã€‚</p>
<h4 id="æŒä¹…é˜Ÿåˆ—ç»„"><a href="#æŒä¹…é˜Ÿåˆ—ç»„" class="headerlink" title="æŒä¹…é˜Ÿåˆ—ç»„"></a>æŒä¹…é˜Ÿåˆ—ç»„</h4><p>å¦‚ä¸Šæ‰€è¿°ï¼Œå¯¹äºéæŒä¹…é˜Ÿåˆ—è®¢é˜…è€…ï¼Œå½“æœ€åä¸€ä¸ªæˆå‘˜ç¦»å¼€ç»„ï¼Œ é‚£ç¾¤äººè¢«æ’¤èµ°äº†ã€‚æŒä¹…é˜Ÿåˆ—ç»„å…è®¸æ‚¨è®©æ‰€æœ‰æˆå‘˜ç¦»å¼€ä½†ä»ç„¶ ä¿æŒçŠ¶æ€ã€‚å½“ä¸€ä¸ªæˆå‘˜é‡æ–°åŠ å…¥æ—¶ï¼Œå®ƒä»è¯¥ç»„çš„æœ€åä¸€ä¸ªä½ç½®å¼€å§‹ã€‚ </p>
<h5 id="åˆ›å»ºæŒä¹…é˜Ÿåˆ—ç»„"><a href="#åˆ›å»ºæŒä¹…é˜Ÿåˆ—ç»„" class="headerlink" title="åˆ›å»ºæŒä¹…é˜Ÿåˆ—ç»„"></a>åˆ›å»ºæŒä¹…é˜Ÿåˆ—ç»„</h5><p>æŒä¹…é˜Ÿåˆ—ç»„çš„åˆ›å»ºæ–¹å¼ä¸æ ‡å‡†é˜Ÿåˆ—ç»„çš„åˆ›å»ºæ–¹å¼ç±»ä¼¼ï¼Œ é™¤äº†<code>DurableName</code>å¿…é¡»ä½¿ç”¨é€‰é¡¹æ¥æŒ‡å®šæŒä¹…æ€§ã€‚ </p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc.QueueSubscribe(<span class="string">&quot;foo&quot;</span>, <span class="string">&quot;bar&quot;</span>, qcb, stan.DurableName(<span class="string">&quot;dur&quot;</span>))</span><br></pre></td></tr></table></figure>

<p>A group called <code>dur:bar</code> (the concatenation of durable name and group name) is created in the server. This means two things:</p>
<ul>
<li>The character <code>:</code> is not allowed for a queue subscriber&#39;s durable name.</li>
<li>å…·æœ‰ç›¸åŒåç§°çš„æŒä¹…å’ŒéæŒä¹…é˜Ÿåˆ—ç»„å¯ä»¥å…±å­˜ã€‚</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Non durable queue subscriber on group &quot;bar&quot;</span></span><br><span class="line">qsub, _ := sc.QueueSubscribe(<span class="string">&quot;foo&quot;</span>, <span class="string">&quot;bar&quot;</span>, qcb)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Durable queue subscriber on group &quot;bar&quot;</span></span><br><span class="line">durQsub, _ := sc.QueueSubscribe(<span class="string">&quot;foo&quot;</span>, <span class="string">&quot;bar&quot;</span>, qcb, stan.DurableName(<span class="string">&quot;mydurablegroup&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// The same message produced on &quot;foo&quot; would be received by both queue subscribers.</span></span><br></pre></td></tr></table></figure>

<h6 id="èµ·å§‹ä½ç½®-1"><a href="#èµ·å§‹ä½ç½®-1" class="headerlink" title="èµ·å§‹ä½ç½®"></a>èµ·å§‹ä½ç½®</h6><p>éæŒä¹…é˜Ÿåˆ—è®¢é˜…è€…çš„è§„åˆ™é€‚ç”¨äºæŒä¹…è®¢é˜…è€…ã€‚ </p>
<h6 id="ç¦»å¼€é˜Ÿåˆ—ç»„-1"><a href="#ç¦»å¼€é˜Ÿåˆ—ç»„-1" class="headerlink" title="ç¦»å¼€é˜Ÿåˆ—ç»„"></a>ç¦»å¼€é˜Ÿåˆ—ç»„</h6><p> è‡³äºéæŒä¹…é˜Ÿåˆ—è®¢é˜…è€…ï¼Œå¦‚æœæˆå‘˜çš„è¿æ¥å·²å…³é—­ï¼Œæˆ–å¦‚æœ<code>Unsubscribe</code>å®ƒçš„åç§°ï¼Œæˆå‘˜ç¦»å¼€ç»„ã€‚ä»»ä½•æœªç¡®è®¤çš„æ¶ˆæ¯ è¢«è½¬ç§»åˆ°å‰©ä¸‹çš„æˆå‘˜ã€‚æŸ¥çœ‹å…³é—­å°ç»„ä¸éæŒä¹…é˜Ÿåˆ—è®¢æˆ·é‡è¦çš„åŒºåˆ« ã€‚ </p>
<h6 id="å…³é—­é˜Ÿåˆ—ç»„-1"><a href="#å…³é—­é˜Ÿåˆ—ç»„-1" class="headerlink" title="å…³é—­é˜Ÿåˆ—ç»„"></a>å…³é—­é˜Ÿåˆ—ç»„</h6><p>é‚£<em>æœ€åçš„</em>æˆå‘˜è°ƒç”¨<code>Unsubscribe</code>å°†å…³é—­ (é‚£å°±æ˜¯æ‘§æ¯) ç»„æ‰€ä»¥å¦‚æœä½ æƒ³ä¿æŒæŒä¹…çš„é›†å›¢ä½ ä¸åº”è¯¥ å‘¼å«<code>Unsubscribe</code>.</p>
<p>å› æ­¤ï¼Œä¸éæŒä¹…é˜Ÿåˆ—è®¢é˜…è€…ä¸åŒï¼Œç»´æŠ¤é˜Ÿåˆ—ç»„æ˜¯å¯èƒ½çš„ æœåŠ¡å™¨ä¸­æ²¡æœ‰æˆå‘˜ã€‚å½“ä¸€ä¸ªæ–°æˆå‘˜é‡æ–°åŠ å…¥æŒä¹…é˜Ÿåˆ—ç»„ï¼Œ å®ƒå°†ä»å›¢é˜Ÿç¦»å¼€çš„åœ°æ–¹æ¢å¤å®é™…ä¸Šé¦–å…ˆæ¥æ”¶æ‰€æœ‰æœªè¢«æ‰¿è®¤çš„ä¿¡æ¯ å¯èƒ½åœ¨æœ€åä¸€ä¸ªæˆå‘˜ç¦»å¼€æ—¶ç•™ä¸‹çš„æ¶ˆæ¯ã€‚</p>
<h4 id="é€šé…ç¬¦è®¢é˜…-1"><a href="#é€šé…ç¬¦è®¢é˜…-1" class="headerlink" title="é€šé…ç¬¦è®¢é˜…"></a>é€šé…ç¬¦è®¢é˜…</h4><p>NATS æµåª’ä½“è®¢é˜…<strong>ä¸</strong>æ”¯æŒé€šé…ç¬¦ã€‚ </p>
<h3 id="é«˜çº§ç”¨æ³•-1"><a href="#é«˜çº§ç”¨æ³•-1" class="headerlink" title="é«˜çº§ç”¨æ³•"></a>é«˜çº§ç”¨æ³•</h3><h4 id="è¿æ¥é…ç½®ï¼Œå¦‚-TLS-ç­‰"><a href="#è¿æ¥é…ç½®ï¼Œå¦‚-TLS-ç­‰" class="headerlink" title="è¿æ¥é…ç½®ï¼Œå¦‚ TLS ç­‰"></a>è¿æ¥é…ç½®ï¼Œå¦‚ TLS ç­‰</h4><p>å¦‚æœæ‚¨æƒ³è¦æ›´é«˜çº§çš„é…ç½®åº•å±‚ NATS è¿æ¥æ‚¨å°†éœ€è¦ åˆ›å»ºä¸€ä¸ª NATS è¿æ¥è°ƒç”¨<code>stan.NatsConn()</code>é€‰é¡¹å¹¶å°†è¯¥è¿æ¥ä¼ é€’åˆ°<code>stan.Connect()</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a NATS connection that you can configure the way you want</span></span><br><span class="line">nc, err = nats.Connect(<span class="string">&quot;tls://localhost:4443&quot;</span>, nats.ClientCert(<span class="string">&quot;mycerts/client-cert.pem&quot;</span>, <span class="string">&quot;mycerts/client-key.pem&quot;</span>))</span><br><span class="line"><span class="keyword">if</span> (err != <span class="literal">nil</span>)</span><br><span class="line"> ...</span><br><span class="line"></span><br><span class="line"><span class="comment">// Then pass it to the stan.Connect() call.</span></span><br><span class="line">sc, err = stan.Connect(<span class="string">&quot;test-cluster&quot;</span>, <span class="string">&quot;me&quot;</span>, stan.NatsConn(nc))</span><br><span class="line"><span class="keyword">if</span> (err != <span class="literal">nil</span>)</span><br><span class="line"> ...</span><br><span class="line"></span><br><span class="line"><span class="comment">// Note that you will be responsible for closing the NATS Connection after the streaming</span></span><br><span class="line"><span class="comment">// connection has been closed.</span></span><br></pre></td></tr></table></figure>

<h4 id="è¿æ¥çŠ¶æ€"><a href="#è¿æ¥çŠ¶æ€" class="headerlink" title="è¿æ¥çŠ¶æ€"></a>è¿æ¥çŠ¶æ€</h4><p>NATS æµæœåŠ¡å™¨å’Œå®¢æˆ·æœºä¹‹é—´æ²¡æœ‰ç›´æ¥è¿æ¥ï¼Œè¿™å¯¹äº†è§£å®¢æˆ·æœºæ˜¯å¦ä»ç„¶æœ‰æ•ˆæå‡ºäº†æŒ‘æˆ˜ã€‚ å½“å®¢æˆ·ç«¯æ–­å¼€æ—¶æµæœåŠ¡å™¨ä¸è¢«é€šçŸ¥å› æ­¤è°ƒç”¨çš„é‡è¦æ€§<code>Close()</code>.æœåŠ¡å™¨å‘é€å¿ƒè·³ åˆ°å®¢æˆ·ç«¯çš„ç§äººæ”¶ä»¶ç®±å¦‚æœå®ƒé”™è¿‡äº†ä¸€å®šæ•°é‡çš„å“åº”å®ƒå°†è€ƒè™‘å®¢æˆ·ç«¯çš„è¿æ¥ä¸¢å¤±å¹¶åˆ é™¤å®ƒ ä»å®ƒçš„çŠ¶æ€ã€‚</p>
<p>å‰ç‰ˆæœ¬<code>0.4.0</code>ï¼Œå®¢æˆ·ç«¯åº“æ²¡æœ‰å°† PINS å‘é€åˆ°æµæœåŠ¡å™¨ï¼Œä»¥æ£€æµ‹è¿æ¥å¤±è´¥ã€‚è¿™æ˜¯æœ‰é—®é¢˜çš„ ç‰¹åˆ«æ˜¯å¦‚æœåº”ç”¨ç¨‹åºä»æœªå‘é€æ•°æ®ï¼ˆä¾‹å¦‚åªæœ‰è®¢é˜…ï¼‰ã€‚å›¾ç‰‡çš„æƒ…å†µä¸‹ä¸€ä¸ªå®¢æˆ·è¿æ¥åˆ°ä¸€ä¸ª NATS æœåŠ¡å™¨æœ‰ä¸€æ¡é€šå¾€ NATS æµæœåŠ¡å™¨çš„è·¯å¾„ï¼ˆè¿æ¥åˆ°ç‹¬ç«‹çš„ NATS æœåŠ¡å™¨æˆ–å®ƒåµŒå…¥çš„æœåŠ¡å™¨ï¼‰ã€‚å¦‚æœ æµæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„ NATS æœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥ä¸­æ–­ï¼Œå®¢æˆ·ç«¯çš„ NATS è¿æ¥ä»ç„¶å¯ä»¥ï¼Œä½†æ˜¯æ²¡æœ‰ ä¸æµæœåŠ¡å™¨é€šä¿¡æ˜¯å¯èƒ½çš„ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¾èµ–<code>Conn.NatsConn()</code>æ£€æŸ¥çŠ¶æ€æ˜¯æ²¡æœ‰å¸®åŠ©çš„ã€‚</p>
<p>å¼€å§‹ç‰ˆæœ¬<code>0.4.0</code>è¿™ä¸ªåº“å’ŒæœåŠ¡å™¨çš„<code>0.10.0</code>ï¼Œå®¢æˆ·ç«¯åº“ç°åœ¨å°†å®šæœŸå‘é€ PINGï¼ˆé»˜è®¤ä¸º5ç§’ï¼‰ å¹¶å°†å…³é—­æµè¿æ¥åï¼Œä¸€å®šæ•°é‡çš„ PINS å·²å‘é€æ²¡æœ‰ä»»ä½•å“åº”ï¼ˆé»˜è®¤æ˜¯3ï¼‰ã€‚å½“é‚£æ—¶å€™ ç¢°å·§ï¼Œå›è°ƒï¼ˆå¦‚æœæ³¨å†Œäº†ï¼‰å°†è¢«è°ƒç”¨ï¼Œä»¥é€šçŸ¥ç”¨æˆ·è¿æ¥æ°¸ä¹…ä¸¢å¤±ï¼Œä»¥åŠåŸå›  å› ä¸ºå¤±è´¥äº†ã€‚</p>
<p>ä»¥ä¸‹æ˜¯æ‚¨å°†å¦‚ä½•æŒ‡å®šè‡ªå·±çš„ PING å€¼å’Œå›è°ƒï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Send PINGs every 10 seconds, and fail after 5 PINGs without any response.</span></span><br><span class="line">sc, err := stan.Connect(clusterName, clientName,</span><br><span class="line">  	stan.Pings(<span class="number">10</span>, <span class="number">5</span>),    </span><br><span class="line">  	stan.SetConnectionLostHandler(<span class="function"><span class="keyword">func</span><span class="params">(_ stan.Conn, reason <span class="type">error</span>)</span></span> &#123;</span><br><span class="line">    	log.Fatalf(<span class="string">&quot;Connection lost, reason: %v&quot;</span>, reason)</span><br><span class="line">	&#125;)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼Œè¦é€šçŸ¥çš„å”¯ä¸€æ–¹æ³•æ˜¯è®¾ç½®å›è°ƒã€‚å¦‚æœæ²¡æœ‰è®¾ç½®å›è°ƒï¼Œåˆ™ä»ç„¶å‘é€ PING å’Œè¿æ¥ å¦‚æœéœ€è¦ï¼Œå°†å…³é—­ï¼Œä½†åº”ç”¨ç¨‹åºå°†ä¸çŸ¥é“å®ƒæ˜¯å¦åªæœ‰è®¢é˜…ã€‚</p>
<p>å½“è¿æ¥ä¸¢å¤±æ—¶ï¼Œåº”ç”¨ç¨‹åºå°†ä¸å¾—ä¸é‡æ–°åˆ›å»ºå®ƒå’Œæ‰€æœ‰è®¢é˜…ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚</p>
<p>å½“æ²¡æœ‰ NATS è¿æ¥æä¾›ç»™<code>Connect()</code>è°ƒç”¨ï¼Œåº“åˆ›å»ºå®ƒè‡ªå·±çš„ NATS è¿æ¥ï¼Œç°åœ¨å°† å°†é‡æ–°è¿æ¥å°è¯•è®¾ç½®ä¸º â€œæ— é™â€ï¼Œä»¥å‰ä¸æ˜¯è¿™æ ·çš„ã€‚å› æ­¤å›¾ä¹¦é¦†åº”è¯¥æœ‰å¯èƒ½ æ€»æ˜¯é‡æ–°è¿æ¥ä½†è¿™å¹¶ä¸æ„å‘³ç€æµè¿æ¥ä¸ä¼šè¢«å…³é—­å³ä½¿æ‚¨è®¾ç½®çš„éå¸¸é«˜ PINS çš„é˜ˆå€¼æœ€å¤§è¾“å‡ºå€¼ã€‚è¯·è®°ä½ï¼Œå½“å®¢æˆ·ç«¯æ–­å¼€æ—¶ï¼ŒæœåŠ¡å™¨æ­£åœ¨å‘å…¶å‘é€å¿ƒè·³ä¿¡å· å®¢æˆ·æœºä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå½“æ²¡æœ‰å¾—åˆ°ä»»ä½•å“åº”æ—¶ï¼Œå®ƒå°†æŠŠå®¢æˆ·æœºä»å®ƒçš„çŠ¶æ€ä¸­åˆ é™¤ã€‚å½“é€šä¿¡æ¢å¤æ—¶ï¼Œ å‘é€åˆ°æœåŠ¡å™¨çš„ PINS å°†å…è®¸æ£€æµ‹æ­¤æ¡ä»¶å¹¶å‘å®¢æˆ·æœºæŠ¥å‘Šè¿æ¥ç°åœ¨å·²å…³é—­ã€‚</p>
<p>æ­¤å¤–ï¼Œå½“å®¢æˆ·æœºä¸æœåŠ¡å™¨ â€œæ–­å¼€è¿æ¥â€ æ—¶ï¼Œå¦ä¸€ä¸ªè¿æ¥åˆ°æµæœåŠ¡å™¨çš„åº”ç”¨ç¨‹åºå¯èƒ½ä¼š è¿æ¥å¹¶ä½¿ç”¨ç›¸åŒçš„å®¢æˆ·ç«¯ IDã€‚å½“æ£€æµ‹é‡å¤çš„å®¢æˆ·ç«¯ ID æ—¶æœåŠ¡å™¨å°†å°è¯•ä¸ç¬¬ä¸€ä¸ªå®¢æˆ·ç«¯è”ç³» è¦çŸ¥é“å®ƒæ˜¯å¦åº”è¯¥æ‹’ç»ç¬¬äºŒä¸ªå®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ã€‚ç”±äºé€šä¿¡ä¹‹é—´çš„æœåŠ¡å™¨å’Œ ç¬¬ä¸€ä¸ªå®¢æˆ·æœºè¢«ç ´åï¼ŒæœåŠ¡å™¨å°†å¾—ä¸åˆ°å“åº”ï¼Œå› æ­¤å°†ç”¨ç¬¬äºŒä¸ªå®¢æˆ·æœºæ›¿æ¢ç¬¬ä¸€ä¸ªå®¢æˆ·æœºã€‚</p>
<p>åœ¨å®¢æˆ·ä¹‹å‰<code>0.4.0</code>ä¸æœåŠ¡å™¨<code>0.10.0</code>ï¼Œå¦‚æœè¦æ¢å¤ç¬¬ä¸€ä¸ªå®¢æˆ·æœºå’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ï¼Œ è€Œåº”ç”¨ç¨‹åºå°†å‘é€æ¶ˆæ¯æœåŠ¡å™¨å°†æ¥å—è¿™äº›æ¶ˆæ¯å› ä¸ºå‘å¸ƒçš„æ¶ˆæ¯å®¢æˆ·ç«¯ ID æ˜¯ æœ‰æ•ˆï¼Œå°½ç®¡å®¢æˆ·ç«¯æ˜¯æ— æ•ˆçš„ã€‚ä¸å®¢æˆ·åœ¨<code>0.4.0+</code>ä¸æœåŠ¡å™¨<code>0.10.0+</code>ï¼Œæ¯ä¸ªäººéƒ½ä¼šå‘é€æ›´å¤šçš„ä¿¡æ¯ æ¶ˆæ¯ï¼Œå…è®¸æœåŠ¡å™¨æ‹’ç»æ¥è‡ªå·²è¢«å¦ä¸€ä¸ªå®¢æˆ·æœºæ›¿æ¢çš„å®¢æˆ·æœºçš„æ¶ˆæ¯ã€‚</p>
<h4 id="å¼‚æ­¥å‘å¸ƒ"><a href="#å¼‚æ­¥å‘å¸ƒ" class="headerlink" title="å¼‚æ­¥å‘å¸ƒ"></a>å¼‚æ­¥å‘å¸ƒ</h4><p>åŸºæœ¬å‘å¸ƒ API (<code>Publish(subject, payload)</code>)æ˜¯åŒæ­¥çš„;åœ¨ NATS æµæœåŠ¡å™¨ç¡®è®¤æ”¶åˆ°æ¶ˆæ¯ä¹‹å‰ï¼Œå®ƒä¸ä¼šå°†æ§åˆ¶è¿”å›ç»™è°ƒç”¨è€…ã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹<a target="_blank" rel="noopener" href="https://github.com/nats-io/nuid">nuid</a>æ˜¯ä¸ºåˆ›å»ºæ—¶çš„æ¶ˆæ¯ç”Ÿæˆçš„ï¼Œå®¢æˆ·ç«¯åº“åœ¨æœåŠ¡å™¨è¿”å›æ§åˆ¶æƒç»™è°ƒç”¨è€…ä¹‹å‰ç­‰å¾…æ¥è‡ªæœåŠ¡å™¨çš„å‘å¸ƒç¡®è®¤ï¼Œè¿™å¯èƒ½æ˜¯ç”±äºæœåŠ¡å™¨é—®é¢˜æˆ–æˆæƒé”™è¯¯å¯¼è‡´æ“ä½œä¸æˆåŠŸçš„é”™è¯¯ã€‚</p>
<p>é«˜çº§ç”¨æˆ·å¯èƒ½å¸Œæœ›æ‰‹åŠ¨å¤„ç†è¿™äº›å‘å¸ƒç¡®è®¤ï¼Œé€šè¿‡åœ¨å‘å¸ƒæ“ä½œæœŸé—´ä¸ç­‰å¾…å•ä¸ªç¡®è®¤æ¥å®ç°æ›´é«˜çš„å‘å¸ƒååé‡ã€‚ä¸ºæ­¤æä¾›äº†å¼‚æ­¥å‘å¸ƒ APIï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ackHandler := <span class="function"><span class="keyword">func</span><span class="params">(ackedNuid <span class="type">string</span>, err <span class="type">error</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Printf(<span class="string">&quot;Warning: error publishing msg id %s: %v\n&quot;</span>, ackedNuid, err.Error())</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        log.Printf(<span class="string">&quot;Received ack for msg id %s\n&quot;</span>, ackedNuid)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">nuid, err := sc.PublishAsync(<span class="string">&quot;foo&quot;</span>, []<span class="type">byte</span>(<span class="string">&quot;Hello World&quot;</span>), ackHandler) <span class="comment">// returns immediately</span></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    log.Printf(<span class="string">&quot;Error publishing msg %s: %v\n&quot;</span>, nuid, err.Error())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æ¶ˆæ¯ç¡®è®¤å’Œå›å¤"><a href="#æ¶ˆæ¯ç¡®è®¤å’Œå›å¤" class="headerlink" title="æ¶ˆæ¯ç¡®è®¤å’Œå›å¤"></a>æ¶ˆæ¯ç¡®è®¤å’Œå›å¤</h4><p>NATS æµæä¾›äº†è‡³å°‘ä¸€æ¬¡äº¤ä»˜è¯­ä¹‰ï¼Œè¿™æ„å‘³ç€ä¸€æ—¦æ¶ˆæ¯è¢«ä¼ é€’ç»™äº†åˆæ ¼çš„è®¢é˜…è€…ï¼Œå¦‚æœåœ¨é…ç½®çš„è¶…æ—¶é—´éš”å†…æ²¡æœ‰æ¥æ”¶åˆ°ç¡®è®¤ï¼ŒNATS æµå°†å°è¯•é‡æ–°å‘é€æ¶ˆæ¯ã€‚ æ­¤è¶…æ—¶é—´éš”ç”±è®¢é˜…é€‰é¡¹æŒ‡å®š<code>AckWait</code>ï¼Œé»˜è®¤ä¸º30ç§’ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨è°ƒç”¨è®¢é˜…æœåŠ¡å™¨çš„æ¶ˆæ¯å¤„ç†ç¨‹åºåï¼ŒNATS æµå®¢æˆ·ç«¯åº“è‡ªåŠ¨ç¡®è®¤æ¶ˆæ¯ã€‚ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè®¢é˜…å®¢æˆ·ç«¯å¸Œæœ›åŠ é€Ÿæˆ–å»¶è¿Ÿå¯¹æ¶ˆæ¯çš„ç¡®è®¤ã€‚ è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œå®¢æˆ·ç«¯å¿…é¡»åœ¨è®¢é˜…ä¸Šè®¾ç½®æ‰‹åŠ¨ç¡®è®¤æ¨¡å¼ï¼Œå¹¶è°ƒç”¨<code>Ack()</code>å…³äº<code>Msg</code>. ä¾‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Subscribe with manual ack mode, and set AckWait to 60 seconds</span></span><br><span class="line">aw, _ := time.ParseDuration(<span class="string">&quot;60s&quot;</span>)</span><br><span class="line">sub, err := sc.Subscribe(<span class="string">&quot;foo&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(m *stan.Msg)</span></span> &#123;</span><br><span class="line">  m.Ack() <span class="comment">// ack message before performing I/O intensive operation</span></span><br><span class="line">  <span class="comment">///...</span></span><br><span class="line">  fmt.Printf(<span class="string">&quot;Received a message: %s\n&quot;</span>, <span class="type">string</span>(m.Data))</span><br><span class="line">&#125;, stan.SetManualAckMode(), stan.AckWait(aw))</span><br></pre></td></tr></table></figure>

<h3 id="é€Ÿç‡é™åˆ¶-åŒ¹é…"><a href="#é€Ÿç‡é™åˆ¶-åŒ¹é…" class="headerlink" title="é€Ÿç‡é™åˆ¶&#x2F;åŒ¹é…"></a>é€Ÿç‡é™åˆ¶&#x2F;åŒ¹é…</h3><p> å‘å¸ƒ-è®¢é˜…æ¶ˆæ¯ä¼ é€’çš„ä¸€ä¸ªç»å…¸é—®é¢˜æ˜¯æ¶ˆæ¯ç”Ÿäº§è€…çš„é€Ÿç‡ä¸æ¶ˆæ¯ä½¿ç”¨è€…çš„é€Ÿç‡åŒ¹é…ã€‚ æ¶ˆæ¯ç”Ÿæˆç¨‹åºé€šå¸¸å¯ä»¥è¶…è¿‡ä½¿ç”¨å®ƒä»¬çš„æ¶ˆæ¯çš„è®¢é˜…è€…çš„é€Ÿåº¦ã€‚ è¿™ç§ä¸åŒ¹é…é€šå¸¸è¢«ç§°ä¸º â€œå¿«é€Ÿç”Ÿäº§è€…&#x2F;æ…¢æ¶ˆè´¹è€…â€ é—®é¢˜ï¼Œå¹¶å¯èƒ½å¯¼è‡´åº•å±‚æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿçš„èµ„æºåˆ©ç”¨ç‡æ€¥å‰§ä¸Šå‡ï¼Œå› ä¸ºå®ƒè¯•å›¾ç¼“å†²æ¶ˆæ¯ï¼Œç›´åˆ°æ…¢æ¶ˆè´¹è€…èƒ½å¤Ÿèµ¶ä¸Šã€‚ </p>
<h4 id="å‘å¸ƒè€…é€Ÿç‡é™åˆ¶"><a href="#å‘å¸ƒè€…é€Ÿç‡é™åˆ¶" class="headerlink" title="å‘å¸ƒè€…é€Ÿç‡é™åˆ¶"></a>å‘å¸ƒè€…é€Ÿç‡é™åˆ¶</h4><p>NATS æµæä¾›äº†ä¸€ä¸ªåä¸ºè¿æ¥é€‰é¡¹<code>MaxPubAcksInflight</code>è¿™æœ‰æ•ˆåœ°é™åˆ¶äº†å‘å¸ƒè€…åœ¨ä»»ä½•ç»™å®šæ—¶é—´å†…å¯èƒ½æœ‰çš„æœªç¡®è®¤æ¶ˆæ¯çš„æ•°é‡ã€‚å½“è¾¾åˆ°è¿™ä¸ªæœ€å¤§å€¼æ—¶è¿›ä¸€æ­¥<code>PublishAsync()</code>è°ƒç”¨å°†é˜»å¡ï¼Œç›´åˆ°æœªç¡®è®¤æ¶ˆæ¯çš„æ•°é‡ä½äºæŒ‡å®šçš„é™åˆ¶ã€‚ ä¾‹ï¼š </p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sc, _ := stan.Connect(clusterID, clientID, MaxPubAcksInflight(<span class="number">25</span>))</span><br><span class="line"></span><br><span class="line">ah := <span class="function"><span class="keyword">func</span><span class="params">(nuid <span class="type">string</span>, err <span class="type">error</span>)</span></span> &#123;</span><br><span class="line">    <span class="comment">// process the ack</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">1</span>; i &lt; <span class="number">1000</span>; i++ &#123;</span><br><span class="line">    <span class="comment">// If the server is unable to keep up with the publisher, the number of outstanding acks will eventually</span></span><br><span class="line">    <span class="comment">// reach the max and this call will block</span></span><br><span class="line">    guid, _ := sc.PublishAsync(<span class="string">&quot;foo&quot;</span>, []<span class="type">byte</span>(<span class="string">&quot;Hello World&quot;</span>), ah)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ç”¨æˆ·é€Ÿç‡é™åˆ¶"><a href="#ç”¨æˆ·é€Ÿç‡é™åˆ¶" class="headerlink" title="ç”¨æˆ·é€Ÿç‡é™åˆ¶"></a>ç”¨æˆ·é€Ÿç‡é™åˆ¶</h4><p>ä½¿ç”¨ç§°ä¸ºè®¢é˜…é€‰é¡¹çš„è®¢é˜…é€‰é¡¹ä¹Ÿå¯ä»¥åœ¨è®¢é˜…æ–¹æŒ‰æ¯æ¬¡è®¢é˜…çš„æ–¹å¼å®ç°é€Ÿç‡é™åˆ¶<code>MaxInflight</code>. æ­¤é€‰é¡¹æŒ‡å®š NATS æµå…è®¸ç»™å®šè®¢é˜…çš„æœªå®Œæˆç¡®è®¤ï¼ˆå·²äº¤ä»˜ä½†æœªç¡®è®¤çš„æ¶ˆæ¯ï¼‰çš„æœ€å¤§æ•°é‡ã€‚ å½“è¾¾åˆ°æ­¤é™åˆ¶æ—¶ï¼ŒNATS æµå°†æš‚åœå‘æ­¤è®¢é˜…äº¤ä»˜æ¶ˆæ¯ï¼Œç›´åˆ°æœªç¡®è®¤æ¶ˆæ¯çš„æ•°é‡ä½äºæŒ‡å®šçš„é™åˆ¶ã€‚ ä¾‹ï¼š </p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Subscribe with manual ack mode and a max in-flight limit of 25</span></span><br><span class="line">sc.Subscribe(<span class="string">&quot;foo&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(m *stan.Msg)</span></span> &#123;</span><br><span class="line">  fmt.Printf(<span class="string">&quot;Received message #: %s\n&quot;</span>, <span class="type">string</span>(m.Data))</span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">// Does not ack, or takes a very long time to ack</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">// Message delivery will suspend when the number of unacknowledged messages reaches 25</span></span><br><span class="line">&#125;, stan.SetManualAckMode(), stan.MaxInflight(<span class="number">25</span>))</span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="https://wangyyovo.github.io">Blank</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://wangyyovo.github.io/posts/cd0e56c9/">https://wangyyovo.github.io/posts/cd0e56c9/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº <a href="https://wangyyovo.github.io" target="_blank">Blank</a>ï¼</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/nats/939916bec37ea8f169680b4d133f4a86.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/ae51dde1/" title="NATSä¸NSQçš„ä»‹ç»å’Œæ¯”è¾ƒ"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/nats/117253db2af95b52a584feae021fb1f8.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">ä¸Šä¸€ç¯‡</div><div class="info-item-2">NATSä¸NSQçš„ä»‹ç»å’Œæ¯”è¾ƒ</div></div><div class="info-2"><div class="info-item-1"> è½»é‡æ¶ˆæ¯ä¸­é—´ä»¶NATSä¸NSQçš„ä»‹ç»å’Œæ¯”è¾ƒNATS1. è¯­è¨€serverï¼šGOå®˜æ–¹æ”¯æŒclientåº“ï¼šGOã€Cç­‰ 2. è®¾è®¡ç‰¹ç‚¹é«˜æ•ˆç¨³å®šå¯ç”¨è½»é‡æ”¯æŒå¤šç§æ¶ˆæ¯ç­–ç•¥ï¼ˆat-most-onceï¼Œat-least-onceï¼‰æ”¯æŒå¤šç§æ¨¡å¼streamingä¸‹æä¾›å¯é…ç½®çš„æ¶ˆæ¯æŒä¹…åŒ– 3. å¤šç§æ¶ˆæ¯å‘å¸ƒæ¨¡å¼ç”Ÿäº§-æ¶ˆè´¹ï¼ˆå‘å¸ƒ-è®¢é˜…ï¼‰æ¨¡å¼ ä¸€å¯¹å¤šä¸¤ç§ç­–ç•¥ï¼šat-most-onceï¼ˆåªä¿è¯w&#x2F;tcpçš„å¯é æ€§ï¼‰ï¼šæ¶ˆæ¯æ— æ¥å—è€…æ—¶ï¼Œåˆ™è¯¥æ¶ˆæ¯ä¸¢å¤±ã€‚å³æ¶ˆæ¯å‘é€åä¸å…³å¿ƒæ˜¯å¦æœ‰æ¥æ”¶ã€‚è¯¥ç­–ç•¥ä»¥é™ä½å¯é æ€§æ¢å–äº†æ€§èƒ½ï¼ˆååé‡ï¼‰ã€‚å¯é æ€§ç”±ä½¿ç”¨è€…è‡ªè¡Œè®¾è®¡ä¿è¯ã€‚at-least-onceï¼šåœ¨æ¶ˆæ¯å¯é æ€§è¦æ±‚æ›´é«˜çš„åœºåˆï¼Œä½¿ç”¨nats streamingã€‚ç›‘æ§æ¶ˆæ¯æ˜¯å¦åˆ°è¾¾æ¯ä¸€ä¸ªè®¢é˜…è€…ã€‚é™ä½æ€§èƒ½ï¼ˆååé‡ï¼‰æ¢å–å¯é æ€§ã€‚ è¯·æ±‚-å“åº”æ¨¡å¼ ç‚¹å¯¹ç‚¹&#x2F;ä¸€å¯¹å¤šã€‚å‘å¸ƒè€…å‘å¸ƒæ¶ˆæ¯éœ€è¦æ”¶åˆ°å“åº”ã€‚æ¥å—è€…å¯æå‰å°†å“åº”æ”¾å…¥â€œä¿¡ç®±â€ä¸­ã€‚å‘å¸ƒè€…åªæ¥æ”¶ç¬¬ä¸€ä¸ªå“åº”ã€‚ï¼ˆå¦‚ä½•é…ç½®ä¸€å¯¹å¤šæ¨¡å‹æ¥æ”¶å¤šä¸ªå“åº”ï¼Ÿï¼‰ é˜Ÿåˆ—è®¢é˜…ä¸ååŒå·¥ä½œ è®¢é˜…çš„ä¸æ˜¯ä¸»é¢˜ï¼Œè€Œæ˜¯é˜Ÿåˆ—ã€‚æ˜¯ä¸€ç§è´Ÿè½½å‡è¡¡å’Œå®¹ç¾ç­–ç•¥ã€‚é˜Ÿåˆ—ä¸­æ¯ä¸ªæ¶ˆæ¯ï¼Œéšæœºå‘ç»™ä¸€ä¸ªè®¢é˜…è€…ã€‚è®¢é˜…è€…æ•°é‡å¯éšæ—¶å¢å‡ã€‚ ï¼ˆå…·ä½“å¦‚ä½•...</div></div></div></a><a class="pagination-related" href="/posts/e845c472/" title="NATS Streaming"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/nats/95994a9aea31be452e66c89e68ba4a27.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">ä¸‹ä¸€ç¯‡</div><div class="info-item-2">NATS Streaming</div></div><div class="info-2"><div class="info-item-1"> NATS StreamingNATS Streaming æ¦‚å¿µNATS Streamingæ˜¯ä¸€ä¸ªç”±NATSé©±åŠ¨çš„æ•°æ®æµç³»ç»Ÿï¼Œç”¨Goç¼–ç¨‹è¯­è¨€ç¼–å†™ã€‚ NATS StreamingæœåŠ¡å™¨çš„å¯æ‰§è¡Œæ–‡ä»¶åæ˜¯nats-streaming-serverã€‚ NATS Streamingä¸æ ¸å¿ƒNATSå¹³å°æ— ç¼åµŒå…¥ï¼Œæ‰©å±•å’Œäº’æ“ä½œã€‚ NATS StreamingæœåŠ¡å™¨ä½œä¸ºApache-2.0è®¸å¯ä¸‹çš„å¼€æºè½¯ä»¶æä¾›ã€‚ Synadiaç§¯æç»´æŠ¤å’Œæ”¯æŒNATS StreamingæœåŠ¡å™¨ã€‚ ç‰¹ç‚¹é™¤äº†æ ¸å¿ƒNATSå¹³å°çš„åŠŸèƒ½å¤–ï¼ŒNATS Streamingè¿˜æä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š  å¢å¼ºçš„æ¶ˆæ¯åè®® - NATS Streamingä½¿ç”¨è°·æ­Œåè®®ç¼“å†²åŒºå®ç°è‡ªå·±çš„å¢å¼ºå‹æ¶ˆæ¯æ ¼å¼ã€‚è¿™äº›æ¶ˆæ¯é€šè¿‡äºŒè¿›åˆ¶æ•°æ®æµåœ¨NATSæ ¸å¿ƒå¹³å°è¿›è¡Œä¼ æ’­,å› æ­¤ä¸éœ€è¦æ”¹å˜NATSçš„åŸºæœ¬åè®®ã€‚NATS Streamingä¿¡æ¯åŒ…å«ä»¥ä¸‹å­—æ®µ: åºåˆ— - ä¸€ä¸ªå…¨å±€é¡ºåºåºåˆ—å·ä¸ºä¸»é¢˜çš„é€šé“ã€€ã€€- ä¸»é¢˜ - æ˜¯NATS Streaming äº¤ä»˜å¯¹è±¡ã€€ã€€- ç­”å¤å†…å®¹ - å¯¹åº”&quot;reply-to&quot;å¯¹åº”çš„å¯¹è±¡å†…å®¹ã€€ã€€- æ•°æ® - çœŸæ˜¯æ•°æ®å†…å®¹ã€€ã€€- æ—¶é—´æˆ³...</div></div></div></a></nav><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/theme/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Blank</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">352</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">46</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">58</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>ä¸»é¢˜ GitHub</span></a><div class="card-info-social-icons"><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fas fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#NATS%E5%92%8CNATS-Streaming"><span class="toc-number">1.</span> <span class="toc-text">NATSå’ŒNATS Streaming</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#NATS"><span class="toc-number">1.1.</span> <span class="toc-text">NATS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="toc-number">1.1.1.</span> <span class="toc-text">åŸºæœ¬ç”¨æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E7%A0%81%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.1.2.</span> <span class="toc-text">ç¼–ç è¿æ¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81-Nkeys-%E5%92%8C%E7%94%A8%E6%88%B7%E5%87%AD%E6%8D%AE"><span class="toc-number">1.1.3.</span> <span class="toc-text">æ–°èº«ä»½éªŒè¯ (Nkeys å’Œç”¨æˆ·å‡­æ®)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TLS"><span class="toc-number">1.1.4.</span> <span class="toc-text">TLS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Go-%E9%80%9A%E9%81%93"><span class="toc-number">1.1.5.</span> <span class="toc-text">ä½¿ç”¨ Go é€šé“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E9%85%8D%E7%AC%A6%E8%AE%A2%E9%98%85"><span class="toc-number">1.1.6.</span> <span class="toc-text">é€šé…ç¬¦è®¢é˜…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%9F%E5%88%97%E7%BB%84"><span class="toc-number">1.1.7.</span> <span class="toc-text">é˜Ÿåˆ—ç»„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95"><span class="toc-number">1.1.8.</span> <span class="toc-text">é«˜çº§ç”¨æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E7%BE%A4"><span class="toc-number">1.1.9.</span> <span class="toc-text">é›†ç¾¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8A%E4%B8%8B%E6%96%87%E6%94%AF%E6%8C%81-Go1-7"><span class="toc-number">1.1.10.</span> <span class="toc-text">ä¸Šä¸‹æ–‡æ”¯æŒ (+ Go1.7)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NATS-Streaming"><span class="toc-number">1.2.</span> <span class="toc-text">NATS Streaming</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95-1"><span class="toc-number">1.2.1.</span> <span class="toc-text">åŸºæœ¬ç”¨æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A2%E9%98%85%E5%90%AF%E5%8A%A8-i-e-%E9%87%8D%E6%92%AD-%E9%80%89%E9%A1%B9"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">è®¢é˜…å¯åŠ¨ (i.e.é‡æ’­)é€‰é¡¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%81%E4%B9%85%E8%AE%A2%E9%98%85"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">æŒä¹…è®¢é˜…</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%98%9F%E5%88%97%E7%BB%84-1"><span class="toc-number">1.2.1.3.</span> <span class="toc-text">é˜Ÿåˆ—ç»„</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%98%9F%E5%88%97%E7%BB%84"><span class="toc-number">1.2.1.3.1.</span> <span class="toc-text">åˆ›å»ºé˜Ÿåˆ—ç»„</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%B5%B7%E5%A7%8B%E4%BD%8D%E7%BD%AE"><span class="toc-number">1.2.1.3.2.</span> <span class="toc-text">èµ·å§‹ä½ç½®</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A6%BB%E5%BC%80%E9%98%9F%E5%88%97%E7%BB%84"><span class="toc-number">1.2.1.3.3.</span> <span class="toc-text">ç¦»å¼€é˜Ÿåˆ—ç»„</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%B3%E9%97%AD%E9%98%9F%E5%88%97%E7%BB%84"><span class="toc-number">1.2.1.3.4.</span> <span class="toc-text">å…³é—­é˜Ÿåˆ—ç»„</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%81%E4%B9%85%E9%98%9F%E5%88%97%E7%BB%84"><span class="toc-number">1.2.1.4.</span> <span class="toc-text">æŒä¹…é˜Ÿåˆ—ç»„</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%8C%81%E4%B9%85%E9%98%9F%E5%88%97%E7%BB%84"><span class="toc-number">1.2.1.4.1.</span> <span class="toc-text">åˆ›å»ºæŒä¹…é˜Ÿåˆ—ç»„</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%B5%B7%E5%A7%8B%E4%BD%8D%E7%BD%AE-1"><span class="toc-number">1.2.1.4.1.1.</span> <span class="toc-text">èµ·å§‹ä½ç½®</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%A6%BB%E5%BC%80%E9%98%9F%E5%88%97%E7%BB%84-1"><span class="toc-number">1.2.1.4.1.2.</span> <span class="toc-text">ç¦»å¼€é˜Ÿåˆ—ç»„</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%85%B3%E9%97%AD%E9%98%9F%E5%88%97%E7%BB%84-1"><span class="toc-number">1.2.1.4.1.3.</span> <span class="toc-text">å…³é—­é˜Ÿåˆ—ç»„</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E9%85%8D%E7%AC%A6%E8%AE%A2%E9%98%85-1"><span class="toc-number">1.2.1.5.</span> <span class="toc-text">é€šé…ç¬¦è®¢é˜…</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95-1"><span class="toc-number">1.2.2.</span> <span class="toc-text">é«˜çº§ç”¨æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E9%85%8D%E7%BD%AE%EF%BC%8C%E5%A6%82-TLS-%E7%AD%89"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">è¿æ¥é…ç½®ï¼Œå¦‚ TLS ç­‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E7%8A%B6%E6%80%81"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">è¿æ¥çŠ¶æ€</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E5%8F%91%E5%B8%83"><span class="toc-number">1.2.2.3.</span> <span class="toc-text">å¼‚æ­¥å‘å¸ƒ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E7%A1%AE%E8%AE%A4%E5%92%8C%E5%9B%9E%E5%A4%8D"><span class="toc-number">1.2.2.4.</span> <span class="toc-text">æ¶ˆæ¯ç¡®è®¤å’Œå›å¤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9F%E7%8E%87%E9%99%90%E5%88%B6-%E5%8C%B9%E9%85%8D"><span class="toc-number">1.2.3.</span> <span class="toc-text">é€Ÿç‡é™åˆ¶&#x2F;åŒ¹é…</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%91%E5%B8%83%E8%80%85%E9%80%9F%E7%8E%87%E9%99%90%E5%88%B6"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">å‘å¸ƒè€…é€Ÿç‡é™åˆ¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E9%80%9F%E7%8E%87%E9%99%90%E5%88%B6"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">ç”¨æˆ·é€Ÿç‡é™åˆ¶</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/d14168d/" title="è™šæ‹Ÿæœºé—®é¢˜åˆé›†"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/hexo/090cfe4e9e60b0ad0de05db822f3ae97.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="è™šæ‹Ÿæœºé—®é¢˜åˆé›†"/></a><div class="content"><a class="title" href="/posts/d14168d/" title="è™šæ‹Ÿæœºé—®é¢˜åˆé›†">è™šæ‹Ÿæœºé—®é¢˜åˆé›†</a><time datetime="2022-07-16T13:30:36.000Z" title="å‘è¡¨äº 2022-07-16 21:30:36">2022-07-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/f540045f/" title="ç”¨goè¯­è¨€ç¼–å†™ç§»åŠ¨ç«¯sdkå’Œappå¼€å‘"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/golang/941ed1ec2925719a0c92e76f4f786b6a.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ç”¨goè¯­è¨€ç¼–å†™ç§»åŠ¨ç«¯sdkå’Œappå¼€å‘"/></a><div class="content"><a class="title" href="/posts/f540045f/" title="ç”¨goè¯­è¨€ç¼–å†™ç§»åŠ¨ç«¯sdkå’Œappå¼€å‘">ç”¨goè¯­è¨€ç¼–å†™ç§»åŠ¨ç«¯sdkå’Œappå¼€å‘</a><time datetime="2022-07-04T12:14:21.000Z" title="å‘è¡¨äº 2022-07-04 20:14:21">2022-07-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/5faac006/" title="åœ¨çº¿ç¼–ç¨‹IDE"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/hexo/090cfe4e9e60b0ad0de05db822f3ae97.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="åœ¨çº¿ç¼–ç¨‹IDE"/></a><div class="content"><a class="title" href="/posts/5faac006/" title="åœ¨çº¿ç¼–ç¨‹IDE">åœ¨çº¿ç¼–ç¨‹IDE</a><time datetime="2022-06-12T13:30:36.000Z" title="å‘è¡¨äº 2022-06-12 21:30:36">2022-06-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/7594185d/" title="å³æ—¶æ€§èƒ½åˆ†æå·¥å…·Pyroscope"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/golang/3bfb3279740bc9a5b5ef436fa887ef07.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="å³æ—¶æ€§èƒ½åˆ†æå·¥å…·Pyroscope"/></a><div class="content"><a class="title" href="/posts/7594185d/" title="å³æ—¶æ€§èƒ½åˆ†æå·¥å…·Pyroscope">å³æ—¶æ€§èƒ½åˆ†æå·¥å…·Pyroscope</a><time datetime="2022-06-12T08:07:36.000Z" title="å‘è¡¨äº 2022-06-12 16:07:36">2022-06-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/82a7aa7c/" title="golangæ€§èƒ½è°ƒè¯•ä¼˜åŒ–æ–¹æ³•"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="golangæ€§èƒ½è°ƒè¯•ä¼˜åŒ–æ–¹æ³•"/></a><div class="content"><a class="title" href="/posts/82a7aa7c/" title="golangæ€§èƒ½è°ƒè¯•ä¼˜åŒ–æ–¹æ³•">golangæ€§èƒ½è°ƒè¯•ä¼˜åŒ–æ–¹æ³•</a><time datetime="2022-06-12T03:00:36.000Z" title="å‘è¡¨äº 2022-06-12 11:00:36">2022-06-12</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By Blank</span><span class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 5.4.2</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.3</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æ—¥é—´å’Œå¤œé—´æ¨¡å¼åˆ‡æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="translateLink" type="button" title="ç®€ç¹è½¬æ¢">ç¹</button><a id="to_comment" href="#post-comment" title="å‰å¾€è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = {"placeholder":"è¯·ç•™ä¸‹ä½ çš„è„šå°","pageSize":10,"lang":"zh-CN"}

  const initValine = (el, path) => {
    if (isShuoshuo) {
      window.shuoshuoComment.destroyValine = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    const valineConfig = {
      el: '#vcomment',
      appId: 'BSfgwCPLOvPHVPaSoBCGSENf-MdYXbMMI',
      appKey: '2Q8qq5060qxycL6FPL26LnMG',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      visitor: false,
      ...option,
      path: isShuoshuo ? path : (option && option.path) || window.location.pathname
    }

    new Valine(valineConfig)
  }

  const loadValine = async (el, path) => {
    if (typeof Valine === 'function') {
      initValine(el, path)
    } else {
      await btf.getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js')
      initValine(el, path)
    }
  }

  if (isShuoshuo) {
    'Valine' === 'Valine'
      ? window.shuoshuoComment = { loadComment: loadValine }
      : window.loadOtherComment = loadValine
    return
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  æ•°æ®åŠ è½½ä¸­</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>