<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>行为模式-访问者模式 | Blank</title><meta name="author" content="Blank"><meta name="copyright" content="Blank"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="https:&#x2F;&#x2F;refactoringguru.cn&#x2F;design-patterns&#x2F;visitor  行为模式-访问者模式亦称： Visitor 意图访问者模式是一种行为设计模式， 它能将算法与其所作用的对象隔离开来。  问题假如你的团队开发了一款能够使用巨型图像中地理信息的应用程序。 图像中的每个节点既能代表复杂实体 （例如一座城市）， 也能代表更精细的对象 （例如工业区和旅游景点等）。">
<meta property="og:type" content="article">
<meta property="og:title" content="行为模式-访问者模式">
<meta property="og:url" content="https://wangyyovo.github.io/posts/ff280d74/">
<meta property="og:site_name" content="Blank">
<meta property="og:description" content="https:&#x2F;&#x2F;refactoringguru.cn&#x2F;design-patterns&#x2F;visitor  行为模式-访问者模式亦称： Visitor 意图访问者模式是一种行为设计模式， 它能将算法与其所作用的对象隔离开来。  问题假如你的团队开发了一款能够使用巨型图像中地理信息的应用程序。 图像中的每个节点既能代表复杂实体 （例如一座城市）， 也能代表更精细的对象 （例如工业区和旅游景点等）。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/c232294a189f79f9c057415aa13a4c4a.jpg">
<meta property="article:published_time" content="2021-05-04T13:50:44.000Z">
<meta property="article:modified_time" content="2021-05-04T13:50:44.000Z">
<meta property="article:author" content="Blank">
<meta property="article:tag" content="pattern">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/c232294a189f79f9c057415aa13a4c4a.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "行为模式-访问者模式",
  "url": "https://wangyyovo.github.io/posts/ff280d74/",
  "image": "https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/c232294a189f79f9c057415aa13a4c4a.jpg",
  "datePublished": "2021-05-04T13:50:44.000Z",
  "dateModified": "2021-05-04T13:50:44.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Blank",
      "url": "https://wangyyovo.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/theme/favicon.ico"><link rel="canonical" href="https://wangyyovo.github.io/posts/ff280d74/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '行为模式-访问者模式',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="alternate" href="/atom.xml" title="Blank" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/theme/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">356</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">36</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">54</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-coffee"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-image"></i><span> 相册</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-book"></i><span> 教程</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/posts/21cfbf15/"><span> 🚀 快速開始</span></a></li><li><a class="site-page child" href="/posts/dc584b87/"><span> 📑 主題頁面</span></a></li><li><a class="site-page child" href="/posts/4aa8abbe/"><span> 🛠 主題配置-1</span></a></li><li><a class="site-page child" href="/posts/ceeb73f/"><span> ⚔️ 主題配置-2</span></a></li><li><a class="site-page child" href="/posts/98d20436/"><span> ❓ 主題問答</span></a></li><li><a class="site-page child" href="/posts/4073eda/"><span> ⚡️ 進階教程</span></a></li><li><a class="site-page child" href="/posts/198a4240/"><span> ✨ 更新日誌</span></a></li><li><a class="site-page child" href="/posts/507c070f/"><span> 📑 Aplayer教程</span></a></li><li><a class="site-page child" href="/posts/2df239ce/"><span> 📑 標籤外掛</span></a></li><li><a class="site-page child" href="/posts/b37b5fe3/"><span> 📑 自定義代碼配色</span></a></li><li><a class="site-page child" href="/posts/ea33ab97/"><span> 📑 自定義側邊欄</span></a></li><li><a class="site-page child" href="/posts/89757140/"><span> 📑 Markdown</span></a></li><li><a class="site-page child" href="/posts/9db656e5/"><span> 📑 代码高亮测试</span></a></li><li><a class="site-page child" href="/posts/c9711c19/"><span> 📑 當設置top_img為false時</span></a></li><li><a class="site-page child" href="/posts/39b121ef/"><span> 📑 Hexo內置標籤外掛</span></a></li><li><a class="site-page child" href="/posts/7670b080/"><span> 📑 Butterfly 美化/優化/魔改 教程合集</span></a></li><li><a class="site-page child" href="/posts/913b2502/"><span> 📑 没有封面</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/c232294a189f79f9c057415aa13a4c4a.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Blank</span></a><a class="nav-page-title" href="/"><span class="site-name">行为模式-访问者模式</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-coffee"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-image"></i><span> 相册</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-book"></i><span> 教程</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/posts/21cfbf15/"><span> 🚀 快速開始</span></a></li><li><a class="site-page child" href="/posts/dc584b87/"><span> 📑 主題頁面</span></a></li><li><a class="site-page child" href="/posts/4aa8abbe/"><span> 🛠 主題配置-1</span></a></li><li><a class="site-page child" href="/posts/ceeb73f/"><span> ⚔️ 主題配置-2</span></a></li><li><a class="site-page child" href="/posts/98d20436/"><span> ❓ 主題問答</span></a></li><li><a class="site-page child" href="/posts/4073eda/"><span> ⚡️ 進階教程</span></a></li><li><a class="site-page child" href="/posts/198a4240/"><span> ✨ 更新日誌</span></a></li><li><a class="site-page child" href="/posts/507c070f/"><span> 📑 Aplayer教程</span></a></li><li><a class="site-page child" href="/posts/2df239ce/"><span> 📑 標籤外掛</span></a></li><li><a class="site-page child" href="/posts/b37b5fe3/"><span> 📑 自定義代碼配色</span></a></li><li><a class="site-page child" href="/posts/ea33ab97/"><span> 📑 自定義側邊欄</span></a></li><li><a class="site-page child" href="/posts/89757140/"><span> 📑 Markdown</span></a></li><li><a class="site-page child" href="/posts/9db656e5/"><span> 📑 代码高亮测试</span></a></li><li><a class="site-page child" href="/posts/c9711c19/"><span> 📑 當設置top_img為false時</span></a></li><li><a class="site-page child" href="/posts/39b121ef/"><span> 📑 Hexo內置標籤外掛</span></a></li><li><a class="site-page child" href="/posts/7670b080/"><span> 📑 Butterfly 美化/優化/魔改 教程合集</span></a></li><li><a class="site-page child" href="/posts/913b2502/"><span> 📑 没有封面</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">行为模式-访问者模式</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-05-04T13:50:44.000Z" title="发表于 2021-05-04 21:50:44">2021-05-04</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-05-04T13:50:44.000Z" title="更新于 2021-05-04 21:50:44">2021-05-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/pattern/">pattern</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">12k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>58分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><script src="\assets\js\APlayer.min.js"> </script><blockquote>
<p><a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/visitor">https://refactoringguru.cn/design-patterns/visitor</a></p>
</blockquote>
<h1 id="行为模式-访问者模式"><a href="#行为模式-访问者模式" class="headerlink" title="行为模式-访问者模式"></a>行为模式-访问者模式</h1><p><strong>亦称：</strong> Visitor</p>
<h2 id="意图"><a href="#意图" class="headerlink" title="意图"></a>意图</h2><p><strong>访问者模式</strong>是一种行为设计模式， 它能将算法与其所作用的对象隔离开来。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/blog/pattern/visitor.png"></p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>假如你的团队开发了一款能够使用巨型图像中地理信息的应用程序。 图像中的每个节点既能代表复杂实体 （例如一座城市）， 也能代表更精细的对象 （例如工业区和旅游景点等）。 如果节点代表的真实对象之间存在公路， 那么这些节点就会相互连接。 在程序内部， 每个节点的类型都由其所属的类来表示， 每个特定的节点则是一个对象。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/blog/pattern/problem1-visitor.png" alt="将图像导出为 XML。"></p>
<p>一段时间后， 你接到了实现将图像导出到 XML 文件中的任务。 这些工作最初看上去非常简单。 你计划为每个节点类添加导出函数， 然后递归执行图像中每个节点的导出函数。 解决方案简单且优雅： 使用多态机制可以让导出方法的调用代码不会和具体的节点类相耦合。</p>
<p>但你不太走运， 系统架构师拒绝批准对已有节点类进行修改。 他认为这些代码已经是产品了， 不想冒险对其进行修改， 因为修改可能会引入潜在的缺陷。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/blog/pattern/problem2-zh-visitor.png" alt="所有节点的类中都必须添加导出至 XML 文件的方法， 但如果在修改代码的过程中引入了任何缺陷， 那么整个程序都会面临风险。"></p>
<p>此外， 他还质疑在节点类中包含导出 XML 文件的代码是否有意义。 这些类的主要工作是处理地理数据。 导出 XML 文件的代码放在这里并不合适。</p>
<p>还有另一个原因， 那就是在此项任务完成后， 营销部门很有可能会要求程序提供导出其他类型文件的功能， 或者提出其他奇怪的要求。 这样你很可能会被迫再次修改这些重要但脆弱的类。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>访问者模式建议将新行为放入一个名为<em>访问者</em>的独立类中， 而不是试图将其整合到已有类中。 现在， 需要执行操作的原始对象将作为参数被传递给访问者中的方法， 让方法能访问对象所包含的一切必要数据。</p>
<p>如果现在该操作能在不同类的对象上执行会怎么样呢？ 比如在我们的示例中， 各节点类导出 XML 文件的实际实现很可能会稍有不同。 因此， 访问者类可以定义一组 （而不是一个） 方法， 且每个方法可接收不同类型的参数， 如下所示：</p>
<figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> ExportVisitor <span class="keyword">implements</span> Visitor <span class="keyword">is</span></span><br><span class="line">    method doForCity(City c) <span class="comment">&#123; ... &#125;</span></span><br><span class="line">    method doForIndustry(Industry f) <span class="comment">&#123; ... &#125;</span></span><br><span class="line">    method doForSightSeeing(SightSeeing ss) <span class="comment">&#123; ... &#125;</span></span><br><span class="line">    <span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<p>但我们究竟应该如何调用这些方法 （尤其是在处理整个图像方面） 呢？ 这些方法的签名各不相同， 因此我们不能使用多态机制。 为了可以挑选出能够处理特定对象的访问者方法， 我们需要对它的类进行检查。 这是不是听上去像个噩梦呢？</p>
<figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">foreach (Node node <span class="keyword">in</span> graph)</span><br><span class="line">    <span class="keyword">if</span> (node instanceof City)</span><br><span class="line">        exportVisitor.doForCity((City) node)</span><br><span class="line">    <span class="keyword">if</span> (node instanceof Industry)</span><br><span class="line">        exportVisitor.doForIndustry((Industry) node)</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>你可能会问， 我们为什么不使用方法重载呢？ 就是使用相同的方法名称， 但它们的参数不同。 不幸的是， 即使我们的编程语言 （例如 Java 和 C#） 支持重载也不行。 由于我们无法提前知晓节点对象所属的类， 所以重载机制无法执行正确的方法。 方法会将 <code>节点</code>基类作为输入参数的默认类型。</p>
<p>但是， 访问者模式可以解决这个问题。 它使用了一种名为<a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/visitor-double-dispatch">双分派</a>的技巧， 不使用累赘的条件语句也可下执行正确的方法。 与其让客户端来选择调用正确版本的方法， 不如将选择权委派给作为参数传递给访问者的对象。 由于该对象知晓其自身的类， 因此能更自然地在访问者中选出正确的方法。 它们会 “接收” 一个访问者并告诉其应执行的访问者方法。</p>
<figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line">foreach (Node node <span class="keyword">in</span> graph)</span><br><span class="line">    node.accept(exportVisitor)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 城市</span></span><br><span class="line"><span class="keyword">class</span> City <span class="keyword">is</span></span><br><span class="line">    method accept(Visitor v) <span class="keyword">is</span></span><br><span class="line">        v.doForCity(this)</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 工业区</span></span><br><span class="line"><span class="keyword">class</span> Industry <span class="keyword">is</span></span><br><span class="line">    method accept(Visitor v) <span class="keyword">is</span></span><br><span class="line">        v.doForIndustry(this)</span><br><span class="line">    <span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<p>我承认最终还是修改了节点类， 但毕竟改动很小， 且使得我们能够在后续进一步添加行为时无需再次修改代码。</p>
<p>现在， 如果我们抽取出所有访问者的通用接口， 所有已有的节点都能与我们在程序中引入的任何访问者交互。 如果需要引入与节点相关的某个行为， 你只需要实现一个新的访问者类即可。</p>
<h2 id="真实世界类比"><a href="#真实世界类比" class="headerlink" title="真实世界类比"></a>真实世界类比</h2><p><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/blog/pattern/visitor-comic-1.png" alt="优秀的保险代理人总能为不同类型的团体提供不同的保单。"></p>
<p>假如有这样一位非常希望赢得新客户的资深保险代理人。 他可以拜访街区中的每栋楼， 尝试向每个路人推销保险。 所以， 根据大楼内组织类型的不同， 他可以提供专门的保单：</p>
<ul>
<li>如果建筑是居民楼， 他会推销医疗保险。</li>
<li>如果建筑是银行， 他会推销失窃保险。</li>
<li>如果建筑是咖啡厅， 他会推销火灾和洪水保险。</li>
</ul>
<h2 id="访问者模式结构"><a href="#访问者模式结构" class="headerlink" title="访问者模式结构"></a>访问者模式结构</h2><p><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/blog/pattern/structure-zh-indexed-visitor.png"></p>
<ol>
<li><strong>访问者</strong> （Visitor） 接口声明了一系列以对象结构的具体元素为参数的访问者方法。 如果编程语言支持重载， 这些方法的名称可以是相同的， 但是其参数一定是不同的。</li>
<li><strong>具体访问者</strong> （Concrete Visitor） 会为不同的具体元素类实现相同行为的几个不同版本。</li>
<li><strong>元素</strong> （Element） 接口声明了一个方法来 “接收” 访问者。 该方法必须有一个参数被声明为访问者接口类型。</li>
<li><strong>具体元素</strong> （Concrete Element） 必须实现接收方法。 该方法的目的是根据当前元素类将其调用重定向到相应访问者的方法。 请注意， 即使元素基类实现了该方法， 所有子类都必须对其进行重写并调用访问者对象中的合适方法。</li>
<li><strong>客户端</strong> （Client） 通常会作为集合或其他复杂对象 （例如一个<a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/composite">组合</a>树） 的代表。 客户端通常不知晓所有的具体元素类， 因为它们会通过抽象接口与集合中的对象进行交互。</li>
</ol>
<h2 id="伪代码"><a href="#伪代码" class="headerlink" title="伪代码"></a>伪代码</h2><p>在本例中， <strong>访问者</strong>模式为几何图像层次结构添加了对于 XML 文件导出功能的支持。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/blog/pattern/example-visitor.png" alt="通过访问者对象将各种类型的对象导出为 XML 格式文件。"></p>
<figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 元素接口声明了一个`accept（接收）`方法，它会将访问者基础接口作为一个参</span></span><br><span class="line"><span class="comment">// 数。</span></span><br><span class="line"><span class="keyword">interface</span> Shape <span class="keyword">is</span></span><br><span class="line">    method move(x, y)</span><br><span class="line">    method draw()</span><br><span class="line">    method accept(v: Visitor)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 每个具体元素类都必须以特定方式实现`accept`方法，使其能调用相应元素类的</span></span><br><span class="line"><span class="comment">// 访问者方法。</span></span><br><span class="line"><span class="keyword">class</span> Dot <span class="keyword">implements</span> Shape <span class="keyword">is</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注意我们正在调用的`visitDot（访问点）`方法与当前类的名称相匹配。</span></span><br><span class="line">    <span class="comment">// 这样我们能让访问者知晓与其交互的元素类。</span></span><br><span class="line">    method accept(v: Visitor) <span class="keyword">is</span></span><br><span class="line">        v.visitDot(this)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Circle <span class="keyword">implements</span> Shape <span class="keyword">is</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    method accept(v: Visitor) <span class="keyword">is</span></span><br><span class="line">        v.visitCircle(this)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Rectangle <span class="keyword">implements</span> Shape <span class="keyword">is</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    method accept(v: Visitor) <span class="keyword">is</span></span><br><span class="line">        v.visitRectangle(this)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> CompoundShape <span class="keyword">implements</span> Shape <span class="keyword">is</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    method accept(v: Visitor) <span class="keyword">is</span></span><br><span class="line">        v.visitCompoundShape(this)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 访问者接口声明了一组与元素类对应的访问方法。访问方法的签名能让访问者准</span></span><br><span class="line"><span class="comment">// 确辨别出与其交互的元素所属的类。</span></span><br><span class="line"><span class="keyword">interface</span> Visitor <span class="keyword">is</span></span><br><span class="line">    method visitDot(d: Dot)</span><br><span class="line">    method visitCircle(c: Circle)</span><br><span class="line">    method visitRectangle(r: Rectangle)</span><br><span class="line">    method visitCompoundShape(cs: CompoundShape)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体访问者实现了同一算法的多个版本，而且该算法能与所有具体类进行交互。</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// 访问者模式在复杂对象结构（例如组合树）上使用时能发挥最大作用。在这种情</span></span><br><span class="line"><span class="comment">// 况下，它可以存储算法的一些中间状态，并同时在结构中的不同对象上执行访问</span></span><br><span class="line"><span class="comment">// 者方法。这可能会非常有帮助。</span></span><br><span class="line"><span class="keyword">class</span> XMLExportVisitor <span class="keyword">implements</span> Visitor <span class="keyword">is</span></span><br><span class="line">    method visitDot(d: Dot) <span class="keyword">is</span></span><br><span class="line">        <span class="comment">// 导出点（dot）的 ID 和中心坐标。</span></span><br><span class="line"></span><br><span class="line">    method visitCircle(c: Circle) <span class="keyword">is</span></span><br><span class="line">        <span class="comment">// 导出圆（circle）的 ID 、中心坐标和半径。</span></span><br><span class="line"></span><br><span class="line">    method visitRectangle(r: Rectangle) <span class="keyword">is</span></span><br><span class="line">        <span class="comment">// 导出长方形（rectangle）的 ID 、左上角坐标、宽和长。</span></span><br><span class="line"></span><br><span class="line">    method visitCompoundShape(cs: CompoundShape) <span class="keyword">is</span></span><br><span class="line">        <span class="comment">// 导出图形（shape）的 ID 和其子项目的 ID 列表。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码可在不知晓具体类的情况下在一组元素上运行访问者操作。“接收”操</span></span><br><span class="line"><span class="comment">// 作会将调用定位到访问者对象的相应操作上。</span></span><br><span class="line"><span class="keyword">class</span> Application <span class="keyword">is</span></span><br><span class="line">    field allShapes: <span class="keyword">array</span> <span class="keyword">of</span> Shapes</span><br><span class="line"></span><br><span class="line">    method <span class="keyword">export</span>() <span class="keyword">is</span></span><br><span class="line">        exportVisitor = new XMLExportVisitor()</span><br><span class="line"></span><br><span class="line">        foreach (shape <span class="keyword">in</span> allShapes) <span class="keyword">do</span></span><br><span class="line">            shape.accept(exportVisitor)</span><br></pre></td></tr></table></figure>

<p>如果你并不十分理解为何本例中需要使用 <code>accept</code>接收方法， 我的一篇文章<a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/visitor-double-dispatch">访问者和双分派</a>详细解释了这个问题。</p>
<h2 id="访问者模式适合应用场景"><a href="#访问者模式适合应用场景" class="headerlink" title="访问者模式适合应用场景"></a>访问者模式适合应用场景</h2><p><strong>如果你需要对一个复杂对象结构 （例如对象树） 中的所有元素执行某些操作， 可使用访问者模式。</strong></p>
<p>访问者模式通过在访问者对象中为多个目标类提供相同操作的变体， 让你能在属于不同类的一组对象上执行同一操作。</p>
<p><strong>可使用访问者模式来清理辅助行为的业务逻辑。</strong></p>
<p>该模式会将所有非主要的行为抽取到一组访问者类中， 使得程序的主要类能更专注于主要的工作。</p>
<p><strong>当某个行为仅在类层次结构中的一些类中有意义， 而在其他类中没有意义时， 可使用该模式。</strong></p>
<p>你可将该行为抽取到单独的访问者类中， 只需实现接收相关类的对象作为参数的访问者方法并将其他方法留空即可。</p>
<h2 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h2><ol>
<li><p>在访问者接口中声明一组 “访问” 方法， 分别对应程序中的每个具体元素类。</p>
</li>
<li><p>声明元素接口。 如果程序中已有元素类层次接口， 可在层次结构基类中添加抽象的 “接收” 方法。 该方法必须接受访问者对象作为参数。</p>
</li>
<li><p>在所有具体元素类中实现接收方法。 这些方法必须将调用重定向到当前元素对应的访问者对象中的访问者方法上。</p>
</li>
<li><p>元素类只能通过访问者接口与访问者进行交互。 不过访问者必须知晓所有的具体元素类， 因为这些类在访问者方法中都被作为参数类型引用。</p>
</li>
<li><p>为每个无法在元素层次结构中实现的行为创建一个具体访问者类并实现所有的访问者方法。</p>
<p>你可能会遇到访问者需要访问元素类的部分私有成员变量的情况。 在这种情况下， 你要么将这些变量或方法设为公有， 这将破坏元素的封装； 要么将访问者类嵌入到元素类中。 后一种方式只有在支持嵌套类的编程语言中才可能实现。</p>
</li>
<li><p>客户端必须创建访问者对象并通过 “接收” 方法将其传递给元素。</p>
</li>
</ol>
<h2 id="访问者模式优缺点"><a href="#访问者模式优缺点" class="headerlink" title="访问者模式优缺点"></a>访问者模式优缺点</h2><p>优点</p>
<ul>
<li><em>开闭原则</em>。 你可以引入在不同类对象上执行的新行为， 且无需对这些类做出修改。</li>
<li><em>单一职责原则</em>。 可将同一行为的不同版本移到同一个类中。</li>
<li>访问者对象可以在与各种对象交互时收集一些有用的信息。 当你想要遍历一些复杂的对象结构 （例如对象树）， 并在结构中的每个对象上应用访问者时， 这些信息可能会有所帮助。</li>
</ul>
<p>缺点</p>
<ul>
<li>部分客户端可能会受到算法框架的限制。</li>
<li>通过子类抑制默认步骤实现可能会导致违反_里氏替换原则_。</li>
<li>模板方法中的步骤越多， 其维护工作就可能会越困难。</li>
</ul>
<h2 id="与其他模式的关系"><a href="#与其他模式的关系" class="headerlink" title="与其他模式的关系"></a>与其他模式的关系</h2><ul>
<li>你可以将<a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/visitor">访问者模式</a>视为<a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/command">命令模式</a>的加强版本， 其对象可对不同类的多种对象执行操作。</li>
<li>你可以使用<a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/visitor">访问者</a>对整个<a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/composite">组合模式</a>树执行操作。</li>
<li>可以同时使用<a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/visitor">访问者</a>和<a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/iterator">迭代器模式</a>来遍历复杂数据结构， 并对其中的元素执行所需操作， 即使这些元素所属的类完全不同。</li>
</ul>
<h2 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h2><p><strong>访问者</strong>是一种行为设计模式， 允许你在不修改已有代码的情况下向已有类层次结构中增加新的行为。</p>
<div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">C#</button><button type="button" class="tab">C++</button><button type="button" class="tab">JAVA</button><button type="button" class="tab">PHP</button><button type="button" class="tab">Python</button><button type="button" class="tab">Ruby</button><button type="button" class="tab">Swift</button><button type="button" class="tab">TypeScrit</button><button type="button" class="tab">Golang</button></div><div class="tab-contents"><div class="tab-item-content active"><p><strong>在 C# 中使用模式</strong></p>
<p><strong>复杂度：</strong> ★★★</p>
<p><strong>流行度：</strong> ★☆☆</p>
<p><strong>使用示例：</strong> 访问者不是常用的设计模式， 因为它不仅复杂， 应用范围也比较狭窄。</p>
<p><strong>概念示例</strong></p>
<p>本例说明了<strong>访问者</strong>设计模式的结构并重点回答了下面的问题：</p>
<ul>
<li>它由哪些类组成？</li>
<li>这些类扮演了哪些角色？</li>
<li>模式中的各个元素会以何种方式相互关联？</li>
</ul>
<p><strong>Program.cs:</strong> 概念示例</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">RefactoringGuru.DesignPatterns.Visitor.Conceptual</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// The Component interface declares an `accept` method that should take the</span></span><br><span class="line">    <span class="comment">// base visitor interface as an argument.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IComponent</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Accept</span>(<span class="params">IVisitor visitor</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Each Concrete Component must implement the `Accept` method in such a way</span></span><br><span class="line">    <span class="comment">// that it calls the visitor&#x27;s method corresponding to the component&#x27;s</span></span><br><span class="line">    <span class="comment">// class.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ConcreteComponentA</span> : <span class="title">IComponent</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Note that we&#x27;re calling `VisitConcreteComponentA`, which matches the</span></span><br><span class="line">        <span class="comment">// current class name. This way we let the visitor know the class of the</span></span><br><span class="line">        <span class="comment">// component it works with.</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Accept</span>(<span class="params">IVisitor visitor</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            visitor.VisitConcreteComponentA(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Concrete Components may have special methods that don&#x27;t exist in</span></span><br><span class="line">        <span class="comment">// their base class or interface. The Visitor is still able to use these</span></span><br><span class="line">        <span class="comment">// methods since it&#x27;s aware of the component&#x27;s concrete class.</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">ExclusiveMethodOfConcreteComponentA</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;A&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ConcreteComponentB</span> : <span class="title">IComponent</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Same here: VisitConcreteComponentB =&gt; ConcreteComponentB</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Accept</span>(<span class="params">IVisitor visitor</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            visitor.VisitConcreteComponentB(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">SpecialMethodOfConcreteComponentB</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;B&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The Visitor Interface declares a set of visiting methods that correspond</span></span><br><span class="line">    <span class="comment">// to component classes. The signature of a visiting method allows the</span></span><br><span class="line">    <span class="comment">// visitor to identify the exact class of the component that it&#x27;s dealing</span></span><br><span class="line">    <span class="comment">// with.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IVisitor</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">VisitConcreteComponentA</span>(<span class="params">ConcreteComponentA element</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">VisitConcreteComponentB</span>(<span class="params">ConcreteComponentB element</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Concrete Visitors implement several versions of the same algorithm, which</span></span><br><span class="line">    <span class="comment">// can work with all concrete component classes.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// You can experience the biggest benefit of the Visitor pattern when using</span></span><br><span class="line">    <span class="comment">// it with a complex object structure, such as a Composite tree. In this</span></span><br><span class="line">    <span class="comment">// case, it might be helpful to store some intermediate state of the</span></span><br><span class="line">    <span class="comment">// algorithm while executing visitor&#x27;s methods over various objects of the</span></span><br><span class="line">    <span class="comment">// structure.</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title">ConcreteVisitor1</span> : <span class="title">IVisitor</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">VisitConcreteComponentA</span>(<span class="params">ConcreteComponentA element</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(element.ExclusiveMethodOfConcreteComponentA() + <span class="string">&quot; + ConcreteVisitor1&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">VisitConcreteComponentB</span>(<span class="params">ConcreteComponentB element</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(element.SpecialMethodOfConcreteComponentB() + <span class="string">&quot; + ConcreteVisitor1&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title">ConcreteVisitor2</span> : <span class="title">IVisitor</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">VisitConcreteComponentA</span>(<span class="params">ConcreteComponentA element</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(element.ExclusiveMethodOfConcreteComponentA() + <span class="string">&quot; + ConcreteVisitor2&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">VisitConcreteComponentB</span>(<span class="params">ConcreteComponentB element</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(element.SpecialMethodOfConcreteComponentB() + <span class="string">&quot; + ConcreteVisitor2&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Client</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// The client code can run visitor operations over any set of elements</span></span><br><span class="line">        <span class="comment">// without figuring out their concrete classes. The accept operation</span></span><br><span class="line">        <span class="comment">// directs a call to the appropriate operation in the visitor object.</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ClientCode</span>(<span class="params">List&lt;IComponent&gt; components, IVisitor visitor</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> component <span class="keyword">in</span> components)</span><br><span class="line">            &#123;</span><br><span class="line">                component.Accept(visitor);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            List&lt;IComponent&gt; components = <span class="keyword">new</span> List&lt;IComponent&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">new</span> ConcreteComponentA(),</span><br><span class="line">                <span class="keyword">new</span> ConcreteComponentB()</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            Console.WriteLine(<span class="string">&quot;The client code works with all visitors via the base Visitor interface:&quot;</span>);</span><br><span class="line">            <span class="keyword">var</span> visitor1 = <span class="keyword">new</span> ConcreteVisitor1();</span><br><span class="line">            Client.ClientCode(components,visitor1);</span><br><span class="line"></span><br><span class="line">            Console.WriteLine();</span><br><span class="line"></span><br><span class="line">            Console.WriteLine(<span class="string">&quot;It allows the same client code to work with different types of visitors:&quot;</span>);</span><br><span class="line">            <span class="keyword">var</span> visitor2 = <span class="keyword">new</span> ConcreteVisitor2();</span><br><span class="line">            Client.ClientCode(components, visitor2);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">The client code works with all visitors via the base Visitor interface:</span><br><span class="line">A + ConcreteVisitor1</span><br><span class="line">B + ConcreteVisitor1</span><br><span class="line"></span><br><span class="line">It allows the same client code to work with different types of visitors:</span><br><span class="line">A + ConcreteVisitor2</span><br><span class="line">B + ConcreteVisitor2</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><strong>在 C++ 中使用模式</strong></p>
<p><strong>复杂度：</strong> ★★★</p>
<p><strong>流行度：</strong> ★☆☆</p>
<p><strong>使用示例：</strong> 访问者不是常用的设计模式， 因为它不仅复杂， 应用范围也比较狭窄。</p>
<p><strong>概念示例</strong></p>
<p>本例说明了<strong>访问者</strong>设计模式的结构并重点回答了下面的问题：</p>
<ul>
<li>它由哪些类组成？</li>
<li>这些类扮演了哪些角色？</li>
<li>模式中的各个元素会以何种方式相互关联？</li>
</ul>
<p><strong>main.cc:</strong> 概念示例</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Visitor Interface declares a set of visiting methods that correspond to</span></span><br><span class="line"><span class="comment"> * component classes. The signature of a visiting method allows the visitor to</span></span><br><span class="line"><span class="comment"> * identify the exact class of the component that it&#x27;s dealing with.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteComponentA</span>;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteComponentB</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Visitor</span> &#123;</span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">VisitConcreteComponentA</span><span class="params">(<span class="type">const</span> ConcreteComponentA *element)</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">VisitConcreteComponentB</span><span class="params">(<span class="type">const</span> ConcreteComponentB *element)</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Component interface declares an `accept` method that should take the base</span></span><br><span class="line"><span class="comment"> * visitor interface as an argument.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Component</span> &#123;</span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="keyword">virtual</span> ~<span class="built_in">Component</span>() &#123;&#125;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Accept</span><span class="params">(Visitor *visitor)</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Each Concrete Component must implement the `Accept` method in such a way that</span></span><br><span class="line"><span class="comment"> * it calls the visitor&#x27;s method corresponding to the component&#x27;s class.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteComponentA</span> : <span class="keyword">public</span> Component &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Note that we&#x27;re calling `visitConcreteComponentA`, which matches the</span></span><br><span class="line"><span class="comment">   * current class name. This way we let the visitor know the class of the</span></span><br><span class="line"><span class="comment">   * component it works with.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">Accept</span><span class="params">(Visitor *visitor)</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">    visitor-&gt;<span class="built_in">VisitConcreteComponentA</span>(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Concrete Components may have special methods that don&#x27;t exist in their base</span></span><br><span class="line"><span class="comment">   * class or interface. The Visitor is still able to use these methods since</span></span><br><span class="line"><span class="comment">   * it&#x27;s aware of the component&#x27;s concrete class.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function">std::string <span class="title">ExclusiveMethodOfConcreteComponentA</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;A&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteComponentB</span> : <span class="keyword">public</span> Component &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Same here: visitConcreteComponentB =&gt; ConcreteComponentB</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">Accept</span><span class="params">(Visitor *visitor)</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">    visitor-&gt;<span class="built_in">VisitConcreteComponentB</span>(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function">std::string <span class="title">SpecialMethodOfConcreteComponentB</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;B&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Concrete Visitors implement several versions of the same algorithm, which can</span></span><br><span class="line"><span class="comment"> * work with all concrete component classes.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * You can experience the biggest benefit of the Visitor pattern when using it</span></span><br><span class="line"><span class="comment"> * with a complex object structure, such as a Composite tree. In this case, it</span></span><br><span class="line"><span class="comment"> * might be helpful to store some intermediate state of the algorithm while</span></span><br><span class="line"><span class="comment"> * executing visitor&#x27;s methods over various objects of the structure.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteVisitor1</span> : <span class="keyword">public</span> Visitor &#123;</span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">VisitConcreteComponentA</span><span class="params">(<span class="type">const</span> ConcreteComponentA *element)</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; element-&gt;<span class="built_in">ExclusiveMethodOfConcreteComponentA</span>() &lt;&lt; <span class="string">&quot; + ConcreteVisitor1\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">VisitConcreteComponentB</span><span class="params">(<span class="type">const</span> ConcreteComponentB *element)</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; element-&gt;<span class="built_in">SpecialMethodOfConcreteComponentB</span>() &lt;&lt; <span class="string">&quot; + ConcreteVisitor1\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteVisitor2</span> : <span class="keyword">public</span> Visitor &#123;</span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">VisitConcreteComponentA</span><span class="params">(<span class="type">const</span> ConcreteComponentA *element)</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; element-&gt;<span class="built_in">ExclusiveMethodOfConcreteComponentA</span>() &lt;&lt; <span class="string">&quot; + ConcreteVisitor2\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">VisitConcreteComponentB</span><span class="params">(<span class="type">const</span> ConcreteComponentB *element)</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; element-&gt;<span class="built_in">SpecialMethodOfConcreteComponentB</span>() &lt;&lt; <span class="string">&quot; + ConcreteVisitor2\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The client code can run visitor operations over any set of elements without</span></span><br><span class="line"><span class="comment"> * figuring out their concrete classes. The accept operation directs a call to</span></span><br><span class="line"><span class="comment"> * the appropriate operation in the visitor object.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ClientCode</span><span class="params">(std::array&lt;<span class="type">const</span> Component *, <span class="number">2</span>&gt; components, Visitor *visitor)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">const</span> Component *comp : components) &#123;</span><br><span class="line">    comp-&gt;<span class="built_in">Accept</span>(visitor);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  std::array&lt;<span class="type">const</span> Component *, 2&gt; components = &#123;<span class="keyword">new</span> ConcreteComponentA, <span class="keyword">new</span> ConcreteComponentB&#125;;</span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;The client code works with all visitors via the base Visitor interface:\n&quot;</span>;</span><br><span class="line">  ConcreteVisitor1 *visitor1 = <span class="keyword">new</span> ConcreteVisitor1;</span><br><span class="line">  <span class="built_in">ClientCode</span>(components, visitor1);</span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;It allows the same client code to work with different types of visitors:\n&quot;</span>;</span><br><span class="line">  ConcreteVisitor2 *visitor2 = <span class="keyword">new</span> ConcreteVisitor2;</span><br><span class="line">  <span class="built_in">ClientCode</span>(components, visitor2);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">const</span> Component *comp : components) &#123;</span><br><span class="line">    <span class="keyword">delete</span> comp;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">delete</span> visitor1;</span><br><span class="line">  <span class="keyword">delete</span> visitor2;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">The client code works with all visitors via the base Visitor interface:</span><br><span class="line">A + ConcreteVisitor1</span><br><span class="line">B + ConcreteVisitor1</span><br><span class="line"></span><br><span class="line">It allows the same client code to work with different types of visitors:</span><br><span class="line">A + ConcreteVisitor2</span><br><span class="line">B + ConcreteVisitor2</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><strong>在 Java 中使用模式</strong></p>
<p><strong>复杂度：</strong> ★★★</p>
<p><strong>流行度：</strong> ★☆☆</p>
<p><strong>使用示例：</strong> 访问者不是常用的设计模式， 因为它不仅复杂， 应用范围也比较狭窄。</p>
<p>这里是 Java 程序库代码中该模式的一些示例：</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://docs.oracle.com/javase/8/docs/api/javax/lang/model/element/AnnotationValue.html"><code>javax.lang.model.element.AnnotationValue</code></a> 和 <a target="_blank" rel="noopener" href="http://docs.oracle.com/javase/8/docs/api/javax/lang/model/element/AnnotationValueVisitor.html"><code>Annotation­Value­Visitor</code></a></li>
<li><a target="_blank" rel="noopener" href="http://docs.oracle.com/javase/8/docs/api/javax/lang/model/element/Element.html"><code>javax.lang.model.element.Element</code></a> 和 <a target="_blank" rel="noopener" href="http://docs.oracle.com/javase/8/docs/api/javax/lang/model/element/ElementVisitor.html"><code>Element­Visitor</code></a></li>
<li><a target="_blank" rel="noopener" href="http://docs.oracle.com/javase/8/docs/api/javax/lang/model/type/TypeMirror.html"><code>javax.lang.model.type.TypeMirror</code></a> 和 <a target="_blank" rel="noopener" href="http://docs.oracle.com/javase/8/docs/api/javax/lang/model/type/TypeVisitor.html"><code>Type­Visitor</code></a></li>
<li><a target="_blank" rel="noopener" href="http://docs.oracle.com/javase/8/docs/api/java/nio/file/FileVisitor.html"><code>java.nio.file.FileVisitor</code></a> 和 <a target="_blank" rel="noopener" href="http://docs.oracle.com/javase/8/docs/api/java/nio/file/SimpleFileVisitor.html"><code>Simple­File­Visitor</code></a></li>
<li><a target="_blank" rel="noopener" href="http://docs.oracle.com/javaee/7/api/javax/faces/component/visit/VisitContext.html"><code>javax.faces.component.visit.VisitContext</code></a> 和 <a target="_blank" rel="noopener" href="http://docs.oracle.com/javaee/7/api/javax/faces/component/visit/VisitCallback.html"><code>Visit­Callback</code></a></li>
</ul>
<p><strong>将形状导出为 XML 文件</strong></p>
<p>在本例中， 我们希望将一系列几何形状导出为 XML 文件。 重点在于我们不希望直接修改形状代码， 或者至少能确保最小程度的修改。</p>
<p>最终， 访问者模式建立了一个框架， 允许我们在不修改已有类的情况下向形状层次结构中添加新的行为。</p>
<p><strong>shapes</strong></p>
<p><strong>shapes&#x2F;Shape.java:</strong> 通用形状接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.visitor.example.shapes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.visitor.example.visitor.Visitor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">move</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span>;</span><br><span class="line">    String <span class="title function_">accept</span><span class="params">(Visitor visitor)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>shapes&#x2F;Dot.java:</strong> 点</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.visitor.example.shapes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.visitor.example.visitor.Visitor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dot</span> <span class="keyword">implements</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> x;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> y;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Dot</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Dot</span><span class="params">(<span class="type">int</span> id, <span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.x = x;</span><br><span class="line">        <span class="built_in">this</span>.y = y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">move</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        <span class="comment">// move shape</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// draw shape</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">accept</span><span class="params">(Visitor visitor)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> visitor.visitDot(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getX</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getY</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>shapes&#x2F;Circle.java:</strong> 圆形</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.visitor.example.shapes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.visitor.example.visitor.Visitor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Circle</span> <span class="keyword">extends</span> <span class="title class_">Dot</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> radius;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Circle</span><span class="params">(<span class="type">int</span> id, <span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> radius)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(id, x, y);</span><br><span class="line">        <span class="built_in">this</span>.radius = radius;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">accept</span><span class="params">(Visitor visitor)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> visitor.visitCircle(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getRadius</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> radius;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>shapes&#x2F;Rectangle.java:</strong> 矩形</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.visitor.example.shapes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.visitor.example.visitor.Visitor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Rectangle</span> <span class="keyword">implements</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> x;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> y;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> width;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> height;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Rectangle</span><span class="params">(<span class="type">int</span> id, <span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> width, <span class="type">int</span> height)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.x = x;</span><br><span class="line">        <span class="built_in">this</span>.y = y;</span><br><span class="line">        <span class="built_in">this</span>.width = width;</span><br><span class="line">        <span class="built_in">this</span>.height = height;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">accept</span><span class="params">(Visitor visitor)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> visitor.visitRectangle(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">move</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        <span class="comment">// move shape</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// draw shape</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getX</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getY</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getWidth</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> width;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getHeight</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> height;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>shapes&#x2F;CompoundShape.java:</strong> 组合形状</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.visitor.example.shapes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.visitor.example.visitor.Visitor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CompoundShape</span> <span class="keyword">implements</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Shape&gt; children = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CompoundShape</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">move</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        <span class="comment">// move shape</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// draw shape</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">accept</span><span class="params">(Visitor visitor)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> visitor.visitCompoundGraphic(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Shape shape)</span> &#123;</span><br><span class="line">        children.add(shape);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>visitor</strong></p>
<p><strong>visitor&#x2F;Visitor.java:</strong> 通用访问者接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.visitor.example.visitor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.visitor.example.shapes.Circle;</span><br><span class="line"><span class="keyword">import</span> refactoring_guru.visitor.example.shapes.CompoundShape;</span><br><span class="line"><span class="keyword">import</span> refactoring_guru.visitor.example.shapes.Dot;</span><br><span class="line"><span class="keyword">import</span> refactoring_guru.visitor.example.shapes.Rectangle;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Visitor</span> &#123;</span><br><span class="line">    String <span class="title function_">visitDot</span><span class="params">(Dot dot)</span>;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">visitCircle</span><span class="params">(Circle circle)</span>;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">visitRectangle</span><span class="params">(Rectangle rectangle)</span>;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">visitCompoundGraphic</span><span class="params">(CompoundShape cg)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>visitor&#x2F;XMLExportVisitor.java:</strong> 具体访问者， 将所有形状导出为 XML 文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.visitor.example.visitor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.visitor.example.shapes.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XMLExportVisitor</span> <span class="keyword">implements</span> <span class="title class_">Visitor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">export</span><span class="params">(Shape... args)</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        sb.append(<span class="string">&quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;utf-8\&quot;?&gt;&quot;</span> + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (Shape shape : args) &#123;</span><br><span class="line">            sb.append(shape.accept(<span class="built_in">this</span>)).append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">visitDot</span><span class="params">(Dot d)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&lt;dot&gt;&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &lt;id&gt;&quot;</span> + d.getId() + <span class="string">&quot;&lt;/id&gt;&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &lt;x&gt;&quot;</span> + d.getX() + <span class="string">&quot;&lt;/x&gt;&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &lt;y&gt;&quot;</span> + d.getY() + <span class="string">&quot;&lt;/y&gt;&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&lt;/dot&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">visitCircle</span><span class="params">(Circle c)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&lt;circle&gt;&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &lt;id&gt;&quot;</span> + c.getId() + <span class="string">&quot;&lt;/id&gt;&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &lt;x&gt;&quot;</span> + c.getX() + <span class="string">&quot;&lt;/x&gt;&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &lt;y&gt;&quot;</span> + c.getY() + <span class="string">&quot;&lt;/y&gt;&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &lt;radius&gt;&quot;</span> + c.getRadius() + <span class="string">&quot;&lt;/radius&gt;&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&lt;/circle&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">visitRectangle</span><span class="params">(Rectangle r)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&lt;rectangle&gt;&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &lt;id&gt;&quot;</span> + r.getId() + <span class="string">&quot;&lt;/id&gt;&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &lt;x&gt;&quot;</span> + r.getX() + <span class="string">&quot;&lt;/x&gt;&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &lt;y&gt;&quot;</span> + r.getY() + <span class="string">&quot;&lt;/y&gt;&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &lt;width&gt;&quot;</span> + r.getWidth() + <span class="string">&quot;&lt;/width&gt;&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &lt;height&gt;&quot;</span> + r.getHeight() + <span class="string">&quot;&lt;/height&gt;&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&lt;/rectangle&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">visitCompoundGraphic</span><span class="params">(CompoundShape cg)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&lt;compound_graphic&gt;&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;   &lt;id&gt;&quot;</span> + cg.getId() + <span class="string">&quot;&lt;/id&gt;&quot;</span> + <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">                _visitCompoundGraphic(cg) +</span><br><span class="line">                <span class="string">&quot;&lt;/compound_graphic&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">_visitCompoundGraphic</span><span class="params">(CompoundShape cg)</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span> (Shape shape : cg.children) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">obj</span> <span class="operator">=</span> shape.accept(<span class="built_in">this</span>);</span><br><span class="line">            <span class="comment">// Proper indentation for sub-objects.</span></span><br><span class="line">            obj = <span class="string">&quot;    &quot;</span> + obj.replace(<span class="string">&quot;\n&quot;</span>, <span class="string">&quot;\n    &quot;</span>) + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">            sb.append(obj);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Demo.java:</strong> 客户端代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.visitor.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.visitor.example.shapes.*;</span><br><span class="line"><span class="keyword">import</span> refactoring_guru.visitor.example.visitor.XMLExportVisitor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Dot</span> <span class="variable">dot</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dot</span>(<span class="number">1</span>, <span class="number">10</span>, <span class="number">55</span>);</span><br><span class="line">        <span class="type">Circle</span> <span class="variable">circle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Circle</span>(<span class="number">2</span>, <span class="number">23</span>, <span class="number">15</span>, <span class="number">10</span>);</span><br><span class="line">        <span class="type">Rectangle</span> <span class="variable">rectangle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Rectangle</span>(<span class="number">3</span>, <span class="number">10</span>, <span class="number">17</span>, <span class="number">20</span>, <span class="number">30</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">CompoundShape</span> <span class="variable">compoundShape</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CompoundShape</span>(<span class="number">4</span>);</span><br><span class="line">        compoundShape.add(dot);</span><br><span class="line">        compoundShape.add(circle);</span><br><span class="line">        compoundShape.add(rectangle);</span><br><span class="line"></span><br><span class="line">        <span class="type">CompoundShape</span> <span class="variable">c</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CompoundShape</span>(<span class="number">5</span>);</span><br><span class="line">        c.add(dot);</span><br><span class="line">        compoundShape.add(c);</span><br><span class="line"></span><br><span class="line">        export(circle, compoundShape);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">export</span><span class="params">(Shape... shapes)</span> &#123;</span><br><span class="line">        <span class="type">XMLExportVisitor</span> <span class="variable">exportVisitor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XMLExportVisitor</span>();</span><br><span class="line">        System.out.println(exportVisitor.export(shapes));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>OutputDemo.png:</strong>  执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;circle&gt;</span><br><span class="line">    &lt;id&gt;2&lt;/id&gt;</span><br><span class="line">    &lt;x&gt;23&lt;/x&gt;</span><br><span class="line">    &lt;y&gt;15&lt;/y&gt;</span><br><span class="line">    &lt;radius&gt;10&lt;/radius&gt;</span><br><span class="line">&lt;/circle&gt;</span><br><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;compound_graphic&gt;</span><br><span class="line">   &lt;id&gt;4&lt;/id&gt;</span><br><span class="line">    &lt;dot&gt;</span><br><span class="line">        &lt;id&gt;1&lt;/id&gt;</span><br><span class="line">        &lt;x&gt;10&lt;/x&gt;</span><br><span class="line">        &lt;y&gt;55&lt;/y&gt;</span><br><span class="line">    &lt;/dot&gt;</span><br><span class="line">    &lt;circle&gt;</span><br><span class="line">        &lt;id&gt;2&lt;/id&gt;</span><br><span class="line">        &lt;x&gt;23&lt;/x&gt;</span><br><span class="line">        &lt;y&gt;15&lt;/y&gt;</span><br><span class="line">        &lt;radius&gt;10&lt;/radius&gt;</span><br><span class="line">    &lt;/circle&gt;</span><br><span class="line">    &lt;rectangle&gt;</span><br><span class="line">        &lt;id&gt;3&lt;/id&gt;</span><br><span class="line">        &lt;x&gt;10&lt;/x&gt;</span><br><span class="line">        &lt;y&gt;17&lt;/y&gt;</span><br><span class="line">        &lt;width&gt;20&lt;/width&gt;</span><br><span class="line">        &lt;height&gt;30&lt;/height&gt;</span><br><span class="line">    &lt;/rectangle&gt;</span><br><span class="line">    &lt;compound_graphic&gt;</span><br><span class="line">       &lt;id&gt;5&lt;/id&gt;</span><br><span class="line">        &lt;dot&gt;</span><br><span class="line">            &lt;id&gt;1&lt;/id&gt;</span><br><span class="line">            &lt;x&gt;10&lt;/x&gt;</span><br><span class="line">            &lt;y&gt;55&lt;/y&gt;</span><br><span class="line">        &lt;/dot&gt;</span><br><span class="line">    &lt;/compound_graphic&gt;</span><br><span class="line">&lt;/compound_graphic&gt;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><strong>在 PHP 中使用模式</strong></p>
<p><strong>复杂度：</strong> ★★★</p>
<p><strong>流行度：</strong> ★☆☆</p>
<p><strong>使用示例：</strong> 访问者模式在 PHP 代码中不太常用， 因为它不仅复杂， 应用范围也比较狭窄。</p>
<div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">概念示例</button><button type="button" class="tab">真实世界示例</button></div><div class="tab-contents"><div class="tab-item-content active"><p><strong>概念示例</strong></p>
<p>本例说明了<strong>访问者</strong>设计模式的结构并重点回答了下面的问题：</p>
<ul>
<li>它由哪些类组成？</li>
<li>这些类扮演了哪些角色？</li>
<li>模式中的各个元素会以何种方式相互关联？</li>
</ul>
<p>了解该模式的结构后， 你可以更容易地理解下面基于真实世界的 PHP 应用案例。</p>
<p><strong>index.php:</strong> 概念示例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">RefactoringGuru</span>\<span class="title class_">Visitor</span>\<span class="title class_">Conceptual</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Component interface declares an `accept` method that should take the base</span></span><br><span class="line"><span class="comment"> * visitor interface as an argument.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Component</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">accept</span>(<span class="params">Visitor <span class="variable">$visitor</span></span>): <span class="title">void</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Each Concrete Component must implement the `accept` method in such a way that</span></span><br><span class="line"><span class="comment"> * it calls the visitor&#x27;s method corresponding to the component&#x27;s class.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteComponentA</span> <span class="keyword">implements</span> <span class="title">Component</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Note that we&#x27;re calling `visitConcreteComponentA`, which matches the</span></span><br><span class="line"><span class="comment">     * current class name. This way we let the visitor know the class of the</span></span><br><span class="line"><span class="comment">     * component it works with.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">accept</span>(<span class="params">Visitor <span class="variable">$visitor</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$visitor</span>-&gt;<span class="title function_ invoke__">visitConcreteComponentA</span>(<span class="variable">$this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Concrete Components may have special methods that don&#x27;t exist in their</span></span><br><span class="line"><span class="comment">     * base class or interface. The Visitor is still able to use these methods</span></span><br><span class="line"><span class="comment">     * since it&#x27;s aware of the component&#x27;s concrete class.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">exclusiveMethodOfConcreteComponentA</span>(<span class="params"></span>): <span class="title">string</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;A&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteComponentB</span> <span class="keyword">implements</span> <span class="title">Component</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Same here: visitConcreteComponentB =&gt; ConcreteComponentB</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">accept</span>(<span class="params">Visitor <span class="variable">$visitor</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$visitor</span>-&gt;<span class="title function_ invoke__">visitConcreteComponentB</span>(<span class="variable">$this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">specialMethodOfConcreteComponentB</span>(<span class="params"></span>): <span class="title">string</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;B&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Visitor Interface declares a set of visiting methods that correspond to</span></span><br><span class="line"><span class="comment"> * component classes. The signature of a visiting method allows the visitor to</span></span><br><span class="line"><span class="comment"> * identify the exact class of the component that it&#x27;s dealing with.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Visitor</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">visitConcreteComponentA</span>(<span class="params">ConcreteComponentA <span class="variable">$element</span></span>): <span class="title">void</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">visitConcreteComponentB</span>(<span class="params">ConcreteComponentB <span class="variable">$element</span></span>): <span class="title">void</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Concrete Visitors implement several versions of the same algorithm, which can</span></span><br><span class="line"><span class="comment"> * work with all concrete component classes.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * You can experience the biggest benefit of the Visitor pattern when using it</span></span><br><span class="line"><span class="comment"> * with a complex object structure, such as a Composite tree. In this case, it</span></span><br><span class="line"><span class="comment"> * might be helpful to store some intermediate state of the algorithm while</span></span><br><span class="line"><span class="comment"> * executing visitor&#x27;s methods over various objects of the structure.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteVisitor1</span> <span class="keyword">implements</span> <span class="title">Visitor</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">visitConcreteComponentA</span>(<span class="params">ConcreteComponentA <span class="variable">$element</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$element</span>-&gt;<span class="title function_ invoke__">exclusiveMethodOfConcreteComponentA</span>() . <span class="string">&quot; + ConcreteVisitor1\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">visitConcreteComponentB</span>(<span class="params">ConcreteComponentB <span class="variable">$element</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$element</span>-&gt;<span class="title function_ invoke__">specialMethodOfConcreteComponentB</span>() . <span class="string">&quot; + ConcreteVisitor1\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteVisitor2</span> <span class="keyword">implements</span> <span class="title">Visitor</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">visitConcreteComponentA</span>(<span class="params">ConcreteComponentA <span class="variable">$element</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$element</span>-&gt;<span class="title function_ invoke__">exclusiveMethodOfConcreteComponentA</span>() . <span class="string">&quot; + ConcreteVisitor2\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">visitConcreteComponentB</span>(<span class="params">ConcreteComponentB <span class="variable">$element</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$element</span>-&gt;<span class="title function_ invoke__">specialMethodOfConcreteComponentB</span>() . <span class="string">&quot; + ConcreteVisitor2\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The client code can run visitor operations over any set of elements without</span></span><br><span class="line"><span class="comment"> * figuring out their concrete classes. The accept operation directs a call to</span></span><br><span class="line"><span class="comment"> * the appropriate operation in the visitor object.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clientCode</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$components</span>, Visitor <span class="variable">$visitor</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$components</span> <span class="keyword">as</span> <span class="variable">$component</span>) &#123;</span><br><span class="line">        <span class="variable">$component</span>-&gt;<span class="title function_ invoke__">accept</span>(<span class="variable">$visitor</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$components</span> = [</span><br><span class="line">    <span class="keyword">new</span> <span class="title function_ invoke__">ConcreteComponentA</span>(),</span><br><span class="line">    <span class="keyword">new</span> <span class="title function_ invoke__">ConcreteComponentB</span>(),</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;The client code works with all visitors via the base Visitor interface:\n&quot;</span>;</span><br><span class="line"><span class="variable">$visitor1</span> = <span class="keyword">new</span> <span class="title class_">ConcreteVisitor1</span>();</span><br><span class="line"><span class="title function_ invoke__">clientCode</span>(<span class="variable">$components</span>, <span class="variable">$visitor1</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;It allows the same client code to work with different types of visitors:\n&quot;</span>;</span><br><span class="line"><span class="variable">$visitor2</span> = <span class="keyword">new</span> <span class="title class_">ConcreteVisitor2</span>();</span><br><span class="line"><span class="title function_ invoke__">clientCode</span>(<span class="variable">$components</span>, <span class="variable">$visitor2</span>);</span><br></pre></td></tr></table></figure>

<p><strong>Output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">The client code works with all visitors via the base Visitor interface:</span><br><span class="line">A + ConcreteVisitor1</span><br><span class="line">B + ConcreteVisitor1</span><br><span class="line"></span><br><span class="line">It allows the same client code to work with different types of visitors:</span><br><span class="line">A + ConcreteVisitor1</span><br><span class="line">B + ConcreteVisitor2</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><strong>真实世界示例</strong></p>
<p>在本例中， <strong>访问者</strong>模式在已有类层次结构 （ “公司 &gt; 部门 &gt; 雇员”） 中添加了报表功能</p>
<p>在将访问者构架添加到程序中后， 你就能够在无需修改已有类的前提下将其他类似行为轻松添加到程序中了。</p>
<p><strong>index.php:</strong> 真实世界示例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">namespace RefactoringGuru\Visitor\RealWorld;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Component interface declares a method of accepting visitor objects.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * In this method, a Concrete Component must call a specific Visitor&#x27;s method</span></span><br><span class="line"><span class="comment"> * that has the same parameter type as that component.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Entity</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_">accept</span><span class="params">(Visitor $visitor)</span>: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Company Concrete Component.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Company</span> <span class="keyword">implements</span> <span class="title class_">Entity</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> $name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> Department[]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> $departments;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_">__construct</span><span class="params">(string $name, array $departments)</span></span><br><span class="line">    &#123;</span><br><span class="line">        $<span class="built_in">this</span>-&gt;name = $name;</span><br><span class="line">        $<span class="built_in">this</span>-&gt;departments = $departments;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_">getName</span><span class="params">()</span>: string</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> $<span class="built_in">this</span>-&gt;name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_">getDepartments</span><span class="params">()</span>: array</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> $<span class="built_in">this</span>-&gt;departments;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_">accept</span><span class="params">(Visitor $visitor)</span>: string</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// See, the Company component must call the visitCompany method. The</span></span><br><span class="line">        <span class="comment">// same principle applies to all components.</span></span><br><span class="line">        <span class="keyword">return</span> $visitor-&gt;visitCompany($<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Department Concrete Component.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Department</span> <span class="keyword">implements</span> <span class="title class_">Entity</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> $name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> Employee[]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> $employees;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_">__construct</span><span class="params">(string $name, array $employees)</span></span><br><span class="line">    &#123;</span><br><span class="line">        $<span class="built_in">this</span>-&gt;name = $name;</span><br><span class="line">        $<span class="built_in">this</span>-&gt;employees = $employees;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_">getName</span><span class="params">()</span>: string</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> $<span class="built_in">this</span>-&gt;name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_">getEmployees</span><span class="params">()</span>: array</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> $<span class="built_in">this</span>-&gt;employees;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_">getCost</span><span class="params">()</span>: <span class="type">int</span></span><br><span class="line">    &#123;</span><br><span class="line">        $cost = <span class="number">0</span>;</span><br><span class="line">        foreach ($<span class="built_in">this</span>-&gt;employees as $employee) &#123;</span><br><span class="line">            $cost += $employee-&gt;getSalary();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $cost;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_">accept</span><span class="params">(Visitor $visitor)</span>: string</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> $visitor-&gt;visitDepartment($<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Employee Concrete Component.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Employee</span> <span class="keyword">implements</span> <span class="title class_">Entity</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> $name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> $position;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> $salary;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_">__construct</span><span class="params">(string $name, string $position, <span class="type">int</span> $salary)</span></span><br><span class="line">    &#123;</span><br><span class="line">        $<span class="built_in">this</span>-&gt;name = $name;</span><br><span class="line">        $<span class="built_in">this</span>-&gt;position = $position;</span><br><span class="line">        $<span class="built_in">this</span>-&gt;salary = $salary;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_">getName</span><span class="params">()</span>: string</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> $<span class="built_in">this</span>-&gt;name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_">getPosition</span><span class="params">()</span>: string</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> $<span class="built_in">this</span>-&gt;position;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_">getSalary</span><span class="params">()</span>: <span class="type">int</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> $<span class="built_in">this</span>-&gt;salary;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_">accept</span><span class="params">(Visitor $visitor)</span>: string</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> $visitor-&gt;visitEmployee($<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Visitor interface declares a set of visiting methods for each of the</span></span><br><span class="line"><span class="comment"> * Concrete Component classes.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Visitor</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_">visitCompany</span><span class="params">(Company $company)</span>: string;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_">visitDepartment</span><span class="params">(Department $department)</span>: string;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_">visitEmployee</span><span class="params">(Employee $employee)</span>: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Concrete Visitor must provide implementations for every single class of</span></span><br><span class="line"><span class="comment"> * the Concrete Components.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SalaryReport</span> <span class="keyword">implements</span> <span class="title class_">Visitor</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_">visitCompany</span><span class="params">(Company $company)</span>: string</span><br><span class="line">    &#123;</span><br><span class="line">        $output = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        $total = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        foreach ($company-&gt;getDepartments() as $department) &#123;</span><br><span class="line">            $total += $department-&gt;getCost();</span><br><span class="line">            $output .= <span class="string">&quot;\n--&quot;</span> . $<span class="built_in">this</span>-&gt;visitDepartment($department);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $output = $company-&gt;getName() .</span><br><span class="line">            <span class="string">&quot; (&quot;</span> . money_format(<span class="string">&quot;%i&quot;</span>, $total) . <span class="string">&quot;)\n&quot;</span> . $output;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $output;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_">visitDepartment</span><span class="params">(Department $department)</span>: string</span><br><span class="line">    &#123;</span><br><span class="line">        $output = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        foreach ($department-&gt;getEmployees() as $employee) &#123;</span><br><span class="line">            $output .= <span class="string">&quot;   &quot;</span> . $<span class="built_in">this</span>-&gt;visitEmployee($employee);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $output = $department-&gt;getName() .</span><br><span class="line">            <span class="string">&quot; (&quot;</span> . money_format(<span class="string">&quot;%i&quot;</span>, $department-&gt;getCost()) . <span class="string">&quot;)\n\n&quot;</span> .</span><br><span class="line">            $output;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $output;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> function <span class="title function_">visitEmployee</span><span class="params">(Employee $employee)</span>: string</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> money_format(<span class="string">&quot;%#6n&quot;</span>, $employee-&gt;getSalary()) .</span><br><span class="line">            <span class="string">&quot; &quot;</span> . $employee-&gt;getName() .</span><br><span class="line">            <span class="string">&quot; (&quot;</span> . $employee-&gt;getPosition() . <span class="string">&quot;)\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The client code.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">$mobileDev = <span class="keyword">new</span> <span class="title class_">Department</span>(<span class="string">&quot;Mobile Development&quot;</span>, [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;Albert Falmore&quot;</span>, <span class="string">&quot;designer&quot;</span>, <span class="number">100000</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;Ali Halabay&quot;</span>, <span class="string">&quot;programmer&quot;</span>, <span class="number">100000</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;Sarah Konor&quot;</span>, <span class="string">&quot;programmer&quot;</span>, <span class="number">90000</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;Monica Ronaldino&quot;</span>, <span class="string">&quot;QA engineer&quot;</span>, <span class="number">31000</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;James Smith&quot;</span>, <span class="string">&quot;QA engineer&quot;</span>, <span class="number">30000</span>),</span><br><span class="line">]);</span><br><span class="line">$techSupport = <span class="keyword">new</span> <span class="title class_">Department</span>(<span class="string">&quot;Tech Support&quot;</span>, [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;Larry Ulbrecht&quot;</span>, <span class="string">&quot;supervisor&quot;</span>, <span class="number">70000</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;Elton Pale&quot;</span>, <span class="string">&quot;operator&quot;</span>, <span class="number">30000</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;Rajeet Kumar&quot;</span>, <span class="string">&quot;operator&quot;</span>, <span class="number">30000</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;John Burnovsky&quot;</span>, <span class="string">&quot;operator&quot;</span>, <span class="number">34000</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;Sergey Korolev&quot;</span>, <span class="string">&quot;operator&quot;</span>, <span class="number">35000</span>),</span><br><span class="line">]);</span><br><span class="line">$company = <span class="keyword">new</span> <span class="title class_">Company</span>(<span class="string">&quot;SuperStarDevelopment&quot;</span>, [$mobileDev, $techSupport]);</span><br><span class="line"></span><br><span class="line">setlocale(LC_MONETARY, <span class="string">&#x27;en_US&#x27;</span>);</span><br><span class="line">$report = <span class="keyword">new</span> <span class="title class_">SalaryReport</span>();</span><br><span class="line"></span><br><span class="line">echo <span class="string">&quot;Client: I can print a report for a whole company:\n\n&quot;</span>;</span><br><span class="line">echo $company-&gt;accept($report);</span><br><span class="line"></span><br><span class="line">echo <span class="string">&quot;\nClient: ...or just for a single department:\n\n&quot;</span>;</span><br><span class="line">echo $techSupport-&gt;accept($report);</span><br><span class="line"></span><br><span class="line"><span class="comment">// $export = new JSONExport(); </span></span><br><span class="line"><span class="comment">// echo $company-&gt;accept($export);</span></span><br></pre></td></tr></table></figure>

<p><strong>Output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">Client: I can print a report for a whole company:</span><br><span class="line"></span><br><span class="line">SuperStarDevelopment (USD550,000.00)</span><br><span class="line"></span><br><span class="line">--Mobile Development (USD351,000.00)</span><br><span class="line"></span><br><span class="line">    $100,000.00 Albert Falmore (designer)</span><br><span class="line">    $100,000.00 Ali Halabay (programmer)</span><br><span class="line">    $ 90,000.00 Sarah Konor (programmer)</span><br><span class="line">    $ 31,000.00 Monica Ronaldino (QA engineer)</span><br><span class="line">    $ 30,000.00 James Smith (QA engineer)</span><br><span class="line"></span><br><span class="line">--Tech Support (USD199,000.00)</span><br><span class="line"></span><br><span class="line">    $ 70,000.00 Larry Ulbrecht (supervisor)</span><br><span class="line">    $ 30,000.00 Elton Pale (operator)</span><br><span class="line">    $ 30,000.00 Rajeet Kumar (operator)</span><br><span class="line">    $ 34,000.00 John Burnovsky (operator)</span><br><span class="line">    $ 35,000.00 Sergey Korolev (operator)</span><br><span class="line"></span><br><span class="line">Client: ...or just for a single department:</span><br><span class="line"></span><br><span class="line">Tech Support (USD199,000.00)</span><br><span class="line"></span><br><span class="line">    $ 70,000.00 Larry Ulbrecht (supervisor)</span><br><span class="line">    $ 30,000.00 Elton Pale (operator)</span><br><span class="line">    $ 30,000.00 Rajeet Kumar (operator)</span><br><span class="line">    $ 34,000.00 John Burnovsky (operator)</span><br><span class="line">    $ 35,000.00 Sergey Korolev (operator)</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><div class="tab-item-content"><p><strong>在 Python 中使用模式</strong></p>
<p><strong>复杂度：</strong> ★★★</p>
<p><strong>流行度：</strong> ★☆☆</p>
<p><strong>使用示例：</strong> 访问者不是常用的设计模式， 因为它不仅复杂， 应用范围也比较狭窄。</p>
<p><strong>概念示例</strong></p>
<p>本例说明了<strong>访问者</strong>设计模式的结构并重点回答了下面的问题：</p>
<ul>
<li>它由哪些类组成？</li>
<li>这些类扮演了哪些角色？</li>
<li>模式中的各个元素会以何种方式相互关联？</li>
</ul>
<p><strong>main.py:</strong> 概念示例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> annotations</span><br><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Component</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Component interface declares an `accept` method that should take the</span></span><br><span class="line"><span class="string">    base visitor interface as an argument.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">accept</span>(<span class="params">self, visitor: Visitor</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteComponentA</span>(<span class="title class_ inherited__">Component</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Each Concrete Component must implement the `accept` method in such a way</span></span><br><span class="line"><span class="string">    that it calls the visitor&#x27;s method corresponding to the component&#x27;s class.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">accept</span>(<span class="params">self, visitor: Visitor</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Note that we&#x27;re calling `visitConcreteComponentA`, which matches the</span></span><br><span class="line"><span class="string">        current class name. This way we let the visitor know the class of the</span></span><br><span class="line"><span class="string">        component it works with.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        visitor.visit_concrete_component_a(self)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">exclusive_method_of_concrete_component_a</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Concrete Components may have special methods that don&#x27;t exist in their</span></span><br><span class="line"><span class="string">        base class or interface. The Visitor is still able to use these methods</span></span><br><span class="line"><span class="string">        since it&#x27;s aware of the component&#x27;s concrete class.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;A&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteComponentB</span>(<span class="title class_ inherited__">Component</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Same here: visitConcreteComponentB =&gt; ConcreteComponentB</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">accept</span>(<span class="params">self, visitor: Visitor</span>):</span><br><span class="line">        visitor.visit_concrete_component_b(self)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">special_method_of_concrete_component_b</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;B&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Visitor</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Visitor Interface declares a set of visiting methods that correspond to</span></span><br><span class="line"><span class="string">    component classes. The signature of a visiting method allows the visitor to</span></span><br><span class="line"><span class="string">    identify the exact class of the component that it&#x27;s dealing with.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">visit_concrete_component_a</span>(<span class="params">self, element: ConcreteComponentA</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">visit_concrete_component_b</span>(<span class="params">self, element: ConcreteComponentB</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Concrete Visitors implement several versions of the same algorithm, which can</span></span><br><span class="line"><span class="string">work with all concrete component classes.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">You can experience the biggest benefit of the Visitor pattern when using it with</span></span><br><span class="line"><span class="string">a complex object structure, such as a Composite tree. In this case, it might be</span></span><br><span class="line"><span class="string">helpful to store some intermediate state of the algorithm while executing</span></span><br><span class="line"><span class="string">visitor&#x27;s methods over various objects of the structure.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteVisitor1</span>(<span class="title class_ inherited__">Visitor</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">visit_concrete_component_a</span>(<span class="params">self, element</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;element.exclusive_method_of_concrete_component_a()&#125;</span> + ConcreteVisitor1&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">visit_concrete_component_b</span>(<span class="params">self, element</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;element.special_method_of_concrete_component_b()&#125;</span> + ConcreteVisitor1&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteVisitor2</span>(<span class="title class_ inherited__">Visitor</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">visit_concrete_component_a</span>(<span class="params">self, element</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;element.exclusive_method_of_concrete_component_a()&#125;</span> + ConcreteVisitor2&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">visit_concrete_component_b</span>(<span class="params">self, element</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;element.special_method_of_concrete_component_b()&#125;</span> + ConcreteVisitor2&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">client_code</span>(<span class="params">components: <span class="type">List</span>[Component], visitor: Visitor</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The client code can run visitor operations over any set of elements without</span></span><br><span class="line"><span class="string">    figuring out their concrete classes. The accept operation directs a call to</span></span><br><span class="line"><span class="string">    the appropriate operation in the visitor object.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">    <span class="keyword">for</span> component <span class="keyword">in</span> components:</span><br><span class="line">        component.accept(visitor)</span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    components = [ConcreteComponentA(), ConcreteComponentB()]</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;The client code works with all visitors via the base Visitor interface:&quot;</span>)</span><br><span class="line">    visitor1 = ConcreteVisitor1()</span><br><span class="line">    client_code(components, visitor1)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;It allows the same client code to work with different types of visitors:&quot;</span>)</span><br><span class="line">    visitor2 = ConcreteVisitor2()</span><br><span class="line">    client_code(components, visitor2)</span><br></pre></td></tr></table></figure>

<p><strong>Output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">The client code works with all visitors via the base Visitor interface:</span><br><span class="line">A + ConcreteVisitor1</span><br><span class="line">B + ConcreteVisitor1</span><br><span class="line">It allows the same client code to work with different types of visitors:</span><br><span class="line">A + ConcreteVisitor2</span><br><span class="line">B + ConcreteVisitor2</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><strong>在 Ruby 中使用模式</strong></p>
<p><strong>复杂度：</strong> ★★★</p>
<p><strong>流行度：</strong> ★☆☆</p>
<p><strong>使用示例：</strong> 访问者不是常用的设计模式， 因为它不仅复杂， 应用范围也比较狭窄。</p>
<p><strong>概念示例</strong></p>
<p>本例说明了<strong>访问者</strong>设计模式的结构并重点回答了下面的问题：</p>
<ul>
<li>它由哪些类组成？</li>
<li>这些类扮演了哪些角色？</li>
<li>模式中的各个元素会以何种方式相互关联？</li>
</ul>
<p><strong>main.rb:</strong> 概念示例</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The Component interface declares an `accept` method that should take the base</span></span><br><span class="line"><span class="comment"># visitor interface as an argument.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Component</span></span><br><span class="line">  <span class="comment"># <span class="doctag">@abstract</span></span></span><br><span class="line">  <span class="comment">#</span></span><br><span class="line">  <span class="comment"># <span class="doctag">@param</span> [Visitor] visitor</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">accept</span>(<span class="params">_visitor</span>)</span><br><span class="line">    raise NotImplementedError, <span class="string">&quot;<span class="subst">#&#123;<span class="variable language_">self</span>.<span class="keyword">class</span>&#125;</span> has not implemented method &#x27;<span class="subst">#&#123;__method__&#125;</span>&#x27;&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Each Concrete Component must implement the `accept` method in such a way that</span></span><br><span class="line"><span class="comment"># it calls the visitor&#x27;s method corresponding to the component&#x27;s class.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteComponentA</span> &lt; <span class="title class_ inherited__">Component</span></span><br><span class="line">  <span class="comment"># Note that we&#x27;re calling `visitConcreteComponentA`, which matches the current</span></span><br><span class="line">  <span class="comment"># class name. This way we let the visitor know the class of the component it</span></span><br><span class="line">  <span class="comment"># works with.</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">accept</span>(<span class="params">visitor</span>)</span><br><span class="line">    visitor.visit_concrete_component_a(<span class="variable language_">self</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Concrete Components may have special methods that don&#x27;t exist in their base</span></span><br><span class="line">  <span class="comment"># class or interface. The Visitor is still able to use these methods since</span></span><br><span class="line">  <span class="comment"># it&#x27;s aware of the component&#x27;s concrete class.</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">exclusive_method_of_concrete_component_a</span></span><br><span class="line">    <span class="string">&#x27;A&#x27;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Same here: visit_concrete_component_b =&gt; ConcreteComponentB</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteComponentB</span> &lt; <span class="title class_ inherited__">Component</span></span><br><span class="line">  <span class="comment"># <span class="doctag">@param</span> [Visitor] visitor</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">accept</span>(<span class="params">visitor</span>)</span><br><span class="line">    visitor.visit_concrete_component_b(<span class="variable language_">self</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">special_method_of_concrete_component_b</span></span><br><span class="line">    <span class="string">&#x27;B&#x27;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The Visitor Interface declares a set of visiting methods that correspond to</span></span><br><span class="line"><span class="comment"># component classes. The signature of a visiting method allows the visitor to</span></span><br><span class="line"><span class="comment"># identify the exact class of the component that it&#x27;s dealing with.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Visitor</span></span><br><span class="line">  <span class="comment"># <span class="doctag">@abstract</span></span></span><br><span class="line">  <span class="comment">#</span></span><br><span class="line">  <span class="comment"># <span class="doctag">@param</span> [ConcreteComponentA] element</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">visit_concrete_component_a</span>(<span class="params">_element</span>)</span><br><span class="line">    raise NotImplementedError, <span class="string">&quot;<span class="subst">#&#123;<span class="variable language_">self</span>.<span class="keyword">class</span>&#125;</span> has not implemented method &#x27;<span class="subst">#&#123;__method__&#125;</span>&#x27;&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># <span class="doctag">@abstract</span></span></span><br><span class="line">  <span class="comment">#</span></span><br><span class="line">  <span class="comment"># <span class="doctag">@param</span> [ConcreteComponentB] element</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">visit_concrete_component_b</span>(<span class="params">_element</span>)</span><br><span class="line">    raise NotImplementedError, <span class="string">&quot;<span class="subst">#&#123;<span class="variable language_">self</span>.<span class="keyword">class</span>&#125;</span> has not implemented method &#x27;<span class="subst">#&#123;__method__&#125;</span>&#x27;&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Concrete Visitors implement several versions of the same algorithm, which can</span></span><br><span class="line"><span class="comment"># work with all concrete component classes.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># You can experience the biggest benefit of the Visitor pattern when using it</span></span><br><span class="line"><span class="comment"># with a complex object structure, such as a Composite tree. In this case, it</span></span><br><span class="line"><span class="comment"># might be helpful to store some intermediate state of the algorithm while</span></span><br><span class="line"><span class="comment"># executing visitor&#x27;s methods over various objects of the structure.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteVisitor1</span> &lt; <span class="title class_ inherited__">Visitor</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">visit_concrete_component_a</span>(<span class="params">element</span>)</span><br><span class="line">    puts <span class="string">&quot;<span class="subst">#&#123;element.exclusive_method_of_concrete_component_a&#125;</span> + <span class="subst">#&#123;<span class="variable language_">self</span>.<span class="keyword">class</span>&#125;</span>&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">visit_concrete_component_b</span>(<span class="params">element</span>)</span><br><span class="line">    puts <span class="string">&quot;<span class="subst">#&#123;element.special_method_of_concrete_component_b&#125;</span> + <span class="subst">#&#123;<span class="variable language_">self</span>.<span class="keyword">class</span>&#125;</span>&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteVisitor2</span> &lt; <span class="title class_ inherited__">Visitor</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">visit_concrete_component_a</span>(<span class="params">element</span>)</span><br><span class="line">    puts <span class="string">&quot;<span class="subst">#&#123;element.exclusive_method_of_concrete_component_a&#125;</span> + <span class="subst">#&#123;<span class="variable language_">self</span>.<span class="keyword">class</span>&#125;</span>&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">visit_concrete_component_b</span>(<span class="params">element</span>)</span><br><span class="line">    puts <span class="string">&quot;<span class="subst">#&#123;element.special_method_of_concrete_component_b&#125;</span> + <span class="subst">#&#123;<span class="variable language_">self</span>.<span class="keyword">class</span>&#125;</span>&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The client code can run visitor operations over any set of elements without</span></span><br><span class="line"><span class="comment"># figuring out their concrete classes. The accept operation directs a call to</span></span><br><span class="line"><span class="comment"># the appropriate operation in the visitor object.</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">client_code</span>(<span class="params">components, visitor</span>)</span><br><span class="line">  <span class="comment"># ...</span></span><br><span class="line">  components.each <span class="keyword">do</span> |<span class="params">component</span>|</span><br><span class="line">    component.accept(visitor)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  <span class="comment"># ...</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">components = [ConcreteComponentA.new, ConcreteComponentB.new]</span><br><span class="line"></span><br><span class="line">puts <span class="string">&#x27;The client code works with all visitors via the base Visitor interface:&#x27;</span></span><br><span class="line">visitor1 = ConcreteVisitor1.new</span><br><span class="line">client_code(components, visitor1)</span><br><span class="line"></span><br><span class="line">puts <span class="string">&#x27;It allows the same client code to work with different types of visitors:&#x27;</span></span><br><span class="line">visitor2 = ConcreteVisitor2.new</span><br><span class="line">client_code(components, visitor2)</span><br></pre></td></tr></table></figure>

<p><strong>output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">The client code works with all visitors via the base Visitor interface:</span><br><span class="line">A + ConcreteVisitor1</span><br><span class="line">B + ConcreteVisitor1</span><br><span class="line">It allows the same client code to work with different types of visitors:</span><br><span class="line">A + ConcreteVisitor2</span><br><span class="line">B + ConcreteVisitor2</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><strong>在 Swift 中使用模式</strong></p>
<p><strong>复杂度：</strong> ★★★</p>
<p><strong>流行度：</strong> ★☆☆</p>
<p><strong>使用示例：</strong> 访问者不是常用的设计模式， 因为它不仅复杂， 应用范围也比较狭窄。</p>
<div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">概念示例</button><button type="button" class="tab">真实世界示例</button></div><div class="tab-contents"><div class="tab-item-content active"><p><strong>概念示例</strong></p>
<p>本例说明了<strong>访问者</strong>设计模式的结构并重点回答了下面的问题：</p>
<ul>
<li>它由哪些类组成？</li>
<li>这些类扮演了哪些角色？</li>
<li>模式中的各个元素会以何种方式相互关联？</li>
</ul>
<p>了解该模式的结构后， 你可以更容易地理解下面基于真实世界的 Swift 应用案例。</p>
<p><strong>Example.swift:</strong> 概念示例</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> XCTest</span><br><span class="line"></span><br><span class="line"><span class="comment">/// The Component interface declares an `accept` method that should take the</span></span><br><span class="line"><span class="comment">/// base visitor interface as an argument.</span></span><br><span class="line"><span class="keyword">protocol</span> <span class="title class_">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">accept</span>(<span class="keyword">_</span> <span class="params">visitor</span>: <span class="type">Visitor</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Each Concrete Component must implement the `accept` method in such a way</span></span><br><span class="line"><span class="comment">/// that it calls the visitor&#x27;s method corresponding to the component&#x27;s class.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteComponentA</span>: <span class="title class_">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Note that we&#x27;re calling `visitConcreteComponentA`, which matches the</span></span><br><span class="line">    <span class="comment">/// current class name. This way we let the visitor know the class of the</span></span><br><span class="line">    <span class="comment">/// component it works with.</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">accept</span>(<span class="keyword">_</span> <span class="params">visitor</span>: <span class="type">Visitor</span>) &#123;</span><br><span class="line">        visitor.visitConcreteComponentA(element: <span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Concrete Components may have special methods that don&#x27;t exist in their</span></span><br><span class="line">    <span class="comment">/// base class or interface. The Visitor is still able to use these methods</span></span><br><span class="line">    <span class="comment">/// since it&#x27;s aware of the component&#x27;s concrete class.</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">exclusiveMethodOfConcreteComponentA</span>() -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;A&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteComponentB</span>: <span class="title class_">Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Same here: visitConcreteComponentB =&gt; ConcreteComponentB</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">accept</span>(<span class="keyword">_</span> <span class="params">visitor</span>: <span class="type">Visitor</span>) &#123;</span><br><span class="line">        visitor.visitConcreteComponentB(element: <span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">specialMethodOfConcreteComponentB</span>() -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;B&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// The Visitor Interface declares a set of visiting methods that correspond to</span></span><br><span class="line"><span class="comment">/// component classes. The signature of a visiting method allows the visitor to</span></span><br><span class="line"><span class="comment">/// identify the exact class of the component that it&#x27;s dealing with.</span></span><br><span class="line"><span class="keyword">protocol</span> <span class="title class_">Visitor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">visitConcreteComponentA</span>(<span class="params">element</span>: <span class="type">ConcreteComponentA</span>)</span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">visitConcreteComponentB</span>(<span class="params">element</span>: <span class="type">ConcreteComponentB</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Concrete Visitors implement several versions of the same algorithm, which</span></span><br><span class="line"><span class="comment">/// can work with all concrete component classes.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// You can experience the biggest benefit of the Visitor pattern when using it</span></span><br><span class="line"><span class="comment">/// with a complex object structure, such as a Composite tree. In this case, it</span></span><br><span class="line"><span class="comment">/// might be helpful to store some intermediate state of the algorithm while</span></span><br><span class="line"><span class="comment">/// executing visitor&#x27;s methods over various objects of the structure.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteVisitor1</span>: <span class="title class_">Visitor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">visitConcreteComponentA</span>(<span class="params">element</span>: <span class="type">ConcreteComponentA</span>) &#123;</span><br><span class="line">        <span class="built_in">print</span>(element.exclusiveMethodOfConcreteComponentA() <span class="operator">+</span> <span class="string">&quot; + ConcreteVisitor1<span class="subst">\n</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">visitConcreteComponentB</span>(<span class="params">element</span>: <span class="type">ConcreteComponentB</span>) &#123;</span><br><span class="line">        <span class="built_in">print</span>(element.specialMethodOfConcreteComponentB() <span class="operator">+</span> <span class="string">&quot; + ConcreteVisitor1<span class="subst">\n</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteVisitor2</span>: <span class="title class_">Visitor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">visitConcreteComponentA</span>(<span class="params">element</span>: <span class="type">ConcreteComponentA</span>) &#123;</span><br><span class="line">        <span class="built_in">print</span>(element.exclusiveMethodOfConcreteComponentA() <span class="operator">+</span> <span class="string">&quot; + ConcreteVisitor2<span class="subst">\n</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">visitConcreteComponentB</span>(<span class="params">element</span>: <span class="type">ConcreteComponentB</span>) &#123;</span><br><span class="line">        <span class="built_in">print</span>(element.specialMethodOfConcreteComponentB() <span class="operator">+</span> <span class="string">&quot; + ConcreteVisitor2<span class="subst">\n</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// The client code can run visitor operations over any set of elements without</span></span><br><span class="line"><span class="comment">/// figuring out their concrete classes. The accept operation directs a call to</span></span><br><span class="line"><span class="comment">/// the appropriate operation in the visitor object.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">func</span> <span class="title function_">clientCode</span>(<span class="params">components</span>: [<span class="type">Component</span>], <span class="params">visitor</span>: <span class="type">Visitor</span>) &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        components.forEach(&#123; <span class="variable">$0</span>.accept(visitor) &#125;)</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Let&#x27;s see how it all works together.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VisitorConceptual</span>: <span class="title class_">XCTestCase</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">test</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> components: [<span class="type">Component</span>] <span class="operator">=</span> [<span class="type">ConcreteComponentA</span>(), <span class="type">ConcreteComponentB</span>()]</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;The client code works with all visitors via the base Visitor interface:<span class="subst">\n</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">let</span> visitor1 <span class="operator">=</span> <span class="type">ConcreteVisitor1</span>()</span><br><span class="line">        <span class="type">Client</span>.clientCode(components: components, visitor: visitor1)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\n</span>It allows the same client code to work with different types of visitors:<span class="subst">\n</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">let</span> visitor2 <span class="operator">=</span> <span class="type">ConcreteVisitor2</span>()</span><br><span class="line">        <span class="type">Client</span>.clientCode(components: components, visitor: visitor2)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">The client code works with all visitors via the base Visitor interface:</span><br><span class="line"></span><br><span class="line">A + ConcreteVisitor1</span><br><span class="line"></span><br><span class="line">B + ConcreteVisitor1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">It allows the same client code to work with different types of visitors:</span><br><span class="line"></span><br><span class="line">A + ConcreteVisitor2</span><br><span class="line"></span><br><span class="line">B + ConcreteVisitor2</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><strong>真实世界示例</strong></p>
<p><strong>Example.swift:</strong> 真实世界示例</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"><span class="keyword">import</span> XCTest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">protocol</span> <span class="title class_">Notification</span>: <span class="title class_">CustomStringConvertible</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">accept</span>(<span class="params">visitor</span>: <span class="type">NotificationPolicy</span>) -&gt; <span class="type">Bool</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Email</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> emailOfSender: <span class="type">String</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> description: <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="string">&quot;Email&quot;</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SMS</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> phoneNumberOfSender: <span class="type">String</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> description: <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="string">&quot;SMS&quot;</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Push</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> usernameOfSender: <span class="type">String</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> description: <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="string">&quot;Push&quot;</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">Email</span>: <span class="title class_">Notification</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">accept</span>(<span class="params">visitor</span>: <span class="type">NotificationPolicy</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> visitor.isTurnedOn(for: <span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">SMS</span>: <span class="title class_">Notification</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">accept</span>(<span class="params">visitor</span>: <span class="type">NotificationPolicy</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> visitor.isTurnedOn(for: <span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">Push</span>: <span class="title class_">Notification</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">accept</span>(<span class="params">visitor</span>: <span class="type">NotificationPolicy</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> visitor.isTurnedOn(for: <span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">protocol</span> <span class="title class_">NotificationPolicy</span>: <span class="title class_">CustomStringConvertible</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">isTurnedOn</span>(<span class="params">for</span> <span class="params">email</span>: <span class="type">Email</span>) -&gt; <span class="type">Bool</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">isTurnedOn</span>(<span class="params">for</span> <span class="params">sms</span>: <span class="type">SMS</span>) -&gt; <span class="type">Bool</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">isTurnedOn</span>(<span class="params">for</span> <span class="params">push</span>: <span class="type">Push</span>) -&gt; <span class="type">Bool</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NightPolicyVisitor</span>: <span class="title class_">NotificationPolicy</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">isTurnedOn</span>(<span class="params">for</span> <span class="params">email</span>: <span class="type">Email</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">isTurnedOn</span>(<span class="params">for</span> <span class="params">sms</span>: <span class="type">SMS</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">isTurnedOn</span>(<span class="params">for</span> <span class="params">push</span>: <span class="type">Push</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> description: <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="string">&quot;Night Policy Visitor&quot;</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DefaultPolicyVisitor</span>: <span class="title class_">NotificationPolicy</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">isTurnedOn</span>(<span class="params">for</span> <span class="params">email</span>: <span class="type">Email</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">isTurnedOn</span>(<span class="params">for</span> <span class="params">sms</span>: <span class="type">SMS</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">isTurnedOn</span>(<span class="params">for</span> <span class="params">push</span>: <span class="type">Push</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> description: <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="string">&quot;Default Policy Visitor&quot;</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BlackListVisitor</span>: <span class="title class_">NotificationPolicy</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> bannedEmails <span class="operator">=</span> [<span class="type">String</span>]()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> bannedPhones <span class="operator">=</span> [<span class="type">String</span>]()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> bannedUsernames <span class="operator">=</span> [<span class="type">String</span>]()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="params">emails</span>: [<span class="type">String</span>], <span class="params">phones</span>: [<span class="type">String</span>], <span class="params">usernames</span>: [<span class="type">String</span>]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.bannedEmails <span class="operator">=</span> emails</span><br><span class="line">        <span class="keyword">self</span>.bannedPhones <span class="operator">=</span> phones</span><br><span class="line">        <span class="keyword">self</span>.bannedUsernames <span class="operator">=</span> usernames</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">isTurnedOn</span>(<span class="params">for</span> <span class="params">email</span>: <span class="type">Email</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bannedEmails.contains(email.emailOfSender)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">isTurnedOn</span>(<span class="params">for</span> <span class="params">sms</span>: <span class="type">SMS</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bannedPhones.contains(sms.phoneNumberOfSender)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">isTurnedOn</span>(<span class="params">for</span> <span class="params">push</span>: <span class="type">Push</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> bannedUsernames.contains(push.usernameOfSender)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> description: <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="string">&quot;Black List Visitor&quot;</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VisitorRealWorld</span>: <span class="title class_">XCTestCase</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">testVisitorRealWorld</span>() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> email <span class="operator">=</span> <span class="type">Email</span>(emailOfSender: <span class="string">&quot;some@email.com&quot;</span>)</span><br><span class="line">        <span class="keyword">let</span> sms <span class="operator">=</span> <span class="type">SMS</span>(phoneNumberOfSender: <span class="string">&quot;+3806700000&quot;</span>)</span><br><span class="line">        <span class="keyword">let</span> push <span class="operator">=</span> <span class="type">Push</span>(usernameOfSender: <span class="string">&quot;Spammer&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> notifications: [<span class="type">Notification</span>] <span class="operator">=</span> [email, sms, push]</span><br><span class="line"></span><br><span class="line">        clientCode(handle: notifications, with: <span class="type">DefaultPolicyVisitor</span>())</span><br><span class="line"></span><br><span class="line">        clientCode(handle: notifications, with: <span class="type">NightPolicyVisitor</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">VisitorRealWorld</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Client code traverses notifications with visitors and checks whether a</span></span><br><span class="line">    <span class="comment">/// notification is in a blacklist and should be shown in accordance with a</span></span><br><span class="line">    <span class="comment">/// current SilencePolicy</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">clientCode</span>(<span class="params">handle</span> <span class="params">notifications</span>: [<span class="type">Notification</span>], <span class="params">with</span> <span class="params">policy</span>: <span class="type">NotificationPolicy</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> blackList <span class="operator">=</span> createBlackList()</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\n</span>Client: Using <span class="subst">\(policy.description)</span> and <span class="subst">\(blackList.description)</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        notifications.forEach &#123; item <span class="keyword">in</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">guard</span> <span class="operator">!</span>item.accept(visitor: blackList) <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\t</span>WARNING: &quot;</span> <span class="operator">+</span> item.description <span class="operator">+</span> <span class="string">&quot; is in a black list&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> item.accept(visitor: policy) &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\t</span>&quot;</span> <span class="operator">+</span> item.description <span class="operator">+</span> <span class="string">&quot; notification will be shown&quot;</span>)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\t</span>&quot;</span> <span class="operator">+</span> item.description <span class="operator">+</span> <span class="string">&quot; notification will be silenced&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">createBlackList</span>() -&gt; <span class="type">BlackListVisitor</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">BlackListVisitor</span>(emails: [<span class="string">&quot;banned@email.com&quot;</span>],</span><br><span class="line">                                phones: [<span class="string">&quot;000000000&quot;</span>, <span class="string">&quot;1234325232&quot;</span>],</span><br><span class="line">                                usernames: [<span class="string">&quot;Spammer&quot;</span>])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Client: Using Default Policy Visitor and Black List Visitor</span><br><span class="line">    Email notification will be shown</span><br><span class="line">    SMS notification will be shown</span><br><span class="line">    WARNING: Push is in a black list</span><br><span class="line"></span><br><span class="line">Client: Using Night Policy Visitor and Black List Visitor</span><br><span class="line">    Email notification will be silenced</span><br><span class="line">    SMS notification will be shown</span><br><span class="line">    WARNING: Push is in a black list</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><div class="tab-item-content"><p><strong>在 TypeScript 中使用模式</strong></p>
<p><strong>复杂度：</strong> ★★★</p>
<p><strong>流行度：</strong> ★☆☆</p>
<p><strong>使用示例：</strong> 访问者不是常用的设计模式， 因为它不仅复杂， 应用范围也比较狭窄。</p>
<p><strong>概念示例</strong></p>
<p>本例说明了<strong>访问者</strong>设计模式的结构并重点回答了下面的问题：</p>
<ul>
<li>它由哪些类组成？</li>
<li>这些类扮演了哪些角色？</li>
<li>模式中的各个元素会以何种方式相互关联？</li>
</ul>
<p><strong>index.ts:</strong> 概念示例</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Component interface declares an `accept` method that should take the base</span></span><br><span class="line"><span class="comment"> * visitor interface as an argument.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Component</span> &#123;</span><br><span class="line">    <span class="title function_">accept</span>(<span class="attr">visitor</span>: <span class="title class_">Visitor</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Each Concrete Component must implement the `accept` method in such a way that</span></span><br><span class="line"><span class="comment"> * it calls the visitor&#x27;s method corresponding to the component&#x27;s class.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteComponentA</span> <span class="keyword">implements</span> <span class="title class_">Component</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Note that we&#x27;re calling `visitConcreteComponentA`, which matches the</span></span><br><span class="line"><span class="comment">     * current class name. This way we let the visitor know the class of the</span></span><br><span class="line"><span class="comment">     * component it works with.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">accept</span>(<span class="attr">visitor</span>: <span class="title class_">Visitor</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        visitor.<span class="title function_">visitConcreteComponentA</span>(<span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Concrete Components may have special methods that don&#x27;t exist in their</span></span><br><span class="line"><span class="comment">     * base class or interface. The Visitor is still able to use these methods</span></span><br><span class="line"><span class="comment">     * since it&#x27;s aware of the component&#x27;s concrete class.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">exclusiveMethodOfConcreteComponentA</span>(): <span class="built_in">string</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteComponentB</span> <span class="keyword">implements</span> <span class="title class_">Component</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Same here: visitConcreteComponentB =&gt; ConcreteComponentB</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">accept</span>(<span class="attr">visitor</span>: <span class="title class_">Visitor</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        visitor.<span class="title function_">visitConcreteComponentB</span>(<span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">specialMethodOfConcreteComponentB</span>(): <span class="built_in">string</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;B&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Visitor Interface declares a set of visiting methods that correspond to</span></span><br><span class="line"><span class="comment"> * component classes. The signature of a visiting method allows the visitor to</span></span><br><span class="line"><span class="comment"> * identify the exact class of the component that it&#x27;s dealing with.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Visitor</span> &#123;</span><br><span class="line">    <span class="title function_">visitConcreteComponentA</span>(<span class="attr">element</span>: <span class="title class_">ConcreteComponentA</span>): <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">visitConcreteComponentB</span>(<span class="attr">element</span>: <span class="title class_">ConcreteComponentB</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Concrete Visitors implement several versions of the same algorithm, which can</span></span><br><span class="line"><span class="comment"> * work with all concrete component classes.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * You can experience the biggest benefit of the Visitor pattern when using it</span></span><br><span class="line"><span class="comment"> * with a complex object structure, such as a Composite tree. In this case, it</span></span><br><span class="line"><span class="comment"> * might be helpful to store some intermediate state of the algorithm while</span></span><br><span class="line"><span class="comment"> * executing visitor&#x27;s methods over various objects of the structure.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteVisitor1</span> <span class="keyword">implements</span> <span class="title class_">Visitor</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">visitConcreteComponentA</span>(<span class="attr">element</span>: <span class="title class_">ConcreteComponentA</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;element.exclusiveMethodOfConcreteComponentA()&#125;</span> + ConcreteVisitor1`</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">visitConcreteComponentB</span>(<span class="attr">element</span>: <span class="title class_">ConcreteComponentB</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;element.specialMethodOfConcreteComponentB()&#125;</span> + ConcreteVisitor1`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteVisitor2</span> <span class="keyword">implements</span> <span class="title class_">Visitor</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">visitConcreteComponentA</span>(<span class="attr">element</span>: <span class="title class_">ConcreteComponentA</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;element.exclusiveMethodOfConcreteComponentA()&#125;</span> + ConcreteVisitor2`</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">visitConcreteComponentB</span>(<span class="attr">element</span>: <span class="title class_">ConcreteComponentB</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;element.specialMethodOfConcreteComponentB()&#125;</span> + ConcreteVisitor2`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The client code can run visitor operations over any set of elements without</span></span><br><span class="line"><span class="comment"> * figuring out their concrete classes. The accept operation directs a call to</span></span><br><span class="line"><span class="comment"> * the appropriate operation in the visitor object.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">clientCode</span>(<span class="params">components: Component[], visitor: Visitor</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> component <span class="keyword">of</span> components) &#123;</span><br><span class="line">        component.<span class="title function_">accept</span>(visitor);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> components = [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ConcreteComponentA</span>(),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ConcreteComponentB</span>(),</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;The client code works with all visitors via the base Visitor interface:&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> visitor1 = <span class="keyword">new</span> <span class="title class_">ConcreteVisitor1</span>();</span><br><span class="line"><span class="title function_">clientCode</span>(components, visitor1);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;It allows the same client code to work with different types of visitors:&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> visitor2 = <span class="keyword">new</span> <span class="title class_">ConcreteVisitor2</span>();</span><br><span class="line"><span class="title function_">clientCode</span>(components, visitor2);</span><br></pre></td></tr></table></figure>

<p><strong>Output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">The client code works with all visitors via the base Visitor interface:</span><br><span class="line">A + ConcreteVisitor1</span><br><span class="line">B + ConcreteVisitor1</span><br><span class="line"></span><br><span class="line">It allows the same client code to work with different types of visitors:</span><br><span class="line">A + ConcreteVisitor2</span><br><span class="line">B + ConcreteVisitor2</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><strong>概念示例</strong></p>
<p>访问者模式允许你在结构体中添加行为， 而又不会对结构体造成实际变更。 假设你是一个代码库的维护者， 代码库中包含不同的形状结构体， 如：</p>
<ul>
<li>方形</li>
<li>圆形</li>
<li>三角形</li>
</ul>
<p>上述每个形状结构体都实现了通用形状接口。</p>
<p>在公司员工开始使用你维护的代码库时， 你就会被各种功能请求给淹没。 让我们来看看其中比较简单的请求： 有个团队请求你在形状结构体中添加 <code>get­Area</code>获取面积行为。</p>
<p>解决这一问题的办法有很多。</p>
<p>第一个选项便是将 <code>get­Area</code>方法直接添加至形状接口， 然后在各个形状结构体中进行实现。 这似乎是比较好的解决方案， 但其代价也比较高。 作为代码库的管理员， 相信你也不想在每次有人要求添加另外一种行为时就去冒着风险改动自己的宝贝代码。 不过， 你也一定想让其他团队的人还是用一用自己的代码库。</p>
<p>第二个选项是请求功能的团队自行实现行为。 然而这并不总是可行， 因为行为可能会依赖于私有代码。</p>
<p>第三个方法就是使用访问者模式来解决上述问题。 首先定义一个如下访问者接口：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> visitor <span class="keyword">interface</span> &#123;</span><br><span class="line">    visitForSquare(square)</span><br><span class="line">    visitForCircle(circle)</span><br><span class="line">    visitForTriangle(triangle)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们可以使用 <code>visit­For­Square­(square)</code> 、  <code>visit­For­Circle­(circle)</code>以及 <code>visit­For­Triangle­(triangle)</code>函数来为方形、 圆形以及三角形添加相应的功能。</p>
<p>你可能在想， 为什么我们不再访问者接口里面使用单一的 <code>visit­(shape)</code>方法呢？ 这是因为 Go 语言不支持方法重载， 所以你无法以相同名称、 不同参数的方式来使用方法。</p>
<p>好了， 第二项重要的工作是将 <code>accept</code>接受方法添加至形状接口中。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">accept</span><span class="params">(v visitor)</span></span></span><br></pre></td></tr></table></figure>

<p>所有形状结构体都需要定义此方法， 类似于：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(obj *square)</span></span> accept(v visitor)&#123;</span><br><span class="line">    v.visitForSquare(obj)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>等等， 我刚才是不是提到过， 我们并不想修改现有的形状结构体？ 很不幸， 在使用访问者模式时， 我们必须要修改形状结构体。 但这样的修改只需要进行一次。</p>
<p>如果添加任何其他行为， 比如 <code>get­Num­Sides</code>获取边数和 <code>get­Middle­Coordinates</code>获取中点坐标 ， 我们将使用相同的 <code>accept­(v visitor)</code>函数， 而无需对形状结构体进行进一步的修改。</p>
<p>最后， 形状结构体只需要修改一次， 并且所有未来针对不同行为的请求都可以使用相同的 accept 函数来进行处理。 如果团队成员请求 <code>get­Area</code>行为， 我们只需简单地定义访问者接口的具体实现， 并在其中编写面积的计算逻辑即可。</p>
<p><strong>shape.go:</strong> 元件</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> shape <span class="keyword">interface</span> &#123;</span><br><span class="line">    getType() <span class="type">string</span></span><br><span class="line">    accept(visitor)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>square.go:</strong> 具体元件</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> square <span class="keyword">struct</span> &#123;</span><br><span class="line">    side <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *square)</span></span> accept(v visitor) &#123;</span><br><span class="line">    v.visitForSquare(s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *square)</span></span> getType() <span class="type">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Square&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>circle.go:</strong> 具体元件</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> circle <span class="keyword">struct</span> &#123;</span><br><span class="line">    radius <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *circle)</span></span> accept(v visitor) &#123;</span><br><span class="line">    v.visitForCircle(c)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *circle)</span></span> getType() <span class="type">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Circle&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>rectangle.go:</strong> 具体元件</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> rectangle <span class="keyword">struct</span> &#123;</span><br><span class="line">    l <span class="type">int</span></span><br><span class="line">    b <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *rectangle)</span></span> accept(v visitor) &#123;</span><br><span class="line">    v.visitForrectangle(t)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *rectangle)</span></span> getType() <span class="type">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;rectangle&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>visitor.go:</strong> 访问者</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> visitor <span class="keyword">interface</span> &#123;</span><br><span class="line">    visitForSquare(*square)</span><br><span class="line">    visitForCircle(*circle)</span><br><span class="line">    visitForrectangle(*rectangle)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>areaCalculator.go:</strong> 具体访问者</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> areaCalculator <span class="keyword">struct</span> &#123;</span><br><span class="line">    area <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *areaCalculator)</span></span> visitForSquare(s *square) &#123;</span><br><span class="line">    <span class="comment">// Calculate area for square.</span></span><br><span class="line">    <span class="comment">// Then assign in to the area instance variable.</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;Calculating area for square&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *areaCalculator)</span></span> visitForCircle(s *circle) &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Calculating area for circle&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *areaCalculator)</span></span> visitForrectangle(s *rectangle) &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Calculating area for rectangle&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>middleCoordinates.go:</strong> 具体访问者</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> middleCoordinates <span class="keyword">struct</span> &#123;</span><br><span class="line">    x <span class="type">int</span></span><br><span class="line">    y <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *middleCoordinates)</span></span> visitForSquare(s *square) &#123;</span><br><span class="line">    <span class="comment">// Calculate middle point coordinates for square.</span></span><br><span class="line">    <span class="comment">// Then assign in to the x and y instance variable.</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;Calculating middle point coordinates for square&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *middleCoordinates)</span></span> visitForCircle(c *circle) &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Calculating middle point coordinates for circle&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *middleCoordinates)</span></span> visitForrectangle(t *rectangle) &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Calculating middle point coordinates for rectangle&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>main.go:</strong> 客户端代码</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    square := &amp;square&#123;side: <span class="number">2</span>&#125;</span><br><span class="line">    circle := &amp;circle&#123;radius: <span class="number">3</span>&#125;</span><br><span class="line">    rectangle := &amp;rectangle&#123;l: <span class="number">2</span>, b: <span class="number">3</span>&#125;</span><br><span class="line"></span><br><span class="line">    areaCalculator := &amp;areaCalculator&#123;&#125;</span><br><span class="line"></span><br><span class="line">    square.accept(areaCalculator)</span><br><span class="line">    circle.accept(areaCalculator)</span><br><span class="line">    rectangle.accept(areaCalculator)</span><br><span class="line"></span><br><span class="line">    fmt.Println()</span><br><span class="line">    middleCoordinates := &amp;middleCoordinates&#123;&#125;</span><br><span class="line">    square.accept(middleCoordinates)</span><br><span class="line">    circle.accept(middleCoordinates)</span><br><span class="line">    rectangle.accept(middleCoordinates)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Calculating area for square</span><br><span class="line">Calculating area for circle</span><br><span class="line">Calculating area for rectangle</span><br><span class="line"></span><br><span class="line">Calculating middle point coordinates for square</span><br><span class="line">Calculating middle point coordinates for circle</span><br><span class="line">Calculating middle point coordinates for rectangle</span><br></pre></td></tr></table></figure>

<p><em>根据： <a target="_blank" rel="noopener" href="https://golangbyexample.com/visitor-design-pattern-go/">Golang By Example</a></em></p></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://wangyyovo.github.io">Blank</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://wangyyovo.github.io/posts/ff280d74/">https://wangyyovo.github.io/posts/ff280d74/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://wangyyovo.github.io" target="_blank">Blank</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/pattern/">pattern</a></div><div class="post-share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/c232294a189f79f9c057415aa13a4c4a.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/ab521f7f/" title="行为模式-解释器模式"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/b5b76302b251d3bf11ec1fe54403df31.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">行为模式-解释器模式</div></div><div class="info-2"><div class="info-item-1"> 行为模式-解释器模式亦称： interpreter 介绍解释器模式：定义一种方法和对应的解释器，使用解释器解释此方法的语句来执行；  解释器模式需要上下文类来定义和存储上下文，解释器类用来将语句来翻译成可执行程序； 解释器扩展和改变文化非常简单，构建完成后可以很方便地数据格式； 解释器模式会将非终结表达式递归解释，直到解释为终结符表达式；  场景 解释器模式适用于数据结构不规则，但数据要素相同的情况； 语法不能太复杂，复杂的最好使用解释形语言来实现以降低复杂性；   golangjava12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061package mainimport &quot;strings&quot;//意图：给定一个语言，定义它的文法表示，并定义一个解释器，这个解释器使用该标识来解释语言中的句子。//主要解决：对于一些固定文法构建一个解释句子的解释器。//何时使用：如果一种特定类型的问题发生的...</div></div></div></a><a class="pagination-related" href="/posts/d2372188/" title="行为模式-模板方法模式"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/297762d5a5c2a44c399685af8747f37f.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">行为模式-模板方法模式</div></div><div class="info-2"><div class="info-item-1">  https://refactoringguru.cn/design-patterns/template-method  行为模式-模板方法模式亦称： Template Method 意图模板方法模式是一种行为设计模式， 它在超类中定义了一个算法的框架， 允许子类在不修改结构的情况下重写算法的特定步骤。  问题假如你正在开发一款分析公司文档的数据挖掘程序。 用户需要向程序输入各种格式 （PDF、 DOC 或 CSV） 的文档， 程序则会试图从这些文件中抽取有意义的数据， 并以统一的格式将其返回给用户。 该程序的首个版本仅支持 DOC 文件。 在接下来的一个版本中， 程序能够支持 CSV 文件。 一个月后， 你 “教会” 了程序从 PDF 文件中抽取数据。  一段时间后， 你发现这三个类中包含许多相似代码。 尽管这些类处理不同数据格式的代码完全不同， 但数据处理和分析的代码却几乎完全一样。 如果能在保持算法结构完整的情况下去除重复代码， 这难道不是一件很棒的事情吗？ 还有另一个与使用这些类的客户端代码相关的问题： 客户端代码中包含许多条件语句， 以根据不同的处理对象类型选择合适的...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/54deb0e2/" title="图解设计模式"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/cb75d9300b44131b6a0afbab792f48cd.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-16</div><div class="info-item-2">图解设计模式</div></div><div class="info-2"><div class="info-item-1"> 图解设计模式 http://tigerb.cn/2021/03/07/patterns-picture/  前言常常听别人说设计模式不太容易理解，以及学习设计模式到底能帮我们解决什么问题，今天我们就用几张图来看看：  设计模式到底是什么？ 为什么我们需要学习设计模式？  我也写过烂代码是的，没什么，我也写过烂代码，刚毕业时业务逻辑也会一个函数干到底，只知道能实现功能就可以了。 12345package demo func YourFunc() &#123;	// 所有的逻辑代码一股脑写完......&#125;   知道了拆分函数自然而然知道了需要合理拆分函数。  然后把各个函数组织起来。  面临新的困境某一天产品的需求需要支持新的场景，发现某一处的代码逻辑有变动需要支持新的场景，怎么办？  整个代码拷贝一份？不会有人这么干吧？(其实我还真见过，你们呢😏) 把绿色变动的代码块，复制成一个新的函数，修改为新场景使用的函数？ 把变动的代码再提为两个新函数，一个绿色为老代码，一个蓝色为新场景代码？   上面这种解决问题的方式就是面向过程的编程思想。 我们都在变优秀随着我们不断的学习...</div></div></div></a><a class="pagination-related" href="/posts/88f78d2f/" title="面向对象的设计过程"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/6d6dbbdcfa655b5d965f52adb35443ae.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-16</div><div class="info-item-2">面向对象的设计过程</div></div><div class="info-2"><div class="info-item-1"> 面向对象的设计过程 http://tigerb.cn/2019/10/11/oop/  前言我一直认为分享的目的不是炫技。  一是，自我学习的总结。 二是，降低他人的学习成本。 三是，别人对自己学习结果的审核。  同时，本次分享有下面四个要素：    观点 本次分享的观点是一个软件工程中的思维方法，不限于编程语言    探讨 我可能理解错的，或者大家没理解的，欢迎大家积极评论，尽可能多互动，目的增加理解   理解 真的希望大家能理解   运用 最重要的，如果你觉着有帮助，一定要去在实际业务中实战   背景工作中，几乎大家经常抱怨别人写的代码：  没法改 耦合高 无法扩展   今天就来探讨如何克服上面的问题～  场景首先问个问题：  平常工作中来了一个业务需求，我们是如何开始写代码的？  我推测大多数人可能：  1、梳理业务 2、设计数据库、接口、缓存 3、评审 4、于是就开始了 怎么怎么样...如果怎么怎么样...怎么怎么样...愉快的码代码的过程   此处有人觉着有啥问题么？  1备注：说出来问题的，本次分享就可以略过了~  一个简单的业务场景123456789101112比...</div></div></div></a><a class="pagination-related" href="/posts/bfac6395/" title="工厂模式 | Go设计模式实战"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/296967057d2691c0c7ed919799d75416.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-16</div><div class="info-item-2">工厂模式 | Go设计模式实战</div></div><div class="info-2"><div class="info-item-1">  http://tigerb.cn/  我的代码没有else系列-简单工厂 结合实际业务谈设计模式 业务场景 12调用一个服务生成静态页面不同的页面拥有不同的模块  不同的页面的数据结构不一样生成不同的页面对象 正常代码 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667package mainimport &quot;fmt&quot;const (	// CartConst 购物车列表页面	CartConst = &quot;cart/list&quot;	// ProductConst 商品列表页面	ProductConst = &quot;product/list&quot;)// Context 请求上下文type Context struct &#123;	URI string&#125;// PageInterface PageInterfacetype PageIn...</div></div></div></a><a class="pagination-related" href="/posts/11cee220/" title="并发组件 | Go设计模式实战"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/9f7060cd83cb8a5c5c9c199ae048d1f0.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-16</div><div class="info-item-2">并发组件 | Go设计模式实战</div></div><div class="info-2"><div class="info-item-1"> 并发组件 | Go设计模式实战 嗯，Go设计模式实战系列，一个设计模式业务真实使用的golang系列。 http://tigerb.cn/  前言本系列主要分享，如何在我们的真实业务场景中使用设计模式。 本系列文章主要采用如下结构：  什么是「XX设计模式」？ 什么真实业务场景可以使用「XX设计模式」？ 怎么用「XX设计模式」？  本文主要介绍「组合模式」结合Go语言天生的并发特性，如何在真实业务场景中使用。 之前文章《代码组件 | Go设计模式实战》已经介绍了「组合模式」的概念，以及在业务中的使用。今天我们结合Go语言天生的并发特性，升级「组合模式」为「并发组合模式」。 我们先来简单回顾下「组合模式」的知识，详细可以查看上篇文章《代码组件 | Go设计模式实战》 什么是「并发组合模式」？组合模式的概念：  一个具有层级关系的对象由一系列拥有父子关系的对象通过树形结构组成。  并发组合模式的概念：  一个具有层级关系的对象由一系列拥有父子关系的对象通过树形结构组成，子对象即可被串行执行，也可被并发执行  并发组合模式的优势：  原本串行的业务(存在阻塞的部分，比如网络IO等)可...</div></div></div></a><a class="pagination-related" href="/posts/20ee7783/" title="状态变换 | Go设计模式实战"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/c6e2f99790804a5b20eb687085df1fb6.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-16</div><div class="info-item-2">状态变换 | Go设计模式实战</div></div><div class="info-2"><div class="info-item-1"> 状态变换 | Go设计模式实战 嗯，Go设计模式实战系列，一个设计模式业务真实使用的golang系列。 http://tigerb.cn/  前言本系列主要分享，如何在我们的真实业务场景中使用设计模式。 本系列文章主要采用如下结构：  什么是「XX设计模式」？ 什么真实业务场景可以使用「XX设计模式」？ 怎么用「XX设计模式」？  本文主要介绍「状态模式」如何在真实业务场景中使用。 「状态模式」比较简单，就是算法的选取取决于于自己的内部状态。相较于「策略模式」算法的选取由用户决策变成内部状态决策，「策略模式」是用户(客户端)选择具体的算法，「状态模式」只是通过内部不同的状态选择具体的算法。 什么是「状态模式」？ 不同的算法按照统一的标准封装，根据不同的内部状态，决策使用何种算法  「状态模式」和「策略模式」的区别 策略模式：依靠客户决策 状态模式：依靠内部状态决策  什么真实业务场景可以用「状态模式」？ 具体算法的选取是由内部状态决定的   首先，内部存在多种状态 其次，不同的状态的业务逻辑各不相同   我们有哪些真实业务场景可以用「状态模式」呢？  比如，发送短信接口、限流等...</div></div></div></a><a class="pagination-related" href="/posts/aee36e49/" title="客户决策 | Go设计模式实战"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/e671379624222b1599a340edb6dbce75.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-16</div><div class="info-item-2">客户决策 | Go设计模式实战</div></div><div class="info-2"><div class="info-item-1"> 客户决策 | Go设计模式实战 嗯，Go设计模式实战系列，一个设计模式业务真实使用的golang系列。 http://tigerb.cn/  前言本系列主要分享，如何在我们的真实业务场景中使用设计模式。 本系列文章主要采用如下结构：  什么是「XX设计模式」？ 什么真实业务场景可以使用「XX设计模式」？ 怎么用「XX设计模式」？  本文主要介绍「策略模式」如何在真实业务场景中使用。 什么是「策略模式」？「策略模式」比较简单，大家平常工作中应该经常使用到，所以本文作为复习，帮助大家温故知新。我们先来看下定义：  不同的算法按照统一的标准封装，客户端根据不同的场景，决策使用何种算法。  上面的概念的关键词：  算法：就是行为 标准：就是interface 客户端：客户端是相对的，谁调用谁就是客户端 场景：判断条件 决策：判断的过程  概念很容易理解，不多说。 「策略模式」的优势：  典型的高内聚：算法和算法之间完全独立、互不干扰 典型的松耦合：客户端依赖的是接口的抽象方法 沉淀：每一个封装好的算法都是这个技术团队的财富，且未来可以被轻易的修改、复用  什么真实业务场景可以用「策略模...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/theme/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Blank</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">356</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">36</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">54</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/wangyyovo" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:xxxxxx@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A1%8C%E4%B8%BA%E6%A8%A1%E5%BC%8F-%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.</span> <span class="toc-text">行为模式-访问者模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%84%8F%E5%9B%BE"><span class="toc-number">1.1.</span> <span class="toc-text">意图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98"><span class="toc-number">1.2.</span> <span class="toc-text">问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">1.3.</span> <span class="toc-text">解决方案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9C%9F%E5%AE%9E%E4%B8%96%E7%95%8C%E7%B1%BB%E6%AF%94"><span class="toc-number">1.4.</span> <span class="toc-text">真实世界类比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F%E7%BB%93%E6%9E%84"><span class="toc-number">1.5.</span> <span class="toc-text">访问者模式结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%AA%E4%BB%A3%E7%A0%81"><span class="toc-number">1.6.</span> <span class="toc-text">伪代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F%E9%80%82%E5%90%88%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.7.</span> <span class="toc-text">访问者模式适合应用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F"><span class="toc-number">1.8.</span> <span class="toc-text">实现方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-number">1.9.</span> <span class="toc-text">访问者模式优缺点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8E%E5%85%B6%E4%BB%96%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">1.10.</span> <span class="toc-text">与其他模式的关系</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.11.</span> <span class="toc-text">代码示例</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/d14168d/" title="虚拟机问题合集"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/hexo/090cfe4e9e60b0ad0de05db822f3ae97.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="虚拟机问题合集"/></a><div class="content"><a class="title" href="/posts/d14168d/" title="虚拟机问题合集">虚拟机问题合集</a><time datetime="2022-07-16T13:30:36.000Z" title="发表于 2022-07-16 21:30:36">2022-07-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/f540045f/" title="用go语言编写移动端sdk和app开发"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/golang/941ed1ec2925719a0c92e76f4f786b6a.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="用go语言编写移动端sdk和app开发"/></a><div class="content"><a class="title" href="/posts/f540045f/" title="用go语言编写移动端sdk和app开发">用go语言编写移动端sdk和app开发</a><time datetime="2022-07-04T12:14:21.000Z" title="发表于 2022-07-04 20:14:21">2022-07-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/5faac006/" title="在线编程IDE"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/hexo/090cfe4e9e60b0ad0de05db822f3ae97.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="在线编程IDE"/></a><div class="content"><a class="title" href="/posts/5faac006/" title="在线编程IDE">在线编程IDE</a><time datetime="2022-06-12T13:30:36.000Z" title="发表于 2022-06-12 21:30:36">2022-06-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/7594185d/" title="即时性能分析工具Pyroscope"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/golang/3bfb3279740bc9a5b5ef436fa887ef07.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="即时性能分析工具Pyroscope"/></a><div class="content"><a class="title" href="/posts/7594185d/" title="即时性能分析工具Pyroscope">即时性能分析工具Pyroscope</a><time datetime="2022-06-12T08:07:36.000Z" title="发表于 2022-06-12 16:07:36">2022-06-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/82a7aa7c/" title="golang性能调试优化方法"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="golang性能调试优化方法"/></a><div class="content"><a class="title" href="/posts/82a7aa7c/" title="golang性能调试优化方法">golang性能调试优化方法</a><time datetime="2022-06-12T03:00:36.000Z" title="发表于 2022-06-12 11:00:36">2022-06-12</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By Blank</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 5.4.2</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.3</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>