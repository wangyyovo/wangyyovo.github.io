<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>gqlgenæ–‡æ¡£ | Blank</title><meta name="author" content="Blank"><meta name="copyright" content="Blank"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="1.ä»‹ç»ä»€ä¹ˆæ˜¯gqlgenï¼Ÿgqlgenæ˜¯ç”¨äºæ„å»ºGraphQLæœåŠ¡å™¨çš„Goåº“ã€‚  gqlgen is based on a Schema first approach-æ‚¨å¯ä»¥ä½¿ç”¨GraphQLæ¨¡å¼å®šä¹‰è¯­è¨€æ¥å®šä¹‰APIã€‚  gqlgenä¼˜å…ˆè€ƒè™‘ç±»å‹å®‰å…¨æ€§-æ‚¨åœ¨æ­¤æ°¸è¿œéƒ½ä¸ä¼šçœ‹åˆ°map [string] interface {}ã€‚  gqlgenå¯ç”¨äº†Codegen-æˆ‘ä»¬ç”Ÿæˆäº†æ— èŠçš„ä»£ç ï¼Œå› æ­¤æ‚¨å¯ä»¥">
<meta property="og:type" content="article">
<meta property="og:title" content="gqlgenæ–‡æ¡£">
<meta property="og:url" content="https://wangyyovo.github.io/posts/1391286a/">
<meta property="og:site_name" content="Blank">
<meta property="og:description" content="1.ä»‹ç»ä»€ä¹ˆæ˜¯gqlgenï¼Ÿgqlgenæ˜¯ç”¨äºæ„å»ºGraphQLæœåŠ¡å™¨çš„Goåº“ã€‚  gqlgen is based on a Schema first approach-æ‚¨å¯ä»¥ä½¿ç”¨GraphQLæ¨¡å¼å®šä¹‰è¯­è¨€æ¥å®šä¹‰APIã€‚  gqlgenä¼˜å…ˆè€ƒè™‘ç±»å‹å®‰å…¨æ€§-æ‚¨åœ¨æ­¤æ°¸è¿œéƒ½ä¸ä¼šçœ‹åˆ°map [string] interface {}ã€‚  gqlgenå¯ç”¨äº†Codegen-æˆ‘ä»¬ç”Ÿæˆäº†æ— èŠçš„ä»£ç ï¼Œå› æ­¤æ‚¨å¯ä»¥">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/microservice/b45a976cf0d74608645a7327efbef5e5.jpg">
<meta property="article:published_time" content="2020-10-22T17:30:11.000Z">
<meta property="article:modified_time" content="2020-10-22T17:30:11.000Z">
<meta property="article:author" content="Blank">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/microservice/b45a976cf0d74608645a7327efbef5e5.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "gqlgenæ–‡æ¡£",
  "url": "https://wangyyovo.github.io/posts/1391286a/",
  "image": "https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/microservice/b45a976cf0d74608645a7327efbef5e5.jpg",
  "datePublished": "2020-10-22T17:30:11.000Z",
  "dateModified": "2020-10-22T17:30:11.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Blank",
      "url": "https://wangyyovo.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/theme/favicon.ico"><link rel="canonical" href="https://wangyyovo.github.io/posts/1391286a/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"æœªæ‰¾åˆ°ç¬¦åˆæ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}","hits_stats":"å…±æ‰¾åˆ° ${hits} ç¯‡æ–‡ç« "}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"ç¹","msgToSimplifiedChinese":"ç®€"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400,"highlightFullpage":true,"highlightMacStyle":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶å¤±è´¥',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: {"limitCount":150,"languages":{"author":"ä½œè€…: Blank","link":"é“¾æ¥: ","source":"æ¥æº: Blank","info":"è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚"}},
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'gqlgenæ–‡æ¡£',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="alternate" href="/atom.xml" title="Blank" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/theme/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">352</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">46</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">58</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> ä¸»é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-comment-dots"></i><span> ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> å¨±ä¹</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> éŸ³ä¹</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> ç”µå½±</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-image"></i><span> ç›¸å†Œ</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-book"></i><span> æ•™ç¨‹</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/posts/21cfbf15/"><span> ğŸš€ å¿«é€Ÿé–‹å§‹</span></a></li><li><a class="site-page child" href="/posts/dc584b87/"><span> ğŸ“‘ ä¸»é¡Œé é¢</span></a></li><li><a class="site-page child" href="/posts/4aa8abbe/"><span> ğŸ›  ä¸»é¡Œé…ç½®</span></a></li><li><a class="site-page child" href="/posts/ceeb73f/"><span> âš”ï¸ æ¨™ç°½å¤–æŒ‚</span></a></li><li><a class="site-page child" href="/posts/98d20436/"><span> â“ ä¸»é¡Œå•ç­”</span></a></li><li><a class="site-page child" href="/posts/4073eda/"><span> âš¡ï¸ é€²éšæ•™ç¨‹</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-language"></i><span> è¯­è¨€</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/"><i class="fa-fw fas fa-c"></i><span> ä¸­æ–‡</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/microservice/b45a976cf0d74608645a7327efbef5e5.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Blank</span></a><a class="nav-page-title" href="/"><span class="site-name">gqlgenæ–‡æ¡£</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  è¿”å›é¦–é¡µ</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> ä¸»é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-comment-dots"></i><span> ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> å¨±ä¹</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> éŸ³ä¹</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> ç”µå½±</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-image"></i><span> ç›¸å†Œ</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-book"></i><span> æ•™ç¨‹</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/posts/21cfbf15/"><span> ğŸš€ å¿«é€Ÿé–‹å§‹</span></a></li><li><a class="site-page child" href="/posts/dc584b87/"><span> ğŸ“‘ ä¸»é¡Œé é¢</span></a></li><li><a class="site-page child" href="/posts/4aa8abbe/"><span> ğŸ›  ä¸»é¡Œé…ç½®</span></a></li><li><a class="site-page child" href="/posts/ceeb73f/"><span> âš”ï¸ æ¨™ç°½å¤–æŒ‚</span></a></li><li><a class="site-page child" href="/posts/98d20436/"><span> â“ ä¸»é¡Œå•ç­”</span></a></li><li><a class="site-page child" href="/posts/4073eda/"><span> âš¡ï¸ é€²éšæ•™ç¨‹</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-language"></i><span> è¯­è¨€</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/"><i class="fa-fw fas fa-c"></i><span> ä¸­æ–‡</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">gqlgenæ–‡æ¡£</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2020-10-22T17:30:11.000Z" title="å‘è¡¨äº 2020-10-23 01:30:11">2020-10-23</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2020-10-22T17:30:11.000Z" title="æ›´æ–°äº 2020-10-23 01:30:11">2020-10-23</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/microservice/">microservice</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">æ€»å­—æ•°:</span><span class="word-count">11.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>52åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">æµè§ˆé‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><script src="\assets\js\APlayer.min.js"> </script><h1 id="1-ä»‹ç»"><a href="#1-ä»‹ç»" class="headerlink" title="1.ä»‹ç»"></a>1.ä»‹ç»</h1><h2 id="ä»€ä¹ˆæ˜¯gqlgenï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯gqlgenï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯gqlgenï¼Ÿ"></a>ä»€ä¹ˆæ˜¯gqlgenï¼Ÿ</h2><p>gqlgenæ˜¯ç”¨äºæ„å»ºGraphQLæœåŠ¡å™¨çš„Goåº“ã€‚</p>
<ul>
<li><p><strong>gqlgen is based on a Schema first approach</strong>-æ‚¨å¯ä»¥ä½¿ç”¨GraphQLæ¨¡å¼å®šä¹‰è¯­è¨€æ¥å®šä¹‰APIã€‚</p>
</li>
<li><p>gqlgenä¼˜å…ˆè€ƒè™‘ç±»å‹å®‰å…¨æ€§-æ‚¨åœ¨æ­¤æ°¸è¿œéƒ½ä¸ä¼šçœ‹åˆ°map [string] interface {}ã€‚</p>
</li>
<li><p>gqlgenå¯ç”¨äº†Codegen-æˆ‘ä»¬ç”Ÿæˆäº†æ— èŠçš„ä»£ç ï¼Œå› æ­¤æ‚¨å¯ä»¥ä¸“æ³¨äºå¿«é€Ÿæ„å»ºåº”ç”¨ç¨‹åºã€‚</p>
</li>
</ul>
<p>ä»ä¸è¶³ä»¥è¯´æœä½¿ç”¨gqlgenï¼Ÿå°†gqlgenä¸å…¶ä»–Go graphqlå®ç°è¿›è¡Œæ¯”è¾ƒ</p>
<h2 id="å…¥é—¨"><a href="#å…¥é—¨" class="headerlink" title="å…¥é—¨"></a>å…¥é—¨</h2><ul>
<li>è¦å®‰è£…gqlgenï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼šåœ¨é¡¹ç›®ç›®å½•ä¸­è¿è¡Œ<code>go get github.com/99designs/gqlgen</code>ã€‚</li>
<li>æ‚¨å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥åˆå§‹åŒ–æ–°é¡¹ç›®ï¼š<code>go run github.com/99designs/gqlgen init</code>ã€‚</li>
</ul>
<p>æ‚¨å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°æ›´å…¨é¢çš„æŒ‡å—æ¥å¸®åŠ©æ‚¨å…¥é—¨ã€‚æˆ‘ä»¬è¿˜æœ‰ä¸¤ä¸ªçœŸå®çš„ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨gqlgenæ— ç¼å®ç°GraphQLåº”ç”¨ç¨‹åºã€‚æ‚¨å¯ä»¥åœ¨æ­¤å¤„æŸ¥çœ‹è¿™äº›<a target="_blank" rel="noopener" href="https://github.com/99designs/gqlgen/tree/master/example">ç¤ºä¾‹</a>æˆ–è®¿é—®<a target="_blank" rel="noopener" href="https://godoc.org/github.com/99designs/gqlgen">godoc</a>ã€‚</p>
<h2 id="æŠ¥å‘Šé—®é¢˜"><a href="#æŠ¥å‘Šé—®é¢˜" class="headerlink" title="æŠ¥å‘Šé—®é¢˜"></a>æŠ¥å‘Šé—®é¢˜</h2><p>å¦‚æœæ‚¨è®¤ä¸ºå·²å‘ç°é”™è¯¯ï¼Œæˆ–æŸäº›è¡Œä¸ºä¸ç¬¦åˆæ‚¨çš„é¢„æœŸï¼Œè¯·åœ¨GitHubä¸Šæå‡º<a target="_blank" rel="noopener" href="https://github.com/99designs/gqlgen/issues">é—®é¢˜</a>ã€‚</p>
<h2 id="è´¡çŒ®"><a href="#è´¡çŒ®" class="headerlink" title="è´¡çŒ®"></a>è´¡çŒ®</h2><p>æˆ‘ä»¬æ¬¢è¿æ‚¨çš„è´¡çŒ®ï¼Œè¯·é˜…è¯»æˆ‘ä»¬çš„è´¡çŒ®å‡†åˆ™ï¼Œä»¥äº†è§£æœ‰å…³ä¸ºgqlgenåšå‡ºè´¡çŒ®çš„æ›´å¤šä¿¡æ¯</p>
<h2 id="ç»å¸¸é—®çš„é—®é¢˜"><a href="#ç»å¸¸é—®çš„é—®é¢˜" class="headerlink" title="ç»å¸¸é—®çš„é—®é¢˜"></a>ç»å¸¸é—®çš„é—®é¢˜</h2><p>å¦‚ä½•é˜²æ­¢è·å–å¯èƒ½ä¸ä½¿ç”¨çš„å­å¯¹è±¡ï¼Ÿ<br>å½“æ‚¨åƒè¿™æ ·åµŒå¥—æˆ–é€’å½’æ¶æ„æ—¶ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">type User &#123;</span><br><span class="line">  id: ID!</span><br><span class="line">  name: String!</span><br><span class="line">  friends: [User!]!</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‚¨éœ€è¦å‘Šè¯‰gqlgenï¼Œå®ƒä»…åº”åœ¨ç”¨æˆ·è¯·æ±‚æ—¶è·å–friendsã€‚æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹;</p>
<ul>
<li>ä½¿ç”¨è‡ªå®šä¹‰æ¨¡å‹</li>
</ul>
<p>ç¼–å†™å¿½ç•¥friends å­—æ®µçš„è‡ªå®šä¹‰æ¨¡å‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">type User struct &#123;</span><br><span class="line">  ID int</span><br><span class="line">  Name string</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¹¶åœ¨gqlgen.ymlä¸­å¼•ç”¨è¯¥æ¨¡å‹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># gqlgen.yml</span></span><br><span class="line"><span class="attr">models:</span></span><br><span class="line">  <span class="attr">User:</span></span><br><span class="line">    <span class="attr">model:</span> <span class="string">github.com/you/pkg/model.User</span> <span class="comment"># go import path to the User struct above</span></span><br></pre></td></tr></table></figure>

<ul>
<li>ä½¿ç”¨æ˜¾å¼è§£æå™¨</li>
</ul>
<p>å¦‚æœè¦ç»§ç»­ä½¿ç”¨ç”Ÿæˆçš„æ¨¡å‹ï¼Œè¯·åœ¨gqlgen.ymlä¸­å°†å­—æ®µæ˜ç¡®æ ‡è®°ä¸ºéœ€è¦è§£æå™¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># gqlgen.yml</span></span><br><span class="line"><span class="attr">models:</span></span><br><span class="line">  <span class="attr">User:</span></span><br><span class="line">    <span class="attr">fields:</span></span><br><span class="line">      <span class="attr">friends:</span></span><br><span class="line">        <span class="attr">resolver:</span> <span class="literal">true</span> <span class="comment"># force a resolver to be generated</span></span><br></pre></td></tr></table></figure>

<p>å®Œæˆä»¥ä¸Šä»»ä¸€æ“ä½œå¹¶è¿è¡Œgenerateä¹‹åï¼Œæˆ‘ä»¬éœ€è¦ä¸ºfriendsæä¾›ä¸€ä¸ªè§£æå™¨ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *userResolver)</span></span> Friends(ctx context.Context, obj *User) ([]*User, <span class="type">error</span>) &#123;</span><br><span class="line">  	<span class="comment">// select * from user where friendid = obj.ID</span></span><br><span class="line">	<span class="keyword">return</span> friends,  <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æˆ‘å¯ä»¥å°†IDçš„ç±»å‹ä»Stringæ›´æ”¹ä¸ºIntç±»å‹å—ï¼Ÿ</strong><br>æ˜¯!æ‚¨å¯ä»¥é€šè¿‡å¦‚ä¸‹æ‰€ç¤ºåœ¨configä¸­é‡æ–°æ˜ å°„å®ƒï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">models:</span></span><br><span class="line">  <span class="attr">ID:</span> <span class="comment"># The GraphQL type ID is backed by</span></span><br><span class="line">    <span class="attr">model:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">github.com/99designs/gqlgen/graphql.IntID</span> <span class="comment"># An go integer</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">github.com/99designs/gqlgen/graphql.ID</span> <span class="comment"># or a go string</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ„å‘³ç€gqlgenå°†èƒ½å¤Ÿè‡ªåŠ¨ç»‘å®šåˆ°æ‚¨è‡ªå·±ç¼–å†™çš„æ¨¡å‹çš„å­—ç¬¦ä¸²æˆ–æ•´æ•°ï¼Œä½†æ˜¯æ­¤åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªæ¨¡å‹ç”¨ä½œé»˜è®¤ç±»å‹ï¼Œå¹¶ä¸”åœ¨ä»¥ä¸‹æƒ…å†µä¸‹å°†å§‹ç»ˆä½¿ç”¨ï¼š</p>
<ul>
<li>åŸºäºschemaç”Ÿæˆæ¨¡å‹</li>
<li>ä½œä¸ºè§£æå™¨ä¸­çš„å‚æ•°</li>
</ul>
<p>å¯¹æ­¤æ²¡æœ‰ä»»ä½•åŠæ³•ï¼Œgqlgenæ— æ³•åœ¨ç»™å®šçš„ä¸Šä¸‹æ–‡ä¸­çŸ¥é“æ‚¨æƒ³è¦ä»€ä¹ˆã€‚</p>
<h1 id="2-å…¥é—¨"><a href="#2-å…¥é—¨" class="headerlink" title="2.å…¥é—¨"></a>2.å…¥é—¨</h1><p>åœ¨Golangä¸­å»ºç«‹GraphQLæœåŠ¡å™¨</p>
<p>æœ¬æ•™ç¨‹å°†æŒ‡å¯¼æ‚¨å®Œæˆä½¿ç”¨gqlgenæ„å»ºGraphQLæœåŠ¡å™¨çš„è¿‡ç¨‹ï¼Œè¯¥æœåŠ¡å™¨å¯ä»¥ï¼š</p>
<ul>
<li>è¿”å›å¾…åŠäº‹é¡¹æ¸…å•</li>
<li>åˆ›å»ºæ–°çš„å¾…åŠäº‹é¡¹</li>
<li>æ ‡è®°å¾…åŠäº‹é¡¹å¾…åŠäº‹é¡¹</li>
</ul>
<p>æ‚¨å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°æœ¬æ•™ç¨‹çš„å®Œæˆä»£ç </p>
<h2 id="åˆ›å»ºé¡¹ç›®"><a href="#åˆ›å»ºé¡¹ç›®" class="headerlink" title="åˆ›å»ºé¡¹ç›®"></a>åˆ›å»ºé¡¹ç›®</h2><p>ä¸ºæ‚¨çš„é¡¹ç›®åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºGoæ¨¡å—ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">mkdir</span> gqlgen-todos</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> gqlgen-todos</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">go mod init github.com/[username]/gqlgen-todos</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">go get github.com/99designs/gqlgen</span></span><br></pre></td></tr></table></figure>

<h2 id="æ„å»ºæœåŠ¡å™¨"><a href="#æ„å»ºæœåŠ¡å™¨" class="headerlink" title="æ„å»ºæœåŠ¡å™¨"></a>æ„å»ºæœåŠ¡å™¨</h2><p>åˆ›å»ºé¡¹ç›®æ¡†æ¶</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">go run github.com/99designs/gqlgen init</span></span><br></pre></td></tr></table></figure>

<p>è¿™å°†åˆ›å»ºæˆ‘ä»¬å»ºè®®çš„é¡¹ç›®å¸ƒå±€ã€‚ å¦‚æœéœ€è¦ï¼Œå¯ä»¥åœ¨gqlgen.ymlä¸­ä¿®æ”¹è¿™äº›è·¯å¾„ã€‚</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ go.mod</span><br><span class="line">â”œâ”€â”€ go.sum</span><br><span class="line">â”œâ”€â”€ gqlgen.yml               - The gqlgen config file, knobs for controlling the generated code.</span><br><span class="line">â”œâ”€â”€ graph</span><br><span class="line">â”‚   â”œâ”€â”€ generated            - A package that only contains the generated runtime</span><br><span class="line">â”‚   â”‚   â””â”€â”€ generated.go</span><br><span class="line">â”‚   â”œâ”€â”€ model                - A package for all your graph models, generated or otherwise</span><br><span class="line">â”‚   â”‚   â””â”€â”€ models_gen.go</span><br><span class="line">â”‚   â”œâ”€â”€ resolver.go          - The root graph resolver type. This file wont get regenerated</span><br><span class="line">â”‚   â”œâ”€â”€ schema.graphqls      - Some schema. You can split the schema into as many graphql files as you like</span><br><span class="line">â”‚   â””â”€â”€ schema.resolvers.go  - the resolver implementation for schema.graphql</span><br><span class="line">â””â”€â”€ server.go                - The entry point to your app. Customize it however you see fit</span><br></pre></td></tr></table></figure>

<p>å®šä¹‰æ‚¨çš„schema<br>gqlgenæ˜¯ä¸€ä¸ªæ¶æ„ä¼˜å…ˆçš„åº“-åœ¨ç¼–å†™ä»£ç ä¹‹å‰ï¼Œæ‚¨ä½¿ç”¨GraphQLæ¶æ„å®šä¹‰è¯­è¨€æè¿°æ‚¨çš„APIã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒè¿›å…¥ä¸€ä¸ªåä¸ºschema.graphqlçš„æ–‡ä»¶ä¸­ï¼Œä½†æ˜¯æ‚¨å¯ä»¥æ ¹æ®éœ€è¦å°†å…¶åˆ†è§£ä¸º<strong>å¤šä¸ªä¸åŒ</strong>çš„æ–‡ä»¶ã€‚</p>
<p>ä¸ºæˆ‘ä»¬ç”Ÿæˆçš„schemaæ˜¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">type Todo &#123;</span><br><span class="line">  id: ID!</span><br><span class="line">  text: String!</span><br><span class="line">  done: Boolean!</span><br><span class="line">  user: User!</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type User &#123;</span><br><span class="line">  id: ID!</span><br><span class="line">  name: String!</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type Query &#123;</span><br><span class="line">  todos: [Todo!]!</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">input NewTodo &#123;</span><br><span class="line">  text: String!</span><br><span class="line">  userId: String!</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type Mutation &#123;</span><br><span class="line">  createTodo(input: NewTodo!): Todo!</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å®ç°è§£æå™¨</strong><br><code>gqlgen generate</code>å°†æ¨¡å¼æ–‡ä»¶ï¼ˆ<code>graph/schema.graphqls</code>ï¼‰ä¸æ¨¡å‹<code>graph/model/*</code>è¿›è¡Œæ¯”è¾ƒï¼Œå¹¶ä¸”å®ƒå°†åœ¨ä»»ä½•å¯èƒ½çš„åœ°æ–¹ç›´æ¥ç»‘å®šåˆ°æ¨¡å‹ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æŸ¥çœ‹<code>graph/schema.resolvers.go</code>ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°gqlgenæ— æ³•åŒ¹é…å®ƒä»¬çš„æ‰€æœ‰æƒ…å†µã€‚ å¯¹æˆ‘ä»¬æ¥è¯´æ˜¯ä¸¤æ¬¡ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">func (r *mutationResolver) CreateTodo(ctx context.Context, input model.NewTodo) (*model.Todo, error) &#123;</span><br><span class="line">	panic(fmt.Errorf(&quot;not implemented&quot;))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (r *queryResolver) Todos(ctx context.Context) ([]*model.Todo, error) &#123;</span><br><span class="line">	panic(fmt.Errorf(&quot;not implemented&quot;))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬åªéœ€è¦å®ç°ä»¥ä¸‹ä¸¤ç§æ–¹æ³•å³å¯ä½¿æœåŠ¡å™¨å·¥ä½œï¼š</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªè·Ÿè¸ªçŠ¶æ€çš„åœ°æ–¹ï¼Œå°†å…¶æ”¾å…¥<code>graph/resolver.go</code>ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Resolver <span class="keyword">struct</span>&#123;</span><br><span class="line">	todos []*model.Todo</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯æˆ‘ä»¬åœ¨å…¶ä¸­å£°æ˜åº”ç”¨ç¨‹åºï¼ˆå¦‚æ•°æ®åº“ï¼‰çš„ä»»ä½•ä¾èµ–å…³ç³»çš„åœ°æ–¹ï¼Œå½“æˆ‘ä»¬åˆ›å»ºgraphæ—¶ï¼Œå®ƒå°†åœ¨server.goä¸­åˆå§‹åŒ–ä¸€æ¬¡ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *mutationResolver)</span></span> CreateTodo(ctx context.Context, input model.NewTodo) (*model.Todo, <span class="type">error</span>) &#123;</span><br><span class="line">	todo := &amp;model.Todo&#123;</span><br><span class="line">		Text:   input.Text,</span><br><span class="line">		ID:     fmt.Sprintf(<span class="string">&quot;T%d&quot;</span>, rand.Int()),</span><br><span class="line">		User: &amp;model.User&#123;ID: input.UserID, Name: <span class="string">&quot;user &quot;</span> + input.UserID&#125;,</span><br><span class="line">	&#125;</span><br><span class="line">	r.todos = <span class="built_in">append</span>(r.todos, todo)</span><br><span class="line">	<span class="keyword">return</span> todo, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *queryResolver)</span></span> Todos(ctx context.Context) ([]*model.Todo, <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="keyword">return</span> r.todos, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªæ­£å¸¸å·¥ä½œçš„æœåŠ¡å™¨æ¥å¯åŠ¨å®ƒï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go run server.go</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨æµè§ˆå™¨ä¸­æ‰“å¼€<a href="http://localhost:8080ã€‚è¿™æ˜¯ä¸€äº›æŸ¥è¯¢å°è¯•ï¼š">http://localhost:8080ã€‚è¿™æ˜¯ä¸€äº›æŸ¥è¯¢å°è¯•ï¼š</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mutation createTodo &#123;</span><br><span class="line">  createTodo(input:&#123;text:&quot;todo&quot;, userId:&quot;1&quot;&#125;) &#123;</span><br><span class="line">    user &#123;</span><br><span class="line">      id</span><br><span class="line">    &#125;</span><br><span class="line">    text</span><br><span class="line">    done</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">query findTodos &#123;</span><br><span class="line">    todos &#123;</span><br><span class="line">      text</span><br><span class="line">      done</span><br><span class="line">      user &#123;</span><br><span class="line">        name</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ä¸è¦æ€¥äºå¸å¼•ç”¨æˆ·</strong><br>è¿™ä¸ªä¾‹å­å¾ˆæ£’ï¼Œä½†æ˜¯åœ¨ç°å®ä¸–ç•Œä¸­ï¼Œè·å–å¤§å¤šæ•°å¯¹è±¡å¾ˆå¤šä½™ã€‚ é™¤éç”¨æˆ·å®é™…è¦æ±‚ï¼Œå¦åˆ™æˆ‘ä»¬ä¸å¸Œæœ›å°†ç”¨æˆ·åŠ è½½åˆ°å¾…åŠäº‹é¡¹ä¸Šã€‚ å› æ­¤ï¼Œè®©æˆ‘ä»¬å°†ç”Ÿæˆçš„Todoæ¨¡å‹æ›¿æ¢ä¸ºæ›´å®é™…çš„ä¸œè¥¿ã€‚</p>
<p>åˆ›å»ºä¸€ä¸ªåä¸º<code>graph/model/todo.go</code>çš„æ–°æ–‡ä»¶</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> model</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Todo <span class="keyword">struct</span> &#123;</span><br><span class="line">	ID     <span class="type">string</span> <span class="string">`json:&quot;id&quot;`</span></span><br><span class="line">	Text   <span class="type">string</span> <span class="string">`json:&quot;text&quot;`</span></span><br><span class="line">	Done   <span class="type">bool</span>   <span class="string">`json:&quot;done&quot;`</span></span><br><span class="line">	UserID <span class="type">string</span> <span class="string">`json:&quot;user&quot;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ³¨æ„</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œgqlgenå°†ä½¿ç”¨æ¨¡å‹ç›®å½•ä¸­åç§°åŒ¹é…çš„ä»»ä½•æ¨¡å‹ï¼Œå¯ä»¥åœ¨gqlgen.ymlä¸­è¿›è¡Œé…ç½®ã€‚</p>
</blockquote>
<p>ç„¶åè¿è¡Œ<code>github.com/99designs/gqlgen generate</code>ã€‚</p>
<p>ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬åœ¨<code>graph/schema.resolvers.go</code>ä¸­æŸ¥çœ‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªæ–°çš„è§£æå™¨ï¼Œå®ç°å®ƒå¹¶ä¿®å¤CreateTodoã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *mutationResolver)</span></span> CreateTodo(ctx context.Context, input model.NewTodo) (*model.Todo, <span class="type">error</span>) &#123;</span><br><span class="line">	todo := &amp;model.Todo&#123;</span><br><span class="line">		Text:   input.Text,</span><br><span class="line">		ID:     fmt.Sprintf(<span class="string">&quot;T%d&quot;</span>, rand.Int()),</span><br><span class="line">		UserID: input.UserID, <span class="comment">// fix this line</span></span><br><span class="line">	&#125;</span><br><span class="line">	r.todos = <span class="built_in">append</span>(r.todos, todo)</span><br><span class="line">	<span class="keyword">return</span> todo, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *todoResolver)</span></span> User(ctx context.Context, obj *model.Todo) (*model.User, <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;model.User&#123;ID: obj.UserID, Name: <span class="string">&quot;user &quot;</span> + obj.UserID&#125;, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ç”»é¾™ç‚¹ç›"><a href="#ç”»é¾™ç‚¹ç›" class="headerlink" title="ç”»é¾™ç‚¹ç›"></a>ç”»é¾™ç‚¹ç›</h2><p>åœ¨æˆ‘ä»¬çš„<code>resolver.go</code>çš„é¡¶éƒ¨ï¼Œåœ¨<code>package</code>å’Œ<code>import</code>ä¹‹é—´ï¼Œæ·»åŠ ä»¥ä¸‹è¡Œï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//go:generate go run github.com/99designs/gqlgen</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªç¥å¥‡çš„æ³¨é‡Šå‘Šè¯‰<code>go generate</code>å½“æˆ‘ä»¬æƒ³é‡æ–°ç”Ÿæˆä»£ç æ—¶è¦è¿è¡Œä»€ä¹ˆå‘½ä»¤ã€‚ è¦åœ¨æ•´ä¸ªé¡¹ç›®ä¸­é€’å½’è¿è¡Œgo generateï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go generate ./...</span><br></pre></td></tr></table></figure>

<h1 id="3-é…ç½®"><a href="#3-é…ç½®" class="headerlink" title="3.é…ç½®"></a>3.é…ç½®</h1><p>å¦‚ä½•ä½¿ç”¨gqlgen.ymlé…ç½®gqlgen</p>
<p>å¯ä»¥ä½¿ç”¨gqlgen.ymlæ–‡ä»¶é…ç½®gqlgenï¼Œé»˜è®¤æƒ…å†µä¸‹å°†ä»å½“å‰ç›®å½•æˆ–ä»»ä½•çˆ¶ç›®å½•ä¸­åŠ è½½å®ƒã€‚</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Where are all the schema files located? globs are supported eg  src/**/*.graphqls</span></span><br><span class="line"><span class="attr">schema:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">graph/*.graphqls</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Where should the generated server code go?</span></span><br><span class="line"><span class="attr">exec:</span></span><br><span class="line">  <span class="attr">filename:</span> <span class="string">graph/generated/generated.go</span></span><br><span class="line">  <span class="attr">package:</span> <span class="string">generated</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable Apollo federation support</span></span><br><span class="line"><span class="attr">federation:</span></span><br><span class="line">  <span class="attr">filename:</span> <span class="string">graph/generated/federation.go</span></span><br><span class="line">  <span class="attr">package:</span> <span class="string">generated</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Where should any generated models go?</span></span><br><span class="line"><span class="attr">model:</span></span><br><span class="line">  <span class="attr">filename:</span> <span class="string">graph/model/models_gen.go</span></span><br><span class="line">  <span class="attr">package:</span> <span class="string">model</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Where should the resolver implementations go?</span></span><br><span class="line"><span class="attr">resolver:</span></span><br><span class="line">  <span class="attr">layout:</span> <span class="string">follow-schema</span></span><br><span class="line">  <span class="attr">dir:</span> <span class="string">graph</span></span><br><span class="line">  <span class="attr">package:</span> <span class="string">graph</span></span><br><span class="line">  <span class="attr">filename_template:</span> <span class="string">&quot;&#123;name&#125;.resolvers.go&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Optional: turn on use ` + &quot;`&quot; + `gqlgen:&quot;fieldName&quot;` + &quot;`&quot; + ` tags in your models</span></span><br><span class="line"><span class="comment"># struct_tag: json</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Optional: turn on to use []Thing instead of []*Thing</span></span><br><span class="line"><span class="comment"># omit_slice_element_pointers: false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Optional: set to speed up generation time by not performing a final validation pass.</span></span><br><span class="line"><span class="comment"># skip_validation: true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># gqlgen will search for any type names in the schema in these go packages</span></span><br><span class="line"><span class="comment"># if they match it will use them, otherwise it will generate them.</span></span><br><span class="line"><span class="attr">autobind:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;github.com/your/app/graph/model&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># This section declares type mapping between the GraphQL and go type systems</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The first line in each type will be used as defaults for resolver arguments and</span></span><br><span class="line"><span class="comment"># modelgen, the others will be allowed when binding to fields. Configure them to</span></span><br><span class="line"><span class="comment"># your liking</span></span><br><span class="line"><span class="attr">models:</span></span><br><span class="line">  <span class="attr">ID:</span></span><br><span class="line">    <span class="attr">model:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">github.com/99designs/gqlgen/graphql.ID</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">github.com/99designs/gqlgen/graphql.Int</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">github.com/99designs/gqlgen/graphql.Int64</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">github.com/99designs/gqlgen/graphql.Int32</span></span><br><span class="line">  <span class="attr">Int:</span></span><br><span class="line">    <span class="attr">model:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">github.com/99designs/gqlgen/graphql.Int</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">github.com/99designs/gqlgen/graphql.Int64</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">github.com/99designs/gqlgen/graphql.Int3</span></span><br></pre></td></tr></table></figure>

<p>ä¸€åˆ‡éƒ½æœ‰é»˜è®¤å€¼ï¼Œå› æ­¤å¯ä»¥æ ¹æ®éœ€è¦æ·»åŠ ã€‚</p>
<h2 id="å¸¦æŒ‡ä»¤çš„å†…è”é…ç½®"><a href="#å¸¦æŒ‡ä»¤çš„å†…è”é…ç½®" class="headerlink" title="å¸¦æŒ‡ä»¤çš„å†…è”é…ç½®"></a>å¸¦æŒ‡ä»¤çš„å†…è”é…ç½®</h2><p>gqlgené™„å¸¦äº†ä¸€äº›å†…ç½®æŒ‡ä»¤ï¼Œè¿™ä½¿å¾—ç®¡ç†æ¥çº¿æ›´åŠ å®¹æ˜“ã€‚</p>
<p>è¦å¼€å§‹ä½¿ç”¨å®ƒä»¬ï¼Œæ‚¨é¦–å…ˆéœ€è¦å®šä¹‰å®ƒä»¬ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">directive @goModel(model: String, models: [String!]) on OBJECT</span><br><span class="line">    | INPUT_OBJECT</span><br><span class="line">    | SCALAR</span><br><span class="line">    | ENUM</span><br><span class="line">    | INTERFACE</span><br><span class="line">    | UNION</span><br><span class="line"></span><br><span class="line">directive @goField(forceResolver: Boolean, name: String) on INPUT_FIELD_DEFINITION</span><br><span class="line">    | FIELD_DEFINITION</span><br></pre></td></tr></table></figure>

<blockquote>
<p>gqlgenå½“å‰ä¸æ”¯æŒSCALARï¼ŒENUMï¼ŒINTERFACEæˆ–UNIONçš„ç”¨æˆ·å¯é…ç½®æŒ‡ä»¤ã€‚ è¿™ä»…é€‚ç”¨äºå†…éƒ¨æŒ‡ä»¤ã€‚ æ‚¨å¯ä»¥åœ¨æ­¤å¤„è·Ÿè¸ªè¿›åº¦</p>
</blockquote>
<p>ç°åœ¨ï¼Œæ‚¨å¯ä»¥åœ¨schemaä¸­å®šä¹‰ç±»å‹æ—¶ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">type User @goModel(model: &quot;github.com/my/app/models.User&quot;) &#123;</span><br><span class="line">    id: ID!         @goField(name: &quot;todoId&quot;)</span><br><span class="line">    name: String!   @goField(forceResolver: true)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="4-å‚è€ƒ"><a href="#4-å‚è€ƒ" class="headerlink" title="4.å‚è€ƒ"></a>4.å‚è€ƒ</h1><h2 id="4-1-APQ"><a href="#4-1-APQ" class="headerlink" title="4.1 APQ"></a>4.1 APQ</h2><p>è‡ªåŠ¨æŒä¹…æŸ¥è¯¢</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“æ‚¨ä½¿ç”¨GraphQLæ—¶ï¼ŒæŸ¥è¯¢å°†éšæ¯ä¸ªè¯·æ±‚ä¸€èµ·ä¼ è¾“ã€‚ è¿™ä¼šæµªè´¹å¤§é‡å¸¦å®½ã€‚ ä¸ºé¿å…è¿™ç§æƒ…å†µï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è‡ªåŠ¨æŒä¹…æŸ¥è¯¢ï¼ˆAPQï¼‰ã€‚</p>
<p>ä½¿ç”¨APQï¼Œæ‚¨ä»…å°†æŸ¥è¯¢å“ˆå¸Œå‘é€åˆ°æœåŠ¡å™¨ã€‚ å¦‚æœåœ¨æœåŠ¡å™¨ä¸Šæœªæ‰¾åˆ°å“ˆå¸Œï¼Œåˆ™å®¢æˆ·ç«¯ä¼šå†æ¬¡è¯·æ±‚åœ¨æœåŠ¡å™¨ä¸Šå‘åŸå§‹æŸ¥è¯¢æ³¨å†ŒæŸ¥è¯¢å“ˆå¸Œã€‚</p>
<h3 id="ç”¨æ³•"><a href="#ç”¨æ³•" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h3><p>ä¸ºäº†å¯ç”¨è‡ªåŠ¨æŒä¹…æŸ¥è¯¢ï¼Œæ‚¨éœ€è¦æ›´æ”¹å®¢æˆ·ç«¯ã€‚ æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a target="_blank" rel="noopener" href="https://github.com/apollographql/apollo-link-persisted-queries">è‡ªåŠ¨æŒä¹…æŸ¥è¯¢é“¾æ¥</a>æ–‡æ¡£ã€‚</p>
<p>å¯¹äºæœåŠ¡å™¨ï¼Œæ‚¨éœ€è¦å®ç°<code>PersistedQueryCache</code>æ¥å£å¹¶å°†å®ä¾‹ä¼ é€’ç»™<code>handler.EnablePersistedQueryCache</code>é€‰é¡¹ã€‚</p>
<p>è¯·å‚é˜…ä»¥ä¸‹ä½¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/go-redis/redis">go-redis</a>è½¯ä»¶åŒ…çš„ç¤ºä¾‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/99designs/gqlgen/graphql/handler&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/99designs/gqlgen/graphql/handler/extension&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/99designs/gqlgen/graphql/handler/transport&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/go-redis/redis&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Cache <span class="keyword">struct</span> &#123;</span><br><span class="line">	client redis.UniversalClient</span><br><span class="line">	ttl    time.Duration</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> apqPrefix = <span class="string">&quot;apq:&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewCache</span><span class="params">(redisAddress <span class="type">string</span>, password <span class="type">string</span>, ttl time.Duration)</span></span> (*Cache, <span class="type">error</span>) &#123;</span><br><span class="line">	client := redis.NewClient(&amp;redis.Options&#123;</span><br><span class="line">		Addr:     redisAddress,</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	err := client.Ping().Err()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;could not create cache: %w&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> &amp;Cache&#123;client: client, ttl: ttl&#125;, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Cache)</span></span> Add(ctx context.Context, key <span class="type">string</span>, value <span class="keyword">interface</span>&#123;&#125;) &#123;</span><br><span class="line">	c.client.Set(apqPrefix+key, value, c.ttl)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Cache)</span></span> Get(ctx context.Context, key <span class="type">string</span>) (<span class="keyword">interface</span>&#123;&#125;, <span class="type">bool</span>) &#123;</span><br><span class="line">	s, err := c.client.Get(apqPrefix + key).Result()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">struct</span>&#123;&#125;&#123;&#125;, <span class="literal">false</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> s, <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	cache, err := NewCache(cfg.RedisAddress, <span class="number">24</span>*time.Hour)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalf(<span class="string">&quot;cannot create APQ redis cache: %v&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	c := Config&#123; Resolvers: &amp;resolvers&#123;&#125; &#125;</span><br><span class="line">	gqlHandler := handler.New(</span><br><span class="line">		generated.NewExecutableSchema(c),</span><br><span class="line">	)</span><br><span class="line">	gqlHandler.AddTransport(transport.POST&#123;&#125;)</span><br><span class="line">	gqlHandler.Use(extension.AutomaticPersistedQuery&#123;Cache: cache&#125;)</span><br><span class="line">	http.Handle(<span class="string">&quot;/query&quot;</span>, gqlHandler)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="4-2-å˜æ›´é›†"><a href="#4-2-å˜æ›´é›†" class="headerlink" title="4.2 å˜æ›´é›†"></a>4.2 å˜æ›´é›†</h2><p>ä½¿ç”¨åœ°å›¾ä½œä¸ºå˜æ›´é›†</p>
<p>æœ‰æ—¶ï¼Œæ‚¨éœ€è¦å°†çŠ¶æ€ä¸nilï¼ˆæœªå®šä¹‰å’Œç©ºï¼‰åŒºåˆ†å¼€ã€‚ åœ¨gqlgenä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨åœ°å›¾è¿›è¡Œæ­¤æ“ä½œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">type Query &#123;</span><br><span class="line">	updateUser(id: ID!, changes: UserChanges!): User</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type UserChanges &#123;</span><br><span class="line">	name: String</span><br><span class="line">	email: String</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨é…ç½®ä¸­å°†ç±»å‹è®¾ç½®ä¸º<code>map [string] interface &#123;&#125;</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">models:</span></span><br><span class="line">  <span class="attr">UserChanges:</span></span><br><span class="line">    <span class="attr">model:</span> <span class="string">&quot;map[string]interface&#123;&#125;&quot;</span></span><br></pre></td></tr></table></figure>

<p>è¿è¡Œ<code>go generate</code>ä¹‹åï¼Œæ‚¨åº”è¯¥å¾—åˆ°ä¸€ä¸ªçœ‹èµ·æ¥åƒè¿™æ ·çš„è§£æå™¨ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *queryResolver)</span></span> UpdateUser(ctx context.Context, id <span class="type">int</span>, changes <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;) (*User, <span class="type">error</span>) &#123;</span><br><span class="line">	u := fetchFromDb(id)</span><br><span class="line">	<span class="comment">/// apply the changes</span></span><br><span class="line">	saveToDb(u)</span><br><span class="line">	<span class="keyword">return</span> u, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ç»å¸¸ä½¿ç”¨<code>mapstructure</code>åº“é€šè¿‡åå°„å°†è¿™äº›å˜æ›´é›†ç›´æ¥ç›´æ¥åº”ç”¨äºå¯¹è±¡ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ApplyChanges</span><span class="params">(changes <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;, to <span class="keyword">interface</span>&#123;&#125;)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">	dec, err := mapstructure.NewDecoder(&amp;mapstructure.DecoderConfig&#123;</span><br><span class="line">		ErrorUnused: <span class="literal">true</span>,</span><br><span class="line">		TagName:     <span class="string">&quot;json&quot;</span>,</span><br><span class="line">		Result:      to,</span><br><span class="line">		ZeroFields:  <span class="literal">true</span>,</span><br><span class="line">		<span class="comment">// This is needed to get mapstructure to call the gqlgen unmarshaler func for custom scalars (eg Date)</span></span><br><span class="line">		DecodeHook: <span class="function"><span class="keyword">func</span><span class="params">(a reflect.Type, b reflect.Type, v <span class="keyword">interface</span>&#123;&#125;)</span></span> (<span class="keyword">interface</span>&#123;&#125;, <span class="type">error</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> reflect.PtrTo(b).Implements(reflect.TypeOf((*graphql.Unmarshaler)(<span class="literal">nil</span>)).Elem()) &#123;</span><br><span class="line">				resultType := reflect.New(b)</span><br><span class="line">				result := resultType.MethodByName(<span class="string">&quot;UnmarshalGQL&quot;</span>).Call([]reflect.Value&#123;reflect.ValueOf(v)&#125;)</span><br><span class="line">				err, _ := result[<span class="number">0</span>].Interface().(<span class="type">error</span>)</span><br><span class="line">				<span class="keyword">return</span> resultType.Elem().Interface(), err</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span> v, <span class="literal">nil</span></span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> dec.Decode(changes)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-3-æ•°æ®åŠ è½½å™¨"><a href="#4-3-æ•°æ®åŠ è½½å™¨" class="headerlink" title="4.3 æ•°æ®åŠ è½½å™¨"></a>4.3 æ•°æ®åŠ è½½å™¨</h2><p>ä½¿ç”¨æ•°æ®åŠ è½½å™¨ä¼˜åŒ–N + 1æ•°æ®åº“æŸ¥è¯¢</p>
<p>æ‚¨æ˜¯å¦æ³¨æ„åˆ°æŸäº›GraphQLæŸ¥è¯¢ç«¯å¯ä»¥è¿›è¡Œæ•°ç™¾ä¸ªæ•°æ®åº“æŸ¥è¯¢ï¼Œè¿™äº›æŸ¥è¯¢é€šå¸¸åŒ…å«é‡å¤çš„æ•°æ®ï¼Ÿ è®©æˆ‘ä»¬æ¥çœ‹çœ‹ä¸ºä»€ä¹ˆä»¥åŠå¦‚ä½•ä¿®å¤å®ƒã€‚</p>
<h3 id="æŸ¥è¯¢è§£æ"><a href="#æŸ¥è¯¢è§£æ" class="headerlink" title="æŸ¥è¯¢è§£æ"></a>æŸ¥è¯¢è§£æ</h3><p>æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæ‚¨æœ‰ä¸€ä¸ªç®€å•çš„æŸ¥è¯¢ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">query &#123; todos &#123; users &#123; name &#125; &#125; &#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬çš„<code>todo.user</code>è§£æå™¨å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *todoResolver)</span></span> UserRaw(ctx context.Context, obj *model.Todo) (*model.User, <span class="type">error</span>) &#123;</span><br><span class="line">	res := db.LogAndQuery(r.Conn, <span class="string">&quot;SELECT id, name FROM dataloader_example.user WHERE id = ?&quot;</span>, obj.UserID)</span><br><span class="line">	<span class="keyword">defer</span> res.Close()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> !res.Next() &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, <span class="literal">nil</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">var</span> user model.User</span><br><span class="line">	<span class="keyword">if</span> err := res.Scan(&amp;user.ID, &amp;user.Name); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> &amp;user, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„</strong>ï¼šæˆ‘å°†åœ¨æ­¤å¤„ä½¿ç”¨goçš„ä½çº§sql.DBã€‚ æ‰€æœ‰è¿™ä¸€åˆ‡éƒ½å°†ä¸æ‚¨å–œæ¬¢çš„ORMä¸€èµ·ä½¿ç”¨ã€‚</p>
<p>æŸ¥è¯¢æ‰§è¡Œç¨‹åºå°†è°ƒç”¨<code>Query.Todos</code>è§£æå™¨ï¼Œè¯¥è§£æå™¨<code>select * from todo</code>ï¼Œå¹¶è¿”å›Nä¸ªtodosã€‚ ç„¶åï¼Œå¯¹äºæ¯ä¸ªå¾…åŠäº‹é¡¹ï¼ŒåŒæ—¶è°ƒç”¨Todo_userè§£æç¨‹åºï¼Œ<code>SELECT * from USER where id = todo.user_id</code>ã€‚</p>
<p>eg:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id, todo, user_id <span class="keyword">FROM</span> todo</span><br><span class="line"><span class="keyword">SELECT</span> id, name <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> ?</span><br><span class="line"><span class="keyword">SELECT</span> id, name <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> ?</span><br><span class="line"><span class="keyword">SELECT</span> id, name <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> ?</span><br><span class="line"><span class="keyword">SELECT</span> id, name <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> ?</span><br><span class="line"><span class="keyword">SELECT</span> id, name <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> ?</span><br><span class="line"><span class="keyword">SELECT</span> id, name <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> ?</span><br><span class="line"><span class="keyword">SELECT</span> id, name <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> ?</span><br><span class="line"><span class="keyword">SELECT</span> id, name <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> ?</span><br><span class="line"><span class="keyword">SELECT</span> id, name <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> ?</span><br><span class="line"><span class="keyword">SELECT</span> id, name <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> ?</span><br><span class="line"><span class="keyword">SELECT</span> id, name <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> ?</span><br><span class="line"><span class="keyword">SELECT</span> id, name <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> ?</span><br><span class="line"><span class="keyword">SELECT</span> id, name <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> ?</span><br><span class="line"><span class="keyword">SELECT</span> id, name <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> ?</span><br><span class="line"><span class="keyword">SELECT</span> id, name <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> ?</span><br><span class="line"><span class="keyword">SELECT</span> id, name <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> ?</span><br><span class="line"><span class="keyword">SELECT</span> id, name <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> ?</span><br><span class="line"><span class="keyword">SELECT</span> id, name <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> ?</span><br><span class="line"><span class="keyword">SELECT</span> id, name <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> ?</span><br><span class="line"><span class="keyword">SELECT</span> id, name <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> ?</span><br></pre></td></tr></table></figure>

<p>æ›´ç³Ÿçš„æ˜¯ï¼Ÿ è¿™äº›å¾…åŠäº‹é¡¹å¤§å¤šæ•°éƒ½ç”±åŒä¸€ç”¨æˆ·æ‹¥æœ‰ï¼ æˆ‘ä»¬å¯ä»¥åšå¾—æ›´å¥½ã€‚</p>
<h2 id="4-4-Dataloader"><a href="#4-4-Dataloader" class="headerlink" title="4.4 Dataloader"></a>4.4 Dataloader</h2><p>æˆ‘ä»¬éœ€è¦çš„æ˜¯ä¸€ç§å¯¹æ‰€æœ‰å¹¶å‘è¯·æ±‚è¿›è¡Œåˆ†ç»„ï¼Œå–å‡ºæ‰€æœ‰é‡å¤é¡¹å¹¶è¿›è¡Œå­˜å‚¨çš„æ–¹å¼ï¼Œä»¥å¤‡æ—¥ååœ¨è¯·æ±‚ä¸­éœ€è¦æ—¶ä½¿ç”¨ã€‚ æ•°æ®åŠ è½½å™¨å°±æ˜¯è¿™æ ·ï¼Œå®ƒæ˜¯ä¸€ç§ç”±Facebookæ™®åŠçš„è¯·æ±‚èŒƒå›´çš„æ‰¹å¤„ç†å’Œç¼“å­˜è§£å†³æ–¹æ¡ˆã€‚</p>
<p>æˆ‘ä»¬å°†ä½¿ç”¨dataloadenæ„å»ºæ•°æ®åŠ è½½å™¨ã€‚ åœ¨å…·æœ‰æ³›å‹çš„è¯­è¨€ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½åªæ˜¯åˆ›å»ºä¸€ä¸ªDataLoaderï¼Œä½†golangæ²¡æœ‰æ³›å‹ã€‚ ç›¸åï¼Œæˆ‘ä»¬ä¸ºå®ä¾‹æ‰‹åŠ¨ç”Ÿæˆä»£ç ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">go get github.com/vektah/dataloaden</span><br><span class="line">mkdir dataloader</span><br><span class="line">cd dataloader</span><br><span class="line">go run github.com/vektah/dataloaden UserLoader int *gqlgen-tutorials/dataloader/graph/model.User</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºæ–°æ•°æ®åŠ è½½å™¨çš„å®ä¾‹ï¼Œå¹¶å‘Šè¯‰æ‚¨å¦‚ä½•è·å–æ•°æ®ã€‚ ç”±äºæ•°æ®åŠ è½½å™¨æ˜¯è¯·æ±‚èŒƒå›´çš„ï¼Œå› æ­¤éå¸¸é€‚åˆä¸Šä¸‹æ–‡ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> loadersKey = <span class="string">&quot;dataloaders&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Loaders <span class="keyword">struct</span> &#123;</span><br><span class="line">	UserById UserLoader</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Middleware</span><span class="params">(conn *sql.DB, next http.Handler)</span></span> http.Handler &#123;</span><br><span class="line">	<span class="keyword">return</span> http.HandlerFunc(<span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">		ctx := context.WithValue(r.Context(), loadersKey, &amp;Loaders&#123;</span><br><span class="line">			UserById: UserLoader&#123;</span><br><span class="line">				maxBatch: <span class="number">100</span>,</span><br><span class="line">				wait:     <span class="number">1</span> * time.Millisecond,</span><br><span class="line">				fetch: <span class="function"><span class="keyword">func</span><span class="params">(ids []<span class="type">int</span>)</span></span> ([]*model.User, []<span class="type">error</span>) &#123;</span><br><span class="line">					placeholders := <span class="built_in">make</span>([]<span class="type">string</span>, <span class="built_in">len</span>(ids))</span><br><span class="line">					args := <span class="built_in">make</span>([]<span class="keyword">interface</span>&#123;&#125;, <span class="built_in">len</span>(ids))</span><br><span class="line">					<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(ids); i++ &#123;</span><br><span class="line">						placeholders[i] = <span class="string">&quot;?&quot;</span></span><br><span class="line">						args[i] = i</span><br><span class="line">					&#125;</span><br><span class="line"></span><br><span class="line">					res := db.LogAndQuery(conn,</span><br><span class="line">						<span class="string">&quot;SELECT id, name from dataloader_example.user WHERE id IN (&quot;</span>+strings.Join(placeholders, <span class="string">&quot;,&quot;</span>)+<span class="string">&quot;)&quot;</span>,</span><br><span class="line">						args...,</span><br><span class="line">					)</span><br><span class="line">					<span class="keyword">defer</span> res.Close()</span><br><span class="line"></span><br><span class="line">					userById := <span class="keyword">map</span>[<span class="type">int</span>]*model.User&#123;&#125;</span><br><span class="line">					<span class="keyword">for</span> res.Next() &#123;</span><br><span class="line">						user := model.User&#123;&#125;</span><br><span class="line">						err := res.Scan(&amp;user.ID, &amp;user.Name)</span><br><span class="line">						<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">							<span class="built_in">panic</span>(err)</span><br><span class="line">						&#125;</span><br><span class="line">						userById[user.ID] = &amp;user</span><br><span class="line">					&#125;</span><br><span class="line"></span><br><span class="line">					users := <span class="built_in">make</span>([]*model.User, <span class="built_in">len</span>(ids))</span><br><span class="line">					<span class="keyword">for</span> i, id := <span class="keyword">range</span> ids &#123;</span><br><span class="line">						users[i] = userById[id]</span><br><span class="line">					&#125;</span><br><span class="line"></span><br><span class="line">					<span class="keyword">return</span> users, <span class="literal">nil</span></span><br><span class="line">				&#125;,</span><br><span class="line">			&#125;,</span><br><span class="line">		&#125;)</span><br><span class="line">		r = r.WithContext(ctx)</span><br><span class="line">		next.ServeHTTP(w, r)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">For</span><span class="params">(ctx context.Context)</span></span> *Loaders &#123;</span><br><span class="line">	<span class="keyword">return</span> ctx.Value(loadersKey).(*Loaders)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯¥æ•°æ®åŠ è½½å™¨å°†ç­‰å¾…1æ¯«ç§’ä»¥è·å–100ä¸ªå”¯ä¸€è¯·æ±‚ï¼Œç„¶åè°ƒç”¨æå–å‡½æ•°ã€‚ è¿™ä¸ªå‡½æ•°æœ‰ç‚¹ä¸‘é™‹ï¼Œä½†æ˜¯å…¶ä¸­ä¸€åŠåªæ˜¯æ„å»ºSQLï¼</p>
<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ›´æ–°è§£æå™¨ä»¥è°ƒç”¨æ•°æ®åŠ è½½å™¨ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *todoResolver)</span></span> UserLoader(ctx context.Context, obj *model.Todo) (*model.User, <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="keyword">return</span> dataloader.For(ctx).UserById.Load(obj.UserID)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€ç»ˆç»“æœï¼Ÿä»…2ä¸ªæŸ¥è¯¢ï¼</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id, todo, user_id <span class="keyword">FROM</span> todo</span><br><span class="line"><span class="keyword">SELECT</span> id, name <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> id <span class="keyword">IN</span> (?,?,?,?,?)</span><br></pre></td></tr></table></figure>

<p>ç”Ÿæˆçš„UserLoaderä¸Šè¿˜æœ‰å…¶ä»–ä¸€äº›æœ‰ç”¨çš„æ–¹æ³•ï¼š</p>
<ul>
<li>LoadAllï¼ˆkeysï¼‰ï¼šå¦‚æœæ‚¨é¢„å…ˆçŸ¥é“ï¼Œåˆ™éœ€è¦ä¸€å †ç”¨æˆ·</li>
<li>Primeï¼ˆkeyï¼Œuserï¼‰ï¼šç”¨äºåœ¨ç±»ä¼¼çš„åŠ è½½å™¨ï¼ˆusersByIdï¼ŒusersByNoteï¼‰ä¹‹é—´åŒæ­¥çŠ¶æ€</li>
</ul>
<p>æ‚¨å¯ä»¥åœ¨æ­¤å¤„æŸ¥çœ‹å®Œæ•´çš„å·¥ä½œ<a target="_blank" rel="noopener" href="https://github.com/vektah/gqlgen-tutorials/tree/master/dataloader">ç¤ºä¾‹</a>ã€‚</p>
<h2 id="4-5-å­—æ®µæ”¶é›†"><a href="#4-5-å­—æ®µæ”¶é›†" class="headerlink" title="4.5 å­—æ®µæ”¶é›†"></a>4.5 å­—æ®µæ”¶é›†</h2><p>ç¡®å®šæŸ¥è¯¢è¯·æ±‚å“ªäº›å­—æ®µ</p>
<p>çŸ¥é“åœ¨è§£æå™¨ä¸­æŸ¥è¯¢å“ªäº›å­—æ®µé€šå¸¸å¾ˆæœ‰ç”¨ã€‚ æ‹¥æœ‰æ­¤ä¿¡æ¯å¯ä»¥ä½¿è§£æç¨‹åºä»…ä»æ•°æ®æºè·å–æ‰€éœ€çš„å­—æ®µé›†ï¼Œè€Œä¸æ˜¯è¿‡åº¦è·å–æ‰€æœ‰å†…å®¹å¹¶å…è®¸gqlgenè¿›è¡Œå…¶ä½™æ“ä½œã€‚</p>
<p>æ­¤è¿‡ç¨‹ç§°ä¸ºå­—æ®µæ”¶é›†gqlgenè‡ªåŠ¨æ‰§è¡Œæ­¤æ“ä½œï¼Œä»¥ä¾¿çŸ¥é“å“ªäº›å­—æ®µåº”æˆä¸ºå“åº”æœ‰æ•ˆè´Ÿè½½çš„ä¸€éƒ¨åˆ†ã€‚ ä½†æ˜¯ï¼Œæ”¶é›†çš„å­—æ®µé›†ç¡®å®å–å†³äºè¦è§£æçš„ç±»å‹ã€‚ æŸ¥è¯¢å¯ä»¥åŒ…å«ç‰‡æ®µï¼Œè€Œè§£æç¨‹åºå¯ä»¥è¿”å›æ¥å£å’Œè”åˆï¼Œå› æ­¤åœ¨çŸ¥é“è§£æå¯¹è±¡çš„ç±»å‹ä¹‹å‰ï¼Œæ— æ³•å®Œå…¨ç¡®å®šæ‰€æ”¶é›†å­—æ®µçš„é›†åˆã€‚</p>
<p>åœ¨è§£æç¨‹åºä¸­ï¼Œæœ‰å‡ ç§APIæ–¹æ³•å¯ç”¨äºæŸ¥è¯¢æ‰€é€‰å­—æ®µã€‚</p>
<h3 id="CollectAllFields"><a href="#CollectAllFields" class="headerlink" title="CollectAllFields"></a>CollectAllFields</h3><p><code>CollectAllFields</code>æ˜¯è·å–æŸ¥è¯¢å­—æ®µé›†çš„æœ€ç®€å•æ–¹æ³•ã€‚ å®ƒå°†ä»æŸ¥è¯¢ä¸­è¿”å›å­—æ®µåç§°çš„å­—ç¬¦ä¸²ç‰‡æ®µã€‚ è¿™å°†æ˜¯ä¸€ç»„å”¯ä¸€çš„å­—æ®µï¼Œå¹¶ä¸”å°†è¿”å›æ‰€æœ‰ç‰‡æ®µå­—æ®µï¼Œè€Œå¿½ç•¥ç‰‡æ®µç±»å‹æ¡ä»¶ã€‚</p>
<p>ç»™å®šä»¥ä¸‹ç¤ºä¾‹æŸ¥è¯¢ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">query &#123;</span><br><span class="line">    foo &#123;</span><br><span class="line">        fieldA</span><br><span class="line">        ... on Bar &#123;</span><br><span class="line">            fieldB</span><br><span class="line">        &#125;</span><br><span class="line">        ... on Baz &#123;</span><br><span class="line">            fieldC</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»è§£æå™¨è°ƒç”¨<code>CollectAllFields</code>å°†äº§ç”Ÿä¸€ä¸ªåŒ…å«fieldAï¼ŒfieldBå’ŒfieldCçš„å­—ç¬¦ä¸²åˆ‡ç‰‡ã€‚</p>
<h3 id="CollectFieldsCtx"><a href="#CollectFieldsCtx" class="headerlink" title="CollectFieldsCtx"></a>CollectFieldsCtx</h3><p>å¦‚æœéœ€è¦æ›´å¤šæœ‰å…³åŒ¹é…çš„ä¿¡æ¯ï¼Œæˆ–è€…æ”¶é›†çš„å­—æ®µé›†åº”ä¸è§£æç±»å‹çš„ç‰‡æ®µç±»å‹æ¡ä»¶åŒ¹é…ï¼Œåˆ™<code>CollectFieldsCtx</code>å¾ˆæœ‰ç”¨ã€‚<code>CollectFieldsCtx</code>å¸¦æœ‰ä¸€ä¸ªä»¤äººæ»¡æ„çš„å‚æ•°ï¼Œè¯¥å‚æ•°åº”è¯¥æ˜¯è§£æç±»å‹å°†æ»¡è¶³çš„ç±»å‹çš„å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ã€‚</p>
<p>ä¾‹å¦‚ï¼Œç»™å®šä»¥ä¸‹æ¶æ„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">interface Shape &#123;</span><br><span class="line">    area: Float</span><br><span class="line">&#125;</span><br><span class="line">type Circle implements Shape &#123;</span><br><span class="line">    radius: Float</span><br><span class="line">    area: Float</span><br><span class="line">&#125;</span><br><span class="line">union Shapes = Circle</span><br></pre></td></tr></table></figure>

<p><code>Circle</code>ç±»å‹å°†æ»¡è¶³<code>Circle</code>ï¼Œ<code>Shape</code>å’Œ<code>Shapes</code>çš„ç±»å‹-è¿™äº›å€¼åº”ä¼ é€’ç»™<code>CollectFieldsCtx</code>ä»¥è·å–å·²è§£æçš„<code>Circle</code>å¯¹è±¡çš„ä¸€ç»„æ”¶é›†å­—æ®µã€‚</p>
<blockquote>
<p>æ³¨æ„</p>
<p>CollectFieldsCtxåªæ˜¯CollectFieldsçš„ä¾¿åˆ©åŒ…è£…ï¼Œå®ƒä½¿ç”¨è§£æå™¨ä¸Šä¸‹æ–‡ä¸­è‡ªåŠ¨ä¼ é€’çš„é€‰æ‹©é›†è°ƒç”¨åé¢çš„å†…å®¹ã€‚</p>
</blockquote>
<h3 id="å®é™…ä¾‹å­"><a href="#å®é™…ä¾‹å­" class="headerlink" title="å®é™…ä¾‹å­"></a>å®é™…ä¾‹å­</h3><p>æˆ‘ä»¬æœ‰ä»¥ä¸‹GraphQLæŸ¥è¯¢</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">query &#123;</span><br><span class="line">  flowBlocks &#123;</span><br><span class="line">    id</span><br><span class="line">    block &#123;</span><br><span class="line">      id</span><br><span class="line">      title</span><br><span class="line">      type</span><br><span class="line">      choices &#123;</span><br><span class="line">        id</span><br><span class="line">        title</span><br><span class="line">        description</span><br><span class="line">        slug</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä¸æƒ³è¶…è½½æˆ‘ä»¬çš„æ•°æ®åº“ï¼Œæ‰€ä»¥æˆ‘ä»¬æƒ³çŸ¥é“è¯·æ±‚å“ªä¸ªå­—æ®µã€‚ è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œè¯¥ç¤ºä¾‹å°†æ‰€æœ‰è¯·æ±‚çš„å­—æ®µéƒ½ä½œä¸ºæ–¹ä¾¿çš„å­—ç¬¦ä¸²ç‰‡æ®µï¼Œå¯ä»¥æ–¹ä¾¿åœ°è¿›è¡Œæ£€æŸ¥ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetPreloads</span><span class="params">(ctx context.Context)</span></span> []<span class="type">string</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> GetNestedPreloads(</span><br><span class="line">		graphql.GetOperationContext(ctx),</span><br><span class="line">		graphql.CollectFieldsCtx(ctx, <span class="literal">nil</span>),</span><br><span class="line">		<span class="string">&quot;&quot;</span>,</span><br><span class="line">	)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetNestedPreloads</span><span class="params">(ctx *graphql.OperationContext, fields []graphql.CollectedField, prefix <span class="type">string</span>)</span></span> (preloads []<span class="type">string</span>) &#123;</span><br><span class="line">	<span class="keyword">for</span> _, column := <span class="keyword">range</span> fields &#123;</span><br><span class="line">		prefixColumn := GetPreloadString(prefix, column.Name)</span><br><span class="line">		preloads = <span class="built_in">append</span>(preloads, prefixColumn)</span><br><span class="line">		preloads = <span class="built_in">append</span>(preloads, GetNestedPreloads(ctx, graphql.CollectFields(ctx, column.Selections, <span class="literal">nil</span>), prefixColumn)...)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetPreloadString</span><span class="params">(prefix, name <span class="type">string</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(prefix) &gt; <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> prefix + <span class="string">&quot;.&quot;</span> + name</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> name</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬åœ¨è§£æå™¨ä¸­è°ƒç”¨è¿™äº›åŠ©æ‰‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *queryResolver)</span></span> FlowBlocks(ctx context.Context) ([]*FlowBlock, <span class="type">error</span>) &#123;</span><br><span class="line">	preloads := getPreloads(ctx)</span><br></pre></td></tr></table></figure>

<p>å®ƒå°†å¯¼è‡´ä»¥ä¸‹å­—ç¬¦ä¸²åˆ‡ç‰‡ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&quot;id&quot;, &quot;block&quot;, &quot;block.id&quot;, &quot;block.title&quot;, &quot;block.type&quot;, &quot;block.choices&quot;, &quot;block.choices.id&quot;, &quot;block.choices.title&quot;, &quot;block.choices.description&quot;, &quot;block.choices.slug&quot;]</span><br></pre></td></tr></table></figure>

<h2 id="4-6-ä¸Šä¼ æ–‡ä»¶"><a href="#4-6-ä¸Šä¼ æ–‡ä»¶" class="headerlink" title="4.6 ä¸Šä¼ æ–‡ä»¶"></a>4.6 ä¸Šä¼ æ–‡ä»¶</h2><p>GraphqlæœåŠ¡å™¨å…·æœ‰å†…ç½®çš„Uploadæ ‡é‡ï¼Œå¯ä½¿ç”¨åˆ†æ®µè¯·æ±‚ä¸Šä¼ æ–‡ä»¶ã€‚<br>å®ƒå®ç°äº†ä»¥ä¸‹è§„èŒƒ<a target="_blank" rel="noopener" href="https://github.com/jaydenseric/graphql-multipart-request-spec%EF%BC%8C%E8%AF%A5%E8%A7%84%E8%8C%83%E5%AE%9A%E4%B9%89%E4%BA%86%E7%94%A8%E4%BA%8EGraphQL%E8%AF%B7%E6%B1%82%E7%9A%84%E5%8F%AF%E4%BA%92%E6%93%8D%E4%BD%9C%E7%9A%84%E5%A4%9A%E9%83%A8%E5%88%86%E8%A1%A8%E5%8D%95%E5%AD%97%E6%AE%B5%E7%BB%93%E6%9E%84%EF%BC%8C%E4%BE%9B%E5%90%84%E7%A7%8D%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AE%9E%E7%8E%B0%E4%BD%BF%E7%94%A8%E3%80%82">https://github.com/jaydenseric/graphql-multipart-request-specï¼Œè¯¥è§„èŒƒå®šä¹‰äº†ç”¨äºGraphQLè¯·æ±‚çš„å¯äº’æ“ä½œçš„å¤šéƒ¨åˆ†è¡¨å•å­—æ®µç»“æ„ï¼Œä¾›å„ç§æ–‡ä»¶ä¸Šä¼ å®¢æˆ·ç«¯å®ç°ä½¿ç”¨ã€‚</a></p>
<p>è¦ä½¿ç”¨å®ƒï¼Œæ‚¨éœ€è¦åœ¨æ¶æ„ä¸­æ·»åŠ Uploadæ ‡é‡ï¼Œå®ƒå°†è‡ªåŠ¨å°†ç¼–ç»„è¡Œä¸ºæ·»åŠ åˆ°Goç±»å‹ã€‚</p>
<h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>å¯ä»¥é…ç½®ä¸¤ä¸ªç”¨äºä¸Šä¼ æ–‡ä»¶çš„ç‰¹å®šé€‰é¡¹ï¼š</p>
<ul>
<li>uploadMaxSize<br>æ­¤é€‰é¡¹æŒ‡å®šç”¨äºå°†è¯·æ±‚æ­£æ–‡è§£æä¸º<code>multipart/form-data</code>çš„æœ€å¤§å­—èŠ‚æ•°ã€‚</li>
<li>uploadMaxMemory<br>æ­¤é€‰é¡¹æŒ‡å®šç”¨äºå°†è¯·æ±‚æ­£æ–‡è§£æä¸ºå†…å­˜ä¸­çš„<code>multipart/form-data</code>çš„æœ€å¤§å­—èŠ‚æ•°ï¼Œå…¶ä½™éƒ¨åˆ†å­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„ä¸´æ—¶æ–‡ä»¶ä¸­ã€‚</li>
</ul>
<h3 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h3><h4 id="å•æ–‡ä»¶ä¸Šä¼ "><a href="#å•æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="å•æ–‡ä»¶ä¸Šä¼ "></a>å•æ–‡ä»¶ä¸Šä¼ </h4><p>å¯¹äºæ­¤ç”¨ä¾‹ï¼Œæ¶æ„å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&quot;The `UploadFile, // b.txt` scalar type represents a multipart file upload.&quot;</span><br><span class="line">scalar Upload</span><br><span class="line"></span><br><span class="line">&quot;The `Query` type, represents all of the entry points into our object graph.&quot;</span><br><span class="line">type Query &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&quot;The `Mutation` type, represents all updates we can make to our data.&quot;</span><br><span class="line">type Mutation &#123;</span><br><span class="line">    singleUpload(file: Upload!): Bool!</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥ä½¿ç”¨cURLè¿›è¡ŒæŸ¥è¯¢ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl localhost:4000/graphql \</span><br><span class="line">  -F operations=&#x27;&#123; &quot;query&quot;: &quot;mutation ($file: Upload!) &#123; singleUpload(file: $file) &#123; id &#125; &#125;&quot;, &quot;variables&quot;: &#123; &quot;file&quot;: null &#125; &#125;&#x27; \</span><br><span class="line">  -F map=&#x27;&#123; &quot;0&quot;: [&quot;variables.file&quot;] &#125;&#x27; \</span><br><span class="line">  -F 0=@a.txt</span><br></pre></td></tr></table></figure>

<p>è¿™å°†è°ƒç”¨ä»¥ä¸‹æ“ä½œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  query: `</span><br><span class="line">    mutation($file: Upload!) &#123;</span><br><span class="line">      singleUpload(file: $file) &#123;</span><br><span class="line">        id</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  `,</span><br><span class="line">  variables: &#123;</span><br><span class="line">    file: File // a.txt</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="å¤šæ–‡ä»¶ä¸Šä¼ "><a href="#å¤šæ–‡ä»¶ä¸Šä¼ " class="headerlink" title="å¤šæ–‡ä»¶ä¸Šä¼ "></a>å¤šæ–‡ä»¶ä¸Šä¼ </h4><p>å¯¹äºæ­¤ç”¨ä¾‹ï¼Œæ¶æ„å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&quot;The `Upload` scalar type represents a multipart file upload.&quot;</span><br><span class="line">scalar Upload</span><br><span class="line"></span><br><span class="line">&quot;The `File` type, represents the response of uploading a file.&quot;</span><br><span class="line">type File &#123;</span><br><span class="line">    id: Int!</span><br><span class="line">    name: String!</span><br><span class="line">    content: String!</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&quot;The `UploadFile` type, represents the request for uploading a file with a certain payload.&quot;</span><br><span class="line">input UploadFile &#123;</span><br><span class="line">    id: Int!</span><br><span class="line">    file: Upload!</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&quot;The `Query` type, represents all of the entry points into our object graph.&quot;</span><br><span class="line">type Query &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&quot;The `Mutation` type, represents all updates we can make to our data.&quot;</span><br><span class="line">type Mutation &#123;</span><br><span class="line">    multipleUpload(req: [UploadFile!]!): [File!]!</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥ä½¿ç”¨cURLè¿›è¡ŒæŸ¥è¯¢ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl localhost:4000/query \</span><br><span class="line">  -F operations=&#x27;&#123; &quot;query&quot;: &quot;mutation($req: [UploadFile!]!) &#123; multipleUpload(req: $req) &#123; id, name, content &#125; &#125;&quot;, &quot;variables&quot;: &#123; &quot;req&quot;: [ &#123; &quot;id&quot;: 1, &quot;file&quot;: null &#125;, &#123; &quot;id&quot;: 2, &quot;file&quot;: null &#125; ] &#125; &#125;&#x27; \</span><br><span class="line">  -F map=&#x27;&#123; &quot;0&quot;: [&quot;variables.req.0.file&quot;], &quot;1&quot;: [&quot;variables.req.1.file&quot;] &#125;&#x27; \</span><br><span class="line">  -F 0=@b.txt \</span><br><span class="line">  -F 1=@c.txt</span><br></pre></td></tr></table></figure>

<p>è¿™å°†è°ƒç”¨ä»¥ä¸‹æ“ä½œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  query: `</span><br><span class="line">    mutation($req: [UploadFile!]!)</span><br><span class="line">      multipleUpload(req: $req) &#123;</span><br><span class="line">        id,</span><br><span class="line">        name,</span><br><span class="line">        content</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  `,</span><br><span class="line">  variables: &#123;</span><br><span class="line">    req: [</span><br><span class="line">        &#123;</span><br><span class="line">            id: 1,</span><br><span class="line">            File, // b.txt</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            id: 2,</span><br><span class="line">            File, // c.txt</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ‰å…³æ›´å¤šç¤ºä¾‹ï¼Œè¯·å‚è§<a href="example/fileupload">example&#x2F;fileupload</a>è½¯ä»¶åŒ…ã€‚</p>
<h3 id="Apolloçš„ç”¨æ³•"><a href="#Apolloçš„ç”¨æ³•" class="headerlink" title="Apolloçš„ç”¨æ³•"></a>Apolloçš„ç”¨æ³•</h3><p>éœ€è¦å®‰è£…apollo-upload-clientæ‰èƒ½ä½¿æ–‡ä»¶ä¸Šä¼ ä¸Apolloä¸€èµ·ä½¿ç”¨ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">ApolloClient</span> <span class="keyword">from</span> <span class="string">&quot;apollo-client&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createUploadLink &#125; <span class="keyword">from</span> <span class="string">&quot;apollo-upload-client&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> client = <span class="keyword">new</span> <span class="title class_">ApolloClient</span>(&#123;</span><br><span class="line">	<span class="attr">cache</span>: <span class="keyword">new</span> <span class="title class_">InMemoryCache</span>(),</span><br><span class="line">	<span class="attr">link</span>: <span class="title function_">createUploadLink</span>(&#123; <span class="attr">uri</span>: <span class="string">&quot;/graphql&quot;</span> &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>ç„¶åå¯ä»¥å°†<code>File</code>å¯¹è±¡ä½œä¸ºå˜é‡ä¼ é€’åˆ°æ‚¨çš„mutationä¸­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  query: `</span><br><span class="line">    mutation($file: Upload!) &#123;</span><br><span class="line">      singleUpload(file: $file) &#123;</span><br><span class="line">        id</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  `,</span><br><span class="line">  variables: &#123;</span><br><span class="line">    file: new File(...)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-7-å¤„ç†é”™è¯¯"><a href="#4-7-å¤„ç†é”™è¯¯" class="headerlink" title="4.7 å¤„ç†é”™è¯¯"></a>4.7 å¤„ç†é”™è¯¯</h2><p>åœ¨graphqlå“åº”ä¸­å‘é€è‡ªå®šä¹‰é”™è¯¯æ•°æ®</p>
<h3 id="è¿”å›é”™è¯¯"><a href="#è¿”å›é”™è¯¯" class="headerlink" title="è¿”å›é”™è¯¯"></a>è¿”å›é”™è¯¯</h3><p>æ‰€æœ‰è§£æå™¨ä»…è¿”å›é”™è¯¯å¹¶å‘é€ç»™ç”¨æˆ·ã€‚ å‡å®šæ­¤å¤„è¿”å›çš„ä»»ä½•é”™è¯¯æ¶ˆæ¯éƒ½é€‚åˆæœ€ç»ˆç”¨æˆ·ã€‚ å¦‚æœæŸäº›æ¶ˆæ¯ä¸å®‰å…¨ï¼Œè¯·è‡ªå®šä¹‰é”™è¯¯æç¤ºå™¨ã€‚</p>
<p>å¤šé‡é”™è¯¯<br>è¦è¿”å›å¤šä¸ªé”™è¯¯ï¼Œæ‚¨å¯ä»¥åƒè¿™æ ·è°ƒç”¨<code>graphql.Error</code>å‡½æ•°ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> foo</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/vektah/gqlparser/v2/gqlerror&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/99designs/gqlgen/graphql&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r Query)</span></span> DoThings(ctx context.Context) (<span class="type">bool</span>, <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="comment">// Print a formatted string</span></span><br><span class="line">	graphql.AddErrorf(ctx, <span class="string">&quot;Error %d&quot;</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Pass an existing error out</span></span><br><span class="line">	graphql.AddError(ctx, gqlerror.Errorf(<span class="string">&quot;zzzzzt&quot;</span>))</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Or fully customize the error</span></span><br><span class="line">	graphql.AddError(ctx, &amp;gqlerror.Error&#123;</span><br><span class="line">		Path:       graphql.GetPath(ctx),</span><br><span class="line">		Message:    <span class="string">&quot;A descriptive error message&quot;</span>,</span><br><span class="line">		Extensions: <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;</span><br><span class="line">			<span class="string">&quot;code&quot;</span>: <span class="string">&quot;10-4&quot;</span>,</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// And you can still return an error if you need</span></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span>, gqlerror.Errorf(<span class="string">&quot;BOOM! Headshot&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®ƒä»¬å°†åœ¨å“åº”ä¸­ä»¥ç›¸åŒé¡ºåºè¿”å›ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;todo&quot;</span><span class="punctuation">:</span> <span class="keyword">null</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span> <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Error 1&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="string">&quot;todo&quot;</span> <span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span> <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;zzzzzt&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="string">&quot;todo&quot;</span> <span class="punctuation">]</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span> <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;A descriptive error message&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="string">&quot;todo&quot;</span> <span class="punctuation">]</span><span class="punctuation">,</span> <span class="attr">&quot;extensions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10-4&quot;</span> <span class="punctuation">&#125;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span> <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;BOOM! Headshot&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="string">&quot;todo&quot;</span> <span class="punctuation">]</span> <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="é’©å­"><a href="#é’©å­" class="headerlink" title="é’©å­"></a>é’©å­</h3><p>é”™è¯¯æç¤ºå™¨<br>è§£æç¨‹åºè¿”å›æˆ–ä»éªŒè¯è¿”å›çš„æ‰€æœ‰é”™è¯¯åœ¨æ˜¾ç¤ºç»™ç”¨æˆ·ä¹‹å‰éƒ½è¦ç»è¿‡ä¸€ä¸ªé’©å­ã€‚ è¯¥æŒ‚é’©ä½¿æ‚¨èƒ½å¤Ÿè‡ªå®šä¹‰é”™è¯¯ï¼Œä½†æ˜¯åœ¨æ‚¨çš„åº”ç”¨ä¸­æœ‰æ„ä¹‰ã€‚</p>
<p>é»˜è®¤é”™è¯¯æç¤ºå™¨å°†æ•è·è§£æå™¨è·¯å¾„ï¼Œå¹¶åœ¨å“åº”ä¸­ä½¿ç”¨<code>Error()</code>æ¶ˆæ¯ã€‚</p>
<p>æ‚¨åœ¨åˆ›å»ºæœåŠ¡å™¨æ—¶æ›´æ”¹æ­¤è®¾ç½®ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bar</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;errors&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/vektah/gqlparser/v2/gqlerror&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/99designs/gqlgen/graphql&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/99designs/gqlgen/graphql/handler&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	server := handler.NewDefaultServer(MakeExecutableSchema(resolvers))</span><br><span class="line">	server.SetErrorPresenter(<span class="function"><span class="keyword">func</span><span class="params">(ctx context.Context, e <span class="type">error</span>)</span></span> *gqlerror.Error &#123;</span><br><span class="line">		err := graphql.DefaultErrorPresenter(ctx, e)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">var</span> myErr *MyError</span><br><span class="line">		<span class="keyword">if</span> errors.As(e, &amp;myErr) &#123;</span><br><span class="line">			err.Message = <span class="string">&quot;Eeek!&quot;</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å°†ä½¿ç”¨ä¸ç”Ÿæˆè¯¥å‡½æ•°ç›¸åŒçš„è§£æå™¨ä¸Šä¸‹æ–‡æ¥è°ƒç”¨æ­¤å‡½æ•°ï¼Œå› æ­¤æ‚¨å¯ä»¥æå–å½“å‰çš„è§£æå™¨è·¯å¾„ä»¥åŠå¯èƒ½è¦é€šçŸ¥å®¢æˆ·ç«¯çš„å…¶ä»–ä»»ä½•çŠ¶æ€ã€‚</p>
<p>ç´§æ€¥å¤„ç†ç¨‹åº<br>è¿˜æœ‰ä¸€ä¸ªææ…Œå¤„ç†ç¨‹åºï¼Œæ¯å½“å‘ç”Ÿææ…Œä»¥åœ¨åœæ­¢è§£æä¹‹å‰å‘ç”¨æˆ·æ­£å¸¸è¿”å›æ¶ˆæ¯æ—¶ï¼Œå°±ä¼šè°ƒç”¨è¯¥å¤„ç†ç¨‹åºã€‚ è¿™æ˜¯é€šçŸ¥æ‚¨çš„é”™è¯¯è·Ÿè¸ªå™¨å¹¶å°†è‡ªå®šä¹‰æ¶ˆæ¯å‘é€ç»™ç”¨æˆ·çš„å¥½åœ°æ–¹ã€‚ ä»è¿™é‡Œè¿”å›çš„ä»»ä½•é”™è¯¯ä¹Ÿå°†é€šè¿‡é”™è¯¯æç¤ºå™¨ã€‚</p>
<p>æ‚¨åœ¨åˆ›å»ºæœåŠ¡å™¨æ—¶æ›´æ”¹æ­¤è®¾ç½®ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">server := handler.NewDefaultServer(MakeExecutableSchema(resolvers)</span><br><span class="line">server.SetRecoverFunc(<span class="function"><span class="keyword">func</span><span class="params">(ctx context.Context, err <span class="keyword">interface</span>&#123;&#125;)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">    <span class="comment">// notify bug tracker...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> errors.New(<span class="string">&quot;Internal server error!&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="4-8-å†…çœ"><a href="#4-8-å†…çœ" class="headerlink" title="4.8 å†…çœ"></a>4.8 å†…çœ</h2><p>GraphQLçš„æœ€ä½³åŠŸèƒ½ä¹‹ä¸€æ˜¯å¼ºå¤§çš„å‘ç°èƒ½åŠ›ï¼Œä½†æœ‰æ—¶æ‚¨ä¸æƒ³è®©å…¶ä»–äººæ¢ç´¢æ‚¨çš„ç«¯ç‚¹ã€‚</p>
<h3 id="ç¦ç”¨æœåŠ¡å™¨çš„è‡ªçœ"><a href="#ç¦ç”¨æœåŠ¡å™¨çš„è‡ªçœ" class="headerlink" title="ç¦ç”¨æœåŠ¡å™¨çš„è‡ªçœ"></a>ç¦ç”¨æœåŠ¡å™¨çš„è‡ªçœ</h3><p>è¦åœ¨è¿è¡Œæ—¶æ‰“å¼€å’Œå…³é—­è‡ªçœåŠŸèƒ½ï¼Œè¯·åœ¨å¯åŠ¨æœåŠ¡å™¨æ—¶ä¼ é€’IntrospectionEnabledå¤„ç†ç¨‹åºé€‰é¡¹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">srv := httptest.NewServer(</span><br><span class="line">	handler.GraphQL(</span><br><span class="line">		NewExecutableSchema(Config&#123;Resolvers: resolvers&#125;),</span><br><span class="line">		handler.IntrospectionEnabled(<span class="literal">false</span>),</span><br><span class="line">	),</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="ç¦ç”¨èº«ä»½éªŒè¯çš„è‡ªçœ"><a href="#ç¦ç”¨èº«ä»½éªŒè¯çš„è‡ªçœ" class="headerlink" title="ç¦ç”¨èº«ä»½éªŒè¯çš„è‡ªçœ"></a>ç¦ç”¨èº«ä»½éªŒè¯çš„è‡ªçœ</h3><p>ä¹Ÿå¯ä»¥åŸºäºæ¯ä¸ªè¯·æ±‚ä¸Šä¸‹æ–‡å¯ç”¨è‡ªçœã€‚ ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åœ¨åŸºäºç”¨æˆ·èº«ä»½éªŒè¯çš„ä¸­é—´ä»¶ä¸­å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">srv := httptest.NewServer(</span><br><span class="line">	handler.GraphQL(</span><br><span class="line">		NewExecutableSchema(Config&#123;Resolvers: resolvers&#125;),</span><br><span class="line">		handler.RequestMiddleware(<span class="function"><span class="keyword">func</span><span class="params">(ctx context.Context, next <span class="keyword">func</span>(ctx context.Context)</span></span> []<span class="type">byte</span>) []<span class="type">byte</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> !userForContext(ctx).IsAdmin &#123;</span><br><span class="line">				graphql.GetOperationContext(ctx).DisableIntrospection = <span class="literal">true</span></span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span> next(ctx)</span><br><span class="line">		&#125;),</span><br><span class="line">	),</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="4-9-æ’ä»¶"><a href="#4-9-æ’ä»¶" class="headerlink" title="4.9 æ’ä»¶"></a>4.9 æ’ä»¶</h2><p>å¦‚ä½•ä¸ºgqlgenç¼–å†™æ’ä»¶</p>
<p>æ’ä»¶æä¾›äº†ä¸€ç§è¿›å…¥gqlgenä»£ç ç”Ÿæˆç”Ÿå‘½å‘¨æœŸçš„æ–¹å¼ã€‚ ä¸ºäº†ä½¿ç”¨é»˜è®¤æ’ä»¶ä»¥å¤–çš„ä»»ä½•ä¸œè¥¿ï¼Œæ‚¨å°†éœ€è¦åˆ›å»ºè‡ªå·±çš„å…¥å£ç‚¹ï¼š</p>
<h3 id="ä½¿ç”¨æ’ä»¶"><a href="#ä½¿ç”¨æ’ä»¶" class="headerlink" title="ä½¿ç”¨æ’ä»¶"></a>ä½¿ç”¨æ’ä»¶</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// +build ignore</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;flag&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;os&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/99designs/gqlgen/api&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/99designs/gqlgen/codegen/config&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/99designs/gqlgen/plugin/stubgen&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	cfg, err := config.LoadConfigFromDefaultLocations()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Fprintln(os.Stderr, <span class="string">&quot;failed to load config&quot;</span>, err.Error())</span><br><span class="line">		os.Exit(<span class="number">2</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	err = api.Generate(cfg,</span><br><span class="line">		api.AddPlugin(yourplugin.New()), <span class="comment">// This is the magic line</span></span><br><span class="line">	)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Fprintln(os.Stderr, err.Error())</span><br><span class="line">		os.Exit(<span class="number">3</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç¼–å†™æ’ä»¶"><a href="#ç¼–å†™æ’ä»¶" class="headerlink" title="ç¼–å†™æ’ä»¶"></a>ç¼–å†™æ’ä»¶</h3><p>å½“å‰åªæœ‰ä¸¤ä¸ªé’©å­ï¼š</p>
<ul>
<li>MutateConfigï¼šå…è®¸æ’ä»¶åœ¨ä»£ç ç”Ÿæˆå¼€å§‹ä¹‹å‰å¯¹é…ç½®è¿›è¡Œæ›´æ”¹ã€‚ è¿™ä½¿æ’ä»¶å¯ä»¥æ·»åŠ è‡ªå®šä¹‰æŒ‡ä»¤ï¼Œå®šä¹‰ç±»å‹å¹¶å®ç°è§£æå™¨ã€‚ å‚è§<a target="_blank" rel="noopener" href="https://github.com/99designs/gqlgen/tree/master/plugin/modelgen">modelgen</a>çš„ä¾‹å­</li>
<li>GenerateCodeï¼šå…è®¸æ’ä»¶ç”Ÿæˆæ–°çš„è¾“å‡ºæ–‡ä»¶ï¼Œæœ‰å…³ç¤ºä¾‹ï¼Œè¯·å‚è§<a target="_blank" rel="noopener" href="https://github.com/99designs/gqlgen/tree/master/plugin/stubgen">stubgen</a></li>
</ul>
<p>è¯·æŸ¥çœ‹plugin.goä»¥è·å–å¯ç”¨é’©å­çš„å®Œæ•´åˆ—è¡¨ã€‚ è¿™äº›å¯èƒ½éšæ¯ä¸ªå‘è¡Œç‰ˆè€Œæ”¹å˜ã€‚</p>
<h2 id="4-10-æŸ¥è¯¢å¤æ‚åº¦"><a href="#4-10-æŸ¥è¯¢å¤æ‚åº¦" class="headerlink" title="4.10 æŸ¥è¯¢å¤æ‚åº¦"></a>4.10 æŸ¥è¯¢å¤æ‚åº¦</h2><p>é˜²æ­¢è¿‡äºå¤æ‚çš„æŸ¥è¯¢<br>GraphQLæä¾›äº†ä¸€ç§å¼ºå¤§çš„æŸ¥è¯¢æ•°æ®çš„æ–¹æ³•ï¼Œä½†æ˜¯å°†å¼ºå¤§çš„åŠŸèƒ½æŒæ¡åœ¨APIå®¢æˆ·ç«¯ä¸Šä¹Ÿä½¿æ‚¨é¢ä¸´æ‹’ç»æœåŠ¡æ”»å‡»çš„é£é™©ã€‚ æ‚¨å¯ä»¥é€šè¿‡é™åˆ¶å…è®¸çš„æŸ¥è¯¢çš„å¤æ‚æ€§ï¼Œä½¿ç”¨gqlgenå‡è½»è¿™ç§é£é™©ã€‚</p>
<h3 id="ä»£ä»·é«˜çš„æŸ¥è¯¢"><a href="#ä»£ä»·é«˜çš„æŸ¥è¯¢" class="headerlink" title="ä»£ä»·é«˜çš„æŸ¥è¯¢"></a>ä»£ä»·é«˜çš„æŸ¥è¯¢</h3><p>è€ƒè™‘ä¸€ç§å…è®¸åˆ—å‡ºåšå®¢æ–‡ç« çš„æ¶æ„ã€‚ æ¯ä¸ªåšå®¢å¸–å­ä¹Ÿä¸å…¶ä»–å¸–å­ç›¸å…³ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">type Query &#123;</span><br><span class="line">	posts(count: Int = 10): [Post!]!</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type Post &#123;</span><br><span class="line">	title: String!</span><br><span class="line">	text: String!</span><br><span class="line">	related(count: Int = 10): [Post!]!</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Itâ€™s not too hard to craft a query that will cause a very large response:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	posts(count: 100) &#123;</span><br><span class="line">		related(count: 100) &#123;</span><br><span class="line">			related(count: 100) &#123;</span><br><span class="line">				related(count: 100) &#123;</span><br><span class="line">					title</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å“åº”çš„å¤§å°éšç›¸å…³å­—æ®µçš„æ¯ä¸ªé™„åŠ çº§åˆ«å‘ˆæŒ‡æ•°å¢é•¿ã€‚ å¹¸è¿çš„æ˜¯ï¼Œgqlgençš„http.HandleråŒ…å«äº†ä¸€ç§é˜²æ­¢æ­¤ç±»æŸ¥è¯¢çš„æ–¹æ³•ã€‚</p>
<h3 id="é™åˆ¶æŸ¥è¯¢å¤æ‚åº¦"><a href="#é™åˆ¶æŸ¥è¯¢å¤æ‚åº¦" class="headerlink" title="é™åˆ¶æŸ¥è¯¢å¤æ‚åº¦"></a>é™åˆ¶æŸ¥è¯¢å¤æ‚åº¦</h3><p>é™åˆ¶æŸ¥è¯¢å¤æ‚åº¦å°±åƒä½¿ç”¨æä¾›çš„æ‰©å±•åŒ…è¿›è¡ŒæŒ‡å®šä¸€æ ·ç®€å•ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    c := Config&#123; Resolvers: &amp;resolvers&#123;&#125; &#125;</span><br><span class="line">		srv := handler.NewDefaultServer(blog.NewExecutableSchema(c))</span><br><span class="line">		srv.Use(extension.FixedComplexityLimit(<span class="number">5</span>)) <span class="comment">// This line is key</span></span><br><span class="line">    r.Handle(<span class="string">&quot;/query&quot;</span>, srv)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œä»»ä½•å¤æ‚åº¦å¤§äº5çš„æŸ¥è¯¢éƒ½ä¼šè¢«APIæ‹’ç»ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªå­—æ®µå’Œæ·±åº¦çº§åˆ«éƒ½ä¼šä½¿æ•´ä½“æŸ¥è¯¢å¤æ‚æ€§åŠ ä¸€ã€‚ æ‚¨è¿˜å¯ä»¥ä½¿ç”¨<code>extension.ComplexityLimit</code>åŠ¨æ€é…ç½®æ¯ä¸ªè¯·æ±‚çš„å¤æ‚åº¦é™åˆ¶ã€‚</p>
<p>è¿™æœ‰å¸®åŠ©ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶æœ‰ä¸€ä¸ªé—®é¢˜ï¼šè¿”å›æ•°ç»„çš„<code>posts</code>å’Œ<code>related</code>å­—æ®µæ¯”æ ‡é‡<code>title</code>å’Œ<code>text</code>å­—æ®µè¦æ˜‚è´µå¾—å¤šã€‚ ä½†æ˜¯ï¼Œé»˜è®¤å¤æ‚åº¦è®¡ç®—å¯¹å®ƒä»¬è¿›è¡Œå¹³å‡åŠ æƒã€‚ å°†è¾ƒé«˜çš„æˆæœ¬åº”ç”¨äºæ•°ç»„å­—æ®µä¼šæ›´æœ‰æ„ä¹‰ã€‚</p>
<h3 id="è‡ªå®šä¹‰å¤æ‚åº¦è®¡ç®—"><a href="#è‡ªå®šä¹‰å¤æ‚åº¦è®¡ç®—" class="headerlink" title="è‡ªå®šä¹‰å¤æ‚åº¦è®¡ç®—"></a>è‡ªå®šä¹‰å¤æ‚åº¦è®¡ç®—</h3><p>ä¸ºäº†å°†æ›´é«˜çš„æˆæœ¬åº”ç”¨äºæŸäº›é¢†åŸŸï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰å¤æ‚åº¦å‡½æ•°ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    c := Config&#123; Resolvers: &amp;resolvers&#123;&#125; &#125;</span><br><span class="line"></span><br><span class="line">    countComplexity := <span class="function"><span class="keyword">func</span><span class="params">(childComplexity, count <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> count * childComplexity</span><br><span class="line">    &#125;</span><br><span class="line">    c.Complexity.Query.Posts = countComplexity</span><br><span class="line">    c.Complexity.Post.Related = countComplexity</span><br><span class="line"></span><br><span class="line">    srv := handler.NewDefaultServer(blog.NewExecutableSchema(c))</span><br><span class="line">		srv.Use(extension.FixedComplexityLimit(<span class="number">5</span>))</span><br><span class="line">    http.Handle(<span class="string">&quot;/query&quot;</span>, gqlHandler)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“æˆ‘ä»¬å°†å‡½æ•°åˆ†é…ç»™é€‚å½“çš„â€œComplexityâ€å­—æ®µæ—¶ï¼Œè¯¥å‡½æ•°å°†ç”¨äºå¤æ‚åº¦è®¡ç®—ã€‚ åœ¨è¿™é‡Œï¼Œ<code>posts</code>åŠå…¶<code>related</code>å­—æ®µæ ¹æ®å…¶<code>count</code>å‚æ•°çš„å€¼è¿›è¡ŒåŠ æƒã€‚ è¿™æ„å‘³ç€å®¢æˆ·è¯·æ±‚å‘å¸ƒçš„å†…å®¹è¶Šå¤šï¼ŒæŸ¥è¯¢çš„å¤æ‚åº¦å°±è¶Šé«˜ã€‚ å°±åƒå“åº”çš„å¤§å°åœ¨åŸå§‹æŸ¥è¯¢ä¸­ä»¥æŒ‡æ•°æ–¹å¼å¢åŠ ä¸€æ ·ï¼Œå¤æ‚æ€§ä¹Ÿå°†ä»¥æŒ‡æ•°æ–¹å¼å¢åŠ ï¼Œå› æ­¤ä»»ä½•å°è¯•æ»¥ç”¨APIçš„å®¢æˆ·ç«¯éƒ½ä¼šå¾ˆå¿«é‡åˆ°é™åˆ¶ã€‚</p>
<p>é€šè¿‡åº”ç”¨æŸ¥è¯¢å¤æ‚æ€§é™åˆ¶å¹¶åœ¨æ­£ç¡®çš„ä½ç½®æŒ‡å®šè‡ªå®šä¹‰å¤æ‚æ€§åŠŸèƒ½ï¼Œå¯ä»¥è½»æ¾åœ°é˜²æ­¢å®¢æˆ·ç«¯ä½¿ç”¨è¿‡å¤šçš„èµ„æºå¹¶ç ´åæ‚¨çš„æœåŠ¡ã€‚</p>
<h2 id="4-11-è§£æå™¨"><a href="#4-11-è§£æå™¨" class="headerlink" title="4.11 è§£æå™¨"></a>4.11 è§£æå™¨</h2><p>è§£å†³graphQLè¯·æ±‚<br>graphQLç±»å‹å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼ç»‘å®šåˆ°å…è®¸è®¸å¤šç”¨ä¾‹çš„Goç»“æ„ã€‚</p>
<h3 id="ç›´æ¥ç»‘å®šåˆ°ç»“æ„å­—æ®µåç§°"><a href="#ç›´æ¥ç»‘å®šåˆ°ç»“æ„å­—æ®µåç§°" class="headerlink" title="ç›´æ¥ç»‘å®šåˆ°ç»“æ„å­—æ®µåç§°"></a>ç›´æ¥ç»‘å®šåˆ°ç»“æ„å­—æ®µåç§°</h3><p>è¿™æ˜¯æœ€å¸¸è§çš„ç”¨ä¾‹ï¼Œå…¶ä¸­Goç»“æ„ä¸Šçš„å­—æ®µåç§°ä¸graphQLç±»å‹çš„å­—æ®µåç§°åŒ¹é…ã€‚ å¦‚æœæœªå¯¼å‡ºGo structå­—æ®µï¼Œåˆ™ä¸ä¼šå°†å…¶ç»‘å®šåˆ°graphQLç±»å‹ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Car <span class="keyword">struct</span> &#123;</span><br><span class="line">    Make <span class="type">string</span></span><br><span class="line">    Model <span class="type">string</span></span><br><span class="line">    Color <span class="type">string</span></span><br><span class="line">    OdometerReading <span class="type">int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨æ‚¨çš„graphQLæ¨¡å¼ä¸­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">type Car &#123;</span><br><span class="line">    make: String!</span><br><span class="line">    model: String!</span><br><span class="line">    color: String!</span><br><span class="line">    odometerReading: Int!</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¹¶åœ¨gqlgené…ç½®æ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">models:</span></span><br><span class="line">    <span class="attr">Car:</span></span><br><span class="line">        <span class="attr">model:</span> <span class="string">github.com/my/app/models.Car</span></span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒgraphQLç±»å‹çš„æ¯ä¸ªå­—æ®µéƒ½å°†ç»‘å®šåˆ°goç»“æ„ä¸Šçš„ç›¸åº”å­—æ®µï¼Œè€Œå¿½ç•¥å­—æ®µçš„å¤§å°å†™</p>
<h3 id="ç»‘å®šåˆ°æ–¹æ³•åç§°"><a href="#ç»‘å®šåˆ°æ–¹æ³•åç§°" class="headerlink" title="ç»‘å®šåˆ°æ–¹æ³•åç§°"></a>ç»‘å®šåˆ°æ–¹æ³•åç§°</h3><p>è¿™ä¹Ÿæ˜¯æˆ‘ä»¬è¦å°†graphQLå­—æ®µç»‘å®šåˆ°Go structæ–¹æ³•çš„éå¸¸å¸¸è§çš„ç”¨ä¾‹</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Car <span class="keyword">struct</span> &#123;</span><br><span class="line">    Make <span class="type">string</span></span><br><span class="line">    Model <span class="type">string</span></span><br><span class="line">    Color <span class="type">string</span></span><br><span class="line">    OwnerID *<span class="type">string</span></span><br><span class="line">    OdometerReading <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Car)</span></span> Owner() (*Person) &#123;</span><br><span class="line">    <span class="comment">// get the car owner</span></span><br><span class="line">    <span class="comment">//....</span></span><br><span class="line">    <span class="keyword">return</span> owner</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨æ‚¨çš„graphQLæ¨¡å¼ä¸­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">type Car &#123;</span><br><span class="line">    make: String!</span><br><span class="line">    model: String!</span><br><span class="line">    color: String!</span><br><span class="line">    odometerReading: Int!</span><br><span class="line">    owner: Person</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¹¶åœ¨gqlgené…ç½®æ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">models:</span></span><br><span class="line">    <span class="attr">Car:</span></span><br><span class="line">        <span class="attr">model:</span> <span class="string">github.com/my/app/models.Car</span></span><br><span class="line">    <span class="attr">Person:</span></span><br><span class="line">        <span class="attr">model:</span> <span class="string">github.com/my/app/models.Person</span></span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬çœ‹åˆ°åœ¨<code>Car</code>ä¸Šæœ‰ä¸€ä¸ªåä¸º<code>Owner</code>çš„æ–¹æ³•ï¼Œå› æ­¤ï¼Œå¦‚æœ<code>graphQL</code>è¯·æ±‚åŒ…å«è¦è§£æçš„å­—æ®µï¼Œåˆ™å°†è°ƒç”¨<code>Owner</code>å‡½æ•°ã€‚</p>
<p>æ¨¡å‹æ–¹æ³•å¯ä»¥é€‰æ‹©å°†ä¸Šä¸‹æ–‡ä½œä¸ºå…¶ç¬¬ä¸€ä¸ªå‚æ•°ã€‚ å¦‚æœéœ€è¦ä¸Šä¸‹æ–‡ï¼Œåˆ™æ¨¡å‹æ–¹æ³•ä¹Ÿå°†å¹¶è¡Œè¿è¡Œã€‚</p>
<h3 id="å­—æ®µåç§°ä¸åŒ¹é…æ—¶ç»‘å®š"><a href="#å­—æ®µåç§°ä¸åŒ¹é…æ—¶ç»‘å®š" class="headerlink" title="å­—æ®µåç§°ä¸åŒ¹é…æ—¶ç»‘å®š"></a>å­—æ®µåç§°ä¸åŒ¹é…æ—¶ç»‘å®š</h3><p>å½“Goç»“æ„å’ŒgraphQLç±»å‹ä¸åŒ¹é…æ—¶ï¼Œå¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼ç»‘å®šåˆ°å­—æ®µã€‚</p>
<p>ç¬¬ä¸€ç§æ–¹æ³•æ˜¯å¯ä»¥å°†è§£æå™¨ç»‘å®šåˆ°åŸºäºstructæ ‡è®°çš„ç»“æ„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Car <span class="keyword">struct</span> &#123;</span><br><span class="line">    Make <span class="type">string</span></span><br><span class="line">    ShortState <span class="type">string</span></span><br><span class="line">    LongState <span class="type">string</span> <span class="string">`gqlgen:&quot;state&quot;`</span></span><br><span class="line">    Model <span class="type">string</span></span><br><span class="line">    Color <span class="type">string</span></span><br><span class="line">    OdometerReading <span class="type">int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨æ‚¨çš„graphQLæ¨¡å¼ä¸­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">type Car &#123;</span><br><span class="line">    make: String!</span><br><span class="line">    model: String!</span><br><span class="line">    state: String!</span><br><span class="line">    color: String!</span><br><span class="line">    odometerReading: Int!</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨gqlgené…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹è¡Œï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">struct_tag:</span> <span class="string">gqlgen</span></span><br><span class="line"></span><br><span class="line"><span class="attr">models:</span></span><br><span class="line">    <span class="attr">Car:</span></span><br><span class="line">        <span class="attr">model:</span> <span class="string">github.com/my/app/models.Car</span></span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼Œå³ä½¿graphQLç±»å‹å’ŒGoç»“æ„å…·æœ‰ä¸åŒçš„å­—æ®µåç§°ï¼Œåœ¨longStateä¸Šä¹Ÿä¼šæœ‰ä¸€ä¸ªGoç»“æ„æ ‡ç­¾å­—æ®µåŒ¹é…ï¼Œå› æ­¤stateå°†ç»‘å®šåˆ°LongStateã€‚</p>
<p>ç»‘å®šå­—æ®µçš„ç¬¬äºŒç§æ–¹æ³•æ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä¸€è¡Œï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Car <span class="keyword">struct</span> &#123;</span><br><span class="line">    Make <span class="type">string</span></span><br><span class="line">    ShortState <span class="type">string</span></span><br><span class="line">    LongState <span class="type">string</span></span><br><span class="line">    Model <span class="type">string</span></span><br><span class="line">    Color <span class="type">string</span></span><br><span class="line">    OdometerReading <span class="type">int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨æ‚¨çš„graphQLæ¨¡å¼ä¸­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">type Car &#123;</span><br><span class="line">    make: String!</span><br><span class="line">    model: String!</span><br><span class="line">    state: String!</span><br><span class="line">    color: String!</span><br><span class="line">    odometerReading: Int!</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨gqlgené…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹è¡Œï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">models:</span></span><br><span class="line">    <span class="attr">Car:</span></span><br><span class="line">        <span class="attr">model:</span> <span class="string">github.com/my/app/models.Car</span></span><br><span class="line">        <span class="attr">fields:</span></span><br><span class="line">            <span class="attr">state:</span></span><br><span class="line">                <span class="attr">fieldName:</span> <span class="string">LongState</span></span><br></pre></td></tr></table></figure>

<h3 id="ç»‘å®šåˆ°åŒ¿åæˆ–åµŒå…¥å¼ç»“æ„"><a href="#ç»‘å®šåˆ°åŒ¿åæˆ–åµŒå…¥å¼ç»“æ„" class="headerlink" title="ç»‘å®šåˆ°åŒ¿åæˆ–åµŒå…¥å¼ç»“æ„"></a>ç»‘å®šåˆ°åŒ¿åæˆ–åµŒå…¥å¼ç»“æ„</h3><p>ä¸Šé¢çš„æ‰€æœ‰è§„åˆ™éƒ½é€‚ç”¨äºå…·æœ‰åµŒå…¥å¼ç»“æ„çš„ç»“æ„ã€‚ è¿™æ˜¯ä¸€ä¸ªä¾‹å­</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Truck <span class="keyword">struct</span> &#123;</span><br><span class="line">    Car</span><br><span class="line"></span><br><span class="line">    Is4x4 <span class="type">bool</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Car <span class="keyword">struct</span> &#123;</span><br><span class="line">    Make <span class="type">string</span></span><br><span class="line">    ShortState <span class="type">string</span></span><br><span class="line">    LongState <span class="type">string</span></span><br><span class="line">    Model <span class="type">string</span></span><br><span class="line">    Color <span class="type">string</span></span><br><span class="line">    OdometerReading <span class="type">int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨æ‚¨çš„graphQLæ¨¡å¼ä¸­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">type Truck &#123;</span><br><span class="line">    make: String!</span><br><span class="line">    model: String!</span><br><span class="line">    state: String!</span><br><span class="line">    color: String!</span><br><span class="line">    odometerReading: Int!</span><br><span class="line">    is4x4: Bool!</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼Œæ¥è‡ªGo struct Carçš„æ‰€æœ‰å­—æ®µä»å°†ç»‘å®šåˆ°graphQLæ¨¡å¼ä¸­ä¸ä¹‹åŒ¹é…çš„å„ä¸ªå­—æ®µ</p>
<p>åµŒå…¥å¼ç»“æ„æ˜¯å›´ç»•æ•°æ®è®¿é—®ç±»å‹åˆ›å»ºç²¾ç®€åŒ…è£…çš„å¥½æ–¹æ³•ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Cat <span class="keyword">struct</span> &#123;</span><br><span class="line">    db.Cat</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Cat)</span></span> ID() <span class="type">string</span> &#123;</span><br><span class="line">    <span class="comment">// return a custom id based on the db shard and the cat&#x27;s id</span></span><br><span class="line">     <span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;%d:%d&quot;</span>, c.Shard, c.Id)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®ƒå°†ä¸ä»¥ä¸‹çš„gqlgené…ç½®æ–‡ä»¶ç›¸å…³ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">models:</span></span><br><span class="line">    <span class="attr">Cat:</span></span><br><span class="line">        <span class="attr">model:</span> <span class="string">github.com/my/app/models.Cat</span></span><br></pre></td></tr></table></figure>

<h3 id="ç»‘å®šä¼˜å…ˆ"><a href="#ç»‘å®šä¼˜å…ˆ" class="headerlink" title="ç»‘å®šä¼˜å…ˆ"></a>ç»‘å®šä¼˜å…ˆ</h3><p>å¦‚æœå­˜åœ¨struct_tagsé…ç½®ï¼Œåˆ™ç»“æ„æ ‡è®°ç»‘å®šçš„ä¼˜å…ˆçº§é«˜äºæ‰€æœ‰å…¶ä»–ç±»å‹çš„ç»‘å®šã€‚ åœ¨æ‰€æœ‰å…¶ä»–æƒ…å†µä¸‹ï¼Œæ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªä¸graphQL typeå­—æ®µåŒ¹é…çš„Go structå­—æ®µå°†æ˜¯ç»‘å®šçš„å­—æ®µã€‚</p>
<h2 id="4-12-æ ‡é‡"><a href="#4-12-æ ‡é‡" class="headerlink" title="4.12 æ ‡é‡"></a>4.12 æ ‡é‡</h2><p>å°†GraphQLæ ‡é‡ç±»å‹æ˜ å°„åˆ°Goç±»å‹</p>
<h3 id="å†…ç½®åŠ©æ‰‹"><a href="#å†…ç½®åŠ©æ‰‹" class="headerlink" title="å†…ç½®åŠ©æ‰‹"></a>å†…ç½®åŠ©æ‰‹</h3><p>gqlgené™„å¸¦äº†ä¸€äº›å†…ç½®çš„å¸®åŠ©ç¨‹åºï¼Œç”¨äºå¸¸è§çš„è‡ªå®šä¹‰æ ‡é‡ç”¨ä¾‹ï¼Œæ—¶é—´ï¼Œä»»æ„ï¼Œä¸Šè½½å’Œæ˜ å°„ã€‚ å°†ä»»ä½•è¿™äº›æ·»åŠ åˆ°æ¶æ„ä¸­å°†è‡ªåŠ¨å°†ç¼–ç»„è¡Œä¸ºæ·»åŠ åˆ°Goç±»å‹ã€‚</p>
<h4 id="Time"><a href="#Time" class="headerlink" title="Time"></a>Time</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scalar Time</span><br></pre></td></tr></table></figure>

<p>å°†Time GraphQLæ ‡é‡æ˜ å°„åˆ°Go time.Timeç»“æ„ã€‚</p>
<h4 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scalar Map</span><br></pre></td></tr></table></figure>

<p>å°†ä»»æ„GraphQLå€¼æ˜ å°„åˆ°map [string] interface {} Goç±»å‹ã€‚</p>
<h4 id="Upload"><a href="#Upload" class="headerlink" title="Upload"></a>Upload</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scalar Upload</span><br></pre></td></tr></table></figure>

<p>å°†Upload GraphQLæ ‡é‡æ˜ å°„åˆ°graphql.Uploadç»“æ„ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Upload <span class="keyword">struct</span> &#123;</span><br><span class="line">	File        io.Reader</span><br><span class="line">	Filename    <span class="type">string</span></span><br><span class="line">	Size        <span class="type">int64</span></span><br><span class="line">	ContentType <span class="type">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Any"><a href="#Any" class="headerlink" title="Any"></a>Any</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scalar Any</span><br></pre></td></tr></table></figure>

<p>å°†ä»»æ„GraphQLå€¼æ˜ å°„åˆ°interface {} Goç±»å‹ã€‚</p>
<h3 id="å…·æœ‰ç”¨æˆ·å®šä¹‰ç±»å‹çš„è‡ªå®šä¹‰æ ‡é‡"><a href="#å…·æœ‰ç”¨æˆ·å®šä¹‰ç±»å‹çš„è‡ªå®šä¹‰æ ‡é‡" class="headerlink" title="å…·æœ‰ç”¨æˆ·å®šä¹‰ç±»å‹çš„è‡ªå®šä¹‰æ ‡é‡"></a>å…·æœ‰ç”¨æˆ·å®šä¹‰ç±»å‹çš„è‡ªå®šä¹‰æ ‡é‡</h3><p>å¯¹äºç”¨æˆ·å®šä¹‰çš„ç±»å‹ï¼Œæ‚¨å¯ä»¥å®ç°graphql.Marshalerå’Œgraphql.Unmarshaleræ¥å£ï¼Œå®ƒä»¬å°†è¢«è°ƒç”¨ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mypkg</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;io&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> YesNo <span class="type">bool</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// UnmarshalGQL implements the graphql.Unmarshaler interface</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(y *YesNo)</span></span> UnmarshalGQL(v <span class="keyword">interface</span>&#123;&#125;) <span class="type">error</span> &#123;</span><br><span class="line">	yes, ok := v.(<span class="type">string</span>)</span><br><span class="line">	<span class="keyword">if</span> !ok &#123;</span><br><span class="line">		<span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;YesNo must be a string&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> yes == <span class="string">&quot;yes&quot;</span> &#123;</span><br><span class="line">		*y = <span class="literal">true</span></span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		*y = <span class="literal">false</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MarshalGQL implements the graphql.Marshaler interface</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(y YesNo)</span></span> MarshalGQL(w io.Writer) &#123;</span><br><span class="line">	<span class="keyword">if</span> y &#123;</span><br><span class="line">		w.Write([]<span class="type">byte</span>(<span class="string">`&quot;yes&quot;`</span>))</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		w.Write([]<span class="type">byte</span>(<span class="string">`&quot;no&quot;`</span>))</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨.gqlgen.ymlä¸­æˆ–é€šè¿‡åƒæ­£å¸¸çš„æŒ‡ä»¤è¿æ¥ç±»å‹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">models:</span></span><br><span class="line">  <span class="attr">YesNo:</span></span><br><span class="line">    <span class="attr">model:</span> <span class="string">github.com/me/mypkg.YesNo</span></span><br></pre></td></tr></table></figure>

<h3 id="å…·æœ‰ç¬¬ä¸‰æ–¹ç±»å‹çš„è‡ªå®šä¹‰æ ‡é‡"><a href="#å…·æœ‰ç¬¬ä¸‰æ–¹ç±»å‹çš„è‡ªå®šä¹‰æ ‡é‡" class="headerlink" title="å…·æœ‰ç¬¬ä¸‰æ–¹ç±»å‹çš„è‡ªå®šä¹‰æ ‡é‡"></a>å…·æœ‰ç¬¬ä¸‰æ–¹ç±»å‹çš„è‡ªå®šä¹‰æ ‡é‡</h3><p>æœ‰æ—¶æ‚¨æ— æ³•ä¸ºç±»å‹æ·»åŠ addæ–¹æ³•-ä¹Ÿè®¸æ‚¨ä¸æ‹¥æœ‰è¯¥ç±»å‹ï¼Œæˆ–è€…å®ƒæ˜¯æ ‡å‡†åº“çš„ä¸€éƒ¨åˆ†ï¼ˆä¾‹å¦‚ï¼Œå­—ç¬¦ä¸²æˆ–time.Timeï¼‰ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºä¸€ä¸ªå¤–éƒ¨å°é€å¤„ç†ç¨‹åºï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mypkg</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;io&quot;</span></span><br><span class="line">	<span class="string">&quot;strings&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/99designs/gqlgen/graphql&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">MarshalMyCustomBooleanScalar</span><span class="params">(b <span class="type">bool</span>)</span></span> graphql.Marshaler &#123;</span><br><span class="line">	<span class="keyword">return</span> graphql.WriterFunc(<span class="function"><span class="keyword">func</span><span class="params">(w io.Writer)</span></span> &#123;</span><br><span class="line">		<span class="keyword">if</span> b &#123;</span><br><span class="line">			w.Write([]<span class="type">byte</span>(<span class="string">&quot;true&quot;</span>))</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			w.Write([]<span class="type">byte</span>(<span class="string">&quot;false&quot;</span>))</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">UnmarshalMyCustomBooleanScalar</span><span class="params">(v <span class="keyword">interface</span>&#123;&#125;)</span></span> (<span class="type">bool</span>, <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="keyword">switch</span> v := v.(<span class="keyword">type</span>) &#123;</span><br><span class="line">	<span class="keyword">case</span> <span class="type">string</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;true&quot;</span> == strings.ToLower(v), <span class="literal">nil</span></span><br><span class="line">	<span class="keyword">case</span> <span class="type">int</span>:</span><br><span class="line">		<span class="keyword">return</span> v != <span class="number">0</span>, <span class="literal">nil</span></span><br><span class="line">	<span class="keyword">case</span> <span class="type">bool</span>:</span><br><span class="line">		<span class="keyword">return</span> v, <span class="literal">nil</span></span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>, fmt.Errorf(<span class="string">&quot;%T is not a bool&quot;</span>, v)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨.gqlgen.ymlä¸­æŒ‡å‘å‰é¢æ²¡æœ‰Marshal | Unmarshalçš„åç§°ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">models:</span></span><br><span class="line">  <span class="attr">MyCustomBooleanScalar:</span></span><br><span class="line">    <span class="attr">model:</span> <span class="string">github.com/me/mypkg.MyCustomBooleanScalar</span></span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„</strong>ï¼šæ‚¨ä¹Ÿå¯ä»¥é€šè¿‡è¿™ç§æ–¹æ³•å–æ¶ˆ&#x2F;ç¼–ç»„æŒ‡é’ˆç±»å‹ï¼Œåªéœ€åœ¨<code>Marshal ...</code> funcä¸­æ¥å—ä¸€ä¸ªæŒ‡é’ˆï¼Œç„¶ååœ¨<code>Unmarshal ...</code> funcä¸­è¿”å›ä¸€ä¸ªæŒ‡é’ˆã€‚</p>
<p>æœ‰å…³æ›´å¤šç¤ºä¾‹ï¼Œè¯·å‚è§<a href="example/scalars">example&#x2F;scalars</a>è½¯ä»¶åŒ…ã€‚</p>
<h3 id="è§£æé”™è¯¯"><a href="#è§£æé”™è¯¯" class="headerlink" title="è§£æé”™è¯¯"></a>è§£æé”™è¯¯</h3><p>ä½œä¸ºè‡ªå®šä¹‰æ ‡é‡è§£ç»„çš„ä¸€éƒ¨åˆ†è€Œå‘ç”Ÿçš„é”™è¯¯å°†è¿”å›è¯¥å­—æ®µçš„å®Œæ•´è·¯å¾„ã€‚ ä¾‹å¦‚ï¼Œç»™å®šä»¥ä¸‹æ¶æ„...</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">extend type Mutation&#123;</span><br><span class="line">    updateUser(userInput: UserInput!): User!</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">input UserInput &#123;</span><br><span class="line">    name: String!</span><br><span class="line">    primaryContactDetails: ContactDetailsInput!</span><br><span class="line">    secondaryContactDetails: ContactDetailsInput!</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">scalar Email</span><br><span class="line">input ContactDetailsInput &#123;</span><br><span class="line">    email: Email!</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>â€¦ä»¥åŠä»¥ä¸‹å˜é‡ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;userInput&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;George&quot;</span>,</span><br><span class="line">    <span class="string">&quot;primaryContactDetails&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;email&quot;</span>: <span class="string">&quot;not-an-email&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;secondaryContactDetails&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;email&quot;</span>: <span class="string">&quot;george@gmail.com&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>â€¦ä»¥åŠå–æ¶ˆæ•´ç†åŠŸèƒ½ï¼Œå¦‚æœç”µå­é‚®ä»¶æ— æ•ˆï¼Œè¯¥åŠŸèƒ½å°†è¿”å›é”™è¯¯ã€‚ å˜å¼‚å°†è¿”å›åŒ…å«å®Œæ•´è·¯å¾„çš„é”™è¯¯ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;email invalid&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;updateUser&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;userInput&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;primaryContactDetails&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;email&quot;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="4-13-æ¨¡å¼æŒ‡ä»¤"><a href="#4-13-æ¨¡å¼æŒ‡ä»¤" class="headerlink" title="4.13 æ¨¡å¼æŒ‡ä»¤"></a>4.13 æ¨¡å¼æŒ‡ä»¤</h2><p>ä½¿ç”¨æ¶æ„æŒ‡ä»¤å®æ–½æƒé™æ£€æŸ¥</p>
<p>æŒ‡ä»¤æœ‰ç‚¹åƒå…¶ä»–ä»»ä½•è¯­è¨€çš„æ³¨é‡Šã€‚ å®ƒä»¬ä¸ºæ‚¨æä¾›äº†ä¸€ç§æ— éœ€ç›´æ¥ç»‘å®šåˆ°å®ç°å³å¯æŒ‡å®šæŸäº›è¡Œä¸ºçš„æ–¹å¼ã€‚ è¿™å¯¹äºè¯¸å¦‚æƒé™æ£€æŸ¥ä¹‹ç±»çš„è·¨é¢†åŸŸé—®é¢˜éå¸¸æœ‰ç”¨ã€‚</p>
<p>æ³¨æ„ï¼šå½“å‰çš„æŒ‡ä»¤å®ç°ä»ç„¶ç›¸å½“æœ‰é™ï¼Œæ—¨åœ¨æ¶µç›–æœ€å¸¸è§çš„â€œç°åœºä¸­é—´ä»¶â€æƒ…å†µã€‚</p>
<h3 id="åœ¨schemaä¸­å£°æ˜"><a href="#åœ¨schemaä¸­å£°æ˜" class="headerlink" title="åœ¨schemaä¸­å£°æ˜"></a>åœ¨schemaä¸­å£°æ˜</h3><p>æŒ‡ä»¤ä¸æ‰€æœ‰å…¶ä»–ç±»å‹ä¸€èµ·åœ¨æ‚¨çš„æ¨¡å¼ä¸­å£°æ˜ã€‚ è®©æˆ‘ä»¬å®šä¹‰ä¸€ä¸ª@hasRoleæŒ‡ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">directive @hasRole(role: Role!) on FIELD_DEFINITION</span><br><span class="line"></span><br><span class="line">enum Role &#123;</span><br><span class="line">    ADMIN</span><br><span class="line">    USER</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸‹æ¬¡è¿è¡Œgo generateæ—¶ï¼Œgqlgenä¼šå°†æ­¤æŒ‡ä»¤æ·»åŠ åˆ°DirectiveRootä¸­</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">type DirectiveRoot struct &#123;</span><br><span class="line">	HasRole func(ctx context.Context, obj interface&#123;&#125;, next graphql.Resolver, role Role) (res interface&#123;&#125;, err error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å‚æ•°ä¸ºï¼š</p>
<ul>
<li>ctxï¼šçˆ¶ä¸Šä¸‹æ–‡</li>
<li>objï¼šåŒ…å«è¦åº”ç”¨çš„å€¼çš„å¯¹è±¡ï¼Œä¾‹å¦‚ï¼š<ul>
<li>å¯¹äºå­—æ®µå®šä¹‰æŒ‡ä»¤ï¼ŒåŒ…å«å­—æ®µçš„å¯¹è±¡&#x2F;è¾“å…¥å¯¹è±¡</li>
<li>å¯¹äºå‚æ•°æŒ‡ä»¤ï¼ŒåŒ…å«æ‰€æœ‰å‚æ•°çš„æ˜ å°„</li>
</ul>
</li>
<li>nextï¼šæŒ‡ä»¤é“¾ä¸­çš„ä¸‹ä¸€ä¸ªæŒ‡ä»¤ï¼Œæˆ–å­—æ®µè§£æå™¨ã€‚ åº”è¯¥è°ƒç”¨å®ƒä»¥è·å–å­—æ®µ&#x2F;å‚æ•°&#x2F;ä»»ä½•å€¼ã€‚ æ‚¨å¯ä»¥é€šè¿‡ä¸è°ƒç”¨ä¸‹ä¸€æ­¥è¿›è¡Œæƒé™æ£€æŸ¥ç­‰æ¥é˜»æ­¢å¯¹è¯¥å­—æ®µçš„è®¿é—®ã€‚</li>
<li>â€¦argsï¼šæŒ‡ä»¤çš„æ‰€æœ‰argsä¹Ÿå°†è¢«ä¼ å…¥ã€‚</li>
</ul>
<h3 id="åœ¨æ¨¡å¼ä¸­ä½¿ç”¨å®ƒ"><a href="#åœ¨æ¨¡å¼ä¸­ä½¿ç”¨å®ƒ" class="headerlink" title="åœ¨æ¨¡å¼ä¸­ä½¿ç”¨å®ƒ"></a>åœ¨æ¨¡å¼ä¸­ä½¿ç”¨å®ƒ</h3><p>æˆ‘ä»¬ç°åœ¨å¯ä»¥åœ¨ä»»ä½•å­—æ®µå®šä¹‰ä¸Šè°ƒç”¨å®ƒï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">type Mutation &#123;</span><br><span class="line">	deleteUser(userID: ID!): Bool @hasRole(role: ADMIN)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å®ç°æŒ‡ä»¤"><a href="#å®ç°æŒ‡ä»¤" class="headerlink" title="å®ç°æŒ‡ä»¤"></a>å®ç°æŒ‡ä»¤</h3><p>æœ€åï¼Œæˆ‘ä»¬éœ€è¦å®ç°æŒ‡ä»¤ï¼Œå¹¶åœ¨å¯åŠ¨æœåŠ¡å™¨æ—¶å°†å…¶ä¼ é€’ç»™å®ƒï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	c := Config&#123; Resolvers: &amp;resolvers&#123;&#125; &#125;</span><br><span class="line">	c.Directives.HasRole = <span class="function"><span class="keyword">func</span><span class="params">(ctx context.Context, obj <span class="keyword">interface</span>&#123;&#125;, next graphql.Resolver, role Role)</span></span> (<span class="keyword">interface</span>&#123;&#125;, <span class="type">error</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> !getCurrentUser(ctx).HasRole(role) &#123;</span><br><span class="line">			<span class="comment">// block calling the next resolver</span></span><br><span class="line">			<span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;Access denied&quot;</span>)</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// or let it pass through</span></span><br><span class="line">		<span class="keyword">return</span> next(ctx)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	http.Handle(<span class="string">&quot;/query&quot;</span>, handler.GraphQL(todo.NewExecutableSchema(c), ))</span><br><span class="line">	log.Fatal(http.ListenAndServe(<span class="string">&quot;:8081&quot;</span>, <span class="literal">nil</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="5-ç§˜ç¬ˆ"><a href="#5-ç§˜ç¬ˆ" class="headerlink" title="5.ç§˜ç¬ˆ"></a>5.ç§˜ç¬ˆ</h1><h2 id="5-1-Apollo"><a href="#5-1-Apollo" class="headerlink" title="5.1 Apollo"></a>5.1 Apollo</h2><p>åœ¨æ­¤å¿«é€ŸæŒ‡å—ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨gqlgenä¸­å®ç°ç¤ºä¾‹Apollo FederationæœåŠ¡å™¨ã€‚ æ‚¨å¯ä»¥åœ¨ç¤ºä¾‹ç›®å½•ä¸­æ‰¾åˆ°å®Œæˆçš„ç»“æœã€‚</p>
<h3 id="å¯ç”¨è”ç›Ÿ"><a href="#å¯ç”¨è”ç›Ÿ" class="headerlink" title="å¯ç”¨è”ç›Ÿ"></a>å¯ç”¨è”ç›Ÿ</h3><p>åœ¨æ‚¨çš„gqlgen.ymlä¸­å–æ¶ˆæ³¨é‡Šfederationé…ç½®</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Uncomment to enable federation</span></span><br><span class="line"><span class="attr">federation:</span></span><br><span class="line">  <span class="attr">filename:</span> <span class="string">graph/generated/federation.go</span></span><br><span class="line">  <span class="attr">package:</span> <span class="string">generated</span></span><br></pre></td></tr></table></figure>

<h3 id="åˆ›å»ºè”åˆæœåŠ¡å™¨"><a href="#åˆ›å»ºè”åˆæœåŠ¡å™¨" class="headerlink" title="åˆ›å»ºè”åˆæœåŠ¡å™¨"></a>åˆ›å»ºè”åˆæœåŠ¡å™¨</h3><p>å¯¹äºè¦è”åˆçš„æ¯ä¸ªæœåŠ¡å™¨ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæ–°çš„gqlgené¡¹ç›®ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go run github.com/99designs/gqlgen</span><br></pre></td></tr></table></figure>

<p>æ›´æ–°schemaååº”federatedç¤ºä¾‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">type Review &#123;</span><br><span class="line">  body: String</span><br><span class="line">  author: User @provides(fields: &quot;username&quot;)</span><br><span class="line">  product: Product</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">extend type User @key(fields: &quot;id&quot;) &#123;</span><br><span class="line">  id: ID! @external</span><br><span class="line">  reviews: [Review]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">extend type Product @key(fields: &quot;upc&quot;) &#123;</span><br><span class="line">  upc: String! @external</span><br><span class="line">  reviews: [Review]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”Ÿæˆ</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go run github.com/99designs/gqlgen</span><br></pre></td></tr></table></figure>

<p>ç„¶åå®ç°è§£æå™¨</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// These two methods are required for gqlgen to resolve the internal id-only wrapper structs.</span></span><br><span class="line"><span class="comment">// This boilerplate might be removed in a future version of gqlgen that can no-op id only nodes.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *entityResolver)</span></span> FindProductByUpc(ctx context.Context, upc <span class="type">string</span>) (*model.Product, <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;model.Product&#123;</span><br><span class="line">		Upc: upc,</span><br><span class="line">	&#125;, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *entityResolver)</span></span> FindUserByID(ctx context.Context, id <span class="type">string</span>) (*model.User, <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;model.User&#123;</span><br><span class="line">		ID: id,</span><br><span class="line">	&#125;, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Here we implement the stitched part of this service, returning reviews for a product. Of course normally you would</span></span><br><span class="line"><span class="comment">// go back to the database, but we are just making some data up here.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *productResolver)</span></span> Reviews(ctx context.Context, obj *model.Product) ([]*model.Review, <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="keyword">switch</span> obj.Upc &#123;</span><br><span class="line">	<span class="keyword">case</span> <span class="string">&quot;top-1&quot;</span>:</span><br><span class="line">		<span class="keyword">return</span> []*model.Review&#123;&#123;</span><br><span class="line">			Body: <span class="string">&quot;A highly effective form of birth control.&quot;</span>,</span><br><span class="line">		&#125;&#125;, <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">case</span> <span class="string">&quot;top-2&quot;</span>:</span><br><span class="line">		<span class="keyword">return</span> []*model.Review&#123;&#123;</span><br><span class="line">			Body: <span class="string">&quot;Fedoras are one of the most fashionable hats around and can look great with a variety of outfits.&quot;</span>,</span><br><span class="line">		&#125;&#125;, <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">case</span> <span class="string">&quot;top-3&quot;</span>:</span><br><span class="line">		<span class="keyword">return</span> []*model.Review&#123;&#123;</span><br><span class="line">			Body: <span class="string">&quot;This is the last straw. Hat you will wear. 11/10&quot;</span>,</span><br><span class="line">		&#125;&#125;, <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span>, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *userResolver)</span></span> Reviews(ctx context.Context, obj *model.User) ([]*model.Review, <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="keyword">if</span> obj.ID == <span class="string">&quot;1234&quot;</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> []*model.Review&#123;&#123;</span><br><span class="line">			Body: <span class="string">&quot;Has an odd fascination with hats.&quot;</span>,</span><br><span class="line">		&#125;&#125;, <span class="literal">nil</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span>, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºfederationç½‘å…³</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save @apollo/gateway apollo-server graphql</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">ApolloServer</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;apollo-server&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">ApolloGateway</span> &#125; = <span class="built_in">require</span>(<span class="string">&quot;@apollo/gateway&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> gateway = <span class="keyword">new</span> <span class="title class_">ApolloGateway</span>(&#123;</span><br><span class="line">    <span class="attr">serviceList</span>: [</span><br><span class="line">        &#123; <span class="attr">name</span>: <span class="string">&#x27;accounts&#x27;</span>, <span class="attr">url</span>: <span class="string">&#x27;http://localhost:4001/query&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">name</span>: <span class="string">&#x27;products&#x27;</span>, <span class="attr">url</span>: <span class="string">&#x27;http://localhost:4002/query&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">name</span>: <span class="string">&#x27;reviews&#x27;</span>, <span class="attr">url</span>: <span class="string">&#x27;http://localhost:4003/query&#x27;</span> &#125;</span><br><span class="line">    ],</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = <span class="keyword">new</span> <span class="title class_">ApolloServer</span>(&#123;</span><br><span class="line">    gateway,</span><br><span class="line"></span><br><span class="line">    <span class="attr">subscriptions</span>: <span class="literal">false</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>().<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; url &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`ğŸš€ Server ready at <span class="subst">$&#123;url&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="å¯åŠ¨æ‰€æœ‰æœåŠ¡"><a href="#å¯åŠ¨æ‰€æœ‰æœåŠ¡" class="headerlink" title="å¯åŠ¨æ‰€æœ‰æœåŠ¡"></a>å¯åŠ¨æ‰€æœ‰æœåŠ¡</h3><p>åœ¨å•ç‹¬çš„ç»ˆç«¯ä¸­ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">go run accounts/server.go</span><br><span class="line">go run products/server.go</span><br><span class="line">go run reviews/server.go</span><br><span class="line">node gateway/index.js</span><br></pre></td></tr></table></figure>

<p>æŸ¥è¯¢federatedç½‘å…³<br>apolloæ–‡æ¡£ä¸­çš„ç¤ºä¾‹éƒ½åº”è¯¥èµ·ä½œç”¨ï¼Œä¾‹å¦‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">query &#123;</span><br><span class="line">  me &#123;</span><br><span class="line">    username</span><br><span class="line">    reviews &#123;</span><br><span class="line">      body</span><br><span class="line">      product &#123;</span><br><span class="line">        name</span><br><span class="line">        upc</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿”å›</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;me&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Me&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;reviews&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;body&quot;</span><span class="punctuation">:</span> <span class="string">&quot;A highly effective form of birth control.&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;product&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Trilby&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;upc&quot;</span><span class="punctuation">:</span> <span class="string">&quot;top-1&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;body&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Fedoras are one of the most fashionable hats around and can look great with a variety of outfits.&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;product&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Trilby&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;upc&quot;</span><span class="punctuation">:</span> <span class="string">&quot;top-1&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="5-2-è®¤è¯æ–¹å¼"><a href="#5-2-è®¤è¯æ–¹å¼" class="headerlink" title="5.2 è®¤è¯æ–¹å¼"></a>5.2 è®¤è¯æ–¹å¼</h2><p>é€šè¿‡ä¸Šä¸‹æ–‡æä¾›èº«ä»½éªŒè¯è¯¦ç»†ä¿¡æ¯</p>
<p>æˆ‘ä»¬æœ‰ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œä½¿ç”¨HTTPè¯·æ±‚ä¸­çš„cookieå¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ï¼Œæˆ‘ä»¬æƒ³åœ¨å›¾å½¢ä¸­çš„æŸä¸ªä½ç½®æ£€æŸ¥æ­¤èº«ä»½éªŒè¯çŠ¶æ€ã€‚ ç”±äºGraphQLä¸ä¼ è¾“æ— å…³ï¼Œæˆ‘ä»¬æ— æ³•å‡è®¾ç”šè‡³ä¼šæœ‰HTTPè¯·æ±‚ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸­é—´ä»¶å°†è¿™äº›èº«ä»½éªŒè¯è¯¦ç»†ä¿¡æ¯å…¬å¼€ç»™æˆ‘ä»¬çš„graphã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> auth</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;database/sql&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// A private key for context that only this package can access. This is important</span></span><br><span class="line"><span class="comment">// to prevent collisions between different context uses</span></span><br><span class="line"><span class="keyword">var</span> userCtxKey = &amp;contextKey&#123;<span class="string">&quot;user&quot;</span>&#125;</span><br><span class="line"><span class="keyword">type</span> contextKey <span class="keyword">struct</span> &#123;</span><br><span class="line">	name <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// A stand-in for our database backed user object</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="type">string</span></span><br><span class="line">	IsAdmin <span class="type">bool</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Middleware decodes the share session cookie and packs the session into context</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Middleware</span><span class="params">(db *sql.DB)</span></span> <span class="function"><span class="keyword">func</span><span class="params">(http.Handler)</span></span> http.Handler &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(next http.Handler)</span></span> http.Handler &#123;</span><br><span class="line">		<span class="keyword">return</span> http.HandlerFunc(<span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">			c, err := r.Cookie(<span class="string">&quot;auth-cookie&quot;</span>)</span><br><span class="line"></span><br><span class="line">			<span class="comment">// Allow unauthenticated users in</span></span><br><span class="line">			<span class="keyword">if</span> err != <span class="literal">nil</span> || c == <span class="literal">nil</span> &#123;</span><br><span class="line">				next.ServeHTTP(w, r)</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			userId, err := validateAndGetUserID(c)</span><br><span class="line">			<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">				http.Error(w, <span class="string">&quot;Invalid cookie&quot;</span>, http.StatusForbidden)</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// get the user from the database</span></span><br><span class="line">			user := getUserByID(db, userId)</span><br><span class="line"></span><br><span class="line">			<span class="comment">// put it in context</span></span><br><span class="line">			ctx := context.WithValue(r.Context(), userCtxKey, user)</span><br><span class="line"></span><br><span class="line">			<span class="comment">// and call the next with our new context</span></span><br><span class="line">			r = r.WithContext(ctx)</span><br><span class="line">			next.ServeHTTP(w, r)</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ForContext finds the user from the context. REQUIRES Middleware to have run.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ForContext</span><span class="params">(ctx context.Context)</span></span> *User &#123;</span><br><span class="line">	raw, _ := ctx.Value(userCtxKey).(*User)</span><br><span class="line">	<span class="keyword">return</span> raw</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„</strong>ï¼š<code>getUserByID</code>å’Œ<code>validateAndGetUserID</code>å·²ç•™ç»™ç”¨æˆ·å®ç°ã€‚</p>
<p>ç°åœ¨ï¼Œå½“æˆ‘ä»¬åˆ›å»ºæœåŠ¡å™¨æ—¶ï¼Œåº”è¯¥å°†å…¶åŒ…è£…åœ¨èº«ä»½éªŒè¯ä¸­é—´ä»¶ä¸­ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/99designs/gqlgen/example/starwars&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/99designs/gqlgen/graphql/handler&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/99designs/gqlgen/graphql/playground&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/go-chi/chi&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	router := chi.NewRouter()</span><br><span class="line"></span><br><span class="line">	router.Use(auth.Middleware(db))</span><br><span class="line"></span><br><span class="line">    srv := handler.NewDefaultServer(starwars.NewExecutableSchema(starwars.NewResolver()))</span><br><span class="line">	router.Handle(<span class="string">&quot;/&quot;</span>, playground.Handler(<span class="string">&quot;Starwars&quot;</span>, <span class="string">&quot;/query&quot;</span>))</span><br><span class="line">	router.Handle(<span class="string">&quot;/query&quot;</span>, srv)</span><br><span class="line"></span><br><span class="line">	err := http.ListenAndServe(<span class="string">&quot;:8080&quot;</span>, router)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨æˆ‘ä»¬çš„è§£æå™¨ï¼ˆæˆ–æŒ‡ä»¤ï¼‰ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨ForContextæ¥å–å›æ•°æ®ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *queryResolver)</span></span> Hero(ctx context.Context, episode Episode) (Character, <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="keyword">if</span> user := auth.ForContext(ctx) ; user == <span class="literal">nil</span> || !user.IsAdmin &#123;</span><br><span class="line">		<span class="keyword">return</span> Character&#123;&#125;, fmt.Errorf(<span class="string">&quot;Access denied&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> episode == EpisodeEmpire &#123;</span><br><span class="line">		<span class="keyword">return</span> r.humans[<span class="string">&quot;1000&quot;</span>], <span class="literal">nil</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> r.droid[<span class="string">&quot;2001&quot;</span>], <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Websockets"><a href="#Websockets" class="headerlink" title="Websockets"></a>Websockets</h3><p>å¦‚æœæ‚¨éœ€è¦è®¿é—®websocketåˆå§‹åŒ–æœ‰æ•ˆè´Ÿè½½ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨WebsocketInitFuncæ‰§è¡Œç›¸åŒçš„æ“ä½œï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	router := chi.NewRouter()</span><br><span class="line"></span><br><span class="line">	router.Use(auth.Middleware(db))</span><br><span class="line"></span><br><span class="line">	router.Handle(<span class="string">&quot;/&quot;</span>, handler.Playground(<span class="string">&quot;Starwars&quot;</span>, <span class="string">&quot;/query&quot;</span>))</span><br><span class="line">	router.Handle(<span class="string">&quot;/query&quot;</span>,</span><br><span class="line">		handler.GraphQL(starwars.NewExecutableSchema(starwars.NewResolver())),</span><br><span class="line">		WebsocketInitFunc(<span class="function"><span class="keyword">func</span><span class="params">(ctx context.Context, initPayload InitPayload)</span></span> (context.Context, <span class="type">error</span>) &#123;</span><br><span class="line">			userId, err := validateAndGetUserID(payload[<span class="string">&quot;token&quot;</span>])</span><br><span class="line">			<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// get the user from the database</span></span><br><span class="line">			user := getUserByID(db, userId)</span><br><span class="line"></span><br><span class="line">			<span class="comment">// put it in context</span></span><br><span class="line">			userCtx := context.WithValue(r.Context(), userCtxKey, user)</span><br><span class="line"></span><br><span class="line">			<span class="comment">// and return it so the resolvers can see it</span></span><br><span class="line">			<span class="keyword">return</span> userCtx, <span class="literal">nil</span></span><br><span class="line">		&#125;))</span><br><span class="line">	)</span><br><span class="line"></span><br><span class="line">	err := http.ListenAndServe(<span class="string">&quot;:8080&quot;</span>, router)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„</p>
<p>è®¢é˜…çš„å¯¿å‘½å¾ˆé•¿ï¼Œå¦‚æœæ‚¨çš„ä»¤ç‰Œå¯èƒ½è¶…æ—¶æˆ–éœ€è¦åˆ·æ–°ï¼Œåˆ™æ‚¨ä¹Ÿåº”è¯¥å°†è¯¥ä»¤ç‰Œä¿ç•™åœ¨ä¸Šä¸‹æ–‡ä¸­ï¼Œå¹¶éªŒè¯å®ƒåœ¨auth.ForContextä¸­ä»ç„¶æœ‰æ•ˆã€‚</p>
<h2 id="5-3-CORS"><a href="#5-3-CORS" class="headerlink" title="5.3 CORS"></a>5.3 CORS</h2><p>ä½¿ç”¨rs&#x2F;corsä¸ºgqlgenè®¾ç½®CORSæ ‡å¤´</p>
<p>å½“æ‚¨çš„graphqlæœåŠ¡å™¨ä¸æä¾›å®¢æˆ·ç«¯ä»£ç çš„åŸŸä½äºä¸åŒçš„åŸŸæ—¶ï¼Œéœ€è¦è·¨åŸŸèµ„æºå…±äº«ï¼ˆCORSï¼‰æ ‡å¤´ã€‚ æ‚¨å¯ä»¥åœ¨MDNæ–‡æ¡£ä¸­é˜…è¯»æœ‰å…³CORSçš„æ›´å¤šä¿¡æ¯ã€‚</p>
<h3 id="rs-cors"><a href="#rs-cors" class="headerlink" title="rs&#x2F;cors"></a>rs&#x2F;cors</h3><p>gqlgenä¸åŒ…å«CORSå®æ–½ï¼Œä½†å¯ä»¥ä¸æ‰€æœ‰æ ‡å‡†çš„httpä¸­é—´ä»¶ä¸€èµ·ä½¿ç”¨ã€‚ åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å¥‡å¦™çš„<code>chi</code>å’Œ<code>rs/cors</code>æ¥æ„å»ºæœåŠ¡å™¨ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;net/http&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/99designs/gqlgen/graphql/handler/transport&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/99designs/gqlgen/example/starwars&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/99designs/gqlgen/graphql/handler&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/go-chi/chi&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/rs/cors&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	router := chi.NewRouter()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Add CORS middleware around every request</span></span><br><span class="line">	<span class="comment">// See https://github.com/rs/cors for full option listing</span></span><br><span class="line">	router.Use(cors.New(cors.Options&#123;</span><br><span class="line">		AllowedOrigins:   []<span class="type">string</span>&#123;<span class="string">&quot;http://localhost:8080&quot;</span>&#125;,</span><br><span class="line">		AllowCredentials: <span class="literal">true</span>,</span><br><span class="line">		Debug:            <span class="literal">true</span>,</span><br><span class="line">	&#125;).Handler)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    srv := handler.NewDefaultServer(starwars.NewExecutableSchema(starwars.NewResolver()))</span><br><span class="line">    srv.AddTransport(&amp;transport.Websocket&#123;</span><br><span class="line">        Upgrader: websocket.Upgrader&#123;</span><br><span class="line">            CheckOrigin: <span class="function"><span class="keyword">func</span><span class="params">(r *http.Request)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">                <span class="comment">// Check against your desired domains here</span></span><br><span class="line">                 <span class="keyword">return</span> r.Host == <span class="string">&quot;example.org&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            ReadBufferSize:  <span class="number">1024</span>,</span><br><span class="line">            WriteBufferSize: <span class="number">1024</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">	router.Handle(<span class="string">&quot;/&quot;</span>, handler.Playground(<span class="string">&quot;Starwars&quot;</span>, <span class="string">&quot;/query&quot;</span>))</span><br><span class="line">	router.Handle(<span class="string">&quot;/query&quot;</span>, srv)</span><br><span class="line"></span><br><span class="line">	err := http.ListenAndServe(<span class="string">&quot;:8080&quot;</span>, router)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-4-gin"><a href="#5-4-gin" class="headerlink" title="5.4 gin"></a>5.4 gin</h2><p>ä½¿ç”¨Ginè®¾ç½®HTTPå¤„ç†ç¨‹åº<br>Ginæ˜¯net&#x2F;httpè·¯ç”±å™¨çš„ç»ä½³æ›¿ä»£å“ã€‚ åœ¨ä»–ä»¬çš„å®˜æ–¹<a target="_blank" rel="noopener" href="https://github.com/gin-gonic/gin">GitHubé¡µé¢ä¸Š</a>ï¼š</p>
<p>Ginæ˜¯ç”¨Goï¼ˆGolangï¼‰ç¼–å†™çš„Webæ¡†æ¶ã€‚ å®ƒå…·æœ‰ç±»ä¼¼äºmartiniçš„APIï¼Œæ€§èƒ½æ›´é«˜ï¼Œç”±äºä½¿ç”¨äº†httprouterï¼Œé€Ÿåº¦æé«˜äº†40å€ã€‚ å¦‚æœæ‚¨éœ€è¦æ€§èƒ½å’Œè‰¯å¥½çš„ç”Ÿäº§åŠ›ï¼Œæ‚¨ä¼šå–œæ¬¢Ginçš„ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€èµ·è®¾ç½®Ginå’Œgqlgençš„æ­¥éª¤ï¼š</p>
<p>å®‰è£…ginï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">go get github.com/gin-gonic/gin</span></span><br></pre></td></tr></table></figure>

<p>åœ¨è·¯ç”±å™¨æ–‡ä»¶ä¸­ï¼Œä»¥ä¸¤ç§ä¸åŒçš„æ–¹æ³•å®šä¹‰GraphQLå’ŒPlaygroundç«¯ç‚¹çš„å¤„ç†ç¨‹åºï¼Œç„¶ååœ¨Ginè·¯ç”±å™¨ä¸­è¿›è¡Œç»‘å®šï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/99designs/gqlgen/graphql/handler&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/99designs/gqlgen/graphql/playground&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Defining the Graphql handler</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">graphqlHandler</span><span class="params">()</span></span> gin.HandlerFunc &#123;</span><br><span class="line">	<span class="comment">// NewExecutableSchema and Config are in the generated.go file</span></span><br><span class="line">	<span class="comment">// Resolver is in the resolver.go file</span></span><br><span class="line">	h := handler.NewDefaultServer(NewExecutableSchema(Config&#123;Resolvers: &amp;Resolver&#123;&#125;&#125;))</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		h.ServeHTTP(c.Writer, c.Request)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Defining the Playground handler</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">playgroundHandler</span><span class="params">()</span></span> gin.HandlerFunc &#123;</span><br><span class="line">	h := playground.Handler(<span class="string">&quot;GraphQL&quot;</span>, <span class="string">&quot;/query&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		h.ServeHTTP(c.Writer, c.Request)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// Setting up Gin</span></span><br><span class="line">	r := gin.Default()</span><br><span class="line">	r.POST(<span class="string">&quot;/query&quot;</span>, graphqlHandler())</span><br><span class="line">	r.GET(<span class="string">&quot;/&quot;</span>, playgroundHandler())</span><br><span class="line">	r.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="è®¿é—®gin-Context"><a href="#è®¿é—®gin-Context" class="headerlink" title="è®¿é—®gin.Context"></a>è®¿é—®gin.Context</h3><p>åœ¨è§£æç¨‹åºçº§åˆ«ï¼Œgqlgenä½¿æ‚¨å¯ä»¥è®¿é—®context.Contextå¯¹è±¡ã€‚ è®¿é—®gin.Contextçš„ä¸€ç§æ–¹æ³•æ˜¯å°†å…¶æ·»åŠ åˆ°ä¸Šä¸‹æ–‡ä¸­ï¼Œç„¶åå†æ¬¡æ£€ç´¢å®ƒã€‚</p>
<p>é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªginä¸­é—´ä»¶ä»¥å°†å…¶ä¸Šä¸‹æ–‡æ·»åŠ åˆ°ä¸Šä¸‹æ–‡ä¸­ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GinContextToContextMiddleware</span><span class="params">()</span></span> gin.HandlerFunc &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		ctx := context.WithValue(c.Request.Context(), <span class="string">&quot;GinContextKey&quot;</span>, c)</span><br><span class="line">		c.Request = c.Request.WithContext(ctx)</span><br><span class="line">		c.Next()</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è·¯ç”±å™¨å®šä¹‰ä¸­ï¼Œä½¿ç”¨ä¸­é—´ä»¶ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">r.Use(GinContextToContextMiddleware())</span><br></pre></td></tr></table></figure>

<p>å®šä¹‰ä¸€ä¸ªå‡½æ•°ä»¥ä»context.Contextç»“æ„ä¸­æ¢å¤gin.Contextï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GinContextFromContext</span><span class="params">(ctx context.Context)</span></span> (*gin.Context, <span class="type">error</span>) &#123;</span><br><span class="line">	ginContext := ctx.Value(<span class="string">&quot;GinContextKey&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> ginContext == <span class="literal">nil</span> &#123;</span><br><span class="line">		err := fmt.Errorf(<span class="string">&quot;could not retrieve gin.Context&quot;</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	gc, ok := ginContext.(*gin.Context)</span><br><span class="line">	<span class="keyword">if</span> !ok &#123;</span><br><span class="line">		err := fmt.Errorf(<span class="string">&quot;gin.Context has wrong type&quot;</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> gc, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åï¼Œåœ¨è§£æå™¨ä¸­ï¼Œä½¿ç”¨å…ˆå‰å®šä¹‰çš„å‡½æ•°æ£€ç´¢gin.Contextï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *resolver)</span></span> Todo(ctx context.Context) (*Todo, <span class="type">error</span>) &#123;</span><br><span class="line">	gc, err := GinContextFromContext(ctx)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="https://wangyyovo.github.io">Blank</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://wangyyovo.github.io/posts/1391286a/">https://wangyyovo.github.io/posts/1391286a/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº <a href="https://wangyyovo.github.io" target="_blank">Blank</a>ï¼</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/microservice/b45a976cf0d74608645a7327efbef5e5.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/4a325b27/" title="GraphQLæ­å»ºæœåŠ¡ç«¯API"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/microservice/0a9a446deb87fd5eabf61735b860d658.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">ä¸Šä¸€ç¯‡</div><div class="info-item-2">GraphQLæ­å»ºæœåŠ¡ç«¯API</div></div><div class="info-2"><div class="info-item-1"> GraphQLæ­å»ºæœåŠ¡ç«¯API graphqlåº“: github.com&#x2F;99designs&#x2F;gqlgen åŸºäºgqlgenåŠ å¯†ç‰ˆ: github.com&#x2F;vndocker&#x2F;encrypted-graphql ç½‘ç»œæ¡†æ¶: github.com&#x2F;gin-gonic&#x2F;gin golang: 1.15.2  é¡¹ç›®ç»“æ„1234567891011121314151617181920212223.â”œâ”€â”€ go.modâ”œâ”€â”€ go.sumâ”œâ”€â”€ gqlgen.ymlâ”œâ”€â”€ Dockerfileâ”œâ”€â”€ Makefileâ”œâ”€â”€ internalâ”‚   â”œâ”€â”€ authâ”‚   â”‚   â””â”€â”€ auth.goâ”‚   â”œâ”€â”€ bffâ”‚   â”‚   â””â”€â”€ bff.go              #ä»£ç ç”Ÿæˆâ”‚   â”œâ”€â”€ modelâ”‚   â”‚   â””â”€â”€ model.go			#ä»£ç ç”Ÿæˆ	â”‚   â”œâ”€â”€ resolverâ”‚   â”‚   â”œâ”€â”€ resolver.go			#ä»£ç ç”Ÿæˆâ”‚   â”‚   â””â”€â”€ server.resolvers.go ...</div></div></div></a><a class="pagination-related" href="/posts/260dbad6/" title="GraphQLæ–‡æ¡£"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/microservice/1975ab13a16d7203e5f79efb3e499123.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">ä¸‹ä¸€ç¯‡</div><div class="info-item-2">GraphQLæ–‡æ¡£</div></div><div class="info-2"><div class="info-item-1"> GraphQLæ–‡æ¡£ https://graphql.cn/learn/   GraphQL å…¥é—¨ åœ¨æ¥ä¸‹æ¥çš„ä¸€ç³»åˆ—æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä¼šäº†è§£ GraphQL æ˜¯ä»€ä¹ˆï¼Œå®ƒæ˜¯å¦‚ä½•è¿ä½œä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒã€‚åœ¨æ‰¾å¦‚ä½•æ­å»º GraphQL æœåŠ¡çš„æ–‡æ¡£ï¼Ÿè¿™æœ‰ä¸€äº›ç±»åº“å¯ä»¥å¸®ä½ ç”¨å¤šç§ä¸åŒè¯­è¨€å®ç° GraphQLã€‚é€šè¿‡å®ç”¨æ•™ç¨‹æ·±å…¥å­¦ä¹ ä½“éªŒï¼Œè¯·è®¿é—® How to GraphQL å…¨æ ˆæ•™ç¨‹ç½‘ç«™ã€‚æˆ‘ä»¬è¿˜ä¸ edX åˆä½œåˆ›å»ºäº†å…è´¹çš„åœ¨çº¿è¯¾ç¨‹ï¼Œæ¢ç´¢ GraphQLï¼šä¸€ç§ç”¨äº API çš„æŸ¥è¯¢è¯­è¨€ã€‚  GraphQL æ˜¯ä¸€ä¸ªç”¨äº API çš„æŸ¥è¯¢è¯­è¨€ï¼Œæ˜¯ä¸€ä¸ªä½¿ç”¨åŸºäºç±»å‹ç³»ç»Ÿæ¥æ‰§è¡ŒæŸ¥è¯¢çš„æœåŠ¡ç«¯è¿è¡Œæ—¶ï¼ˆç±»å‹ç³»ç»Ÿç”±ä½ çš„æ•°æ®å®šä¹‰ï¼‰ã€‚GraphQL å¹¶æ²¡æœ‰å’Œä»»ä½•ç‰¹å®šæ•°æ®åº“æˆ–è€…å­˜å‚¨å¼•æ“ç»‘å®šï¼Œè€Œæ˜¯ä¾é ä½ ç°æœ‰çš„ä»£ç å’Œæ•°æ®æ”¯æ’‘ã€‚ ä¸€ä¸ª GraphQL æœåŠ¡æ˜¯é€šè¿‡å®šä¹‰ç±»å‹å’Œç±»å‹ä¸Šçš„å­—æ®µæ¥åˆ›å»ºçš„ï¼Œç„¶åç»™æ¯ä¸ªç±»å‹ä¸Šçš„æ¯ä¸ªå­—æ®µæä¾›è§£æå‡½æ•°ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª GraphQL æœåŠ¡å‘Šè¯‰æˆ‘ä»¬å½“å‰ç™»å½•ç”¨æˆ·æ˜¯ meï¼Œè¿™ä¸ªç”¨æˆ·çš„åç§°å¯èƒ½åƒè¿™æ ·ï¼š 12345678type Query &#123;  me: User&#125;type User &#123;  id:...</div></div></div></a></nav><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/theme/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Blank</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">352</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">46</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">58</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>ä¸»é¢˜ GitHub</span></a><div class="card-info-social-icons"><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fas fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">1.ä»‹ç»</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFgqlgen%EF%BC%9F"><span class="toc-number">1.1.</span> <span class="toc-text">ä»€ä¹ˆæ˜¯gqlgenï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A5%E9%97%A8"><span class="toc-number">1.2.</span> <span class="toc-text">å…¥é—¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%A5%E5%91%8A%E9%97%AE%E9%A2%98"><span class="toc-number">1.3.</span> <span class="toc-text">æŠ¥å‘Šé—®é¢˜</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B4%A1%E7%8C%AE"><span class="toc-number">1.4.</span> <span class="toc-text">è´¡çŒ®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%8F%E5%B8%B8%E9%97%AE%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">1.5.</span> <span class="toc-text">ç»å¸¸é—®çš„é—®é¢˜</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E5%85%A5%E9%97%A8"><span class="toc-number">2.</span> <span class="toc-text">2.å…¥é—¨</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.1.</span> <span class="toc-text">åˆ›å»ºé¡¹ç›®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">2.2.</span> <span class="toc-text">æ„å»ºæœåŠ¡å™¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%BB%E9%BE%99%E7%82%B9%E7%9D%9B"><span class="toc-number">2.3.</span> <span class="toc-text">ç”»é¾™ç‚¹ç›</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E9%85%8D%E7%BD%AE"><span class="toc-number">3.</span> <span class="toc-text">3.é…ç½®</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%A6%E6%8C%87%E4%BB%A4%E7%9A%84%E5%86%85%E8%81%94%E9%85%8D%E7%BD%AE"><span class="toc-number">3.1.</span> <span class="toc-text">å¸¦æŒ‡ä»¤çš„å†…è”é…ç½®</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E5%8F%82%E8%80%83"><span class="toc-number">4.</span> <span class="toc-text">4.å‚è€ƒ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-APQ"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 APQ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%B3%95"><span class="toc-number">4.1.1.</span> <span class="toc-text">ç”¨æ³•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E5%8F%98%E6%9B%B4%E9%9B%86"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 å˜æ›´é›†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-%E6%95%B0%E6%8D%AE%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="toc-number">4.3.</span> <span class="toc-text">4.3 æ•°æ®åŠ è½½å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E8%A7%A3%E6%9E%90"><span class="toc-number">4.3.1.</span> <span class="toc-text">æŸ¥è¯¢è§£æ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-Dataloader"><span class="toc-number">4.4.</span> <span class="toc-text">4.4 Dataloader</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-5-%E5%AD%97%E6%AE%B5%E6%94%B6%E9%9B%86"><span class="toc-number">4.5.</span> <span class="toc-text">4.5 å­—æ®µæ”¶é›†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CollectAllFields"><span class="toc-number">4.5.1.</span> <span class="toc-text">CollectAllFields</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CollectFieldsCtx"><span class="toc-number">4.5.2.</span> <span class="toc-text">CollectFieldsCtx</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E4%BE%8B%E5%AD%90"><span class="toc-number">4.5.3.</span> <span class="toc-text">å®é™…ä¾‹å­</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-6-%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6"><span class="toc-number">4.6.</span> <span class="toc-text">4.6 ä¸Šä¼ æ–‡ä»¶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE"><span class="toc-number">4.6.1.</span> <span class="toc-text">é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B"><span class="toc-number">4.6.2.</span> <span class="toc-text">å®ä¾‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">4.6.2.1.</span> <span class="toc-text">å•æ–‡ä»¶ä¸Šä¼ </span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">4.6.2.2.</span> <span class="toc-text">å¤šæ–‡ä»¶ä¸Šä¼ </span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Apollo%E7%9A%84%E7%94%A8%E6%B3%95"><span class="toc-number">4.6.3.</span> <span class="toc-text">Apolloçš„ç”¨æ³•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-7-%E5%A4%84%E7%90%86%E9%94%99%E8%AF%AF"><span class="toc-number">4.7.</span> <span class="toc-text">4.7 å¤„ç†é”™è¯¯</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E9%94%99%E8%AF%AF"><span class="toc-number">4.7.1.</span> <span class="toc-text">è¿”å›é”™è¯¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%92%A9%E5%AD%90"><span class="toc-number">4.7.2.</span> <span class="toc-text">é’©å­</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-8-%E5%86%85%E7%9C%81"><span class="toc-number">4.8.</span> <span class="toc-text">4.8 å†…çœ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A6%81%E7%94%A8%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E8%87%AA%E7%9C%81"><span class="toc-number">4.8.1.</span> <span class="toc-text">ç¦ç”¨æœåŠ¡å™¨çš„è‡ªçœ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A6%81%E7%94%A8%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81%E7%9A%84%E8%87%AA%E7%9C%81"><span class="toc-number">4.8.2.</span> <span class="toc-text">ç¦ç”¨èº«ä»½éªŒè¯çš„è‡ªçœ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-9-%E6%8F%92%E4%BB%B6"><span class="toc-number">4.9.</span> <span class="toc-text">4.9 æ’ä»¶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%8F%92%E4%BB%B6"><span class="toc-number">4.9.1.</span> <span class="toc-text">ä½¿ç”¨æ’ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E6%8F%92%E4%BB%B6"><span class="toc-number">4.9.2.</span> <span class="toc-text">ç¼–å†™æ’ä»¶</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-10-%E6%9F%A5%E8%AF%A2%E5%A4%8D%E6%9D%82%E5%BA%A6"><span class="toc-number">4.10.</span> <span class="toc-text">4.10 æŸ¥è¯¢å¤æ‚åº¦</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E4%BB%B7%E9%AB%98%E7%9A%84%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.10.1.</span> <span class="toc-text">ä»£ä»·é«˜çš„æŸ¥è¯¢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%99%90%E5%88%B6%E6%9F%A5%E8%AF%A2%E5%A4%8D%E6%9D%82%E5%BA%A6"><span class="toc-number">4.10.2.</span> <span class="toc-text">é™åˆ¶æŸ¥è¯¢å¤æ‚åº¦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%A4%8D%E6%9D%82%E5%BA%A6%E8%AE%A1%E7%AE%97"><span class="toc-number">4.10.3.</span> <span class="toc-text">è‡ªå®šä¹‰å¤æ‚åº¦è®¡ç®—</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-11-%E8%A7%A3%E6%9E%90%E5%99%A8"><span class="toc-number">4.11.</span> <span class="toc-text">4.11 è§£æå™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E7%BB%91%E5%AE%9A%E5%88%B0%E7%BB%93%E6%9E%84%E5%AD%97%E6%AE%B5%E5%90%8D%E7%A7%B0"><span class="toc-number">4.11.1.</span> <span class="toc-text">ç›´æ¥ç»‘å®šåˆ°ç»“æ„å­—æ®µåç§°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%91%E5%AE%9A%E5%88%B0%E6%96%B9%E6%B3%95%E5%90%8D%E7%A7%B0"><span class="toc-number">4.11.2.</span> <span class="toc-text">ç»‘å®šåˆ°æ–¹æ³•åç§°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E6%AE%B5%E5%90%8D%E7%A7%B0%E4%B8%8D%E5%8C%B9%E9%85%8D%E6%97%B6%E7%BB%91%E5%AE%9A"><span class="toc-number">4.11.3.</span> <span class="toc-text">å­—æ®µåç§°ä¸åŒ¹é…æ—¶ç»‘å®š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%91%E5%AE%9A%E5%88%B0%E5%8C%BF%E5%90%8D%E6%88%96%E5%B5%8C%E5%85%A5%E5%BC%8F%E7%BB%93%E6%9E%84"><span class="toc-number">4.11.4.</span> <span class="toc-text">ç»‘å®šåˆ°åŒ¿åæˆ–åµŒå…¥å¼ç»“æ„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%91%E5%AE%9A%E4%BC%98%E5%85%88"><span class="toc-number">4.11.5.</span> <span class="toc-text">ç»‘å®šä¼˜å…ˆ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-12-%E6%A0%87%E9%87%8F"><span class="toc-number">4.12.</span> <span class="toc-text">4.12 æ ‡é‡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E7%BD%AE%E5%8A%A9%E6%89%8B"><span class="toc-number">4.12.1.</span> <span class="toc-text">å†…ç½®åŠ©æ‰‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Time"><span class="toc-number">4.12.1.1.</span> <span class="toc-text">Time</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Map"><span class="toc-number">4.12.1.2.</span> <span class="toc-text">Map</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Upload"><span class="toc-number">4.12.1.3.</span> <span class="toc-text">Upload</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Any"><span class="toc-number">4.12.1.4.</span> <span class="toc-text">Any</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B7%E6%9C%89%E7%94%A8%E6%88%B7%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%9E%8B%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%87%E9%87%8F"><span class="toc-number">4.12.2.</span> <span class="toc-text">å…·æœ‰ç”¨æˆ·å®šä¹‰ç±»å‹çš„è‡ªå®šä¹‰æ ‡é‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B7%E6%9C%89%E7%AC%AC%E4%B8%89%E6%96%B9%E7%B1%BB%E5%9E%8B%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%87%E9%87%8F"><span class="toc-number">4.12.3.</span> <span class="toc-text">å…·æœ‰ç¬¬ä¸‰æ–¹ç±»å‹çš„è‡ªå®šä¹‰æ ‡é‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E6%9E%90%E9%94%99%E8%AF%AF"><span class="toc-number">4.12.4.</span> <span class="toc-text">è§£æé”™è¯¯</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-13-%E6%A8%A1%E5%BC%8F%E6%8C%87%E4%BB%A4"><span class="toc-number">4.13.</span> <span class="toc-text">4.13 æ¨¡å¼æŒ‡ä»¤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8schema%E4%B8%AD%E5%A3%B0%E6%98%8E"><span class="toc-number">4.13.1.</span> <span class="toc-text">åœ¨schemaä¸­å£°æ˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E6%A8%A1%E5%BC%8F%E4%B8%AD%E4%BD%BF%E7%94%A8%E5%AE%83"><span class="toc-number">4.13.2.</span> <span class="toc-text">åœ¨æ¨¡å¼ä¸­ä½¿ç”¨å®ƒ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%8C%87%E4%BB%A4"><span class="toc-number">4.13.3.</span> <span class="toc-text">å®ç°æŒ‡ä»¤</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E7%A7%98%E7%AC%88"><span class="toc-number">5.</span> <span class="toc-text">5.ç§˜ç¬ˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-Apollo"><span class="toc-number">5.1.</span> <span class="toc-text">5.1 Apollo</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E7%94%A8%E8%81%94%E7%9B%9F"><span class="toc-number">5.1.1.</span> <span class="toc-text">å¯ç”¨è”ç›Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%81%94%E5%90%88%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">5.1.2.</span> <span class="toc-text">åˆ›å»ºè”åˆæœåŠ¡å™¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E6%89%80%E6%9C%89%E6%9C%8D%E5%8A%A1"><span class="toc-number">5.1.3.</span> <span class="toc-text">å¯åŠ¨æ‰€æœ‰æœåŠ¡</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-%E8%AE%A4%E8%AF%81%E6%96%B9%E5%BC%8F"><span class="toc-number">5.2.</span> <span class="toc-text">5.2 è®¤è¯æ–¹å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Websockets"><span class="toc-number">5.2.1.</span> <span class="toc-text">Websockets</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-CORS"><span class="toc-number">5.3.</span> <span class="toc-text">5.3 CORS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#rs-cors"><span class="toc-number">5.3.1.</span> <span class="toc-text">rs&#x2F;cors</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-4-gin"><span class="toc-number">5.4.</span> <span class="toc-text">5.4 gin</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AEgin-Context"><span class="toc-number">5.4.1.</span> <span class="toc-text">è®¿é—®gin.Context</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/d14168d/" title="è™šæ‹Ÿæœºé—®é¢˜åˆé›†"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/hexo/090cfe4e9e60b0ad0de05db822f3ae97.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="è™šæ‹Ÿæœºé—®é¢˜åˆé›†"/></a><div class="content"><a class="title" href="/posts/d14168d/" title="è™šæ‹Ÿæœºé—®é¢˜åˆé›†">è™šæ‹Ÿæœºé—®é¢˜åˆé›†</a><time datetime="2022-07-16T13:30:36.000Z" title="å‘è¡¨äº 2022-07-16 21:30:36">2022-07-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/f540045f/" title="ç”¨goè¯­è¨€ç¼–å†™ç§»åŠ¨ç«¯sdkå’Œappå¼€å‘"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/golang/941ed1ec2925719a0c92e76f4f786b6a.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ç”¨goè¯­è¨€ç¼–å†™ç§»åŠ¨ç«¯sdkå’Œappå¼€å‘"/></a><div class="content"><a class="title" href="/posts/f540045f/" title="ç”¨goè¯­è¨€ç¼–å†™ç§»åŠ¨ç«¯sdkå’Œappå¼€å‘">ç”¨goè¯­è¨€ç¼–å†™ç§»åŠ¨ç«¯sdkå’Œappå¼€å‘</a><time datetime="2022-07-04T12:14:21.000Z" title="å‘è¡¨äº 2022-07-04 20:14:21">2022-07-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/5faac006/" title="åœ¨çº¿ç¼–ç¨‹IDE"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/hexo/090cfe4e9e60b0ad0de05db822f3ae97.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="åœ¨çº¿ç¼–ç¨‹IDE"/></a><div class="content"><a class="title" href="/posts/5faac006/" title="åœ¨çº¿ç¼–ç¨‹IDE">åœ¨çº¿ç¼–ç¨‹IDE</a><time datetime="2022-06-12T13:30:36.000Z" title="å‘è¡¨äº 2022-06-12 21:30:36">2022-06-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/7594185d/" title="å³æ—¶æ€§èƒ½åˆ†æå·¥å…·Pyroscope"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/golang/3bfb3279740bc9a5b5ef436fa887ef07.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="å³æ—¶æ€§èƒ½åˆ†æå·¥å…·Pyroscope"/></a><div class="content"><a class="title" href="/posts/7594185d/" title="å³æ—¶æ€§èƒ½åˆ†æå·¥å…·Pyroscope">å³æ—¶æ€§èƒ½åˆ†æå·¥å…·Pyroscope</a><time datetime="2022-06-12T08:07:36.000Z" title="å‘è¡¨äº 2022-06-12 16:07:36">2022-06-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/82a7aa7c/" title="golangæ€§èƒ½è°ƒè¯•ä¼˜åŒ–æ–¹æ³•"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="golangæ€§èƒ½è°ƒè¯•ä¼˜åŒ–æ–¹æ³•"/></a><div class="content"><a class="title" href="/posts/82a7aa7c/" title="golangæ€§èƒ½è°ƒè¯•ä¼˜åŒ–æ–¹æ³•">golangæ€§èƒ½è°ƒè¯•ä¼˜åŒ–æ–¹æ³•</a><time datetime="2022-06-12T03:00:36.000Z" title="å‘è¡¨äº 2022-06-12 11:00:36">2022-06-12</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By Blank</span><span class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 5.4.2</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.3</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æ—¥é—´å’Œå¤œé—´æ¨¡å¼åˆ‡æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="translateLink" type="button" title="ç®€ç¹è½¬æ¢">ç¹</button><a id="to_comment" href="#post-comment" title="å‰å¾€è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = {"placeholder":"è¯´äº›ä»€ä¹ˆå§"}

  const initValine = (el, path) => {
    if (isShuoshuo) {
      window.shuoshuoComment.destroyValine = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    const valineConfig = {
      el: '#vcomment',
      appId: 'BSfgwCPLOvPHVPaSoBCGSENf-MdYXbMMI',
      appKey: '2Q8qq5060qxycL6FPL26LnMG',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      visitor: false,
      ...option,
      path: isShuoshuo ? path : (option && option.path) || window.location.pathname
    }

    new Valine(valineConfig)
  }

  const loadValine = async (el, path) => {
    if (typeof Valine === 'function') {
      initValine(el, path)
    } else {
      await btf.getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js')
      initValine(el, path)
    }
  }

  if (isShuoshuo) {
    'Valine' === 'Valine'
      ? window.shuoshuoComment = { loadComment: loadValine }
      : window.loadOtherComment = loadValine
    return
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  æ•°æ®åŠ è½½ä¸­</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>