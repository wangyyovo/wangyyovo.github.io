<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Etcdçš„ç®€å•ä½¿ç”¨ | Blank</title><meta name="author" content="Blank"><meta name="copyright" content="Blank"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="https:&#x2F;&#x2F;github.com&#x2F;etcd-io&#x2F;etcd&#x2F;releases  Etcdçš„ç®€å•ä½¿ç”¨API V2ä¸V3åŒºåˆ« äº‹åŠ¡ï¼šETCD V3æä¾›äº†å¤šé”®æ¡ä»¶äº‹åŠ¡ï¼ˆmulti-key conditional transactionsï¼‰ï¼Œåº”ç”¨å„ç§éœ€è¦ä½¿ç”¨äº‹åŠ¡ä»£æ›¿åŸæ¥çš„Compare-And-Swapæ“ä½œã€‚ å¹³é”®ç©ºé—´ï¼ˆFlat key spaceï¼‰ï¼šETCD V3ä¸å†ä½¿ç”¨ç›®å½•ç»“æ„ï¼Œåªä¿ç•™é”®ã€‚ä¾‹å¦‚">
<meta property="og:type" content="article">
<meta property="og:title" content="Etcdçš„ç®€å•ä½¿ç”¨">
<meta property="og:url" content="https://wangyyovo.github.io/posts/5baaccef/">
<meta property="og:site_name" content="Blank">
<meta property="og:description" content="https:&#x2F;&#x2F;github.com&#x2F;etcd-io&#x2F;etcd&#x2F;releases  Etcdçš„ç®€å•ä½¿ç”¨API V2ä¸V3åŒºåˆ« äº‹åŠ¡ï¼šETCD V3æä¾›äº†å¤šé”®æ¡ä»¶äº‹åŠ¡ï¼ˆmulti-key conditional transactionsï¼‰ï¼Œåº”ç”¨å„ç§éœ€è¦ä½¿ç”¨äº‹åŠ¡ä»£æ›¿åŸæ¥çš„Compare-And-Swapæ“ä½œã€‚ å¹³é”®ç©ºé—´ï¼ˆFlat key spaceï¼‰ï¼šETCD V3ä¸å†ä½¿ç”¨ç›®å½•ç»“æ„ï¼Œåªä¿ç•™é”®ã€‚ä¾‹å¦‚">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/etcd/85724a45f3babbdb451f3ef24d36a303.jpg">
<meta property="article:published_time" content="2019-10-31T08:00:36.000Z">
<meta property="article:modified_time" content="2019-10-31T08:00:36.000Z">
<meta property="article:author" content="Blank">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/etcd/85724a45f3babbdb451f3ef24d36a303.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Etcdçš„ç®€å•ä½¿ç”¨",
  "url": "https://wangyyovo.github.io/posts/5baaccef/",
  "image": "https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/etcd/85724a45f3babbdb451f3ef24d36a303.jpg",
  "datePublished": "2019-10-31T08:00:36.000Z",
  "dateModified": "2019-10-31T08:00:36.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Blank",
      "url": "https://wangyyovo.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/theme/favicon.ico"><link rel="canonical" href="https://wangyyovo.github.io/posts/5baaccef/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"æœªæ‰¾åˆ°ç¬¦åˆæ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}","hits_stats":"å…±æ‰¾åˆ° ${hits} ç¯‡æ–‡ç« "}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"ç¹","msgToSimplifiedChinese":"ç®€"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400,"highlightFullpage":true,"highlightMacStyle":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶å¤±è´¥',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: {"limitCount":150,"languages":{"author":"ä½œè€…: Blank","link":"é“¾æ¥: ","source":"æ¥æº: Blank","info":"è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚"}},
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Etcdçš„ç®€å•ä½¿ç”¨',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="alternate" href="/atom.xml" title="Blank" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/theme/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">352</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">46</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">58</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> ä¸»é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-comment-dots"></i><span> ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> å¨±ä¹</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> éŸ³ä¹</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> ç”µå½±</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-image"></i><span> ç›¸å†Œ</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-book"></i><span> æ•™ç¨‹</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/posts/21cfbf15/"><span> ğŸš€ å¿«é€Ÿé–‹å§‹</span></a></li><li><a class="site-page child" href="/posts/dc584b87/"><span> ğŸ“‘ ä¸»é¡Œé é¢</span></a></li><li><a class="site-page child" href="/posts/4aa8abbe/"><span> ğŸ›  ä¸»é¡Œé…ç½®</span></a></li><li><a class="site-page child" href="/posts/ceeb73f/"><span> âš”ï¸ æ¨™ç°½å¤–æŒ‚</span></a></li><li><a class="site-page child" href="/posts/98d20436/"><span> â“ ä¸»é¡Œå•ç­”</span></a></li><li><a class="site-page child" href="/posts/4073eda/"><span> âš¡ï¸ é€²éšæ•™ç¨‹</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-language"></i><span> è¯­è¨€</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/"><i class="fa-fw fas fa-c"></i><span> ä¸­æ–‡</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/etcd/85724a45f3babbdb451f3ef24d36a303.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Blank</span></a><a class="nav-page-title" href="/"><span class="site-name">Etcdçš„ç®€å•ä½¿ç”¨</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  è¿”å›é¦–é¡µ</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> ä¸»é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-comment-dots"></i><span> ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> å¨±ä¹</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> éŸ³ä¹</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> ç”µå½±</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-image"></i><span> ç›¸å†Œ</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-book"></i><span> æ•™ç¨‹</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/posts/21cfbf15/"><span> ğŸš€ å¿«é€Ÿé–‹å§‹</span></a></li><li><a class="site-page child" href="/posts/dc584b87/"><span> ğŸ“‘ ä¸»é¡Œé é¢</span></a></li><li><a class="site-page child" href="/posts/4aa8abbe/"><span> ğŸ›  ä¸»é¡Œé…ç½®</span></a></li><li><a class="site-page child" href="/posts/ceeb73f/"><span> âš”ï¸ æ¨™ç°½å¤–æŒ‚</span></a></li><li><a class="site-page child" href="/posts/98d20436/"><span> â“ ä¸»é¡Œå•ç­”</span></a></li><li><a class="site-page child" href="/posts/4073eda/"><span> âš¡ï¸ é€²éšæ•™ç¨‹</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-language"></i><span> è¯­è¨€</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/"><i class="fa-fw fas fa-c"></i><span> ä¸­æ–‡</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Etcdçš„ç®€å•ä½¿ç”¨</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2019-10-31T08:00:36.000Z" title="å‘è¡¨äº 2019-10-31 16:00:36">2019-10-31</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2019-10-31T08:00:36.000Z" title="æ›´æ–°äº 2019-10-31 16:00:36">2019-10-31</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/microservice/">microservice</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/microservice/etcd/">etcd</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">æ€»å­—æ•°:</span><span class="word-count">5.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>30åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">æµè§ˆé‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><script src="\assets\js\APlayer.min.js"> </script><blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/etcd-io/etcd/releases">https://github.com/etcd-io/etcd/releases</a></p>
</blockquote>
<h1 id="Etcdçš„ç®€å•ä½¿ç”¨"><a href="#Etcdçš„ç®€å•ä½¿ç”¨" class="headerlink" title="Etcdçš„ç®€å•ä½¿ç”¨"></a>Etcdçš„ç®€å•ä½¿ç”¨</h1><h2 id="API-V2ä¸V3åŒºåˆ«"><a href="#API-V2ä¸V3åŒºåˆ«" class="headerlink" title="API V2ä¸V3åŒºåˆ«"></a>API V2ä¸V3åŒºåˆ«</h2><ul>
<li>äº‹åŠ¡ï¼šETCD V3æä¾›äº†å¤šé”®æ¡ä»¶äº‹åŠ¡ï¼ˆmulti-key conditional transactionsï¼‰ï¼Œåº”ç”¨å„ç§éœ€è¦ä½¿ç”¨äº‹åŠ¡ä»£æ›¿åŸæ¥çš„Compare-And-Swapæ“ä½œã€‚</li>
<li>å¹³é”®ç©ºé—´ï¼ˆFlat key spaceï¼‰ï¼šETCD V3ä¸å†ä½¿ç”¨ç›®å½•ç»“æ„ï¼Œåªä¿ç•™é”®ã€‚ä¾‹å¦‚ï¼šâ€&#x2F;a&#x2F;b&#x2F;c&#x2F;â€œæ˜¯ä¸€ä¸ªé”®ï¼Œè€Œä¸æ˜¯ç›®å½•ã€‚V3ä¸­æä¾›äº†å‰ç¼€æŸ¥è¯¢ï¼Œæ¥è·å–ç¬¦åˆå‰ç¼€æ¡ä»¶çš„æ‰€æœ‰é”®å€¼ï¼Œè¿™å˜å‘å®ç°äº†V2ä¸­æŸ¥è¯¢ä¸€ä¸ªç›®å½•ä¸‹æ‰€æœ‰å­ç›®å½•å’ŒèŠ‚ç‚¹çš„åŠŸèƒ½ã€‚</li>
<li>ç®€æ´çš„å“åº”ï¼šåƒDELETEè¿™ç±»æ“ä½œæˆåŠŸåå°†ä¸å†è¿”å›æ“ä½œå‰çš„å€¼ã€‚å¦‚æœå¸Œæœ›è·å¾—åˆ é™¤å‰çš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨äº‹åŠ¡ï¼Œæ¥å®ç°ä¸€ä¸ªåŸå­æ“ä½œï¼Œå…ˆè·å–é”®å€¼ï¼Œç„¶åå†åˆ é™¤ã€‚</li>
<li>ç§Ÿçº¦ï¼šç§Ÿçº¦ä»£æ›¿äº†V2ä¸­çš„TTLå®ç°ï¼ŒTTLç»‘å®šåˆ°ä¸€ä¸ªç§Ÿçº¦ä¸Šï¼Œé”®å†é™„åŠ åˆ°è¿™ä¸ªç§Ÿçº¦ä¸Šã€‚å½“TTLè¿‡æœŸæ—¶ï¼Œç§Ÿçº¦å°†è¢«é”€æ¯ï¼ŒåŒæ—¶é™„åŠ åˆ°è¿™ä¸ªç§Ÿçº¦ä¸Šçš„é”®ä¹Ÿè¢«åˆ é™¤ã€‚</li>
</ul>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>æ‰‹åŠ¨å®‰è£…</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">WORKSPACE=/etcd</span><br><span class="line">ETCD_DIR=etcd</span><br><span class="line">ETCD_VER=v3.4.3</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">choose either URL</span></span><br><span class="line">GOOGLE_URL=https://storage.googleapis.com/etcd</span><br><span class="line">GITHUB_URL=https://github.com/etcd-io/etcd/releases/download</span><br><span class="line">DOWNLOAD_URL=$&#123;GOOGLE_URL&#125;</span><br><span class="line"></span><br><span class="line">rm -f $&#123;WORKSPACE&#125;/etcd-$&#123;ETCD_VER&#125;-linux-amd64.tar.gz</span><br><span class="line">rm -rf $&#123;WORKSPACE&#125;/$&#123;ETCD_DIR&#125; &amp;&amp; mkdir -p $&#123;WORKSPACE&#125;/$&#123;ETCD_DIR&#125;</span><br><span class="line"></span><br><span class="line">curl -L $&#123;DOWNLOAD_URL&#125;/$&#123;ETCD_VER&#125;/etcd-$&#123;ETCD_VER&#125;-linux-amd64.tar.gz -o $&#123;WORKSPACE&#125;/etcd-$&#123;ETCD_VER&#125;-linux-amd64.tar.gz</span><br><span class="line">tar xzvf $&#123;WORKSPACE&#125;/etcd-$&#123;ETCD_VER&#125;-linux-amd64.tar.gz -C $&#123;WORKSPACE&#125;/$&#123;ETCD_DIR&#125; --strip-components=1</span><br><span class="line">rm -f $&#123;WORKSPACE&#125;/etcd-$&#123;ETCD_VER&#125;-linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line">/etcd/etcd/etcd --version</span><br><span class="line">/etcd/etcd/etcdctl version</span><br></pre></td></tr></table></figure>

<p>éœ€è¦ç¿»å¢™</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">rm -rf /tmp/etcd-data.tmp &amp;&amp; mkdir -p /tmp/etcd-data.tmp &amp;&amp; \</span><br><span class="line">  docker rmi gcr.io/etcd-development/etcd:v3.4.3 || true &amp;&amp; \</span><br><span class="line">  docker run \</span><br><span class="line">  -p 2379:2379 \</span><br><span class="line">  -p 2380:2380 \</span><br><span class="line">  --mount type=bind,source=/tmp/etcd-data.tmp,destination=/etcd-data \</span><br><span class="line">  --name etcd-gcr-v3.4.3 \</span><br><span class="line">  gcr.io/etcd-development/etcd:v3.4.3 \</span><br><span class="line">  /usr/local/bin/etcd \</span><br><span class="line">  --name s1 \</span><br><span class="line">  --data-dir /etcd-data \</span><br><span class="line">  --listen-client-urls http://0.0.0.0:2379 \</span><br><span class="line">  --advertise-client-urls http://0.0.0.0:2379 \</span><br><span class="line">  --listen-peer-urls http://0.0.0.0:2380 \</span><br><span class="line">  --initial-advertise-peer-urls http://0.0.0.0:2380 \</span><br><span class="line">  --initial-cluster s1=http://0.0.0.0:2380 \</span><br><span class="line">  --initial-cluster-token tkn \</span><br><span class="line">  --initial-cluster-state new \</span><br><span class="line">  --log-level info \</span><br><span class="line">  --logger zap \</span><br><span class="line">  --log-outputs stderr</span><br><span class="line"></span><br><span class="line">docker exec etcd-gcr-v3.4.3 /bin/sh -c &quot;/usr/local/bin/etcd --version&quot;</span><br><span class="line">docker exec etcd-gcr-v3.4.3 /bin/sh -c &quot;/usr/local/bin/etcdctl version&quot;</span><br><span class="line">docker exec etcd-gcr-v3.4.3 /bin/sh -c &quot;/usr/local/bin/etcdctl endpoint health&quot;</span><br><span class="line">docker exec etcd-gcr-v3.4.3 /bin/sh -c &quot;/usr/local/bin/etcdctl put foo bar&quot;</span><br><span class="line">docker exec etcd-gcr-v3.4.3 /bin/sh -c &quot;/usr/local/bin/etcdctl get foo&quot;</span><br></pre></td></tr></table></figure>

<h2 id="ç®€å•è¯»å†™"><a href="#ç®€å•è¯»å†™" class="headerlink" title="ç®€å•è¯»å†™"></a>ç®€å•è¯»å†™</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">start a <span class="built_in">local</span> etcd server</span></span><br><span class="line">/etcd/etcd/etcd</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">write,<span class="built_in">read</span> to etcd</span></span><br><span class="line">/etcd/etcd/etcdctl --endpoints=localhost:2379 put foo bar</span><br><span class="line">/etcd/etcd/etcdctl --endpoints=localhost:2379 get foo</span><br></pre></td></tr></table></figure>

<h2 id="Etcdå¯è§†åŒ–å·¥å…·"><a href="#Etcdå¯è§†åŒ–å·¥å…·" class="headerlink" title="Etcdå¯è§†åŒ–å·¥å…·"></a>Etcdå¯è§†åŒ–å·¥å…·</h2><p><a target="_blank" rel="noopener" href="https://github.com/shiguanghuxian/etcd-manage">https://github.com/shiguanghuxian/etcd-manage</a> </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cd /etcd/</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸‹è½½</span></span><br><span class="line">wget https://github.com/shiguanghuxian/etcd-manage/releases/download/1.1.5/etcd-manage_linux_amd64.zip</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£å‹</span></span><br><span class="line">unzip etcd-manage_linux_amd64.zip</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é…ç½®</span></span><br><span class="line">vi ./config/cfg.toml</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿è¡Œ</span></span><br><span class="line">./etcd-manage</span><br></pre></td></tr></table></figure>

<h2 id="Etcdå•æœºå¯åŠ¨"><a href="#Etcdå•æœºå¯åŠ¨" class="headerlink" title="Etcdå•æœºå¯åŠ¨"></a>Etcdå•æœºå¯åŠ¨</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /etcd/etcdrun/data.etcd/</span><br><span class="line">mkdir -p /etcd/etcdrun/log/</span><br><span class="line">cd /etcd/etcdrun/</span><br><span class="line">/etcd/etcd/etcd  --data-dir ./data.etcd/  --listen-client-urls http://localhost:2379 --advertise-client-urls http://localhost:2379 &amp; &gt;./log/etcd.log</span><br></pre></td></tr></table></figure>

<ul>
<li><p>-listen-client-urls</p>
<p>ç”¨äºæŒ‡å®šetcdå’Œå®¢æˆ·ç«¯çš„è¿æ¥ç«¯å£</p>
</li>
<li><p>-advertise-client-urls</p>
<p>ç”¨äºæŒ‡å®šetcdæœåŠ¡å™¨ä¹‹é—´é€šè®¯çš„ç«¯å£</p>
</li>
</ul>
<p>etcdæœ‰è¦æ±‚ï¼Œå¦‚æœ-listen-client-urlsè¢«è®¾ç½®äº†ï¼Œé‚£ä¹ˆå°±å¿…é¡»åŒæ—¶è®¾ç½®-advertise-client-urlsï¼Œæ‰€ä»¥å³ä½¿è®¾ç½®å’Œé»˜è®¤ç›¸åŒï¼Œä¹Ÿå¿…é¡»æ˜¾å¼è®¾ç½®.</p>
<h2 id="Etcdå•æœºdocker-compose"><a href="#Etcdå•æœºdocker-compose" class="headerlink" title="Etcdå•æœºdocker-compose"></a>Etcdå•æœºdocker-compose</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">etcd:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">etcd-s1</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">quay.io/coreos/etcd:v3.5.12</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ETCD_NAME=etcd-s1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ETCD_DATA_DIR=/var/etcd</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ETCD_LISTEN_CLIENT_URLS=http://0.0.0.0:2379</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ETCD_ADVERTISE_CLIENT_URLS=http://0.0.0.0:2379</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ETCD_LISTEN_PEER_URLS=http://0.0.0.0:2380</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ETCD_INITIAL_ADVERTISE_PEER_URLS=http://0.0.0.0:2380</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ETCD_INITIAL_CLUSTER_TOKEN=etcd-cluster</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ETCD_INITIAL_CLUSTER=etcd-s1=http://0.0.0.0:2380</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ETCD_INITIAL_CLUSTER_STATE=new</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ETCD_LOGGER=zap</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ETCD_LOG_LeveL=info</span>      </span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/data/etcd:/var/etcd</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;/etc/localtime:/etc/localtime:ro&quot;</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">2379</span><span class="string">:2379</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">2380</span><span class="string">:2380</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">  <span class="attr">etcdkeeper:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">deltaprojects/etcdkeeper</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">etcdkeeper</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8088</span><span class="string">:8080</span></span><br></pre></td></tr></table></figure>





<h2 id="Etcdæ•°æ®æ“ä½œ"><a href="#Etcdæ•°æ®æ“ä½œ" class="headerlink" title="Etcdæ•°æ®æ“ä½œ"></a>Etcdæ•°æ®æ“ä½œ</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export ETCDCTL_API=3</span><br></pre></td></tr></table></figure>

<h3 id="etcdctlå‘½ä»¤"><a href="#etcdctlå‘½ä»¤" class="headerlink" title="etcdctlå‘½ä»¤"></a>etcdctlå‘½ä»¤</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">COMMANDS:</span><br><span class="line">        alarm disarm            Disarms all alarms</span><br><span class="line">        alarm list              Lists all alarms</span><br><span class="line">        auth disable            Disables authentication</span><br><span class="line">        auth enable             Enables authentication</span><br><span class="line">        check datascale         Check the memory usage of holding data for different workloads on a given server endpoint.</span><br><span class="line">        check perf              Check the performance of the etcd cluster</span><br><span class="line">        compaction              Compacts the event history in etcd</span><br><span class="line">        defrag                  Defragments the storage of the etcd members with given endpoints</span><br><span class="line">        del                     Removes the specified key or range of keys [key, range_end)</span><br><span class="line">        elect                   Observes and participates in leader election</span><br><span class="line">        endpoint hashkv         Prints the KV history hash for each endpoint in --endpoints</span><br><span class="line">        endpoint health         Checks the healthiness of endpoints specified in `--endpoints` flag</span><br><span class="line">        endpoint status         Prints out the status of endpoints specified in `--endpoints` flag</span><br><span class="line">        get                     Gets the key or a range of keys</span><br><span class="line">        help                    Help about any command</span><br><span class="line">        lease grant             Creates leases</span><br><span class="line">        lease keep-alive        Keeps leases alive (renew)</span><br><span class="line">        lease list              List all active leases</span><br><span class="line">        lease revoke            Revokes leases</span><br><span class="line">        lease timetolive        Get lease information</span><br><span class="line">        lock                    Acquires a named lock</span><br><span class="line">        make-mirror             Makes a mirror at the destination etcd cluster</span><br><span class="line">        member add              Adds a member into the cluster</span><br><span class="line">        member list             Lists all members in the cluster</span><br><span class="line">        member promote          Promotes a non-voting member in the cluster</span><br><span class="line">        member remove           Removes a member from the cluster</span><br><span class="line">        member update           Updates a member in the cluster</span><br><span class="line">        migrate                 Migrates keys in a v2 store to a mvcc store</span><br><span class="line">        move-leader             Transfers leadership to another etcd cluster member.</span><br><span class="line">        put                     Puts the given key into the store</span><br><span class="line">        role add                Adds a new role</span><br><span class="line">        role delete             Deletes a role</span><br><span class="line">        role get                Gets detailed information of a role</span><br><span class="line">        role grant-permission   Grants a key to a role</span><br><span class="line">        role list               Lists all roles</span><br><span class="line">        role revoke-permission  Revokes a key from a role</span><br><span class="line">        snapshot restore        Restores an etcd member snapshot to an etcd directory</span><br><span class="line">        snapshot save           Stores an etcd node backend snapshot to a given file</span><br><span class="line">        snapshot status         Gets backend snapshot status of a given file</span><br><span class="line">        txn                     Txn processes all the requests in one transaction</span><br><span class="line">        user add                Adds a new user</span><br><span class="line">        user delete             Deletes a user</span><br><span class="line">        user get                Gets detailed information of a user</span><br><span class="line">        user grant-role         Grants a role to a user</span><br><span class="line">        user list               Lists all users</span><br><span class="line">        user passwd             Changes password of user</span><br><span class="line">        user revoke-role        Revokes a role from a user</span><br><span class="line">        version                 Prints the version of etcdctl</span><br><span class="line">        watch                   Watches events stream on keys or prefixes</span><br><span class="line"></span><br><span class="line">OPTIONS:</span><br><span class="line">      --cacert=&quot;&quot;                               verify certificates of TLS-enabled secure servers using this CA bundle</span><br><span class="line">      --cert=&quot;&quot;                                 identify secure client using this TLS certificate file</span><br><span class="line">      --command-timeout=5s                      timeout for short running command (excluding dial timeout)</span><br><span class="line">      --debug[=false]                           enable client-side debug logging</span><br><span class="line">      --dial-timeout=2s                         dial timeout for client connections</span><br><span class="line">  -d, --discovery-srv=&quot;&quot;                        domain name to query for SRV records describing cluster endpoints</span><br><span class="line">      --discovery-srv-name=&quot;&quot;                   service name to query when using DNS discovery</span><br><span class="line">      --endpoints=[127.0.0.1:2379]              gRPC endpoints</span><br><span class="line">  -h, --help[=false]                            help for etcdctl</span><br><span class="line">      --hex[=false]                             print byte strings as hex encoded strings</span><br><span class="line">      --insecure-discovery[=true]               accept insecure SRV records describing cluster endpoints</span><br><span class="line">      --insecure-skip-tls-verify[=false]        skip server certificate verification</span><br><span class="line">      --insecure-transport[=true]               disable transport security for client connections</span><br><span class="line">      --keepalive-time=2s                       keepalive time for client connections</span><br><span class="line">      --keepalive-timeout=6s                    keepalive timeout for client connections</span><br><span class="line">      --key=&quot;&quot;                                  identify secure client using this TLS key file</span><br><span class="line">      --password=&quot;&quot;                             password for authentication (if this option is used, --user option shouldn&#x27;t include password)</span><br><span class="line">      --user=&quot;&quot;                                 username[:password] for authentication (prompt if password is not supplied)</span><br><span class="line">  -w, --write-out=&quot;simple&quot;                      set the output format (fields, json, protobuf, simple, table)</span><br></pre></td></tr></table></figure>



<h3 id="è®¾ç½®ã€æ›´æ–°key"><a href="#è®¾ç½®ã€æ›´æ–°key" class="headerlink" title="è®¾ç½®ã€æ›´æ–°key"></a>è®¾ç½®ã€æ›´æ–°key</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½®</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">/etcd/etcd/etcdctl --endpoints=localhost:2379 put /test/1 <span class="string">&quot;Hello world1&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ›´æ–°</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">/etcd/etcd/etcdctl --endpoints=localhost:2379 put /test/1 <span class="string">&quot;Hello world2&quot;</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="è·å–key"><a href="#è·å–key" class="headerlink" title="è·å–key"></a>è·å–key</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">/etcd/etcd/etcdctl --endpoints=localhost:2379 get /test/1</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åŒ¹é…å‰ç¼€æŸ¥è¯¢</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">/etcd/etcd/etcdctl --endpoints=localhost:2379 get /test --prefix</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">/etcd/etcd/etcdctl --endpoints=localhost:2379 --write-out=<span class="string">&quot;json&quot;</span> get /test/1</span></span><br></pre></td></tr></table></figure>

<h3 id="åˆ é™¤key"><a href="#åˆ é™¤key" class="headerlink" title="åˆ é™¤key"></a>åˆ é™¤key</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">/etcd/etcd/etcdctl --endpoints=localhost:2379 del /test/1</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åŒ¹é…å‰ç¼€åˆ é™¤</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">/etcd/etcd/etcdctl --endpoints=localhost:2379 del /test --prefix</span></span><br></pre></td></tr></table></figure>

<h3 id="ç›‘å¬ä¸€ä¸ªkey"><a href="#ç›‘å¬ä¸€ä¸ªkey" class="headerlink" title="ç›‘å¬ä¸€ä¸ªkey"></a>ç›‘å¬ä¸€ä¸ªkey</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">/etcd/etcd/etcdctl --endpoints=localhost:2379 watch /test/1</span></span><br></pre></td></tr></table></figure>

<h3 id="ç”³è¯·ç§Ÿçº¦"><a href="#ç”³è¯·ç§Ÿçº¦" class="headerlink" title="ç”³è¯·ç§Ÿçº¦"></a>ç”³è¯·ç§Ÿçº¦</h3><p>ä»ç”³è¯·å¼€å§‹è®¡ç®—æ—¶é—´</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">/etcd/etcd/etcdctl --endpoints=localhost:2379 lease grant 100</span></span><br><span class="line">lease 694d680edbc7579e granted with TTL(100s)</span><br></pre></td></tr></table></figure>

<h3 id="æˆæƒç§Ÿçº¦"><a href="#æˆæƒç§Ÿçº¦" class="headerlink" title="æˆæƒç§Ÿçº¦"></a>æˆæƒç§Ÿçº¦</h3><p>èŠ‚ç‚¹çš„ç”Ÿå‘½ä¼´éšç€ç§Ÿçº¦åˆ°æœŸå°†ä¼šè¢«åˆ é™¤</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">/etcd/etcd/etcdctl --endpoints=localhost:2379 put --lease=694d680edbc7579e /key/1 1</span></span><br></pre></td></tr></table></figure>

<h3 id="ç§Ÿçº¦ç»­çº¦"><a href="#ç§Ÿçº¦ç»­çº¦" class="headerlink" title="ç§Ÿçº¦ç»­çº¦"></a>ç§Ÿçº¦ç»­çº¦</h3><p>æ¯å½“åˆ°æœŸå°†ä¼šç»­çº¦</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">/etcd/etcd/etcdctl --endpoints=localhost:2379 lease grant 100</span></span><br><span class="line">lease 694d680edbc757a2 granted with TTL(100s)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">/etcd/etcd/etcdctl --endpoints=localhost:2379 lease keep-alive 694d680edbc757a2</span></span><br><span class="line">lease 694d680edbc757a2 keepalived with TTL(100)</span><br><span class="line">lease 694d680edbc757a2 keepalived with TTL(100)</span><br><span class="line">lease 694d680edbc757a2 keepalived with TTL(100)</span><br></pre></td></tr></table></figure>



<h3 id="é›†ç¾¤"><a href="#é›†ç¾¤" class="headerlink" title="é›†ç¾¤"></a>é›†ç¾¤</h3><p>æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">/etcd/etcd/etcdctl member list</span></span><br><span class="line">8e9e05c52164694d, started, default, http://localhost:2380, http://localhost:2379, false</span><br></pre></td></tr></table></figure>

<p>åˆ é™¤é›†ç¾¤ä¸­å­˜åœ¨çš„èŠ‚ç‚¹</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">/etcd/etcd/etcdctl member remove 8e9e05c52164694d</span></span><br></pre></td></tr></table></figure>

<p> å‘é›†ç¾¤ä¸­æ–°åŠ èŠ‚ç‚¹</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">/etcd/etcd/etcdctl member add etcd3 http://192.168.1.100:2380</span></span><br></pre></td></tr></table></figure>

<p> æ›´æ–°é›†ç¾¤ä¸­èŠ‚ç‚¹</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">/etcd/etcd/etcdctl member update 8e9e05c52164694d</span></span><br></pre></td></tr></table></figure>

<p>æå‡é›†ç¾¤ä¸­èŠ‚ç‚¹</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">/etcd/etcd/etcdctl member promote 8e9e05c52164694d</span></span><br></pre></td></tr></table></figure>



<h3 id="å¤‡ä»½å’Œæ¢å¤"><a href="#å¤‡ä»½å’Œæ¢å¤" class="headerlink" title="å¤‡ä»½å’Œæ¢å¤"></a>å¤‡ä»½å’Œæ¢å¤</h3><p>å¤‡ä»½</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">/etcd/etcd/etcdctl snapshot save backup.db</span></span><br></pre></td></tr></table></figure>

<p> æŸ¥çœ‹å¤‡ä»½æ–‡ä»¶ä¿¡æ¯ </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">/etcd/etcd/etcdctl --write-out=table snapshot status backup.db</span></span><br></pre></td></tr></table></figure>

<p>æ¢å¤</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">etcdctl snapshot restore backup.db \  </span><br><span class="line">-name etcd1 \ </span><br><span class="line">-initialcluster etcd1=https://192.168.2.10:2380,etcd2=https://192.168.2.11:2380,etcd3=https://192.168.2.12:2380 \</span><br><span class="line">-initial-cluster-token etcd-cluster-0 \</span><br><span class="line">--initial-advertise-peer-urls https://192.168.2.10:2380</span><br></pre></td></tr></table></figure>





<h3 id="etcdå‘½ä»¤"><a href="#etcdå‘½ä»¤" class="headerlink" title="etcdå‘½ä»¤"></a>etcdå‘½ä»¤</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br></pre></td><td class="code"><pre><span class="line">Usage:</span><br><span class="line"></span><br><span class="line">  etcd [flags]</span><br><span class="line">    Start an etcd server.</span><br><span class="line"></span><br><span class="line">  etcd --version</span><br><span class="line">    Show the version of etcd.</span><br><span class="line"></span><br><span class="line">  etcd -h | --help</span><br><span class="line">    Show the help information about etcd.</span><br><span class="line"></span><br><span class="line">  etcd --config-file</span><br><span class="line">    Path to the server configuration file. Note that if a configuration file is provided, other command line flags and environment variables will be ignored.</span><br><span class="line"></span><br><span class="line">  etcd gateway</span><br><span class="line">    Run the stateless pass-through etcd TCP connection forwarding proxy.</span><br><span class="line"></span><br><span class="line">  etcd grpc-proxy</span><br><span class="line">    Run the stateless etcd v3 gRPC L7 reverse proxy.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Member:</span><br><span class="line">  --name &#x27;default&#x27;</span><br><span class="line">    Human-readable name for this member.</span><br><span class="line">  --data-dir &#x27;$&#123;name&#125;.etcd&#x27;</span><br><span class="line">    Path to the data directory.</span><br><span class="line">  --wal-dir &#x27;&#x27;</span><br><span class="line">    Path to the dedicated wal directory.</span><br><span class="line">  --snapshot-count &#x27;100000&#x27;</span><br><span class="line">    Number of committed transactions to trigger a snapshot to disk.</span><br><span class="line">  --heartbeat-interval &#x27;100&#x27;</span><br><span class="line">    Time (in milliseconds) of a heartbeat interval.</span><br><span class="line">  --election-timeout &#x27;1000&#x27;</span><br><span class="line">    Time (in milliseconds) for an election to timeout. See tuning documentation for details.</span><br><span class="line">  --initial-election-tick-advance &#x27;true&#x27;</span><br><span class="line">    Whether to fast-forward initial election ticks on boot for faster election.</span><br><span class="line">  --listen-peer-urls &#x27;http://localhost:2380&#x27;</span><br><span class="line">    List of URLs to listen on for peer traffic.</span><br><span class="line">  --listen-client-urls &#x27;http://localhost:2379&#x27;</span><br><span class="line">    List of URLs to listen on for client traffic.</span><br><span class="line">  --max-snapshots &#x27;5&#x27;</span><br><span class="line">    Maximum number of snapshot files to retain (0 is unlimited).</span><br><span class="line">  --max-wals &#x27;5&#x27;</span><br><span class="line">    Maximum number of wal files to retain (0 is unlimited).</span><br><span class="line">  --quota-backend-bytes &#x27;0&#x27;</span><br><span class="line">    Raise alarms when backend size exceeds the given quota (0 defaults to low space quota).</span><br><span class="line">  --backend-batch-interval &#x27;&#x27;</span><br><span class="line">    BackendBatchInterval is the maximum time before commit the backend transaction.</span><br><span class="line">  --backend-batch-limit &#x27;0&#x27;</span><br><span class="line">    BackendBatchLimit is the maximum operations before commit the backend transaction.</span><br><span class="line">  --max-txn-ops &#x27;128&#x27;</span><br><span class="line">    Maximum number of operations permitted in a transaction.</span><br><span class="line">  --max-request-bytes &#x27;1572864&#x27;</span><br><span class="line">    Maximum client request size in bytes the server will accept.</span><br><span class="line">  --grpc-keepalive-min-time &#x27;5s&#x27;</span><br><span class="line">    Minimum duration interval that a client should wait before pinging server.</span><br><span class="line">  --grpc-keepalive-interval &#x27;2h&#x27;</span><br><span class="line">    Frequency duration of server-to-client ping to check if a connection is alive (0 to disable).</span><br><span class="line">  --grpc-keepalive-timeout &#x27;20s&#x27;</span><br><span class="line">    Additional duration of wait before closing a non-responsive connection (0 to disable).</span><br><span class="line"></span><br><span class="line">Clustering:</span><br><span class="line">  --initial-advertise-peer-urls &#x27;http://localhost:2380&#x27;</span><br><span class="line">    List of this member&#x27;s peer URLs to advertise to the rest of the cluster.</span><br><span class="line">  --initial-cluster &#x27;default=http://localhost:2380&#x27;</span><br><span class="line">    Initial cluster configuration for bootstrapping.</span><br><span class="line">  --initial-cluster-state &#x27;new&#x27;</span><br><span class="line">    Initial cluster state (&#x27;new&#x27; or &#x27;existing&#x27;).</span><br><span class="line">  --initial-cluster-token &#x27;etcd-cluster&#x27;</span><br><span class="line">    Initial cluster token for the etcd cluster during bootstrap.</span><br><span class="line">    Specifying this can protect you from unintended cross-cluster interaction when running multiple clusters.</span><br><span class="line">  --advertise-client-urls &#x27;http://localhost:2379&#x27;</span><br><span class="line">    List of this member&#x27;s client URLs to advertise to the public.</span><br><span class="line">    The client URLs advertised should be accessible to machines that talk to etcd cluster. etcd client libraries parse these URLs to connect to the cluster.</span><br><span class="line">  --discovery &#x27;&#x27;</span><br><span class="line">    Discovery URL used to bootstrap the cluster.</span><br><span class="line">  --discovery-fallback &#x27;proxy&#x27;</span><br><span class="line">    Expected behavior (&#x27;exit&#x27; or &#x27;proxy&#x27;) when discovery services fails.</span><br><span class="line">    &quot;proxy&quot; supports v2 API only.</span><br><span class="line">  --discovery-proxy &#x27;&#x27;</span><br><span class="line">    HTTP proxy to use for traffic to discovery service.</span><br><span class="line">  --discovery-srv &#x27;&#x27;</span><br><span class="line">    DNS srv domain used to bootstrap the cluster.</span><br><span class="line">  --discovery-srv-name &#x27;&#x27;</span><br><span class="line">    Suffix to the dns srv name queried when bootstrapping.</span><br><span class="line">  --strict-reconfig-check &#x27;true&#x27;</span><br><span class="line">    Reject reconfiguration requests that would cause quorum loss.</span><br><span class="line">  --pre-vote &#x27;false&#x27;</span><br><span class="line">    Enable to run an additional Raft election phase.</span><br><span class="line">  --auto-compaction-retention &#x27;0&#x27;</span><br><span class="line">    Auto compaction retention length. 0 means disable auto compaction.</span><br><span class="line">  --auto-compaction-mode &#x27;periodic&#x27;</span><br><span class="line">    Interpret &#x27;auto-compaction-retention&#x27; one of: periodic|revision. &#x27;periodic&#x27; for duration based retention, defaulting to hours if no time unit is provided (e.g. &#x27;5m&#x27;). &#x27;revision&#x27; for revision number based retention.</span><br><span class="line">  --enable-v2 &#x27;false&#x27;</span><br><span class="line">    Accept etcd V2 client requests.</span><br><span class="line"></span><br><span class="line">Security:</span><br><span class="line">  --cert-file &#x27;&#x27;</span><br><span class="line">    Path to the client server TLS cert file.</span><br><span class="line">  --key-file &#x27;&#x27;</span><br><span class="line">    Path to the client server TLS key file.</span><br><span class="line">  --client-cert-auth &#x27;false&#x27;</span><br><span class="line">    Enable client cert authentication.</span><br><span class="line">  --client-crl-file &#x27;&#x27;</span><br><span class="line">    Path to the client certificate revocation list file.</span><br><span class="line">  --client-cert-allowed-hostname &#x27;&#x27;</span><br><span class="line">    Allowed TLS hostname for client cert authentication.</span><br><span class="line">  --trusted-ca-file &#x27;&#x27;</span><br><span class="line">    Path to the client server TLS trusted CA cert file.</span><br><span class="line">  --auto-tls &#x27;false&#x27;</span><br><span class="line">    Client TLS using generated certificates.</span><br><span class="line">  --peer-cert-file &#x27;&#x27;</span><br><span class="line">    Path to the peer server TLS cert file.</span><br><span class="line">  --peer-key-file &#x27;&#x27;</span><br><span class="line">    Path to the peer server TLS key file.</span><br><span class="line">  --peer-client-cert-auth &#x27;false&#x27;</span><br><span class="line">    Enable peer client cert authentication.</span><br><span class="line">  --peer-trusted-ca-file &#x27;&#x27;</span><br><span class="line">    Path to the peer server TLS trusted CA file.</span><br><span class="line">  --peer-cert-allowed-cn &#x27;&#x27;</span><br><span class="line">    Required CN for client certs connecting to the peer endpoint.</span><br><span class="line">  --peer-cert-allowed-hostname &#x27;&#x27;</span><br><span class="line">    Allowed TLS hostname for inter peer authentication.</span><br><span class="line">  --peer-auto-tls &#x27;false&#x27;</span><br><span class="line">    Peer TLS using self-generated certificates if --peer-key-file and --peer-cert-file are not provided.</span><br><span class="line">  --peer-crl-file &#x27;&#x27;</span><br><span class="line">    Path to the peer certificate revocation list file.</span><br><span class="line">  --cipher-suites &#x27;&#x27;</span><br><span class="line">    Comma-separated list of supported TLS cipher suites between client/server and peers (empty will be auto-populated by Go).</span><br><span class="line">  --cors &#x27;*&#x27;</span><br><span class="line">    Comma-separated whitelist of origins for CORS, or cross-origin resource sharing, (empty or * means allow all).</span><br><span class="line">  --host-whitelist &#x27;*&#x27;</span><br><span class="line">    Acceptable hostnames from HTTP client requests, if server is not secure (empty or * means allow all).</span><br><span class="line"></span><br><span class="line">Auth:</span><br><span class="line">  --auth-token &#x27;simple&#x27;</span><br><span class="line">    Specify a v3 authentication token type and its options (&#x27;simple&#x27; or &#x27;jwt&#x27;).</span><br><span class="line">  --bcrypt-cost 10</span><br><span class="line">    Specify the cost / strength of the bcrypt algorithm for hashing auth passwords. Valid values are between 4 and 31.</span><br><span class="line"></span><br><span class="line">Profiling and Monitoring:</span><br><span class="line">  --enable-pprof &#x27;false&#x27;</span><br><span class="line">    Enable runtime profiling data via HTTP server. Address is at client URL + &quot;/debug/pprof/&quot;</span><br><span class="line">  --metrics &#x27;basic&#x27;</span><br><span class="line">    Set level of detail for exported metrics, specify &#x27;extensive&#x27; to include histogram metrics.</span><br><span class="line">  --listen-metrics-urls &#x27;&#x27;</span><br><span class="line">    List of URLs to listen on for the metrics and health endpoints.</span><br><span class="line"></span><br><span class="line">Logging:</span><br><span class="line">  --logger &#x27;capnslog&#x27;</span><br><span class="line">    Specify &#x27;zap&#x27; for structured logging or &#x27;capnslog&#x27;. [WARN] &#x27;capnslog&#x27; will be deprecated in v3.5.</span><br><span class="line">  --log-outputs &#x27;default&#x27;</span><br><span class="line">    Specify &#x27;stdout&#x27; or &#x27;stderr&#x27; to skip journald logging even when running under systemd, or list of comma separated output targets.</span><br><span class="line">  --log-level &#x27;info&#x27;</span><br><span class="line">    Configures log level. Only supports debug, info, warn, error, panic, or fatal.</span><br><span class="line"></span><br><span class="line">v2 Proxy (to be deprecated in v4):</span><br><span class="line">  --proxy &#x27;off&#x27;</span><br><span class="line">    Proxy mode setting (&#x27;off&#x27;, &#x27;readonly&#x27; or &#x27;on&#x27;).</span><br><span class="line">  --proxy-failure-wait 5000</span><br><span class="line">    Time (in milliseconds) an endpoint will be held in a failed state.</span><br><span class="line">  --proxy-refresh-interval 30000</span><br><span class="line">    Time (in milliseconds) of the endpoints refresh interval.</span><br><span class="line">  --proxy-dial-timeout 1000</span><br><span class="line">    Time (in milliseconds) for a dial to timeout.</span><br><span class="line">  --proxy-write-timeout 5000</span><br><span class="line">    Time (in milliseconds) for a write to timeout.</span><br><span class="line">  --proxy-read-timeout 0</span><br><span class="line">    Time (in milliseconds) for a read to timeout.</span><br><span class="line"></span><br><span class="line">Experimental feature:</span><br><span class="line">  --experimental-initial-corrupt-check &#x27;false&#x27;</span><br><span class="line">    Enable to check data corruption before serving any client/peer traffic.</span><br><span class="line">  --experimental-corrupt-check-time &#x27;0s&#x27;</span><br><span class="line">    Duration of time between cluster corruption check passes.</span><br><span class="line">  --experimental-enable-v2v3 &#x27;&#x27;</span><br><span class="line">    Serve v2 requests through the v3 backend under a given prefix.</span><br><span class="line">  --experimental-backend-bbolt-freelist-type &#x27;array&#x27;</span><br><span class="line">    ExperimentalBackendFreelistType specifies the type of freelist that boltdb backend uses(array and map are supported types).</span><br><span class="line">  --experimental-enable-lease-checkpoint &#x27;false&#x27;</span><br><span class="line">    ExperimentalEnableLeaseCheckpoint enables primary lessor to persist lease remainingTTL to prevent indefinite auto-renewal of long lived leases.</span><br><span class="line">  --experimental-compaction-batch-limit 1000</span><br><span class="line">    ExperimentalCompactionBatchLimit sets the maximum revisions deleted in each compaction batch.</span><br><span class="line">  --experimental-peer-skip-client-san-verification &#x27;false&#x27;</span><br><span class="line">    Skip verification of SAN field in client certificate for peer connections.</span><br><span class="line"></span><br><span class="line">Unsafe feature:</span><br><span class="line">  --force-new-cluster &#x27;false&#x27;</span><br><span class="line">    Force to create a new one-member cluster.</span><br><span class="line"></span><br><span class="line">CAUTIOUS with unsafe flag! It may break the guarantees given by the consensus protocol!</span><br><span class="line"></span><br><span class="line">TO BE DEPRECATED:</span><br><span class="line"></span><br><span class="line">  --debug &#x27;false&#x27;</span><br><span class="line">    Enable debug-level logging for etcd. [WARN] Will be deprecated in v3.5. Use &#x27;--log-level=debug&#x27; instead.</span><br><span class="line">  --log-package-levels &#x27;&#x27;</span><br><span class="line">    Specify a particular log level for each etcd package (eg: &#x27;etcdmain=CRITICAL,etcdserver=DEBUG&#x27;).</span><br></pre></td></tr></table></figure>

<h3 id="goå®ä¾‹"><a href="#goå®ä¾‹" class="headerlink" title="goå®ä¾‹"></a>goå®ä¾‹</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/coreos/etcd/clientv3&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	dialTimeout    = <span class="number">5</span> * time.Second</span><br><span class="line">	requestTimeout = <span class="number">2</span> * time.Second</span><br><span class="line">    <span class="comment">//endpoints      = []string&#123;&quot;192.168.221.136:2379&quot;&#125;</span></span><br><span class="line">	endpoints      = []<span class="type">string</span>&#123;<span class="string">&quot;127.0.0.1:2379&quot;</span>&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	cli, err := clientv3.New(clientv3.Config&#123;</span><br><span class="line">		Endpoints:   endpoints,</span><br><span class="line">		DialTimeout: dialTimeout,</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> cli.Close()</span><br><span class="line"></span><br><span class="line">	log.Println(<span class="string">&quot;å­˜å‚¨å€¼&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> _, err := cli.Put(context.TODO(), <span class="string">&quot;/sensors&quot;</span>, <span class="string">`&#123;sensor01:&#123;topic:&quot;w_sensor01&quot;&#125;&#125;`</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	log.Println(<span class="string">&quot;è·å–å€¼&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> resp, err := cli.Get(context.TODO(), <span class="string">&quot;/sensors&quot;</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		log.Println(<span class="string">&quot;resp: &quot;</span>, resp)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// see https://github.com/coreos/etcd/blob/master/clientv3/example_kv_test.go#L220</span></span><br><span class="line">	log.Println(<span class="string">&quot;äº‹åŠ¡&amp;è¶…æ—¶&quot;</span>)</span><br><span class="line">	ctx, cancel := context.WithTimeout(context.Background(), requestTimeout)</span><br><span class="line">	_, err = cli.Txn(ctx).</span><br><span class="line">		If(clientv3.Compare(clientv3.Value(<span class="string">&quot;key&quot;</span>), <span class="string">&quot;&gt;&quot;</span>, <span class="string">&quot;abc&quot;</span>)). <span class="comment">// txn value comparisons are lexical</span></span><br><span class="line">		Then(clientv3.OpPut(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;XYZ&quot;</span>)).                      <span class="comment">// this runs, since &#x27;xyz&#x27; &gt; &#x27;abc&#x27;</span></span><br><span class="line">		Else(clientv3.OpPut(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;ABC&quot;</span>)).</span><br><span class="line">		Commit()</span><br><span class="line">	cancel()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// see https://github.com/coreos/etcd/blob/master/clientv3/example_watch_test.go</span></span><br><span class="line">	log.Println(<span class="string">&quot;ç›‘è§†&quot;</span>)</span><br><span class="line">	rch := cli.Watch(context.Background(), <span class="string">&quot;&quot;</span>, clientv3.WithPrefix())</span><br><span class="line">	<span class="keyword">for</span> wresp := <span class="keyword">range</span> rch &#123;</span><br><span class="line">		<span class="keyword">for</span> _, ev := <span class="keyword">range</span> wresp.Events &#123;</span><br><span class="line">			fmt.Printf(<span class="string">&quot;%s %q : %q\n&quot;</span>, ev.Type, ev.Kv.Key, ev.Kv.Value)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="é›†ç¾¤é…ç½®"><a href="#é›†ç¾¤é…ç½®" class="headerlink" title="é›†ç¾¤é…ç½®"></a>é›†ç¾¤é…ç½®</h2><h3 id="é…ç½®é¡¹"><a href="#é…ç½®é¡¹" class="headerlink" title="é…ç½®é¡¹"></a>é…ç½®é¡¹</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">--name etcd0 //èŠ‚ç‚¹åç§°ï¼Œé»˜è®¤ä¸º default</span><br><span class="line"></span><br><span class="line">--data-dir //æœåŠ¡è¿è¡Œæ•°æ®ä¿å­˜çš„è·¯å¾„ï¼Œé»˜è®¤ä¸º$&#123;name&#125;.etcd</span><br><span class="line"></span><br><span class="line">--snapshot-count //æŒ‡å®šæœ‰å¤šå°‘äº‹åŠ¡ï¼ˆtransactionï¼‰è¢«æäº¤æ—¶ï¼Œè§¦å‘æˆªå–å¿«ç…§ä¿å­˜åˆ°ç£ç›˜</span><br><span class="line"></span><br><span class="line">--heartbeat-interval //leader å¤šä¹…å‘é€ä¸€æ¬¡å¿ƒè·³åˆ° followersã€‚é»˜è®¤å€¼æ˜¯ 100ms</span><br><span class="line"></span><br><span class="line">--eletion-timeout //é‡æ–°æŠ•ç¥¨çš„è¶…æ—¶æ—¶é—´ï¼Œå¦‚æœ follow åœ¨è¯¥æ—¶é—´é—´éš”æ²¡æœ‰æ”¶åˆ°å¿ƒè·³åŒ…ï¼Œä¼šè§¦å‘é‡æ–°æŠ•ç¥¨ï¼Œé»˜è®¤ä¸º 1000 msã€‚</span><br><span class="line"></span><br><span class="line">--listen-peer-urls  //å’ŒåŒä¼´é€šä¿¡çš„åœ°å€ï¼Œæ¯”å¦‚http://ip:2380ï¼Œå¦‚æœæœ‰å¤šä¸ªï¼Œä½¿ç”¨é€—å·åˆ†éš”ã€‚éœ€è¦æ‰€æœ‰èŠ‚ç‚¹éƒ½èƒ½å¤Ÿè®¿é—®ï¼Œæ‰€ä»¥ä¸è¦ä½¿ç”¨ localhost</span><br><span class="line"></span><br><span class="line">--listen-client-urls //å¯¹å¤–æä¾›æœåŠ¡çš„åœ°å€ï¼šæ¯”å¦‚http://ip:2379,http://127.0.0.1:2379ï¼Œå®¢æˆ·ç«¯ä¼šè¿æ¥åˆ°è¿™é‡Œå’Œ etcd äº¤äº’</span><br><span class="line"></span><br><span class="line">--advertise-client-urlsï¼šå¯¹å¤–å…¬å‘Šçš„è¯¥èŠ‚ç‚¹å®¢æˆ·ç«¯ç›‘å¬åœ°å€ï¼Œè¿™ä¸ªå€¼ä¼šå‘Šè¯‰é›†ç¾¤ä¸­å…¶ä»–èŠ‚ç‚¹</span><br><span class="line"></span><br><span class="line">--initial-advertise-peer-urls http://192.168.2.55:2380 //å…¶ä»–memberä½¿ç”¨ï¼Œå…¶ä»–memberé€šè¿‡è¯¥åœ°å€ä¸æœ¬memberäº¤äº’ä¿¡æ¯ã€‚ä¸€å®šè¦ä¿è¯ä»å…¶ä»–memberèƒ½å¯è®¿é—®è¯¥åœ°å€ã€‚é™æ€é…ç½®æ–¹å¼ä¸‹ï¼Œè¯¥å‚æ•°çš„valueä¸€å®šè¦åŒæ—¶åœ¨--initial-clusterå‚æ•°ä¸­å­˜åœ¨ã€‚</span><br><span class="line"></span><br><span class="line">memberIDçš„ç”Ÿæˆå—--initial-cluster-tokenå’Œ--initial-advertise-peer-urlså½±å“ã€‚è¯¥èŠ‚ç‚¹åŒä¼´ç›‘å¬åœ°å€ï¼Œè¿™ä¸ªå€¼ä¼šå‘Šè¯‰é›†ç¾¤ä¸­å…¶ä»–èŠ‚ç‚¹</span><br><span class="line"></span><br><span class="line">--initial-cluster //é›†ç¾¤ä¸­æ‰€æœ‰èŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œæ ¼å¼ä¸ºnode1=http://ip1:2380,node2=http://ip2:2380,â€¦ï¼Œæ³¨æ„ï¼šè¿™é‡Œçš„ node1 æ˜¯èŠ‚ç‚¹çš„ --name æŒ‡å®šçš„åå­—ï¼›åé¢çš„ ip1:2380 æ˜¯ --initial-advertise-peer-urls æŒ‡å®šçš„å€¼ã€‚</span><br><span class="line"></span><br><span class="line">--initial-cluster-state //æ–°å»ºé›†ç¾¤çš„æ—¶å€™ï¼Œè¿™ä¸ªå€¼ä¸º newï¼›å‡å¦‚å·²ç»å­˜åœ¨çš„é›†ç¾¤ï¼Œè¿™ä¸ªå€¼ä¸º existingã€‚</span><br><span class="line"></span><br><span class="line">--initial-cluster-token//åˆ›å»ºé›†ç¾¤çš„ tokenï¼Œè¿™ä¸ªå€¼æ¯ä¸ªé›†ç¾¤ä¿æŒå”¯ä¸€ã€‚è¿™æ ·çš„è¯ï¼Œå¦‚æœä½ è¦é‡æ–°åˆ›å»ºé›†ç¾¤ï¼Œå³ä½¿é…ç½®å’Œä¹‹å‰ä¸€æ ·ï¼Œä¹Ÿä¼šå†æ¬¡ç”Ÿæˆæ–°çš„é›†ç¾¤å’ŒèŠ‚ç‚¹ uuidï¼›å¦åˆ™ä¼šå¯¼è‡´å¤šä¸ªé›†ç¾¤ä¹‹é—´çš„å†²çªï¼Œé€ æˆæœªçŸ¥çš„é”™è¯¯ã€‚</span><br><span class="line"></span><br><span class="line">--initial-cluster-token etcd-cluster-2    //ç”¨äºåŒºåˆ†ä¸åŒé›†ç¾¤ã€‚æœ¬åœ°å¦‚æœ‰å¤šä¸ªé›†ç¾¤è¦è®¾ä¸ºä¸åŒã€‚</span><br><span class="line"></span><br><span class="line">--initial-cluster-state new    //ç”¨äºæŒ‡ç¤ºæœ¬æ¬¡æ˜¯å¦ä¸ºæ–°å»ºé›†ç¾¤ã€‚æœ‰ä¸¤ä¸ªå–å€¼newå’Œexistingã€‚å¦‚æœå¡«ä¸ºexistingï¼Œåˆ™è¯¥memberå¯åŠ¨æ—¶ä¼šå°è¯•ä¸å…¶ä»–memberäº¤äº’ã€‚é›†ç¾¤åˆæ¬¡å»ºç«‹æ—¶ï¼Œè¦å¡«ä¸ºnewï¼Œç»å°è¯•æœ€åä¸€ä¸ªèŠ‚ç‚¹å¡«existingä¹Ÿæ­£å¸¸ï¼Œå…¶ä»–èŠ‚ç‚¹ä¸èƒ½å¡«ä¸ºexistingã€‚é›†ç¾¤è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œä¸€ä¸ªmemberæ•…éšœåæ¢å¤æ—¶å¡«ä¸ºexistingï¼Œç»å°è¯•å¡«ä¸ºnewä¹Ÿæ­£å¸¸ã€‚</span><br></pre></td></tr></table></figure>

<h3 id="é›†ç¾¤å¯åŠ¨è„šæœ¬"><a href="#é›†ç¾¤å¯åŠ¨è„šæœ¬" class="headerlink" title="é›†ç¾¤å¯åŠ¨è„šæœ¬"></a>é›†ç¾¤å¯åŠ¨è„šæœ¬</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">export ETCDCTL_API=3</span><br><span class="line">IP=&quot;192.168.221.136&quot;</span><br><span class="line"></span><br><span class="line">CLUSTER=&quot;s11=http://$&#123;IP&#125;:2380,s12=http://$&#123;IP&#125;:2480,s13=http://$&#123;IP&#125;:2580&quot;</span><br><span class="line"></span><br><span class="line">nohup /etcd/etcd/etcd --name s11 --initial-advertise-peer-urls http://$&#123;IP&#125;:2380 \</span><br><span class="line">  --listen-peer-urls http://$&#123;IP&#125;:2380 \</span><br><span class="line">  --listen-client-urls http://$&#123;IP&#125;:2379,http://127.0.0.1:2379 \</span><br><span class="line">  --advertise-client-urls http://$&#123;IP&#125;:2379,http://127.0.0.1:2379 \</span><br><span class="line">  --initial-cluster-token etcd-cluster-1 \</span><br><span class="line">  --initial-cluster $&#123;CLUSTER&#125; \</span><br><span class="line">  --initial-cluster-state new &gt; /dev/null 2&gt;&amp;1 &amp;</span><br><span class="line">  </span><br><span class="line">nohup /etcd/etcd/etcd --name s12 --initial-advertise-peer-urls http://$&#123;IP&#125;:2480 \</span><br><span class="line">  --listen-peer-urls http://$&#123;IP&#125;:2480 \</span><br><span class="line">  --listen-client-urls http://$&#123;IP&#125;:2479,http://127.0.0.1:2479 \</span><br><span class="line">  --advertise-client-urls http://$&#123;IP&#125;:2479,http://127.0.0.1:2479 \</span><br><span class="line">  --initial-cluster-token etcd-cluster-1 \</span><br><span class="line">  --initial-cluster $&#123;CLUSTER&#125; \</span><br><span class="line">  --initial-cluster-state new &gt; /dev/null 2&gt;&amp;1 &amp;</span><br><span class="line"></span><br><span class="line">nohup /etcd/etcd/etcd --name s13 --initial-advertise-peer-urls http://$&#123;IP&#125;:2580 \</span><br><span class="line">  --listen-peer-urls http://$&#123;IP&#125;:2580 \</span><br><span class="line">  --listen-client-urls http://$&#123;IP&#125;:2579,http://127.0.0.1:2579 \</span><br><span class="line">  --advertise-client-urls http://$&#123;IP&#125;:2579,http://127.0.0.1:2579 \</span><br><span class="line">  --initial-cluster-token etcd-cluster-1 \</span><br><span class="line">  --initial-cluster $&#123;CLUSTER&#125; \</span><br><span class="line">  --initial-cluster-state new &gt; /dev/null 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹é›†ç¾¤</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">etcdctl member list</span></span><br><span class="line"></span><br><span class="line">cfdda6f4fce7ec9, started, s13, http://192.168.221.136:2580, http://127.0.0.1:2579,http://192.168.221.136:2579, false</span><br><span class="line">b0a4b6bdd1efe123, started, s11, http://192.168.221.136:2380, http://127.0.0.1:2379,http://192.168.221.136:2379, false</span><br><span class="line">bba82993c0bc3537, started, s12, http://192.168.221.136:2480, http://127.0.0.1:2479,http://192.168.221.136:2479, false</span><br></pre></td></tr></table></figure>

<h3 id="goå®ä¾‹-1"><a href="#goå®ä¾‹-1" class="headerlink" title="goå®ä¾‹"></a>goå®ä¾‹</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;context&quot;</span><br><span class="line">	&quot;fmt&quot;</span><br><span class="line">	&quot;log&quot;</span><br><span class="line">	&quot;time&quot;</span><br><span class="line"></span><br><span class="line">	&quot;github.com/coreos/etcd/clientv3&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">var (</span><br><span class="line">	dialTimeout    = 5 * time.Second</span><br><span class="line">	requestTimeout = 2 * time.Second</span><br><span class="line">    endpoints      = []string&#123;&quot;192.168.221.136:2379&quot;,&quot;192.168.221.136:2479&quot;,&quot;192.168.221.136:2579&quot;&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	cli, err := clientv3.New(clientv3.Config&#123;</span><br><span class="line">		Endpoints:   endpoints,</span><br><span class="line">		DialTimeout: dialTimeout,</span><br><span class="line">	&#125;)</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;</span><br><span class="line">	defer cli.Close()</span><br><span class="line"></span><br><span class="line">	log.Println(&quot;å­˜å‚¨å€¼&quot;)</span><br><span class="line">	if _, err := cli.Put(context.TODO(), &quot;/sensors&quot;, `&#123;sensor01:&#123;topic:&quot;w_sensor01&quot;&#125;&#125;`); err != nil &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	log.Println(&quot;è·å–å€¼&quot;)</span><br><span class="line">	if resp, err := cli.Get(context.TODO(), &quot;/sensors&quot;); err != nil &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		log.Println(&quot;resp: &quot;, resp)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// see https://github.com/coreos/etcd/blob/master/clientv3/example_kv_test.go#L220</span><br><span class="line">	log.Println(&quot;äº‹åŠ¡&amp;è¶…æ—¶&quot;)</span><br><span class="line">	ctx, cancel := context.WithTimeout(context.Background(), requestTimeout)</span><br><span class="line">	_, err = cli.Txn(ctx).</span><br><span class="line">		If(clientv3.Compare(clientv3.Value(&quot;key&quot;), &quot;&gt;&quot;, &quot;abc&quot;)). // txn value comparisons are lexical</span><br><span class="line">		Then(clientv3.OpPut(&quot;key&quot;, &quot;XYZ&quot;)).                      // this runs, since &#x27;xyz&#x27; &gt; &#x27;abc&#x27;</span><br><span class="line">		Else(clientv3.OpPut(&quot;key&quot;, &quot;ABC&quot;)).</span><br><span class="line">		Commit()</span><br><span class="line">	cancel()</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// see https://github.com/coreos/etcd/blob/master/clientv3/example_watch_test.go</span><br><span class="line">	log.Println(&quot;ç›‘è§†&quot;)</span><br><span class="line">	rch := cli.Watch(context.Background(), &quot;&quot;, clientv3.WithPrefix())</span><br><span class="line">	for wresp := range rch &#123;</span><br><span class="line">		for _, ev := range wresp.Events &#123;</span><br><span class="line">			fmt.Printf(&quot;%s %q : %q\n&quot;, ev.Type, ev.Kv.Key, ev.Kv.Value)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="dockeréƒ¨ç½²etcdé›†ç¾¤"><a href="#dockeréƒ¨ç½²etcdé›†ç¾¤" class="headerlink" title="dockeréƒ¨ç½²etcdé›†ç¾¤"></a>dockeréƒ¨ç½²etcdé›†ç¾¤</h2><p>é…ç½®ç¯å¢ƒå˜é‡</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /var/log/etcd/			      #å»ºè®®åˆ›å»ºetcdæ—¥å¿—ä¿å­˜ç›®å½•</span><br><span class="line">mkdir -p /data/etcd				      #å»ºè®®åˆ›å»ºå•ç‹¬çš„etcdæ•°æ®ç›®å½•</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">REGISTRY=quay.io/coreos/etcd:latest  <span class="comment">#å®˜æ–¹ä»“åº“</span></span></span><br><span class="line">REGISTRY=willdockerhub/etcd:v3.3.12   #ä¸ªäººä»“åº“</span><br><span class="line">TOKEN=my-etcd-01				      #è®¾ç½®å”¯ä¸€é›†ç¾¤ID</span><br><span class="line">CLUSTER_STATE=new				      #è®¾ç½®ä¸ºæ–°å»ºé›†ç¾¤</span><br><span class="line">NAME_1=etcd1</span><br><span class="line">NAME_2=etcd2</span><br><span class="line">NAME_3=etcd3					      #è®¾ç½®ä¸‰ä¸ªèŠ‚ç‚¹çš„name</span><br><span class="line">HOST_1=192.168.92.11</span><br><span class="line">HOST_2=192.168.92.12</span><br><span class="line">HOST_3=192.168.92.13			      #è®¾ç½®ä¸‰ä¸ªèŠ‚ç‚¹çš„IP</span><br><span class="line">CLUSTER=$&#123;NAME_1&#125;=http://$&#123;HOST_1&#125;:2380,$&#123;NAME_2&#125;=http://$&#123;HOST_2&#125;:2380,$&#123;NAME_3&#125;=http://$&#123;HOST_3&#125;:2380</span><br><span class="line">DATA_DIR=/data/etcd				      #è®¾ç½®é›†ç¾¤etcdæ•°æ®èŠ‚ç‚¹</span><br></pre></td></tr></table></figure>

<p>æç¤ºï¼šä»¥ä¸Šæ‰€æœ‰æ“ä½œéœ€è¦åœ¨æ‰€æœ‰èŠ‚ç‚¹æ“ä½œã€‚</p>
<p>èŠ‚ç‚¹1æ‰§è¡Œ</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">THIS_NAME=$&#123;NAME_1&#125;</span><br><span class="line">THIS_IP=$&#123;HOST_1&#125;</span><br><span class="line">docker run -d --restart=always \</span><br><span class="line">  -p 2379:2379 \</span><br><span class="line">  -p 2380:2380 \</span><br><span class="line">  --volume=$&#123;DATA_DIR&#125;:/etcd-data \</span><br><span class="line">  --name etcd $&#123;REGISTRY&#125; \</span><br><span class="line">  /usr/local/bin/etcd \</span><br><span class="line">  --data-dir=/etcd-data --name $&#123;THIS_NAME&#125; \</span><br><span class="line">  --initial-advertise-peer-urls http://$&#123;THIS_IP&#125;:2380 --listen-peer-urls http://0.0.0.0:2380 \</span><br><span class="line">  --advertise-client-urls http://$&#123;THIS_IP&#125;:2379 --listen-client-urls http://0.0.0.0:2379 \</span><br><span class="line">  --initial-cluster $&#123;CLUSTER&#125; \</span><br><span class="line">  --initial-cluster-state $&#123;CLUSTER_STATE&#125; --initial-cluster-token $&#123;TOKEN&#125;</span><br></pre></td></tr></table></figure>

<p>èŠ‚ç‚¹2æ‰§è¡Œ</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">THIS_NAME=$&#123;NAME_2&#125;</span><br><span class="line">THIS_IP=$&#123;HOST_2&#125;</span><br><span class="line">docker run -d --restart=always \</span><br><span class="line">  -p 2379:2379 \</span><br><span class="line">  -p 2380:2380 \</span><br><span class="line">  --volume=$&#123;DATA_DIR&#125;:/etcd-data \</span><br><span class="line">  --name etcd $&#123;REGISTRY&#125; \</span><br><span class="line">  /usr/local/bin/etcd \</span><br><span class="line">  --data-dir=/etcd-data --name $&#123;THIS_NAME&#125; \</span><br><span class="line">  --initial-advertise-peer-urls http://$&#123;THIS_IP&#125;:2380 --listen-peer-urls http://0.0.0.0:2380 \</span><br><span class="line">  --advertise-client-urls http://$&#123;THIS_IP&#125;:2379 --listen-client-urls http://0.0.0.0:2379 \</span><br><span class="line">  --initial-cluster $&#123;CLUSTER&#125; \</span><br><span class="line">  --initial-cluster-state $&#123;CLUSTER_STATE&#125; --initial-cluster-token $&#123;TOKEN&#125;</span><br></pre></td></tr></table></figure>

<p>èŠ‚ç‚¹3æ‰§è¡Œ</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">THIS_NAME=$&#123;NAME_3&#125;</span><br><span class="line">THIS_IP=$&#123;HOST_3&#125;</span><br><span class="line">docker run -d --restart=always \</span><br><span class="line">  -p 2379:2379 \</span><br><span class="line">  -p 2380:2380 \</span><br><span class="line">  --volume=$&#123;DATA_DIR&#125;:/etcd-data \</span><br><span class="line">  --name etcd $&#123;REGISTRY&#125; \</span><br><span class="line">  /usr/local/bin/etcd \</span><br><span class="line">  --data-dir=/etcd-data --name $&#123;THIS_NAME&#125; \</span><br><span class="line">  --initial-advertise-peer-urls http://$&#123;THIS_IP&#125;:2380 --listen-peer-urls http://0.0.0.0:2380 \</span><br><span class="line">  --advertise-client-urls http://$&#123;THIS_IP&#125;:2379 --listen-client-urls http://0.0.0.0:2379 \</span><br><span class="line">  --initial-cluster $&#123;CLUSTER&#125; \</span><br><span class="line">  --initial-cluster-state $&#123;CLUSTER_STATE&#125; --initial-cluster-token $&#123;TOKEN&#125;</span><br></pre></td></tr></table></figure>

<p>1.2 éªŒè¯é›†ç¾¤</p>
<p>æŸ¥çœ‹å®¹å™¨çŠ¶æ€</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE                        COMMAND                  CREATED              STATUS              PORTS                              NAMES</span><br><span class="line">36b1c9db2321        willdockerhub/etcd:v3.3.12   &quot;/usr/local/bin/et...&quot;   About a minute ago   Up About a minute   0.0.0.0:2379-2380-&gt;2379-2380/tcp   etcd</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker exec -it etcd /usr/local/bin/etcdctl cluster-health</span><br><span class="line">member 1d5a95e7cc3da4a2 is healthy: got healthy result from http://192.168.92.11:2379</span><br><span class="line">member 2324302b6450f04d is healthy: got healthy result from http://192.168.92.12:2379</span><br><span class="line">member 7f413d967727fb2b is healthy: got healthy result from http://192.168.92.13:2379</span><br><span class="line">cluster is healthy</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹ä¸»æœºç›‘å¬ç«¯å£</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# netstat -nltp | grep 2380</span><br><span class="line">tcp6       0      0 :::2380                 :::*                    LISTEN      19601/docker-proxy- </span><br><span class="line">[root@localhost ~]#</span><br></pre></td></tr></table></figure>



















</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="https://wangyyovo.github.io">Blank</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://wangyyovo.github.io/posts/5baaccef/">https://wangyyovo.github.io/posts/5baaccef/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº <a href="https://wangyyovo.github.io" target="_blank">Blank</a>ï¼</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/etcd/85724a45f3babbdb451f3ef24d36a303.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/6b7ef58d/" title="Etcdé›†ç¾¤æŒ‡å—"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/etcd/55556e54209b5be718614c259f8aca64.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">ä¸Šä¸€ç¯‡</div><div class="info-item-2">Etcdé›†ç¾¤æŒ‡å—</div></div><div class="info-2"><div class="info-item-1"> Etcdé›†ç¾¤æŒ‡å—æ¦‚è¿°å¯åŠ¨ etcd é›†ç¾¤è¦æ±‚æ¯ä¸ªæˆå‘˜çŸ¥é“é›†ç¾¤ä¸­çš„å…¶ä»–æˆå‘˜ã€‚åœ¨ä¸€äº›åœºæ™¯ä¸­ï¼Œé›†ç¾¤æˆå‘˜çš„ IP åœ°å€å¯èƒ½æ— æ³•æå‰çŸ¥é“ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œetcd é›†ç¾¤å¯ä»¥åœ¨å‘ç°æœåŠ¡çš„å¸®åŠ©ä¸‹å¯åŠ¨ã€‚ ä¸€æ—¦ etcd é›†ç¾¤å¯åŠ¨å¹¶è¿è¡Œï¼Œå¯ä»¥é€šè¿‡ è¿è¡Œæ—¶é‡é…ç½® æ¥æ·»åŠ æˆ–è€…ç§»é™¤æˆå‘˜ã€‚ä¸ºäº†æ›´å¥½çš„ç†è§£è¿è¡Œæ—¶é‡é…ç½®èƒŒåçš„è®¾è®¡ï¼Œå»ºè®®é˜…è¯» è¿è¡Œæ—¶é‡é…ç½®çš„è®¾è®¡ã€‚ è¿™ä»½æŒ‡å—å°†è¦†ç›–ä¸‹åˆ—ç”¨äºå¯åŠ¨ etcd é›†ç¾¤çš„æœºåˆ¶ï¼š  é™æ€ etcd å‘ç° DNS å‘ç°  å¯åŠ¨æœºåˆ¶çš„æ¯ä¸€ç§éƒ½å°†ç”¨äºå¯åŠ¨ä¸‰å°æœºå™¨çš„ etcd é›†ç¾¤ï¼Œè¯¦æƒ…å¦‚ä¸‹ï¼š    åå­— åœ°å€ ä¸»æœº    infra0 10.0.1.10 infra0.example.com   infra1 10.0.1.11 infra1.example.com   infra2 10.0.1.12 infra2.example.com   é™æ€å¦‚æœåœ¨å¯åŠ¨å‰æˆ‘ä»¬çŸ¥é“é›†ç¾¤æˆå‘˜ï¼Œä»–ä»¬çš„åœ°å€å’Œé›†ç¾¤çš„å¤§å°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨é€šè¿‡è®¾ç½® initial-cluster æ ‡è®°æ¥ç¦»çº¿å¯åŠ¨é…ç½®ã€‚æ¯ä¸ªæœºå™¨å°†å¾—åˆ°ä¸‹åˆ—ç¯å¢ƒå˜é‡æˆ–è€…å‘½ä»¤è¡Œï¼š 1234ETCD_INITIAL_CLUSTER=&quot;infr...</div></div></div></a><a class="pagination-related" href="/posts/589ab773/" title="Etcdåº”ç”¨"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/etcd/41896216ab5517c3b870d9ed6bb1b126.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">ä¸‹ä¸€ç¯‡</div><div class="info-item-2">Etcdåº”ç”¨</div></div><div class="info-2"><div class="info-item-1"> Etcdåº”ç”¨éšç€CoreOSå’ŒKubernetesç­‰é¡¹ç›®åœ¨å¼€æºç¤¾åŒºæ—¥ç›Šç«çƒ­ï¼Œå®ƒä»¬é¡¹ç›®ä¸­éƒ½ç”¨åˆ°çš„etcdç»„ä»¶ä½œä¸ºä¸€ä¸ªé«˜å¯ç”¨å¼ºä¸€è‡´æ€§çš„æœåŠ¡å‘ç°å­˜å‚¨ä»“åº“ï¼Œæ¸æ¸ä¸ºå¼€å‘äººå‘˜æ‰€å…³æ³¨ã€‚åœ¨äº‘è®¡ç®—æ—¶ä»£ï¼Œå¦‚ä½•è®©æœåŠ¡å¿«é€Ÿé€æ˜åœ°æ¥å…¥åˆ°è®¡ç®—é›†ç¾¤ä¸­ï¼Œå¦‚ä½•è®©å…±äº«é…ç½®ä¿¡æ¯å¿«é€Ÿè¢«é›†ç¾¤ä¸­çš„æ‰€æœ‰æœºå™¨å‘ç°ï¼Œæ›´ä¸ºé‡è¦çš„æ˜¯ï¼Œå¦‚ä½•æ„å»ºè¿™æ ·ä¸€å¥—é«˜å¯ç”¨ã€å®‰å…¨ã€æ˜“äºéƒ¨ç½²ä»¥åŠå“åº”å¿«é€Ÿçš„æœåŠ¡é›†ç¾¤ï¼Œå·²ç»æˆä¸ºäº†è¿«åˆ‡éœ€è¦è§£å†³çš„é—®é¢˜ã€‚etcdä¸ºè§£å†³è¿™ç±»é—®é¢˜å¸¦æ¥äº†ç¦éŸ³ï¼Œæœ¬æ–‡å°†ä»etcdçš„åº”ç”¨åœºæ™¯å¼€å§‹ï¼Œæ·±å…¥è§£è¯»etcdçš„å®ç°æ–¹å¼ï¼Œä»¥ä¾›å¼€å‘è€…ä»¬æ›´ä¸ºå……åˆ†åœ°äº«ç”¨etcdæ‰€å¸¦æ¥çš„ä¾¿åˆ©ã€‚ ç»å…¸åº”ç”¨åœºæ™¯è¦é—®etcdæ˜¯ä»€ä¹ˆï¼Ÿå¾ˆå¤šäººç¬¬ä¸€ååº”å¯èƒ½æ˜¯ä¸€ä¸ªé”®å€¼å­˜å‚¨ä»“åº“ï¼Œå´æ²¡æœ‰é‡è§†å®˜æ–¹å®šä¹‰çš„ååŠå¥ï¼Œç”¨äºé…ç½®å…±äº«å’ŒæœåŠ¡å‘ç°ã€‚  A highly-available key value store for shared configuration and service discovery.  å®é™…ä¸Šï¼Œetcdä½œä¸ºä¸€ä¸ªå—åˆ°ZooKeeperä¸doozerå¯å‘è€Œå‚¬ç”Ÿçš„é¡¹ç›®ï¼Œé™¤äº†æ‹¥æœ‰ä¸ä¹‹ç±»ä¼¼çš„åŠŸèƒ½å¤–ï¼Œæ›´ä¸“æ³¨äºä»¥ä¸‹å››ç‚¹ã€‚  ç®€å•ï¼šåŸºäºHTTP+JSONçš„APIè®©ä½ ç”¨curlå°±å¯...</div></div></div></a></nav><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/theme/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Blank</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">352</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">46</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">58</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>ä¸»é¢˜ GitHub</span></a><div class="card-info-social-icons"><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fas fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Etcd%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8"><span class="toc-number">1.</span> <span class="toc-text">Etcdçš„ç®€å•ä½¿ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#API-V2%E4%B8%8EV3%E5%8C%BA%E5%88%AB"><span class="toc-number">1.1.</span> <span class="toc-text">API V2ä¸V3åŒºåˆ«</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">1.2.</span> <span class="toc-text">å®‰è£…</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E8%AF%BB%E5%86%99"><span class="toc-number">1.3.</span> <span class="toc-text">ç®€å•è¯»å†™</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Etcd%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B7%A5%E5%85%B7"><span class="toc-number">1.4.</span> <span class="toc-text">Etcdå¯è§†åŒ–å·¥å…·</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Etcd%E5%8D%95%E6%9C%BA%E5%90%AF%E5%8A%A8"><span class="toc-number">1.5.</span> <span class="toc-text">Etcdå•æœºå¯åŠ¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Etcd%E5%8D%95%E6%9C%BAdocker-compose"><span class="toc-number">1.6.</span> <span class="toc-text">Etcdå•æœºdocker-compose</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Etcd%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C"><span class="toc-number">1.7.</span> <span class="toc-text">Etcdæ•°æ®æ“ä½œ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#etcdctl%E5%91%BD%E4%BB%A4"><span class="toc-number">1.7.1.</span> <span class="toc-text">etcdctlå‘½ä»¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E3%80%81%E6%9B%B4%E6%96%B0key"><span class="toc-number">1.7.2.</span> <span class="toc-text">è®¾ç½®ã€æ›´æ–°key</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96key"><span class="toc-number">1.7.3.</span> <span class="toc-text">è·å–key</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4key"><span class="toc-number">1.7.4.</span> <span class="toc-text">åˆ é™¤key</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%91%E5%90%AC%E4%B8%80%E4%B8%AAkey"><span class="toc-number">1.7.5.</span> <span class="toc-text">ç›‘å¬ä¸€ä¸ªkey</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%B3%E8%AF%B7%E7%A7%9F%E7%BA%A6"><span class="toc-number">1.7.6.</span> <span class="toc-text">ç”³è¯·ç§Ÿçº¦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%88%E6%9D%83%E7%A7%9F%E7%BA%A6"><span class="toc-number">1.7.7.</span> <span class="toc-text">æˆæƒç§Ÿçº¦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A7%9F%E7%BA%A6%E7%BB%AD%E7%BA%A6"><span class="toc-number">1.7.8.</span> <span class="toc-text">ç§Ÿçº¦ç»­çº¦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E7%BE%A4"><span class="toc-number">1.7.9.</span> <span class="toc-text">é›†ç¾¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%87%E4%BB%BD%E5%92%8C%E6%81%A2%E5%A4%8D"><span class="toc-number">1.7.10.</span> <span class="toc-text">å¤‡ä»½å’Œæ¢å¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#etcd%E5%91%BD%E4%BB%A4"><span class="toc-number">1.7.11.</span> <span class="toc-text">etcdå‘½ä»¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#go%E5%AE%9E%E4%BE%8B"><span class="toc-number">1.7.12.</span> <span class="toc-text">goå®ä¾‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE"><span class="toc-number">1.8.</span> <span class="toc-text">é›†ç¾¤é…ç½®</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E9%A1%B9"><span class="toc-number">1.8.1.</span> <span class="toc-text">é…ç½®é¡¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E7%BE%A4%E5%90%AF%E5%8A%A8%E8%84%9A%E6%9C%AC"><span class="toc-number">1.8.2.</span> <span class="toc-text">é›†ç¾¤å¯åŠ¨è„šæœ¬</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#go%E5%AE%9E%E4%BE%8B-1"><span class="toc-number">1.8.3.</span> <span class="toc-text">goå®ä¾‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker%E9%83%A8%E7%BD%B2etcd%E9%9B%86%E7%BE%A4"><span class="toc-number">1.9.</span> <span class="toc-text">dockeréƒ¨ç½²etcdé›†ç¾¤</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/d14168d/" title="è™šæ‹Ÿæœºé—®é¢˜åˆé›†"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/hexo/090cfe4e9e60b0ad0de05db822f3ae97.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="è™šæ‹Ÿæœºé—®é¢˜åˆé›†"/></a><div class="content"><a class="title" href="/posts/d14168d/" title="è™šæ‹Ÿæœºé—®é¢˜åˆé›†">è™šæ‹Ÿæœºé—®é¢˜åˆé›†</a><time datetime="2022-07-16T13:30:36.000Z" title="å‘è¡¨äº 2022-07-16 21:30:36">2022-07-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/f540045f/" title="ç”¨goè¯­è¨€ç¼–å†™ç§»åŠ¨ç«¯sdkå’Œappå¼€å‘"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/golang/941ed1ec2925719a0c92e76f4f786b6a.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ç”¨goè¯­è¨€ç¼–å†™ç§»åŠ¨ç«¯sdkå’Œappå¼€å‘"/></a><div class="content"><a class="title" href="/posts/f540045f/" title="ç”¨goè¯­è¨€ç¼–å†™ç§»åŠ¨ç«¯sdkå’Œappå¼€å‘">ç”¨goè¯­è¨€ç¼–å†™ç§»åŠ¨ç«¯sdkå’Œappå¼€å‘</a><time datetime="2022-07-04T12:14:21.000Z" title="å‘è¡¨äº 2022-07-04 20:14:21">2022-07-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/5faac006/" title="åœ¨çº¿ç¼–ç¨‹IDE"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/hexo/090cfe4e9e60b0ad0de05db822f3ae97.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="åœ¨çº¿ç¼–ç¨‹IDE"/></a><div class="content"><a class="title" href="/posts/5faac006/" title="åœ¨çº¿ç¼–ç¨‹IDE">åœ¨çº¿ç¼–ç¨‹IDE</a><time datetime="2022-06-12T13:30:36.000Z" title="å‘è¡¨äº 2022-06-12 21:30:36">2022-06-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/7594185d/" title="å³æ—¶æ€§èƒ½åˆ†æå·¥å…·Pyroscope"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/golang/3bfb3279740bc9a5b5ef436fa887ef07.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="å³æ—¶æ€§èƒ½åˆ†æå·¥å…·Pyroscope"/></a><div class="content"><a class="title" href="/posts/7594185d/" title="å³æ—¶æ€§èƒ½åˆ†æå·¥å…·Pyroscope">å³æ—¶æ€§èƒ½åˆ†æå·¥å…·Pyroscope</a><time datetime="2022-06-12T08:07:36.000Z" title="å‘è¡¨äº 2022-06-12 16:07:36">2022-06-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/82a7aa7c/" title="golangæ€§èƒ½è°ƒè¯•ä¼˜åŒ–æ–¹æ³•"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="golangæ€§èƒ½è°ƒè¯•ä¼˜åŒ–æ–¹æ³•"/></a><div class="content"><a class="title" href="/posts/82a7aa7c/" title="golangæ€§èƒ½è°ƒè¯•ä¼˜åŒ–æ–¹æ³•">golangæ€§èƒ½è°ƒè¯•ä¼˜åŒ–æ–¹æ³•</a><time datetime="2022-06-12T03:00:36.000Z" title="å‘è¡¨äº 2022-06-12 11:00:36">2022-06-12</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By Blank</span><span class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 5.4.2</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.3</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æ—¥é—´å’Œå¤œé—´æ¨¡å¼åˆ‡æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="translateLink" type="button" title="ç®€ç¹è½¬æ¢">ç¹</button><a id="to_comment" href="#post-comment" title="å‰å¾€è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const initValine = (el, path) => {
    if (isShuoshuo) {
      window.shuoshuoComment.destroyValine = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    const valineConfig = {
      el: '#vcomment',
      appId: '49gEIIGN7uRbL6vHhieSpBzM-MdYXbMMI',
      appKey: 'uqts0urLKwikYQ0fKmIkMHBE',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      visitor: false,
      ...option,
      path: isShuoshuo ? path : (option && option.path) || window.location.pathname
    }

    new Valine(valineConfig)
  }

  const loadValine = async (el, path) => {
    if (typeof Valine === 'function') {
      initValine(el, path)
    } else {
      await btf.getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js')
      initValine(el, path)
    }
  }

  if (isShuoshuo) {
    'Valine' === 'Valine'
      ? window.shuoshuoComment = { loadComment: loadValine }
      : window.loadOtherComment = loadValine
    return
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  æ•°æ®åŠ è½½ä¸­</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>