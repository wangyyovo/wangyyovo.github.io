<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>行为模式-观察者模式 | Blank</title><meta name="author" content="Blank"><meta name="copyright" content="Blank"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="https:&#x2F;&#x2F;refactoringguru.cn&#x2F;design-patterns&#x2F;observer  行为模式-观察者模式亦称： 事件订阅者、监听者、Event-Subscriber、Listener、Observer 意图观察者模式是一种行为设计模式， 允许你定义一种订阅机制， 可在对象事件发生时通知多个 “观察” 该对象的其他对象。  问题假如你有两种类型的对象：  顾客和 商店 。">
<meta property="og:type" content="article">
<meta property="og:title" content="行为模式-观察者模式">
<meta property="og:url" content="https://wangyyovo.github.io/posts/1b971bb/">
<meta property="og:site_name" content="Blank">
<meta property="og:description" content="https:&#x2F;&#x2F;refactoringguru.cn&#x2F;design-patterns&#x2F;observer  行为模式-观察者模式亦称： 事件订阅者、监听者、Event-Subscriber、Listener、Observer 意图观察者模式是一种行为设计模式， 允许你定义一种订阅机制， 可在对象事件发生时通知多个 “观察” 该对象的其他对象。  问题假如你有两种类型的对象：  顾客和 商店 。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/20fc0d2e2c5e62b73248c59cc505b718.jpg">
<meta property="article:published_time" content="2021-05-04T12:00:56.000Z">
<meta property="article:modified_time" content="2021-05-04T12:00:56.000Z">
<meta property="article:author" content="Blank">
<meta property="article:tag" content="pattern">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/20fc0d2e2c5e62b73248c59cc505b718.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "行为模式-观察者模式",
  "url": "https://wangyyovo.github.io/posts/1b971bb/",
  "image": "https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/20fc0d2e2c5e62b73248c59cc505b718.jpg",
  "datePublished": "2021-05-04T12:00:56.000Z",
  "dateModified": "2021-05-04T12:00:56.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Blank",
      "url": "https://wangyyovo.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/theme/favicon.ico"><link rel="canonical" href="https://wangyyovo.github.io/posts/1b971bb/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400,"highlightFullpage":true,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":150,"languages":{"author":"作者: Blank","link":"链接: ","source":"来源: Blank","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '行为模式-观察者模式',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="alternate" href="/atom.xml" title="Blank" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/theme/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">352</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">46</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">58</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-comment-dots"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-image"></i><span> 相册</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-book"></i><span> 教程</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/posts/21cfbf15/"><span> 🚀 快速開始</span></a></li><li><a class="site-page child" href="/posts/dc584b87/"><span> 📑 主題頁面</span></a></li><li><a class="site-page child" href="/posts/4aa8abbe/"><span> 🛠 主題配置</span></a></li><li><a class="site-page child" href="/posts/ceeb73f/"><span> ⚔️ 標簽外挂</span></a></li><li><a class="site-page child" href="/posts/98d20436/"><span> ❓ 主題問答</span></a></li><li><a class="site-page child" href="/posts/4073eda/"><span> ⚡️ 進階教程</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-language"></i><span> 语言</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/"><i class="fa-fw fas fa-c"></i><span> 中文</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/20fc0d2e2c5e62b73248c59cc505b718.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Blank</span></a><a class="nav-page-title" href="/"><span class="site-name">行为模式-观察者模式</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-comment-dots"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-image"></i><span> 相册</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-book"></i><span> 教程</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/posts/21cfbf15/"><span> 🚀 快速開始</span></a></li><li><a class="site-page child" href="/posts/dc584b87/"><span> 📑 主題頁面</span></a></li><li><a class="site-page child" href="/posts/4aa8abbe/"><span> 🛠 主題配置</span></a></li><li><a class="site-page child" href="/posts/ceeb73f/"><span> ⚔️ 標簽外挂</span></a></li><li><a class="site-page child" href="/posts/98d20436/"><span> ❓ 主題問答</span></a></li><li><a class="site-page child" href="/posts/4073eda/"><span> ⚡️ 進階教程</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-language"></i><span> 语言</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/"><i class="fa-fw fas fa-c"></i><span> 中文</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">行为模式-观察者模式</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-05-04T12:00:56.000Z" title="发表于 2021-05-04 20:00:56">2021-05-04</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-05-04T12:00:56.000Z" title="更新于 2021-05-04 20:00:56">2021-05-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/pattern/">pattern</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">11.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>53分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><script src="\assets\js\APlayer.min.js"> </script><blockquote>
<p><a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/observer">https://refactoringguru.cn/design-patterns/observer</a></p>
</blockquote>
<h1 id="行为模式-观察者模式"><a href="#行为模式-观察者模式" class="headerlink" title="行为模式-观察者模式"></a>行为模式-观察者模式</h1><p><strong>亦称：</strong> 事件订阅者、监听者、Event-Subscriber、Listener、Observer</p>
<h2 id="意图"><a href="#意图" class="headerlink" title="意图"></a>意图</h2><p><strong>观察者模式</strong>是一种行为设计模式， 允许你定义一种订阅机制， 可在对象事件发生时通知多个 “观察” 该对象的其他对象。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/blog/pattern/observer.png"></p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>假如你有两种类型的对象：  <code>顾客</code>和 <code>商店</code> 。 顾客对某个特定品牌的产品非常感兴趣 （例如最新型号的 iPhone 手机）， 而该产品很快将会在商店里出售。</p>
<p>顾客可以每天来商店看看产品是否到货。 但如果商品尚未到货时， 绝大多数来到商店的顾客都会空手而归。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/blog/pattern/observer-comic-1-zh.png" alt="前往商店和发送垃圾邮件"></p>
<p>另一方面， 每次新产品到货时， 商店可以向所有顾客发送邮件 （可能会被视为垃圾邮件）。 这样， 部分顾客就无需反复前往商店了， 但也可能会惹恼对新产品没有兴趣的其他顾客。</p>
<p>我们似乎遇到了一个矛盾： 要么让顾客浪费时间检查产品是否到货， 要么让商店浪费资源去通知没有需求的顾客。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>拥有一些值得关注的状态的对象通常被称为<em>目标</em>， 由于它要将自身的状态改变通知给其他对象， 我们也将其称为<em>发布者</em> （publisher）。 所有希望关注发布者状态变化的其他对象被称为<em>订阅者</em> （subscribers）。</p>
<p>观察者模式建议你为发布者类添加订阅机制， 让每个对象都能订阅或取消订阅发布者事件流。 不要害怕！ 这并不像听上去那么复杂。 实际上， 该机制包括 1） 一个用于存储订阅者对象引用的列表成员变量； 2） 几个用于添加或删除该列表中订阅者的公有方法。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/blog/pattern/solution1-zh-observer.png" alt="订阅机制允许对象订阅事件通知。"></p>
<p>现在， 无论何时发生了重要的发布者事件， 它都要遍历订阅者并调用其对象的特定通知方法。</p>
<p>实际应用中可能会有十几个不同的订阅者类跟踪着同一个发布者类的事件， 你不会希望发布者与所有这些类相耦合的。 此外如果他人会使用发布者类， 那么你甚至可能会对其中的一些类一无所知。</p>
<p>因此， 所有订阅者都必须实现同样的接口， 发布者仅通过该接口与订阅者交互。 接口中必须声明通知方法及其参数， 这样发布者在发出通知时还能传递一些上下文数据。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/blog/pattern/solution2-zh-observer.png" alt="发布者调用订阅者对象中的特定通知方法来通知订阅者。"></p>
<p>如果你的应用中有多个不同类型的发布者， 且希望订阅者可兼容所有发布者， 那么你甚至可以进一步让所有订阅者遵循同样的接口。 该接口仅需描述几个订阅方法即可。 这样订阅者就能在不与具体发布者类耦合的情况下通过接口观察发布者的状态。</p>
<h2 id="真实世界类比"><a href="#真实世界类比" class="headerlink" title="真实世界类比"></a>真实世界类比</h2><p><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/blog/pattern/observer-comic-2-zh.png" alt="杂志和报纸订阅。"></p>
<p>如果你订阅了一份杂志或报纸， 那就不需要再去报摊查询新出版的刊物了。 出版社 （即应用中的 “发布者”） 会在刊物出版后 （甚至提前） 直接将最新一期寄送至你的邮箱中。</p>
<p>出版社负责维护订阅者列表， 了解订阅者对哪些刊物感兴趣。 当订阅者希望出版社停止寄送新一期的杂志时， 他们可随时从该列表中退出。</p>
<h2 id="观察者模式结构"><a href="#观察者模式结构" class="headerlink" title="观察者模式结构"></a>观察者模式结构</h2><p><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/blog/pattern/structure-indexed-observer.png"></p>
<ol>
<li><strong>发布者</strong> （Publisher） 会向其他对象发送值得关注的事件。 事件会在发布者自身状态改变或执行特定行为后发生。 发布者中包含一个允许新订阅者加入和当前订阅者离开列表的订阅构架。</li>
<li>当新事件发生时， 发送者会遍历订阅列表并调用每个订阅者对象的通知方法。 该方法是在订阅者接口中声明的。</li>
<li><strong>订阅者</strong> （Subscriber） 接口声明了通知接口。 在绝大多数情况下， 该接口仅包含一个 <code>update</code>更新方法。 该方法可以拥有多个参数， 使发布者能在更新时传递事件的详细信息。</li>
<li><strong>具体订阅者</strong> （Concrete Subscribers） 可以执行一些操作来回应发布者的通知。 所有具体订阅者类都实现了同样的接口， 因此发布者不需要与具体类相耦合。</li>
<li>订阅者通常需要一些上下文信息来正确地处理更新。 因此， 发布者通常会将一些上下文数据作为通知方法的参数进行传递。 发布者也可将自身作为参数进行传递， 使订阅者直接获取所需的数据。</li>
<li><strong>客户端</strong> （Client） 会分别创建发布者和订阅者对象， 然后为订阅者注册发布者更新。</li>
</ol>
<h2 id="伪代码"><a href="#伪代码" class="headerlink" title="伪代码"></a>伪代码</h2><p>在本例中， <strong>观察者</strong>模式允许文本编辑器对象将自身的状态改变通知给其他服务对象。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/blog/pattern/example-observer.png" alt="将对象中发生的事件通知给其他对象。"></p>
<p>订阅者列表是动态生成的： 对象可在运行时根据程序需要开始或停止监听通知。</p>
<p>在本实现中， 编辑器类自身并不维护订阅列表。 它将工作委派给专门从事此工作的一个特殊帮手对象。 你还可将该对象升级为中心化的事件分发器， 允许任何对象成为发布者。</p>
<p>只要发布者通过同样的接口与所有订阅者进行交互， 那么在程序中新增订阅者时就无需修改已有发布者类的代码。</p>
<figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 发布者基类包含订阅管理代码和通知方法。</span></span><br><span class="line"><span class="keyword">class</span> EventManager <span class="keyword">is</span></span><br><span class="line">    <span class="keyword">private</span> field listeners: hash map <span class="keyword">of</span> event types <span class="keyword">and</span> listeners</span><br><span class="line"></span><br><span class="line">    method subscribe(eventType, listener) <span class="keyword">is</span></span><br><span class="line">        listeners.add(eventType, listener)</span><br><span class="line"></span><br><span class="line">    method unsubscribe(eventType, listener) <span class="keyword">is</span></span><br><span class="line">        listeners.remove(eventType, listener)</span><br><span class="line"></span><br><span class="line">    method notify(eventType, data) <span class="keyword">is</span></span><br><span class="line">        foreach (listener <span class="keyword">in</span> listeners.<span class="keyword">of</span>(eventType)) <span class="keyword">do</span></span><br><span class="line">            listener.update(data)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体发布者包含一些订阅者感兴趣的实际业务逻辑。我们可以从发布者基类中扩</span></span><br><span class="line"><span class="comment">// 展出该类，但在实际情况下并不总能做到，因为具体发布者可能已经是子类了。</span></span><br><span class="line"><span class="comment">// 在这种情况下，你可用组合来修补订阅逻辑，就像我们在这里做的一样。</span></span><br><span class="line"><span class="keyword">class</span> Editor <span class="keyword">is</span></span><br><span class="line">    <span class="keyword">public</span> field events: EventManager</span><br><span class="line">    <span class="keyword">private</span> field <span class="keyword">file</span>: <span class="keyword">File</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">constructor</span> <span class="title">Editor</span><span class="params">()</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">events</span> = <span class="title">new</span> <span class="title">EventManager</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="comment">// 业务逻辑的方法可将变化通知给订阅者。</span></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">openFile</span><span class="params">(path)</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">this</span>.<span class="title">file</span> = <span class="title">new</span> <span class="title">File</span><span class="params">(path)</span></span></span><br><span class="line"><span class="function">        <span class="title">events</span>.<span class="title">notify</span><span class="params">(&quot;open&quot;, <span class="keyword">file</span>.<span class="keyword">name</span>)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">saveFile</span><span class="params">()</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">file</span>.<span class="title">write</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        <span class="title">events</span>.<span class="title">notify</span><span class="params">(&quot;save&quot;, <span class="keyword">file</span>.<span class="keyword">name</span>)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="comment">// ...</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// 这里是订阅者接口。如果你的编程语言支持函数类型，则可用一组函数来代替整</span></span></span><br><span class="line"><span class="function"><span class="comment">// 个订阅者的层次结构。</span></span></span><br><span class="line"><span class="function"><span class="title">interface</span> <span class="title">EventListener</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">update</span><span class="params">(filename)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// 具体订阅者会对其注册的发布者所发出的更新消息做出响应。</span></span></span><br><span class="line"><span class="function"><span class="title">class</span> <span class="title">LoggingListener</span> <span class="title">implements</span> <span class="title">EventListener</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">    <span class="title">private</span> <span class="title">field</span> <span class="title">log</span>:</span> <span class="keyword">File</span></span><br><span class="line">    <span class="keyword">private</span> field <span class="keyword">message</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">constructor</span> <span class="title">LoggingListener</span><span class="params">(log_filename, <span class="keyword">message</span>)</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">this</span>.<span class="title">log</span> = <span class="title">new</span> <span class="title">File</span><span class="params">(log_filename)</span></span></span><br><span class="line"><span class="function">        <span class="title">this</span>.<span class="title">message</span> = <span class="title">message</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">update</span><span class="params">(filename)</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">log</span>.<span class="title">write</span><span class="params">(replace(<span class="string">&#x27;%s&#x27;</span>,filename,<span class="keyword">message</span>)</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">class</span> <span class="title">EmailAlertsListener</span> <span class="title">implements</span> <span class="title">EventListener</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">    <span class="title">private</span> <span class="title">field</span> <span class="title">email</span>:</span> <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">constructor</span> <span class="title">EmailAlertsListener</span><span class="params">(email, <span class="keyword">message</span>)</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">this</span>.<span class="title">email</span> = <span class="title">email</span></span></span><br><span class="line"><span class="function">        <span class="title">this</span>.<span class="title">message</span> = <span class="title">message</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">update</span><span class="params">(filename)</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">system</span>.<span class="title">email</span><span class="params">(email, replace(<span class="string">&#x27;%s&#x27;</span>,filename,<span class="keyword">message</span>)</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// 应用程序可在运行时配置发布者和订阅者。</span></span></span><br><span class="line"><span class="function"><span class="title">class</span> <span class="title">Application</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">config</span><span class="params">()</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">editor</span> = <span class="title">new</span> <span class="title">Editor</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">        <span class="title">logger</span> = <span class="title">new</span> <span class="title">LoggingListener</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">            &quot;/path/<span class="keyword">to</span>/log.txt&quot;,</span></span></span><br><span class="line"><span class="params"><span class="function">            &quot;有人打开了文件：%s&quot;)</span>;</span></span><br><span class="line">        editor.events.subscribe(&quot;open&quot;, logger)</span><br><span class="line"></span><br><span class="line">        emailAlerts = new EmailAlertsListener(</span><br><span class="line">            &quot;admin@example.com&quot;,</span><br><span class="line">            &quot;有人更改了文件：%s&quot;)</span><br><span class="line">        editor.events.subscribe(&quot;save&quot;, emailAlerts)</span><br></pre></td></tr></table></figure>

<h2 id="观察者模式适合应用场景"><a href="#观察者模式适合应用场景" class="headerlink" title="观察者模式适合应用场景"></a>观察者模式适合应用场景</h2><p><strong>当一个对象状态的改变需要改变其他对象，或实际对象是事先未知的或动态变化的时，可使用观察者模式。</strong></p>
<p>当你使用图形用户界面类时通常会遇到一个问题。 比如， 你创建了自定义按钮类并允许客户端在按钮中注入自定义代码， 这样当用户按下按钮时就会触发这些代码。</p>
<p>观察者模式允许任何实现了订阅者接口的对象订阅发布者对象的事件通知。 你可在按钮中添加订阅机制， 允许客户端通过自定义订阅类注入自定义代码。</p>
<p><strong>当应用中的一些对象必须观察其他对象时，可使用该模式。但仅能在有限时间内或特定情况下使用。</strong></p>
<p>订阅列表是动态的， 因此订阅者可随时加入或离开该列表。</p>
<h2 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h2><ol>
<li><p>仔细检查你的业务逻辑， 试着将其拆分为两个部分： 独立于其他代码的核心功能将作为发布者； 其他代码则将转化为一组订阅类。</p>
</li>
<li><p>声明订阅者接口。 该接口至少应声明一个 <code>update</code>方法。</p>
</li>
<li><p>声明发布者接口并定义一些接口来在列表中添加和删除订阅对象。 记住发布者必须仅通过订阅者接口与它们进行交互。</p>
</li>
<li><p>确定存放实际订阅列表的位置并实现订阅方法。 通常所有类型的发布者代码看上去都一样， 因此将列表放置在直接扩展自发布者接口的抽象类中是显而易见的。 具体发布者会扩展该类从而继承所有的订阅行为。</p>
<p>但是， 如果你需要在现有的类层次结构中应用该模式， 则可以考虑使用组合的方式： 将订阅逻辑放入一个独立的对象， 然后让所有实际订阅者使用该对象。</p>
</li>
<li><p>创建具体发布者类。 每次发布者发生了重要事件时都必须通知所有的订阅者。</p>
</li>
<li><p>在具体订阅者类中实现通知更新的方法。 绝大部分订阅者需要一些与事件相关的上下文数据。 这些数据可作为通知方法的参数来传递。</p>
<p>但还有另一种选择。 订阅者接收到通知后直接从通知中获取所有数据。 在这种情况下， 发布者必须通过更新方法将自身传递出去。 另一种不太灵活的方式是通过构造函数将发布者与订阅者永久性地连接起来。</p>
</li>
<li><p>客户端必须生成所需的全部订阅者， 并在相应的发布者处完成注册工作。</p>
</li>
</ol>
<h2 id="观察者模式优缺点"><a href="#观察者模式优缺点" class="headerlink" title="观察者模式优缺点"></a>观察者模式优缺点</h2><p>优点</p>
<ul>
<li><em>开闭原则</em>。 你无需修改发布者代码就能引入新的订阅者类 （如果是发布者接口则可轻松引入发布者类）。</li>
<li>你可以在运行时建立对象之间的联系。</li>
</ul>
<p>缺点</p>
<ul>
<li>订阅者的通知顺序是随机的。</li>
</ul>
<h2 id="与其他模式的关系"><a href="#与其他模式的关系" class="headerlink" title="与其他模式的关系"></a>与其他模式的关系</h2><ul>
<li><p><a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/chain-of-responsibility">责任链模式</a>、 <a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/command">命令模式</a>、 <a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/mediator">中介者模式</a>和<a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/observer">观察者模式</a>用于处理请求发送者和接收者之间的不同连接方式：</p>
<ul>
<li><em>责任链</em>按照顺序将请求动态传递给一系列的潜在接收者， 直至其中一名接收者对请求进行处理。</li>
<li><em>命令</em>在发送者和请求者之间建立单向连接。</li>
<li><em>中介者</em>清除了发送者和请求者之间的直接连接， 强制它们通过一个中介对象进行间接沟通。</li>
<li><em>观察者</em>允许接收者动态地订阅或取消接收请求。</li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/mediator">中介者</a>和<a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/observer">观察者</a>之间的区别往往很难记住。 在大部分情况下， 你可以使用其中一种模式， 而有时可以同时使用。 让我们来看看如何做到这一点。</p>
<p><em>中介者</em>的主要目标是消除一系列系统组件之间的相互依赖。 这些组件将依赖于同一个中介者对象。 <em>观察者</em>的目标是在对象之间建立动态的单向连接， 使得部分对象可作为其他对象的附属发挥作用。</p>
<p>有一种流行的中介者模式实现方式依赖于<em>观察者</em>。 中介者对象担当发布者的角色， 其他组件则作为订阅者， 可以订阅中介者的事件或取消订阅。 当<em>中介者</em>以这种方式实现时， 它可能看上去与<em>观察者</em>非常相似。</p>
<p>当你感到疑惑时， 记住可以采用其他方式来实现中介者。 例如， 你可永久性地将所有组件链接到同一个中介者对象。 这种实现方式和<em>观察者</em>并不相同， 但这仍是一种中介者模式。</p>
<p>假设有一个程序， 其所有的组件都变成了发布者， 它们之间可以相互建立动态连接。 这样程序中就没有中心化的中介者对象， 而只有一些分布式的观察者。</p>
</li>
</ul>
<h2 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h2><p><strong>观察者</strong>是一种行为设计模式， 允许一个对象将其状态的改变通知其他对象</p>
<p>观察者模式提供了一种作用于任何实现了订阅者接口的对象的机制， 可对其事件进行订阅和取消订阅。</p>
<div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">C#</button><button type="button" class="tab">C++</button><button type="button" class="tab">JAVA</button><button type="button" class="tab">PHP</button><button type="button" class="tab">Python</button><button type="button" class="tab">Ruby</button><button type="button" class="tab">Swift</button><button type="button" class="tab">TypeScrit</button><button type="button" class="tab">Golang</button></div><div class="tab-contents"><div class="tab-item-content active"><p><strong>在 C# 中使用模式</strong></p>
<p><strong>复杂度：</strong> ★★☆</p>
<p><strong>流行度：</strong> ★★★</p>
<p><strong>使用示例：</strong> 观察者模式在 C# 代码中很常见， 特别是在 GUI 组件中。 它提供了在不与其他对象所属类耦合的情况下对其事件做出反应的方式。</p>
<p><strong>识别方法：</strong> 该模式可以通过将对象存储在列表中的订阅方法， 和对于面向该列表中对象的更新方法的调用来识别。</p>
<p><strong>概念示例</strong></p>
<p>本例说明了<strong>观察者</strong>设计模式的结构并重点回答了下面的问题：</p>
<ul>
<li>它由哪些类组成？</li>
<li>这些类扮演了哪些角色？</li>
<li>模式中的各个元素会以何种方式相互关联？</li>
</ul>
<p><strong>Program.cs:</strong> 概念示例</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Threading;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">RefactoringGuru.DesignPatterns.Observer.Conceptual</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IObserver</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Receive update from subject</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params">ISubject subject</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ISubject</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Attach an observer to the subject.</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Attach</span>(<span class="params">IObserver observer</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Detach an observer from the subject.</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Detach</span>(<span class="params">IObserver observer</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Notify all observers about an event.</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Notify</span>()</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The Subject owns some important state and notifies observers when the</span></span><br><span class="line">    <span class="comment">// state changes.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Subject</span> : <span class="title">ISubject</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// For the sake of simplicity, the Subject&#x27;s state, essential to all</span></span><br><span class="line">        <span class="comment">// subscribers, is stored in this variable.</span></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> State &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125; = <span class="number">-0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// List of subscribers. In real life, the list of subscribers can be</span></span><br><span class="line">        <span class="comment">// stored more comprehensively (categorized by event type, etc.).</span></span><br><span class="line">        <span class="keyword">private</span> List&lt;IObserver&gt; _observers = <span class="keyword">new</span> List&lt;IObserver&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// The subscription management methods.</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Attach</span>(<span class="params">IObserver observer</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Subject: Attached an observer.&quot;</span>);</span><br><span class="line">            <span class="keyword">this</span>._observers.Add(observer);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Detach</span>(<span class="params">IObserver observer</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">this</span>._observers.Remove(observer);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Subject: Detached an observer.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Trigger an update in each subscriber.</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Notify</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Subject: Notifying observers...&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> observer <span class="keyword">in</span> _observers)</span><br><span class="line">            &#123;</span><br><span class="line">                observer.Update(<span class="keyword">this</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Usually, the subscription logic is only a fraction of what a Subject</span></span><br><span class="line">        <span class="comment">// can really do. Subjects commonly hold some important business logic,</span></span><br><span class="line">        <span class="comment">// that triggers a notification method whenever something important is</span></span><br><span class="line">        <span class="comment">// about to happen (or after it).</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SomeBusinessLogic</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;\nSubject: I&#x27;m doing something important.&quot;</span>);</span><br><span class="line">            <span class="keyword">this</span>.State = <span class="keyword">new</span> Random().Next(<span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">            Thread.Sleep(<span class="number">15</span>);</span><br><span class="line"></span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Subject: My state has just changed to: &quot;</span> + <span class="keyword">this</span>.State);</span><br><span class="line">            <span class="keyword">this</span>.Notify();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Concrete Observers react to the updates issued by the Subject they had</span></span><br><span class="line">    <span class="comment">// been attached to.</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title">ConcreteObserverA</span> : <span class="title">IObserver</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Update</span>(<span class="params">ISubject subject</span>)</span></span><br><span class="line">        &#123;            </span><br><span class="line">            <span class="keyword">if</span> ((subject <span class="keyword">as</span> Subject).State &lt; <span class="number">3</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(<span class="string">&quot;ConcreteObserverA: Reacted to the event.&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title">ConcreteObserverB</span> : <span class="title">IObserver</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Update</span>(<span class="params">ISubject subject</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> ((subject <span class="keyword">as</span> Subject).State == <span class="number">0</span> || (subject <span class="keyword">as</span> Subject).State &gt;= <span class="number">2</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(<span class="string">&quot;ConcreteObserverB: Reacted to the event.&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// The client code.</span></span><br><span class="line">            <span class="keyword">var</span> subject = <span class="keyword">new</span> Subject();</span><br><span class="line">            <span class="keyword">var</span> observerA = <span class="keyword">new</span> ConcreteObserverA();</span><br><span class="line">            subject.Attach(observerA);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> observerB = <span class="keyword">new</span> ConcreteObserverB();</span><br><span class="line">            subject.Attach(observerB);</span><br><span class="line"></span><br><span class="line">            subject.SomeBusinessLogic();</span><br><span class="line">            subject.SomeBusinessLogic();</span><br><span class="line"></span><br><span class="line">            subject.Detach(observerB);</span><br><span class="line"></span><br><span class="line">            subject.SomeBusinessLogic();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Subject: Attached an observer.</span><br><span class="line">Subject: Attached an observer.</span><br><span class="line"></span><br><span class="line">Subject: I&#x27;m doing something important.</span><br><span class="line">Subject: My state has just changed to: 2</span><br><span class="line">Subject: Notifying observers...</span><br><span class="line">ConcreteObserverA: Reacted to the event.</span><br><span class="line">ConcreteObserverB: Reacted to the event.</span><br><span class="line"></span><br><span class="line">Subject: I&#x27;m doing something important.</span><br><span class="line">Subject: My state has just changed to: 1</span><br><span class="line">Subject: Notifying observers...</span><br><span class="line">ConcreteObserverA: Reacted to the event.</span><br><span class="line">Subject: Detached an observer.</span><br><span class="line"></span><br><span class="line">Subject: I&#x27;m doing something important.</span><br><span class="line">Subject: My state has just changed to: 5</span><br><span class="line">Subject: Notifying observers...</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><strong>在 C++ 中使用模式</strong></p>
<p><strong>复杂度：</strong> ★★☆</p>
<p><strong>流行度：</strong> ★★★</p>
<p><strong>使用示例：</strong> 观察者模式在 C++ 代码中很常见， 特别是在 GUI 组件中。 它提供了在不与其他对象所属类耦合的情况下对其事件做出反应的方式。</p>
<p><strong>识别方法：</strong> 该模式可以通过将对象存储在列表中的订阅方法， 和对于面向该列表中对象的更新方法的调用来识别。</p>
<p><strong>概念示例</strong></p>
<p>本例说明了<strong>观察者</strong>设计模式的结构并重点回答了下面的问题：</p>
<ul>
<li>它由哪些类组成？</li>
<li>这些类扮演了哪些角色？</li>
<li>模式中的各个元素会以何种方式相互关联？</li>
</ul>
<p><strong>main.cc:</strong> 概念示例</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Observer Design Pattern</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Intent: Lets you define a subscription mechanism to notify multiple objects</span></span><br><span class="line"><span class="comment"> * about any events that happen to the object they&#x27;re observing.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Note that there&#x27;s a lot of different terms with similar meaning associated</span></span><br><span class="line"><span class="comment"> * with this pattern. Just remember that the Subject is also called the</span></span><br><span class="line"><span class="comment"> * Publisher and the Observer is often called the Subscriber and vice versa.</span></span><br><span class="line"><span class="comment"> * Also the verbs &quot;observe&quot;, &quot;listen&quot; or &quot;track&quot; usually mean the same thing.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;list&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">IObserver</span> &#123;</span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="keyword">virtual</span> ~<span class="built_in">IObserver</span>()&#123;&#125;;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Update</span><span class="params">(<span class="type">const</span> std::string &amp;message_from_subject)</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ISubject</span> &#123;</span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="keyword">virtual</span> ~<span class="built_in">ISubject</span>()&#123;&#125;;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Attach</span><span class="params">(IObserver *observer)</span> </span>= <span class="number">0</span>;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Detach</span><span class="params">(IObserver *observer)</span> </span>= <span class="number">0</span>;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Notify</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Subject owns some important state and notifies observers when the state</span></span><br><span class="line"><span class="comment"> * changes.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Subject</span> : <span class="keyword">public</span> ISubject &#123;</span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="keyword">virtual</span> ~<span class="built_in">Subject</span>() &#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Goodbye, I was the Subject.\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * The subscription management methods.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">Attach</span><span class="params">(IObserver *observer)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">    list_observer_.<span class="built_in">push_back</span>(observer);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">Detach</span><span class="params">(IObserver *observer)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">    list_observer_.<span class="built_in">remove</span>(observer);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">Notify</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">    std::list&lt;IObserver *&gt;::iterator iterator = list_observer_.<span class="built_in">begin</span>();</span><br><span class="line">    <span class="built_in">HowManyObserver</span>();</span><br><span class="line">    <span class="keyword">while</span> (iterator != list_observer_.<span class="built_in">end</span>()) &#123;</span><br><span class="line">      (*iterator)-&gt;<span class="built_in">Update</span>(message_);</span><br><span class="line">      ++iterator;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">CreateMessage</span><span class="params">(std::string message = <span class="string">&quot;Empty&quot;</span>)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;message_ = message;</span><br><span class="line">    <span class="built_in">Notify</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">HowManyObserver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;There are &quot;</span> &lt;&lt; list_observer_.<span class="built_in">size</span>() &lt;&lt; <span class="string">&quot; observers in the list.\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Usually, the subscription logic is only a fraction of what a Subject can</span></span><br><span class="line"><span class="comment">   * really do. Subjects commonly hold some important business logic, that</span></span><br><span class="line"><span class="comment">   * triggers a notification method whenever something important is about to</span></span><br><span class="line"><span class="comment">   * happen (or after it).</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">SomeBusinessLogic</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;message_ = <span class="string">&quot;change message message&quot;</span>;</span><br><span class="line">    <span class="built_in">Notify</span>();</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;I&#x27;m about to do some thing important\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">  std::list&lt;IObserver *&gt; list_observer_;</span><br><span class="line">  std::string message_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Observer</span> : <span class="keyword">public</span> IObserver &#123;</span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">Observer</span>(Subject &amp;subject) : <span class="built_in">subject_</span>(subject) &#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;subject_.<span class="built_in">Attach</span>(<span class="keyword">this</span>);</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Hi, I&#x27;m the Observer \&quot;&quot;</span> &lt;&lt; ++Observer::static_number_ &lt;&lt; <span class="string">&quot;\&quot;.\n&quot;</span>;</span><br><span class="line">    <span class="keyword">this</span>-&gt;number_ = Observer::static_number_;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">virtual</span> ~<span class="built_in">Observer</span>() &#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Goodbye, I was the Observer \&quot;&quot;</span> &lt;&lt; <span class="keyword">this</span>-&gt;number_ &lt;&lt; <span class="string">&quot;\&quot;.\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">Update</span><span class="params">(<span class="type">const</span> std::string &amp;message_from_subject)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">    message_from_subject_ = message_from_subject;</span><br><span class="line">    <span class="built_in">PrintInfo</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">RemoveMeFromTheList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    subject_.<span class="built_in">Detach</span>(<span class="keyword">this</span>);</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Observer \&quot;&quot;</span> &lt;&lt; number_ &lt;&lt; <span class="string">&quot;\&quot; removed from the list.\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">PrintInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Observer \&quot;&quot;</span> &lt;&lt; <span class="keyword">this</span>-&gt;number_ &lt;&lt; <span class="string">&quot;\&quot;: a new message is available --&gt; &quot;</span> &lt;&lt; <span class="keyword">this</span>-&gt;message_from_subject_ &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">  std::string message_from_subject_;</span><br><span class="line">  Subject &amp;subject_;</span><br><span class="line">  <span class="type">static</span> <span class="type">int</span> static_number_;</span><br><span class="line">  <span class="type">int</span> number_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> Observer::static_number_ = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ClientCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  Subject *subject = <span class="keyword">new</span> Subject;</span><br><span class="line">  Observer *observer1 = <span class="keyword">new</span> <span class="built_in">Observer</span>(*subject);</span><br><span class="line">  Observer *observer2 = <span class="keyword">new</span> <span class="built_in">Observer</span>(*subject);</span><br><span class="line">  Observer *observer3 = <span class="keyword">new</span> <span class="built_in">Observer</span>(*subject);</span><br><span class="line">  Observer *observer4;</span><br><span class="line">  Observer *observer5;</span><br><span class="line"></span><br><span class="line">  subject-&gt;<span class="built_in">CreateMessage</span>(<span class="string">&quot;Hello World! :D&quot;</span>);</span><br><span class="line">  observer3-&gt;<span class="built_in">RemoveMeFromTheList</span>();</span><br><span class="line"></span><br><span class="line">  subject-&gt;<span class="built_in">CreateMessage</span>(<span class="string">&quot;The weather is hot today! :p&quot;</span>);</span><br><span class="line">  observer4 = <span class="keyword">new</span> <span class="built_in">Observer</span>(*subject);</span><br><span class="line"></span><br><span class="line">  observer2-&gt;<span class="built_in">RemoveMeFromTheList</span>();</span><br><span class="line">  observer5 = <span class="keyword">new</span> <span class="built_in">Observer</span>(*subject);</span><br><span class="line"></span><br><span class="line">  subject-&gt;<span class="built_in">CreateMessage</span>(<span class="string">&quot;My new car is great! ;)&quot;</span>);</span><br><span class="line">  observer5-&gt;<span class="built_in">RemoveMeFromTheList</span>();</span><br><span class="line"></span><br><span class="line">  observer4-&gt;<span class="built_in">RemoveMeFromTheList</span>();</span><br><span class="line">  observer1-&gt;<span class="built_in">RemoveMeFromTheList</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">delete</span> observer5;</span><br><span class="line">  <span class="keyword">delete</span> observer4;</span><br><span class="line">  <span class="keyword">delete</span> observer3;</span><br><span class="line">  <span class="keyword">delete</span> observer2;</span><br><span class="line">  <span class="keyword">delete</span> observer1;</span><br><span class="line">  <span class="keyword">delete</span> subject;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">ClientCode</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Hi, I&#x27;m the Observer &quot;1&quot;.</span><br><span class="line">Hi, I&#x27;m the Observer &quot;2&quot;.</span><br><span class="line">Hi, I&#x27;m the Observer &quot;3&quot;.</span><br><span class="line">There are 3 observers in the list.</span><br><span class="line">Observer &quot;1&quot;: a new message is available --&gt; Hello World! :D</span><br><span class="line">Observer &quot;2&quot;: a new message is available --&gt; Hello World! :D</span><br><span class="line">Observer &quot;3&quot;: a new message is available --&gt; Hello World! :D</span><br><span class="line">Observer &quot;3&quot; removed from the list.</span><br><span class="line">There are 2 observers in the list.</span><br><span class="line">Observer &quot;1&quot;: a new message is available --&gt; The weather is hot today! :p</span><br><span class="line">Observer &quot;2&quot;: a new message is available --&gt; The weather is hot today! :p</span><br><span class="line">Hi, I&#x27;m the Observer &quot;4&quot;.</span><br><span class="line">Observer &quot;2&quot; removed from the list.</span><br><span class="line">Hi, I&#x27;m the Observer &quot;5&quot;.</span><br><span class="line">There are 3 observers in the list.</span><br><span class="line">Observer &quot;1&quot;: a new message is available --&gt; My new car is great! ;)</span><br><span class="line">Observer &quot;4&quot;: a new message is available --&gt; My new car is great! ;)</span><br><span class="line">Observer &quot;5&quot;: a new message is available --&gt; My new car is great! ;)</span><br><span class="line">Observer &quot;5&quot; removed from the list.</span><br><span class="line">Observer &quot;4&quot; removed from the list.</span><br><span class="line">Observer &quot;1&quot; removed from the list.</span><br><span class="line">Goodbye, I was the Observer &quot;5&quot;.</span><br><span class="line">Goodbye, I was the Observer &quot;4&quot;.</span><br><span class="line">Goodbye, I was the Observer &quot;3&quot;.</span><br><span class="line">Goodbye, I was the Observer &quot;2&quot;.</span><br><span class="line">Goodbye, I was the Observer &quot;1&quot;.</span><br><span class="line">Goodbye, I was the Subject.</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><strong>在 Java 中使用模式</strong></p>
<p><strong>复杂度：</strong> ★★☆</p>
<p><strong>流行度：</strong> ★★★</p>
<p><strong>使用示例：</strong> 观察者模式在 Java 代码中很常见， 特别是在 GUI 组件中。 它提供了在不与其他对象所属类耦合的情况下对其事件做出反应的方式。</p>
<p>这里是核心 Java 程序库中该模式的一些示例：</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://docs.oracle.com/javase/8/docs/api/java/util/Observer.html"><code>java.util.Observer</code></a>&#x2F;<a target="_blank" rel="noopener" href="http://docs.oracle.com/javase/8/docs/api/java/util/Observable.html"> <code>java.util.Observable</code></a> （极少在真实世界中使用）</li>
<li><a target="_blank" rel="noopener" href="http://docs.oracle.com/javase/8/docs/api/java/util/EventListener.html"><code>java.util.EventListener</code></a>的所有实现 （几乎广泛存在于 Swing 组件中）</li>
<li><a target="_blank" rel="noopener" href="http://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpSessionBindingListener.html"><code>javax.servlet.http.HttpSessionBindingListener</code></a></li>
<li><a target="_blank" rel="noopener" href="http://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpSessionAttributeListener.html"><code>javax.servlet.http.HttpSessionAttributeListener</code></a></li>
<li><a target="_blank" rel="noopener" href="http://docs.oracle.com/javaee/7/api/javax/faces/event/PhaseListener.html"><code>javax.faces.event.PhaseListener</code></a></li>
</ul>
<p><strong>识别方法：</strong> 该模式可以通过将对象存储在列表中的订阅方法， 和对于面向该列表中对象的更新方法的调用来识别。</p>
<p><strong>事件订阅</strong></p>
<p>在本例中， 观察者模式在文本编辑器的对象之间建立了间接的合作关系。 每当 <code>编辑器</code> （Editor） 对象改变时， 它都会通知其订阅者。  <code>邮件通知监听器</code> （Email­Notification­Listener） 和 <code>日志开启监听器</code> （Log­Open­Listener） 都将通过执行其基本行为来对这些通知做出反应。</p>
<p>订阅者类不与编辑器类相耦合， 且能在需要时在其他应用中复用。  <code>编辑器</code>类仅依赖于抽象订阅者接口。 这样就能允许在不改变编辑器代码的情况下添加新的订阅者类型。</p>
<p><strong>publisher</strong></p>
<p><strong>publisher&#x2F;EventManager.java:</strong> 基础发布者</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.observer.example.publisher;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.observer.example.listeners.EventListener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EventManager</span> &#123;</span><br><span class="line">    Map&lt;String, List&lt;EventListener&gt;&gt; listeners = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">EventManager</span><span class="params">(String... operations)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (String operation : operations) &#123;</span><br><span class="line">            <span class="built_in">this</span>.listeners.put(operation, <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">subscribe</span><span class="params">(String eventType, EventListener listener)</span> &#123;</span><br><span class="line">        List&lt;EventListener&gt; users = listeners.get(eventType);</span><br><span class="line">        users.add(listener);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unsubscribe</span><span class="params">(String eventType, EventListener listener)</span> &#123;</span><br><span class="line">        List&lt;EventListener&gt; users = listeners.get(eventType);</span><br><span class="line">        users.remove(listener);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notify</span><span class="params">(String eventType, File file)</span> &#123;</span><br><span class="line">        List&lt;EventListener&gt; users = listeners.get(eventType);</span><br><span class="line">        <span class="keyword">for</span> (EventListener listener : users) &#123;</span><br><span class="line">            listener.update(eventType, file);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>editor</strong></p>
<p><strong>editor&#x2F;Editor.java:</strong> 具体发布者， 由其他对象追踪</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.observer.example.editor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.observer.example.publisher.EventManager;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Editor</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> EventManager events;</span><br><span class="line">    <span class="keyword">private</span> File file;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Editor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.events = <span class="keyword">new</span> <span class="title class_">EventManager</span>(<span class="string">&quot;open&quot;</span>, <span class="string">&quot;save&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">openFile</span><span class="params">(String filePath)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.file = <span class="keyword">new</span> <span class="title class_">File</span>(filePath);</span><br><span class="line">        events.notify(<span class="string">&quot;open&quot;</span>, file);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveFile</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.file != <span class="literal">null</span>) &#123;</span><br><span class="line">            events.notify(<span class="string">&quot;save&quot;</span>, file);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Exception</span>(<span class="string">&quot;Please open a file first.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> <strong>listeners</strong></p>
<p><strong>listeners&#x2F;EventListener.java:</strong> 通用观察者接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.observer.example.listeners;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EventListener</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(String eventType, File file)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>listeners&#x2F;EmailNotificationListener.java:</strong> 收到通知后发送邮件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.observer.example.listeners;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmailNotificationListener</span> <span class="keyword">implements</span> <span class="title class_">EventListener</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">EmailNotificationListener</span><span class="params">(String email)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.email = email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(String eventType, File file)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Email to &quot;</span> + email + <span class="string">&quot;: Someone has performed &quot;</span> + eventType + <span class="string">&quot; operation with the following file: &quot;</span> + file.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>listeners&#x2F;LogOpenListener.java:</strong> 收到通知后在日志中记录一条消息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.observer.example.listeners;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogOpenListener</span> <span class="keyword">implements</span> <span class="title class_">EventListener</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> File log;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LogOpenListener</span><span class="params">(String fileName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.log = <span class="keyword">new</span> <span class="title class_">File</span>(fileName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(String eventType, File file)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Save to log &quot;</span> + log + <span class="string">&quot;: Someone has performed &quot;</span> + eventType + <span class="string">&quot; operation with the following file: &quot;</span> + file.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Demo.java:</strong> 初始化代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.observer.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.observer.example.editor.Editor;</span><br><span class="line"><span class="keyword">import</span> refactoring_guru.observer.example.listeners.EmailNotificationListener;</span><br><span class="line"><span class="keyword">import</span> refactoring_guru.observer.example.listeners.LogOpenListener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Editor</span> <span class="variable">editor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Editor</span>();</span><br><span class="line">        editor.events.subscribe(<span class="string">&quot;open&quot;</span>, <span class="keyword">new</span> <span class="title class_">LogOpenListener</span>(<span class="string">&quot;/path/to/log/file.txt&quot;</span>));</span><br><span class="line">        editor.events.subscribe(<span class="string">&quot;save&quot;</span>, <span class="keyword">new</span> <span class="title class_">EmailNotificationListener</span>(<span class="string">&quot;admin@example.com&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            editor.openFile(<span class="string">&quot;test.txt&quot;</span>);</span><br><span class="line">            editor.saveFile();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>OutputDemo.png:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Save to log \path\to\log\file.txt: Someone has performed open operation with the following file: test.txt</span><br><span class="line">Email to admin@example.com: Someone has performed save operation with the following file: test.txt</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><strong>在 PHP 中使用模式</strong></p>
<p><strong>复杂度：</strong> ★★☆</p>
<p><strong>流行度：</strong> ★★★</p>
<p><strong>使用示例：</strong> PHP 中包含几个内置接口 （<a target="_blank" rel="noopener" href="http://php.net/manual/en/class.splsubject.php">SplSubject</a>、 <a target="_blank" rel="noopener" href="http://php.net/manual/en/class.splobserver.php">SplObserver</a>）， 它们能让你的观察器模式实现与其他 PHP 代码兼容。</p>
<p><strong>识别方法：</strong> 该模式可以通过将对象存储在列表中的订阅方法， 和对于面向该列表中对象的更新方法的调用来识别。</p>
<div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">概念示例</button><button type="button" class="tab">真实世界示例</button></div><div class="tab-contents"><div class="tab-item-content active"><p><strong>概念示例</strong></p>
<p>本例说明了<strong>观察者</strong>设计模式的结构并重点回答了下面的问题：</p>
<ul>
<li>它由哪些类组成？</li>
<li>这些类扮演了哪些角色？</li>
<li>模式中的各个元素会以何种方式相互关联？</li>
</ul>
<p>了解该模式的结构后， 你可以更轻松地理解下面基于真实世界的 PHP 应用案例。</p>
<p><strong>index.php:</strong> 概念示例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">RefactoringGuru</span>\<span class="title class_">Observer</span>\<span class="title class_">Conceptual</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * PHP has a couple of built-in interfaces related to the Observer pattern.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Here&#x27;s what the Subject interface looks like:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@link</span> http://php.net/manual/en/class.splsubject.php</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *     interface SplSubject</span></span><br><span class="line"><span class="comment"> *     &#123;</span></span><br><span class="line"><span class="comment"> *         // Attach an observer to the subject.</span></span><br><span class="line"><span class="comment"> *         public function attach(SplObserver $observer);</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *         // Detach an observer from the subject.</span></span><br><span class="line"><span class="comment"> *         public function detach(SplObserver $observer);</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *         // Notify all observers about an event.</span></span><br><span class="line"><span class="comment"> *         public function notify();</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * There&#x27;s also a built-in interface for Observers:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@link</span> http://php.net/manual/en/class.splobserver.php</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *     interface SplObserver</span></span><br><span class="line"><span class="comment"> *     &#123;</span></span><br><span class="line"><span class="comment"> *         public function update(SplSubject $subject);</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Subject owns some important state and notifies observers when the state</span></span><br><span class="line"><span class="comment"> * changes.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Subject</span> <span class="keyword">implements</span> \<span class="title">SplSubject</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> int For the sake of simplicity, the Subject&#x27;s state, essential to</span></span><br><span class="line"><span class="comment">     * all subscribers, is stored in this variable.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$state</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> \SplObjectStorage List of subscribers. In real life, the list of</span></span><br><span class="line"><span class="comment">     * subscribers can be stored more comprehensively (categorized by event</span></span><br><span class="line"><span class="comment">     * type, etc.).</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$observers</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;observers = <span class="keyword">new</span> <span class="title class_">\SplObjectStorage</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The subscription management methods.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">attach</span>(<span class="params">\<span class="built_in">SplObserver</span> <span class="variable">$observer</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Subject: Attached an observer.\n&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;observers-&gt;<span class="title function_ invoke__">attach</span>(<span class="variable">$observer</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">detach</span>(<span class="params">\<span class="built_in">SplObserver</span> <span class="variable">$observer</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;observers-&gt;<span class="title function_ invoke__">detach</span>(<span class="variable">$observer</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Subject: Detached an observer.\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Trigger an update in each subscriber.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">notify</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Subject: Notifying observers...\n&quot;</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;observers <span class="keyword">as</span> <span class="variable">$observer</span>) &#123;</span><br><span class="line">            <span class="variable">$observer</span>-&gt;<span class="title function_ invoke__">update</span>(<span class="variable">$this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Usually, the subscription logic is only a fraction of what a Subject can</span></span><br><span class="line"><span class="comment">     * really do. Subjects commonly hold some important business logic, that</span></span><br><span class="line"><span class="comment">     * triggers a notification method whenever something important is about to</span></span><br><span class="line"><span class="comment">     * happen (or after it).</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">someBusinessLogic</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;\nSubject: I&#x27;m doing something important.\n&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;state = <span class="title function_ invoke__">rand</span>(<span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Subject: My state has just changed to: <span class="subst">&#123;$this-&gt;state&#125;</span>\n&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">notify</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Concrete Observers react to the updates issued by the Subject they had been</span></span><br><span class="line"><span class="comment"> * attached to.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteObserverA</span> <span class="keyword">implements</span> \<span class="title">SplObserver</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params">\<span class="built_in">SplSubject</span> <span class="variable">$subject</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$subject</span>-&gt;state &lt; <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;ConcreteObserverA: Reacted to the event.\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteObserverB</span> <span class="keyword">implements</span> \<span class="title">SplObserver</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params">\<span class="built_in">SplSubject</span> <span class="variable">$subject</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$subject</span>-&gt;state == <span class="number">0</span> || <span class="variable">$subject</span>-&gt;state &gt;= <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;ConcreteObserverB: Reacted to the event.\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The client code.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$subject</span> = <span class="keyword">new</span> <span class="title class_">Subject</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$o1</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ConcreteObserverA</span>();</span><br><span class="line"><span class="variable">$subject</span>-&gt;<span class="title function_ invoke__">attach</span>(<span class="variable">$o1</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$o2</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ConcreteObserverB</span>();</span><br><span class="line"><span class="variable">$subject</span>-&gt;<span class="title function_ invoke__">attach</span>(<span class="variable">$o2</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$subject</span>-&gt;<span class="title function_ invoke__">someBusinessLogic</span>();</span><br><span class="line"><span class="variable">$subject</span>-&gt;<span class="title function_ invoke__">someBusinessLogic</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$subject</span>-&gt;<span class="title function_ invoke__">detach</span>(<span class="variable">$o2</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$subject</span>-&gt;<span class="title function_ invoke__">someBusinessLogic</span>();</span><br></pre></td></tr></table></figure>

<p><strong>Output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Subject: Attached an observer.</span><br><span class="line">Subject: Attached an observer.</span><br><span class="line"></span><br><span class="line">Subject: I&#x27;m doing something important.</span><br><span class="line">Subject: My state has just changed to: 2</span><br><span class="line">Subject: Notifying observers...</span><br><span class="line">ConcreteObserverA: Reacted to the event.</span><br><span class="line">ConcreteObserverB: Reacted to the event.</span><br><span class="line"></span><br><span class="line">Subject: I&#x27;m doing something important.</span><br><span class="line">Subject: My state has just changed to: 4</span><br><span class="line">Subject: Notifying observers...</span><br><span class="line">ConcreteObserverB: Reacted to the event.</span><br><span class="line">Subject: Detached an observer.</span><br><span class="line"></span><br><span class="line">Subject: I&#x27;m doing something important.</span><br><span class="line">Subject: My state has just changed to: 1</span><br><span class="line">Subject: Notifying observers...</span><br><span class="line">ConcreteObserverA: Reacted to the event.</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><strong>真实世界示例</strong></p>
<p>在本例中， <strong>观察者</strong>模式允许多种对象观察程序用户仓库中发生的事件。</p>
<p>仓库发出各种类型的事件并允许观察者监听所有或个别事件。</p>
<p><strong>index.php:</strong> 真实世界示例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">RefactoringGuru</span>\<span class="title class_">Observer</span>\<span class="title class_">RealWorld</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The UserRepository represents a Subject. Various objects are interested in</span></span><br><span class="line"><span class="comment"> * tracking its internal state, whether it&#x27;s adding a new user or removing one.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserRepository</span> <span class="keyword">implements</span> \<span class="title">SplSubject</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> array The list of users.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$users</span> = [];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Here goes the actual Observer management infrastructure. Note that it&#x27;s</span></span><br><span class="line">    <span class="comment">// not everything that our class is responsible for. Its primary business</span></span><br><span class="line">    <span class="comment">// logic is listed below these methods.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$observers</span> = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// A special event group for observers that want to listen to all</span></span><br><span class="line">        <span class="comment">// events.</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;observers[<span class="string">&quot;*&quot;</span>] = [];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">initEventGroup</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$event</span> = <span class="string">&quot;*&quot;</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;observers[<span class="variable">$event</span>])) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;observers[<span class="variable">$event</span>] = [];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">getEventObservers</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$event</span> = <span class="string">&quot;*&quot;</span></span>): <span class="title">array</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">initEventGroup</span>(<span class="variable">$event</span>);</span><br><span class="line">        <span class="variable">$group</span> = <span class="variable language_">$this</span>-&gt;observers[<span class="variable">$event</span>];</span><br><span class="line">        <span class="variable">$all</span> = <span class="variable language_">$this</span>-&gt;observers[<span class="string">&quot;*&quot;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">array_merge</span>(<span class="variable">$group</span>, <span class="variable">$all</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">attach</span>(<span class="params">\<span class="built_in">SplObserver</span> <span class="variable">$observer</span>, <span class="keyword">string</span> <span class="variable">$event</span> = <span class="string">&quot;*&quot;</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">initEventGroup</span>(<span class="variable">$event</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;observers[<span class="variable">$event</span>][] = <span class="variable">$observer</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">detach</span>(<span class="params">\<span class="built_in">SplObserver</span> <span class="variable">$observer</span>, <span class="keyword">string</span> <span class="variable">$event</span> = <span class="string">&quot;*&quot;</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getEventObservers</span>(<span class="variable">$event</span>) <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$s</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$s</span> === <span class="variable">$observer</span>) &#123;</span><br><span class="line">                <span class="keyword">unset</span>(<span class="variable language_">$this</span>-&gt;observers[<span class="variable">$event</span>][<span class="variable">$key</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">notify</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$event</span> = <span class="string">&quot;*&quot;</span>, <span class="variable">$data</span> = <span class="literal">null</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;UserRepository: Broadcasting the &#x27;<span class="subst">$event</span>&#x27; event.\n&quot;</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getEventObservers</span>(<span class="variable">$event</span>) <span class="keyword">as</span> <span class="variable">$observer</span>) &#123;</span><br><span class="line">            <span class="variable">$observer</span>-&gt;<span class="title function_ invoke__">update</span>(<span class="variable">$this</span>, <span class="variable">$event</span>, <span class="variable">$data</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Here are the methods representing the business logic of the class.</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">initialize</span>(<span class="params"><span class="variable">$filename</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;UserRepository: Loading user records from a file.\n&quot;</span>;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">notify</span>(<span class="string">&quot;users:init&quot;</span>, <span class="variable">$filename</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">createUser</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$data</span></span>): <span class="title">User</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;UserRepository: Creating a user.\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$user</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        <span class="variable">$user</span>-&gt;<span class="title function_ invoke__">update</span>(<span class="variable">$data</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$id</span> = <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">openssl_random_pseudo_bytes</span>(<span class="number">16</span>));</span><br><span class="line">        <span class="variable">$user</span>-&gt;<span class="title function_ invoke__">update</span>([<span class="string">&quot;id&quot;</span> =&gt; <span class="variable">$id</span>]);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;users[<span class="variable">$id</span>] = <span class="variable">$user</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">notify</span>(<span class="string">&quot;users:created&quot;</span>, <span class="variable">$user</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$user</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">updateUser</span>(<span class="params">User <span class="variable">$user</span>, <span class="keyword">array</span> <span class="variable">$data</span></span>): <span class="title">User</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;UserRepository: Updating a user.\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$id</span> = <span class="variable">$user</span>-&gt;attributes[<span class="string">&quot;id&quot;</span>];</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;users[<span class="variable">$id</span>])) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$user</span> = <span class="variable language_">$this</span>-&gt;users[<span class="variable">$id</span>];</span><br><span class="line">        <span class="variable">$user</span>-&gt;<span class="title function_ invoke__">update</span>(<span class="variable">$data</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">notify</span>(<span class="string">&quot;users:updated&quot;</span>, <span class="variable">$user</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$user</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">deleteUser</span>(<span class="params">User <span class="variable">$user</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;UserRepository: Deleting a user.\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$id</span> = <span class="variable">$user</span>-&gt;attributes[<span class="string">&quot;id&quot;</span>];</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;users[<span class="variable">$id</span>])) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">unset</span>(<span class="variable language_">$this</span>-&gt;users[<span class="variable">$id</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">notify</span>(<span class="string">&quot;users:deleted&quot;</span>, <span class="variable">$user</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Let&#x27;s keep the User class trivial since it&#x27;s not the focus of our example.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$attributes</span> = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params"><span class="variable">$data</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;attributes = <span class="title function_ invoke__">array_merge</span>(<span class="variable">$this</span>-&gt;attributes, <span class="variable">$data</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * This Concrete Component logs any events it&#x27;s subscribed to.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Logger</span> <span class="keyword">implements</span> \<span class="title">SplObserver</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$filename</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$filename</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;filename = <span class="variable">$filename</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$this</span>-&gt;filename)) &#123;</span><br><span class="line">            <span class="title function_ invoke__">unlink</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params">\<span class="built_in">SplSubject</span> <span class="variable">$repository</span>, <span class="keyword">string</span> <span class="variable">$event</span> = <span class="literal">null</span>, <span class="variable">$data</span> = <span class="literal">null</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$entry</span> = <span class="title function_ invoke__">date</span>(<span class="string">&quot;Y-m-d H:i:s&quot;</span>) . <span class="string">&quot;: &#x27;<span class="subst">$event</span>&#x27; with data &#x27;&quot;</span> . <span class="title function_ invoke__">json_encode</span>(<span class="variable">$data</span>) . <span class="string">&quot;&#x27;\n&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$this</span>-&gt;filename, <span class="variable">$entry</span>, FILE_APPEND);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Logger: I&#x27;ve written &#x27;<span class="subst">$event</span>&#x27; entry to the log.\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * This Concrete Component sends initial instructions to new users. The client</span></span><br><span class="line"><span class="comment"> * is responsible for attaching this component to a proper user creation event.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OnboardingNotification</span> <span class="keyword">implements</span> \<span class="title">SplObserver</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$adminEmail</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$adminEmail</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;adminEmail = <span class="variable">$adminEmail</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params">\<span class="built_in">SplSubject</span> <span class="variable">$repository</span>, <span class="keyword">string</span> <span class="variable">$event</span> = <span class="literal">null</span>, <span class="variable">$data</span> = <span class="literal">null</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// mail($this-&gt;adminEmail,</span></span><br><span class="line">        <span class="comment">//     &quot;Onboarding required&quot;,</span></span><br><span class="line">        <span class="comment">//     &quot;We have a new user. Here&#x27;s his info: &quot; .json_encode($data));</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;OnboardingNotification: The notification has been emailed!\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The client code.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$repository</span> = <span class="keyword">new</span> <span class="title class_">UserRepository</span>();</span><br><span class="line"><span class="variable">$repository</span>-&gt;<span class="title function_ invoke__">attach</span>(<span class="keyword">new</span> <span class="title class_">Logger</span>(<span class="keyword">__DIR__</span> . <span class="string">&quot;/log.txt&quot;</span>), <span class="string">&quot;*&quot;</span>);</span><br><span class="line"><span class="variable">$repository</span>-&gt;<span class="title function_ invoke__">attach</span>(<span class="keyword">new</span> <span class="title class_">OnboardingNotification</span>(<span class="string">&quot;1@example.com&quot;</span>), <span class="string">&quot;users:created&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$repository</span>-&gt;<span class="title function_ invoke__">initialize</span>(<span class="keyword">__DIR__</span> . <span class="string">&quot;/users.csv&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$user</span> = <span class="variable">$repository</span>-&gt;<span class="title function_ invoke__">createUser</span>([</span><br><span class="line">    <span class="string">&quot;name&quot;</span> =&gt; <span class="string">&quot;John Smith&quot;</span>,</span><br><span class="line">    <span class="string">&quot;email&quot;</span> =&gt; <span class="string">&quot;john99@example.com&quot;</span>,</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$repository</span>-&gt;<span class="title function_ invoke__">deleteUser</span>(<span class="variable">$user</span>);</span><br></pre></td></tr></table></figure>

<p><strong>Output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">UserRepository: Loading user records from a file.</span><br><span class="line">UserRepository: Broadcasting the &#x27;users:init&#x27; event.</span><br><span class="line">Logger: I&#x27;ve written &#x27;users:init&#x27; entry to the log.</span><br><span class="line">UserRepository: Creating a user.</span><br><span class="line">UserRepository: Broadcasting the &#x27;users:created&#x27; event.</span><br><span class="line">OnboardingNotification: The notification has been emailed!</span><br><span class="line">Logger: I&#x27;ve written &#x27;users:created&#x27; entry to the log.</span><br><span class="line">UserRepository: Deleting a user.</span><br><span class="line">UserRepository: Broadcasting the &#x27;users:deleted&#x27; event.</span><br><span class="line">Logger: I&#x27;ve written &#x27;users:deleted&#x27; entry to the log.</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><div class="tab-item-content"><p><strong>在 Python 中使用模式</strong></p>
<p><strong>复杂度：</strong> ★★☆</p>
<p><strong>流行度：</strong> ★★★</p>
<p><strong>使用示例：</strong> 观察者模式在 Python 代码中很常见， 特别是在 GUI 组件中。 它提供了在不与其他对象所属类耦合的情况下对其事件做出反应的方式。</p>
<p><strong>识别方法：</strong> 该模式可以通过将对象存储在列表中的订阅方法， 和对于面向该列表中对象的更新方法的调用来识别。</p>
<p><strong>概念示例</strong></p>
<p>本例说明了<strong>观察者</strong>设计模式的结构并重点回答了下面的问题：</p>
<ul>
<li>它由哪些类组成？</li>
<li>这些类扮演了哪些角色？</li>
<li>模式中的各个元素会以何种方式相互关联？</li>
</ul>
<p><strong>main.py:</strong> 概念示例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> annotations</span><br><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randrange</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Subject</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Subject interface declares a set of methods for managing subscribers.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">attach</span>(<span class="params">self, observer: Observer</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Attach an observer to the subject.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">detach</span>(<span class="params">self, observer: Observer</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Detach an observer from the subject.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">notify</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Notify all observers about an event.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteSubject</span>(<span class="title class_ inherited__">Subject</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Subject owns some important state and notifies observers when the state</span></span><br><span class="line"><span class="string">    changes.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    _state: <span class="built_in">int</span> = <span class="literal">None</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    For the sake of simplicity, the Subject&#x27;s state, essential to all</span></span><br><span class="line"><span class="string">    subscribers, is stored in this variable.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    _observers: <span class="type">List</span>[Observer] = []</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    List of subscribers. In real life, the list of subscribers can be stored</span></span><br><span class="line"><span class="string">    more comprehensively (categorized by event type, etc.).</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">attach</span>(<span class="params">self, observer: Observer</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Subject: Attached an observer.&quot;</span>)</span><br><span class="line">        self._observers.append(observer)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">detach</span>(<span class="params">self, observer: Observer</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self._observers.remove(observer)</span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The subscription management methods.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">notify</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Trigger an update in each subscriber.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Subject: Notifying observers...&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> observer <span class="keyword">in</span> self._observers:</span><br><span class="line">            observer.update(self)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">some_business_logic</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Usually, the subscription logic is only a fraction of what a Subject can</span></span><br><span class="line"><span class="string">        really do. Subjects commonly hold some important business logic, that</span></span><br><span class="line"><span class="string">        triggers a notification method whenever something important is about to</span></span><br><span class="line"><span class="string">        happen (or after it).</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\nSubject: I&#x27;m doing something important.&quot;</span>)</span><br><span class="line">        self._state = randrange(<span class="number">0</span>, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Subject: My state has just changed to: <span class="subst">&#123;self._state&#125;</span>&quot;</span>)</span><br><span class="line">        self.notify()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Observer</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Observer interface declares the update method, used by subjects.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">self, subject: Subject</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Receive update from subject.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Concrete Observers react to the updates issued by the Subject they had been</span></span><br><span class="line"><span class="string">attached to.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteObserverA</span>(<span class="title class_ inherited__">Observer</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">self, subject: Subject</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">if</span> subject._state &lt; <span class="number">3</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;ConcreteObserverA: Reacted to the event&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteObserverB</span>(<span class="title class_ inherited__">Observer</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">self, subject: Subject</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">if</span> subject._state == <span class="number">0</span> <span class="keyword">or</span> subject._state &gt;= <span class="number">2</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;ConcreteObserverB: Reacted to the event&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># The client code.</span></span><br><span class="line"></span><br><span class="line">    subject = ConcreteSubject()</span><br><span class="line"></span><br><span class="line">    observer_a = ConcreteObserverA()</span><br><span class="line">    subject.attach(observer_a)</span><br><span class="line"></span><br><span class="line">    observer_b = ConcreteObserverB()</span><br><span class="line">    subject.attach(observer_b)</span><br><span class="line"></span><br><span class="line">    subject.some_business_logic()</span><br><span class="line">    subject.some_business_logic()</span><br><span class="line"></span><br><span class="line">    subject.detach(observer_a)</span><br><span class="line"></span><br><span class="line">    subject.some_business_logic()</span><br></pre></td></tr></table></figure>

<p><strong>Output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Subject: Attached an observer.</span><br><span class="line">Subject: Attached an observer.</span><br><span class="line"></span><br><span class="line">Subject: I&#x27;m doing something important.</span><br><span class="line">Subject: My state has just changed to: 0</span><br><span class="line">Subject: Notifying observers...</span><br><span class="line">ConcreteObserverA: Reacted to the event</span><br><span class="line">ConcreteObserverB: Reacted to the event</span><br><span class="line"></span><br><span class="line">Subject: I&#x27;m doing something important.</span><br><span class="line">Subject: My state has just changed to: 5</span><br><span class="line">Subject: Notifying observers...</span><br><span class="line">ConcreteObserverB: Reacted to the event</span><br><span class="line"></span><br><span class="line">Subject: I&#x27;m doing something important.</span><br><span class="line">Subject: My state has just changed to: 0</span><br><span class="line">Subject: Notifying observers...</span><br><span class="line">ConcreteObserverB: Reacted to the event</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><strong>在 Ruby 中使用模式</strong></p>
<p><strong>复杂度：</strong> ★★☆</p>
<p><strong>流行度：</strong> ★★★</p>
<p><strong>使用示例：</strong> 观察者模式在 Ruby 代码中很常见， 特别是在 GUI 组件中。 它提供了在不与其他对象所属类耦合的情况下对其事件做出反应的方式。</p>
<p><strong>识别方法：</strong> 该模式可以通过将对象存储在列表中的订阅方法， 和对于面向该列表中对象的更新方法的调用来识别。</p>
<p><strong>概念示例</strong></p>
<p>本例说明了<strong>观察者</strong>设计模式的结构并重点回答了下面的问题：</p>
<ul>
<li>它由哪些类组成？</li>
<li>这些类扮演了哪些角色？</li>
<li>模式中的各个元素会以何种方式相互关联？</li>
</ul>
<p><strong>main.rb:</strong> 概念示例</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The Subject interface declares a set of methods for managing subscribers.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Subject</span></span><br><span class="line">  <span class="comment"># Attach an observer to the subject.</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">attach</span>(<span class="params">observer</span>)</span><br><span class="line">    raise NotImplementedError, <span class="string">&quot;<span class="subst">#&#123;<span class="variable language_">self</span>.<span class="keyword">class</span>&#125;</span> has not implemented method &#x27;<span class="subst">#&#123;__method__&#125;</span>&#x27;&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Detach an observer from the subject.</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">detach</span>(<span class="params">observer</span>)</span><br><span class="line">    raise NotImplementedError, <span class="string">&quot;<span class="subst">#&#123;<span class="variable language_">self</span>.<span class="keyword">class</span>&#125;</span> has not implemented method &#x27;<span class="subst">#&#123;__method__&#125;</span>&#x27;&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Notify all observers about an event.</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">notify</span></span><br><span class="line">    raise NotImplementedError, <span class="string">&quot;<span class="subst">#&#123;<span class="variable language_">self</span>.<span class="keyword">class</span>&#125;</span> has not implemented method &#x27;<span class="subst">#&#123;__method__&#125;</span>&#x27;&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The Subject owns some important state and notifies observers when the state</span></span><br><span class="line"><span class="comment"># changes.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteSubject</span> &lt; <span class="title class_ inherited__">Subject</span></span><br><span class="line">  <span class="comment"># For the sake of simplicity, the Subject&#x27;s state, essential to all</span></span><br><span class="line">  <span class="comment"># subscribers, is stored in this variable.</span></span><br><span class="line">  <span class="keyword">attr_accessor</span> <span class="symbol">:state</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># @!attribute observers</span></span><br><span class="line">  <span class="comment"># <span class="doctag">@return</span> [Array&lt;Observer&gt;] attr_accessor :observers private :observers</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">initialize</span></span><br><span class="line">    <span class="variable">@observers</span> = []</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># List of subscribers. In real life, the list of subscribers can be stored</span></span><br><span class="line">  <span class="comment"># more comprehensively (categorized by event type, etc.).</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># <span class="doctag">@param</span> [Obserser] observer</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">attach</span>(<span class="params">observer</span>)</span><br><span class="line">    puts <span class="string">&#x27;Subject: Attached an observer.&#x27;</span></span><br><span class="line">    <span class="variable">@observers</span> &lt;&lt; observer</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># <span class="doctag">@param</span> [Obserser] observer</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">detach</span>(<span class="params">observer</span>)</span><br><span class="line">    <span class="variable">@observers</span>.delete(observer)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># The subscription management methods.</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Trigger an update in each subscriber.</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">notify</span></span><br><span class="line">    puts <span class="string">&#x27;Subject: Notifying observers...&#x27;</span></span><br><span class="line">    <span class="variable">@observers</span>.each &#123; |<span class="params">observer</span>| observer.update(<span class="variable language_">self</span>) &#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Usually, the subscription logic is only a fraction of what a Subject can</span></span><br><span class="line">  <span class="comment"># really do. Subjects commonly hold some important business logic, that</span></span><br><span class="line">  <span class="comment"># triggers a notification method whenever something important is about to</span></span><br><span class="line">  <span class="comment"># happen (or after it).</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">some_business_logic</span></span><br><span class="line">    puts <span class="string">&quot;\nSubject: I&#x27;m doing something important.&quot;</span></span><br><span class="line">    <span class="variable">@state</span> = rand(<span class="number">0</span>..<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    puts <span class="string">&quot;Subject: My state has just changed to: <span class="subst">#&#123;<span class="variable">@state</span>&#125;</span>&quot;</span></span><br><span class="line">    notify</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The Observer interface declares the update method, used by subjects.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Observer</span></span><br><span class="line">  <span class="comment"># Receive update from subject.</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">_subject</span>)</span><br><span class="line">    raise NotImplementedError, <span class="string">&quot;<span class="subst">#&#123;<span class="variable language_">self</span>.<span class="keyword">class</span>&#125;</span> has not implemented method &#x27;<span class="subst">#&#123;__method__&#125;</span>&#x27;&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Concrete Observers react to the updates issued by the Subject they had been</span></span><br><span class="line"><span class="comment"># attached to.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteObserverA</span> &lt; <span class="title class_ inherited__">Observer</span></span><br><span class="line">  <span class="comment"># <span class="doctag">@param</span> [Subject] subject</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">subject</span>)</span><br><span class="line">    puts <span class="string">&#x27;ConcreteObserverA: Reacted to the event&#x27;</span> <span class="keyword">if</span> subject.state &lt; <span class="number">3</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteObserverB</span> &lt; <span class="title class_ inherited__">Observer</span></span><br><span class="line">  <span class="comment"># <span class="doctag">@param</span> [Subject] subject</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">subject</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">unless</span> subject.state.zero? |<span class="params"></span>| subject.state &gt;= <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    puts <span class="string">&#x27;ConcreteObserverB: Reacted to the event&#x27;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The client code.</span></span><br><span class="line"></span><br><span class="line">subject = ConcreteSubject.new</span><br><span class="line"></span><br><span class="line">observer_a = ConcreteObserverA.new</span><br><span class="line">subject.attach(observer_a)</span><br><span class="line"></span><br><span class="line">observer_b = ConcreteObserverB.new</span><br><span class="line">subject.attach(observer_b)</span><br><span class="line"></span><br><span class="line">subject.some_business_logic</span><br><span class="line">subject.some_business_logic</span><br><span class="line"></span><br><span class="line">subject.detach(observer_a)</span><br><span class="line"></span><br><span class="line">subject.some_business_logic</span><br></pre></td></tr></table></figure>

<p><strong>output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Subject: Attached an observer.</span><br><span class="line">Subject: Attached an observer.</span><br><span class="line"></span><br><span class="line">Subject: I&#x27;m doing something important.</span><br><span class="line">Subject: My state has just changed to: 2</span><br><span class="line">Subject: Notifying observers...</span><br><span class="line">ConcreteObserverA: Reacted to the event</span><br><span class="line">ConcreteObserverB: Reacted to the event</span><br><span class="line"></span><br><span class="line">Subject: I&#x27;m doing something important.</span><br><span class="line">Subject: My state has just changed to: 10</span><br><span class="line">Subject: Notifying observers...</span><br><span class="line">ConcreteObserverB: Reacted to the event</span><br><span class="line"></span><br><span class="line">Subject: I&#x27;m doing something important.</span><br><span class="line">Subject: My state has just changed to: 2</span><br><span class="line">Subject: Notifying observers...</span><br><span class="line">ConcreteObserverB: Reacted to the event</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><strong>在 Swift 中使用模式</strong></p>
<p><strong>复杂度：</strong> ★★☆</p>
<p><strong>流行度：</strong> ★★★</p>
<p><strong>使用示例：</strong> 观察者模式在 Swift 代码中很常见， 特别是在 GUI 组件中。 它提供了在不与其他对象所属类耦合的情况下对其事件做出反应的方式。</p>
<p><strong>识别方法：</strong> 该模式可以通过将对象存储在列表中的订阅方法， 和对于面向该列表中对象的更新方法的调用来识别。</p>
<div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">概念示例</button><button type="button" class="tab">真实世界示例</button></div><div class="tab-contents"><div class="tab-item-content active"><p><strong>概念示例</strong></p>
<p>本例说明了<strong>观察者</strong>设计模式的结构并重点回答了下面的问题：</p>
<ul>
<li>它由哪些类组成？</li>
<li>这些类扮演了哪些角色？</li>
<li>模式中的各个元素会以何种方式相互关联？</li>
</ul>
<p>了解该模式的结构后， 你可以更轻松地理解下面基于真实世界的 Swift 应用案例。</p>
<p><strong>Example.swift:</strong> 概念示例</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> XCTest</span><br><span class="line"></span><br><span class="line"><span class="comment">/// The Subject owns some important state and notifies observers when the state</span></span><br><span class="line"><span class="comment">/// changes.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Subject</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// For the sake of simplicity, the Subject&#x27;s state, essential to all</span></span><br><span class="line">    <span class="comment">/// subscribers, is stored in this variable.</span></span><br><span class="line">    <span class="keyword">var</span> state: <span class="type">Int</span> <span class="operator">=</span> &#123; <span class="keyword">return</span> <span class="type">Int</span>(arc4random_uniform(<span class="number">10</span>)) &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// @var array List of subscribers. In real life, the list of subscribers</span></span><br><span class="line">    <span class="comment">/// can be stored more comprehensively (categorized by event type, etc.).</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">var</span> observers <span class="operator">=</span> [<span class="type">Observer</span>]()</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// The subscription management methods.</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">attach</span>(<span class="keyword">_</span> <span class="params">observer</span>: <span class="type">Observer</span>) &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Subject: Attached an observer.<span class="subst">\n</span>&quot;</span>)</span><br><span class="line">        observers.append(observer)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">detach</span>(<span class="keyword">_</span> <span class="params">observer</span>: <span class="type">Observer</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> idx <span class="operator">=</span> observers.firstIndex(where: &#123; <span class="variable">$0</span> <span class="operator">===</span> observer &#125;) &#123;</span><br><span class="line">            observers.remove(at: idx)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Subject: Detached an observer.<span class="subst">\n</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Trigger an update in each subscriber.</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">notify</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Subject: Notifying observers...<span class="subst">\n</span>&quot;</span>)</span><br><span class="line">        observers.forEach(&#123; <span class="variable">$0</span>.update(subject: <span class="keyword">self</span>)&#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Usually, the subscription logic is only a fraction of what a Subject can</span></span><br><span class="line">    <span class="comment">/// really do. Subjects commonly hold some important business logic, that</span></span><br><span class="line">    <span class="comment">/// triggers a notification method whenever something important is about to</span></span><br><span class="line">    <span class="comment">/// happen (or after it).</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">someBusinessLogic</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\n</span>Subject: I&#x27;m doing something important.<span class="subst">\n</span>&quot;</span>)</span><br><span class="line">        state <span class="operator">=</span> <span class="type">Int</span>(arc4random_uniform(<span class="number">10</span>))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Subject: My state has just changed to: <span class="subst">\(state)</span><span class="subst">\n</span>&quot;</span>)</span><br><span class="line">        notify()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// The Observer protocol declares the update method, used by subjects.</span></span><br><span class="line"><span class="keyword">protocol</span> <span class="title class_">Observer</span>: <span class="title class_">class</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">update</span>(<span class="params">subject</span>: <span class="type">Subject</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Concrete Observers react to the updates issued by the Subject they had been</span></span><br><span class="line"><span class="comment">/// attached to.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteObserverA</span>: <span class="title class_">Observer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">update</span>(<span class="params">subject</span>: <span class="type">Subject</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> subject.state <span class="operator">&lt;</span> <span class="number">3</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;ConcreteObserverA: Reacted to the event.<span class="subst">\n</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteObserverB</span>: <span class="title class_">Observer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">update</span>(<span class="params">subject</span>: <span class="type">Subject</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> subject.state <span class="operator">&gt;=</span> <span class="number">3</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;ConcreteObserverB: Reacted to the event.<span class="subst">\n</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Let&#x27;s see how it all works together.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ObserverConceptual</span>: <span class="title class_">XCTestCase</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">testObserverConceptual</span>() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> subject <span class="operator">=</span> <span class="type">Subject</span>()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> observer1 <span class="operator">=</span> <span class="type">ConcreteObserverA</span>()</span><br><span class="line">        <span class="keyword">let</span> observer2 <span class="operator">=</span> <span class="type">ConcreteObserverB</span>()</span><br><span class="line"></span><br><span class="line">        subject.attach(observer1)</span><br><span class="line">        subject.attach(observer2)</span><br><span class="line"></span><br><span class="line">        subject.someBusinessLogic()</span><br><span class="line">        subject.someBusinessLogic()</span><br><span class="line">        subject.detach(observer2)</span><br><span class="line">        subject.someBusinessLogic()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">Subject: Attached an observer.</span><br><span class="line"></span><br><span class="line">Subject: Attached an observer.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Subject: I&#x27;m doing something important.</span><br><span class="line"></span><br><span class="line">Subject: My state has just changed to: 4</span><br><span class="line"></span><br><span class="line">Subject: Notifying observers...</span><br><span class="line"></span><br><span class="line">ConcreteObserverB: Reacted to the event.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Subject: I&#x27;m doing something important.</span><br><span class="line"></span><br><span class="line">Subject: My state has just changed to: 2</span><br><span class="line"></span><br><span class="line">Subject: Notifying observers...</span><br><span class="line"></span><br><span class="line">ConcreteObserverA: Reacted to the event.</span><br><span class="line"></span><br><span class="line">Subject: Detached an observer.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Subject: I&#x27;m doing something important.</span><br><span class="line"></span><br><span class="line">Subject: My state has just changed to: 8</span><br><span class="line"></span><br><span class="line">Subject: Notifying observers...</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><strong>真实世界示例</strong></p>
<p><strong>Example.swift:</strong> 真实世界示例</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> XCTest</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ObserverRealWorld</span>: <span class="title class_">XCTestCase</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">test</span>() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> cartManager <span class="operator">=</span> <span class="type">CartManager</span>()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> navigationBar <span class="operator">=</span> <span class="type">UINavigationBar</span>()</span><br><span class="line">        <span class="keyword">let</span> cartVC <span class="operator">=</span> <span class="type">CartViewController</span>()</span><br><span class="line"></span><br><span class="line">        cartManager.add(subscriber: navigationBar)</span><br><span class="line">        cartManager.add(subscriber: cartVC)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> apple <span class="operator">=</span> <span class="type">Food</span>(id: <span class="number">111</span>, name: <span class="string">&quot;Apple&quot;</span>, price: <span class="number">10</span>, calories: <span class="number">20</span>)</span><br><span class="line">        cartManager.add(product: apple)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> tShirt <span class="operator">=</span> <span class="type">Clothes</span>(id: <span class="number">222</span>, name: <span class="string">&quot;T-shirt&quot;</span>, price: <span class="number">200</span>, size: <span class="string">&quot;L&quot;</span>)</span><br><span class="line">        cartManager.add(product: tShirt)</span><br><span class="line"></span><br><span class="line">        cartManager.remove(product: apple)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protocol</span> <span class="title class_">CartSubscriber</span>: <span class="title class_">CustomStringConvertible</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">accept</span>(<span class="params">changed</span> <span class="params">cart</span>: [<span class="type">Product</span>])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protocol</span> <span class="title class_">Product</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> id: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="keyword">var</span> price: <span class="type">Double</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">isEqual</span>(<span class="params">to</span> <span class="params">product</span>: <span class="type">Product</span>) -&gt; <span class="type">Bool</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">Product</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">isEqual</span>(<span class="params">to</span> <span class="params">product</span>: <span class="type">Product</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id <span class="operator">==</span> product.id</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Food</span>: <span class="title class_">Product</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> id: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> price: <span class="type">Double</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Food-specific properties</span></span><br><span class="line">    <span class="keyword">var</span> calories: <span class="type">Int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Clothes</span>: <span class="title class_">Product</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> id: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> price: <span class="type">Double</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Clothes-specific properties</span></span><br><span class="line">    <span class="keyword">var</span> size: <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CartManager</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">var</span> cart <span class="operator">=</span> [<span class="type">Product</span>]()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">var</span> subscribers <span class="operator">=</span> [<span class="type">CartSubscriber</span>]()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">add</span>(<span class="params">subscriber</span>: <span class="type">CartSubscriber</span>) &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;CartManager: I&#x27;am adding a new subscriber: <span class="subst">\(subscriber.description)</span>&quot;</span>)</span><br><span class="line">        subscribers.append(subscriber)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">add</span>(<span class="params">product</span>: <span class="type">Product</span>) &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\n</span>CartManager: I&#x27;am adding a new product: <span class="subst">\(product.name)</span>&quot;</span>)</span><br><span class="line">        cart.append(product)</span><br><span class="line">        notifySubscribers()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">remove</span>(<span class="params">subscriber</span> <span class="params">filter</span>: (<span class="type">CartSubscriber</span>) -&gt; (<span class="type">Bool</span>)) &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> index <span class="operator">=</span> subscribers.firstIndex(where: filter) <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">        subscribers.remove(at: index)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">remove</span>(<span class="params">product</span>: <span class="type">Product</span>) &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> index <span class="operator">=</span> cart.firstIndex(where: &#123; <span class="variable">$0</span>.isEqual(to: product) &#125;) <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\n</span>CartManager: Product &#x27;<span class="subst">\(product.name)</span>&#x27; is removed from a cart&quot;</span>)</span><br><span class="line">        cart.remove(at: index)</span><br><span class="line">        notifySubscribers()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">notifySubscribers</span>() &#123;</span><br><span class="line">        subscribers.forEach(&#123; <span class="variable">$0</span>.accept(changed: cart) &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">UINavigationBar</span>: <span class="title class_">CartSubscriber</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">accept</span>(<span class="params">changed</span> <span class="params">cart</span>: [<span class="type">Product</span>]) &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;UINavigationBar: Updating an appearance of navigation items&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">override</span> <span class="keyword">var</span> description: <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="string">&quot;UINavigationBar&quot;</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CartViewController</span>: <span class="title class_">UIViewController</span>, <span class="title class_">CartSubscriber</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">accept</span>(<span class="params">changed</span> <span class="params">cart</span>: [<span class="type">Product</span>]) &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;CartViewController: Updating an appearance of a list view with products&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">override</span> <span class="keyword">var</span> description: <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="string">&quot;CartViewController&quot;</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">CartManager: I&#x27;am adding a new subscriber: UINavigationBar</span><br><span class="line">CartManager: I&#x27;am adding a new subscriber: CartViewController</span><br><span class="line"></span><br><span class="line">CartManager: I&#x27;am adding a new product: Apple</span><br><span class="line">UINavigationBar: Updating an appearance of navigation items</span><br><span class="line">CartViewController: Updating an appearance of a list view with products</span><br><span class="line"></span><br><span class="line">CartManager: I&#x27;am adding a new product: T-shirt</span><br><span class="line">UINavigationBar: Updating an appearance of navigation items</span><br><span class="line">CartViewController: Updating an appearance of a list view with products</span><br><span class="line"></span><br><span class="line">CartManager: Product &#x27;Apple&#x27; is removed from a cart</span><br><span class="line">UINavigationBar: Updating an appearance of navigation items</span><br><span class="line">CartViewController: Updating an appearance of a list view with products</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><div class="tab-item-content"><p><strong>在 TypeScript 中使用模式</strong></p>
<p><strong>复杂度：</strong> ★★☆</p>
<p><strong>流行度：</strong> ★★★</p>
<p><strong>使用示例：</strong> 观察者模式在 TypeScript 代码中很常见， 特别是在 GUI 组件中。 它提供了在不与其他对象所属类耦合的情况下对其事件做出反应的方式。</p>
<p><strong>识别方法：</strong> 该模式可以通过将对象存储在列表中的订阅方法， 和对于面向该列表中对象的更新方法的调用来识别。</p>
<p><strong>概念示例</strong></p>
<p>本例说明了<strong>观察者</strong>设计模式的结构并重点回答了下面的问题：</p>
<ul>
<li>它由哪些类组成？</li>
<li>这些类扮演了哪些角色？</li>
<li>模式中的各个元素会以何种方式相互关联？</li>
</ul>
<p><strong>index.ts:</strong> 概念示例</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Subject interface declares a set of methods for managing subscribers.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Subject</span> &#123;</span><br><span class="line">    <span class="comment">// Attach an observer to the subject.</span></span><br><span class="line">    <span class="title function_">attach</span>(<span class="attr">observer</span>: <span class="title class_">Observer</span>): <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Detach an observer from the subject.</span></span><br><span class="line">    <span class="title function_">detach</span>(<span class="attr">observer</span>: <span class="title class_">Observer</span>): <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Notify all observers about an event.</span></span><br><span class="line">    <span class="title function_">notify</span>(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Subject owns some important state and notifies observers when the state</span></span><br><span class="line"><span class="comment"> * changes.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteSubject</span> <span class="keyword">implements</span> <span class="title class_">Subject</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@type</span> &#123;<span class="type">number</span>&#125; For the sake of simplicity, the Subject&#x27;s state, essential</span></span><br><span class="line"><span class="comment">     * to all subscribers, is stored in this variable.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="attr">state</span>: <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@type</span> &#123;<span class="type">Observer[]</span>&#125; List of subscribers. In real life, the list of</span></span><br><span class="line"><span class="comment">     * subscribers can be stored more comprehensively (categorized by event</span></span><br><span class="line"><span class="comment">     * type, etc.).</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="attr">observers</span>: <span class="title class_">Observer</span>[] = [];</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The subscription management methods.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">attach</span>(<span class="attr">observer</span>: <span class="title class_">Observer</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> isExist = <span class="variable language_">this</span>.<span class="property">observers</span>.<span class="title function_">includes</span>(observer);</span><br><span class="line">        <span class="keyword">if</span> (isExist) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Subject: Observer has been attached already.&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Subject: Attached an observer.&#x27;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">observers</span>.<span class="title function_">push</span>(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">detach</span>(<span class="attr">observer</span>: <span class="title class_">Observer</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> observerIndex = <span class="variable language_">this</span>.<span class="property">observers</span>.<span class="title function_">indexOf</span>(observer);</span><br><span class="line">        <span class="keyword">if</span> (observerIndex === -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Subject: Nonexistent observer.&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">observers</span>.<span class="title function_">splice</span>(observerIndex, <span class="number">1</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Subject: Detached an observer.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Trigger an update in each subscriber.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">notify</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Subject: Notifying observers...&#x27;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> observer <span class="keyword">of</span> <span class="variable language_">this</span>.<span class="property">observers</span>) &#123;</span><br><span class="line">            observer.<span class="title function_">update</span>(<span class="variable language_">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Usually, the subscription logic is only a fraction of what a Subject can</span></span><br><span class="line"><span class="comment">     * really do. Subjects commonly hold some important business logic, that</span></span><br><span class="line"><span class="comment">     * triggers a notification method whenever something important is about to</span></span><br><span class="line"><span class="comment">     * happen (or after it).</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">someBusinessLogic</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;\nSubject: I\&#x27;m doing something important.&#x27;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * (<span class="number">10</span> + <span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Subject: My state has just changed to: <span class="subst">$&#123;<span class="variable language_">this</span>.state&#125;</span>`</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">notify</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Observer interface declares the update method, used by subjects.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line">    <span class="comment">// Receive update from subject.</span></span><br><span class="line">    <span class="title function_">update</span>(<span class="attr">subject</span>: <span class="title class_">Subject</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Concrete Observers react to the updates issued by the Subject they had been</span></span><br><span class="line"><span class="comment"> * attached to.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteObserverA</span> <span class="keyword">implements</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">update</span>(<span class="attr">subject</span>: <span class="title class_">Subject</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (subject <span class="keyword">instanceof</span> <span class="title class_">ConcreteSubject</span> &amp;&amp; subject.<span class="property">state</span> &lt; <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ConcreteObserverA: Reacted to the event.&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteObserverB</span> <span class="keyword">implements</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">update</span>(<span class="attr">subject</span>: <span class="title class_">Subject</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (subject <span class="keyword">instanceof</span> <span class="title class_">ConcreteSubject</span> &amp;&amp; (subject.<span class="property">state</span> === <span class="number">0</span> || subject.<span class="property">state</span> &gt;= <span class="number">2</span>)) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ConcreteObserverB: Reacted to the event.&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The client code.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> subject = <span class="keyword">new</span> <span class="title class_">ConcreteSubject</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> observer1 = <span class="keyword">new</span> <span class="title class_">ConcreteObserverA</span>();</span><br><span class="line">subject.<span class="title function_">attach</span>(observer1);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> observer2 = <span class="keyword">new</span> <span class="title class_">ConcreteObserverB</span>();</span><br><span class="line">subject.<span class="title function_">attach</span>(observer2);</span><br><span class="line"></span><br><span class="line">subject.<span class="title function_">someBusinessLogic</span>();</span><br><span class="line">subject.<span class="title function_">someBusinessLogic</span>();</span><br><span class="line"></span><br><span class="line">subject.<span class="title function_">detach</span>(observer2);</span><br><span class="line"></span><br><span class="line">subject.<span class="title function_">someBusinessLogic</span>();</span><br></pre></td></tr></table></figure>

<p><strong>Output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Subject: Attached an observer.</span><br><span class="line">Subject: Attached an observer.</span><br><span class="line"></span><br><span class="line">Subject: I&#x27;m doing something important.</span><br><span class="line">Subject: My state has just changed to: 6</span><br><span class="line">Subject: Notifying observers...</span><br><span class="line">ConcreteObserverB: Reacted to the event.</span><br><span class="line"></span><br><span class="line">Subject: I&#x27;m doing something important.</span><br><span class="line">Subject: My state has just changed to: 1</span><br><span class="line">Subject: Notifying observers...</span><br><span class="line">ConcreteObserverA: Reacted to the event.</span><br><span class="line">Subject: Detached an observer.</span><br><span class="line"></span><br><span class="line">Subject: I&#x27;m doing something important.</span><br><span class="line">Subject: My state has just changed to: 5</span><br><span class="line">Subject: Notifying observers...</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><strong>概念示例</strong></p>
<p>在电商网站中， 商品时不时地会出现缺货情况。 可能会有客户对于缺货的特定商品表现出兴趣。 这一问题有三种解决方案：</p>
<ol>
<li>客户以一定的频率查看商品的可用性。</li>
<li>电商网站向客户发送有库存的所有新商品。</li>
<li>客户只订阅其感兴趣的特定商品， 商品可用时便会收到通知。 同时， 多名客户也可订阅同一款产品。</li>
</ol>
<p>选项 3 是最具可行性的， 这其实就是观察者模式的思想。 观察者模式的主要组成部分有：</p>
<ul>
<li>会在有任何事发生时发布事件的主体。</li>
<li>订阅了主体事件并会在事件发生时收到通知的观察者。</li>
</ul>
<p><strong>subject.go:</strong> 主体</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> subject <span class="keyword">interface</span> &#123;</span><br><span class="line">    register(Observer observer)</span><br><span class="line">    deregister(Observer observer)</span><br><span class="line">    notifyAll()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>item.go:</strong> 具体主体</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> item <span class="keyword">struct</span> &#123;</span><br><span class="line">    observerList []observer</span><br><span class="line">    name         <span class="type">string</span></span><br><span class="line">    inStock      <span class="type">bool</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newItem</span><span class="params">(name <span class="type">string</span>)</span></span> *item &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;item&#123;</span><br><span class="line">        name: name,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i *item)</span></span> updateAvailability() &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Item %s is now in stock\n&quot;</span>, i.name)</span><br><span class="line">    i.inStock = <span class="literal">true</span></span><br><span class="line">    i.notifyAll()</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i *item)</span></span> register(o observer) &#123;</span><br><span class="line">    i.observerList = <span class="built_in">append</span>(i.observerList, o)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i *item)</span></span> deregister(o observer) &#123;</span><br><span class="line">    i.observerList = removeFromslice(i.observerList, o)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i *item)</span></span> notifyAll() &#123;</span><br><span class="line">    <span class="keyword">for</span> _, observer := <span class="keyword">range</span> i.observerList &#123;</span><br><span class="line">        observer.update(i.name)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">removeFromslice</span><span class="params">(observerList []observer, observerToRemove observer)</span></span> []observer &#123;</span><br><span class="line">    observerListLength := <span class="built_in">len</span>(observerList)</span><br><span class="line">    <span class="keyword">for</span> i, observer := <span class="keyword">range</span> observerList &#123;</span><br><span class="line">        <span class="keyword">if</span> observerToRemove.getID() == observer.getID() &#123;</span><br><span class="line">            observerList[observerListLength<span class="number">-1</span>], observerList[i] = observerList[i], observerList[observerListLength<span class="number">-1</span>]</span><br><span class="line">            <span class="keyword">return</span> observerList[:observerListLength<span class="number">-1</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> observerList</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>observer.go:</strong> 观察者</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> observer <span class="keyword">interface</span> &#123;</span><br><span class="line">    update(<span class="type">string</span>)</span><br><span class="line">    getID() <span class="type">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>customer.go:</strong> 具体观察者</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> customer <span class="keyword">struct</span> &#123;</span><br><span class="line">    id <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *customer)</span></span> update(itemName <span class="type">string</span>) &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Sending email to customer %s for item %s\n&quot;</span>, c.id, itemName)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *customer)</span></span> getID() <span class="type">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> c.id</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>main.go:</strong> 客户端代码</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    shirtItem := newItem(<span class="string">&quot;Nike Shirt&quot;</span>)</span><br><span class="line"></span><br><span class="line">    observerFirst := &amp;customer&#123;id: <span class="string">&quot;abc@gmail.com&quot;</span>&#125;</span><br><span class="line">    observerSecond := &amp;customer&#123;id: <span class="string">&quot;xyz@gmail.com&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">    shirtItem.register(observerFirst)</span><br><span class="line">    shirtItem.register(observerSecond)</span><br><span class="line"></span><br><span class="line">    shirtItem.updateAvailability()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Item Nike Shirt is now in stock</span><br><span class="line">Sending email to customer abc@gmail.com for item Nike Shirt</span><br><span class="line">Sending email to customer xyz@gmail.com for item Nike Shirt</span><br></pre></td></tr></table></figure>

<p><em>根据： <a target="_blank" rel="noopener" href="https://golangbyexample.com/observer-design-pattern-golang/">Golang By Example</a></em></p></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://wangyyovo.github.io">Blank</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://wangyyovo.github.io/posts/1b971bb/">https://wangyyovo.github.io/posts/1b971bb/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://wangyyovo.github.io" target="_blank">Blank</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/pattern/">pattern</a></div><div class="post-share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/20fc0d2e2c5e62b73248c59cc505b718.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/95d77da4/" title="行为模式-状态模式"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/649ab9f89b500117f7199cba9697767d.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">行为模式-状态模式</div></div><div class="info-2"><div class="info-item-1">  https://refactoringguru.cn/design-patterns/state  行为模式-状态模式亦称： State 意图状态模式是一种行为设计模式， 让你能在一个对象的内部状态变化时改变其行为， 使其看上去就像改变了自身所属的类一样。  问题状态模式与有限状态机的概念紧密相关。  其主要思想是程序在任意时刻仅可处于几种有限的状态中。 在任何一个特定状态中， 程序的行为都不相同， 且可瞬间从一个状态切换到另一个状态。 不过， 根据当前状态， 程序可能会切换到另外一种状态， 也可能会保持当前状态不变。 这些数量有限且预先定义的状态切换规则被称为转移。 你还可将该方法应用在对象上。 假如你有一个 文档Document类。 文档可能会处于 草稿Draft 、  审阅中Moderation和 已发布Published三种状态中的一种。 文档的 publish发布方法在不同状态下的行为略有不同：  处于 草稿状态时， 它会将文档转移到审阅中状态。 处于 审阅中状态时， 如果当前用户是管理员， 它会公开发布文档。 处于 已发布状态时， 它不会进行任何操作。   状态机...</div></div></div></a><a class="pagination-related" href="/posts/588a77f8/" title="行为模式-备忘录模式"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/9f2a528ed3ddea6fa869c0c8343a9967.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">行为模式-备忘录模式</div></div><div class="info-2"><div class="info-item-1">  https://refactoringguru.cn/design-patterns/memento  行为模式-备忘录模式亦称： 快照、Snapshot、Memento 意图备忘录模式是一种行为设计模式， 允许在不暴露对象实现细节的情况下保存和恢复对象之前的状态。  问题假如你正在开发一款文字编辑器应用程序。 除了简单的文字编辑功能外， 编辑器中还要有设置文本格式和插入内嵌图片等功能。 后来， 你决定让用户能撤销施加在文本上的任何操作。 这项功能在过去几年里变得十分普遍， 因此用户期待任何程序都有这项功能。 你选择采用直接的方式来实现该功能： 程序在执行任何操作前会记录所有的对象状态， 并将其保存下来。 当用户此后需要撤销某个操作时， 程序将从历史记录中获取最近的快照， 然后使用它来恢复所有对象的状态。  让我们来思考一下这些状态快照。 首先， 到底该如何生成一个快照呢？ 很可能你会需要遍历对象的所有成员变量并将其数值复制保存。 但只有当对象对其内容没有严格访问权限限制的情况下， 你才能使用该方式。 不过很遗憾， 绝大部分对象会使用私有成员变量来存储重要数据， 这样别人就无...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/37f0d8f/" title="创建型模式-单例模式"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/6cc78f9be0372c0d330f2c7d326f7d9e.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-03</div><div class="info-item-2">创建型模式-单例模式</div></div><div class="info-2"><div class="info-item-1">  https://refactoringguru.cn/design-patterns/singleton  创建型模式-单例模式亦称： 单件模式、Singleton 意图单例模式是一种创建型设计模式， 让你能够保证一个类只有一个实例， 并提供一个访问该实例的全局节点。  问题单例模式同时解决了两个问题， 所以违反了_单一职责原则_：  保证一个类只有一个实例。 为什么会有人想要控制一个类所拥有的实例数量？ 最常见的原因是控制某些共享资源 （例如数据库或文件） 的访问权限。 它的运作方式是这样的： 如果你创建了一个对象， 同时过一会儿后你决定再创建一个新对象， 此时你会获得之前已创建的对象， 而不是一个新对象。 注意， 普通构造函数无法实现上述行为， 因为构造函数的设计决定了它必须总是返回一个新对象。   为该实例提供一个全局访问节点。 还记得你 （好吧， 其实是我自己） 用过的那些存储重要对象的全局变量吗？ 它们在使用上十分方便， 但同时也非常不安全， 因为任何代码都有可能覆盖掉那些变量的内容， 从而引发程序崩溃。 和全局变量一样， 单例模式也允许在程序的任何地方访问特定对象...</div></div></div></a><a class="pagination-related" href="/posts/63b28d52/" title="创建型模式-原型模式"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/01b549d5aec9f475e74b2781486eed2d.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-03</div><div class="info-item-2">创建型模式-原型模式</div></div><div class="info-2"><div class="info-item-1">  https://refactoringguru.cn/design-patterns/prototype  创建型模式-原型模式亦称： 克隆、Clone、Prototype 意图原型模式是一种创建型设计模式， 使你能够复制已有对象， 而又无需使代码依赖它们所属的类。  问题如果你有一个对象， 并希望生成与其完全相同的一个复制品， 你该如何实现呢？ 首先， 你必须新建一个属于相同类的对象。 然后， 你必须遍历原始对象的所有成员变量， 并将成员变量值复制到新对象中。 不错！ 但有个小问题。 并非所有对象都能通过这种方式进行复制， 因为有些对象可能拥有私有成员变量， 它们在对象本身以外是不可见的。  直接复制还有另外一个问题。 因为你必须知道对象所属的类才能创建复制品， 所以代码必须依赖该类。 即使你可以接受额外的依赖性， 那还有另外一个问题： 有时你只知道对象所实现的接口， 而不知道其所属的具体类， 比如可向方法的某个参数传入实现了某个接口的任何对象。 解决方案原型模式将克隆过程委派给被克隆的实际对象。 模式为所有支持克隆的对象声明了一个通用接口， 该接口让你能够克隆对象， 同时...</div></div></div></a><a class="pagination-related" href="/posts/7a751a0c/" title="创建型模式-工厂方法模式"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/2cc53835314eae7d55be8b341557ddb0.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-03</div><div class="info-item-2">创建型模式-工厂方法模式</div></div><div class="info-2"><div class="info-item-1">  https://refactoringguru.cn/design-patterns/factory-method  创建型模式-工厂方法模式**亦称：**虚拟构造函数、Virtual Constructor、Factory Method 意图工厂方法模式是一种创建型设计模式， 其在父类中提供一个创建对象的方法， 允许子类决定实例化对象的类型。  问题假设你正在开发一款物流管理应用。 最初版本只能处理卡车运输， 因此大部分代码都在位于名为 卡车的类中。 一段时间后， 这款应用变得极受欢迎。 你每天都能收到十几次来自海运公司的请求， 希望应用能够支持海上物流功能。  这可是个好消息。 但是代码问题该如何处理呢？ 目前， 大部分代码都与 卡车类相关。 在程序中添加 轮船类需要修改全部代码。 更糟糕的是， 如果你以后需要在程序中支持另外一种运输方式， 很可能需要再次对这些代码进行大幅修改。 最后， 你将不得不编写繁复的代码， 根据不同的运输对象类， 在应用中进行不同的处理。 解决方案工厂方法模式建议使用特殊的工厂方法代替对于对象构造函数的直接调用 （即使用 new运算符）。 不用担...</div></div></div></a><a class="pagination-related" href="/posts/63b2a10f/" title="工厂模式比较"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/dd999ecec29f3590f23c26fbb79bb612.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-04</div><div class="info-item-2">工厂模式比较</div></div><div class="info-2"><div class="info-item-1">  https://refactoringguru.cn/design-patterns/factory-comparison  工厂模式比较本文将对下列概念之间的差异进行说明：  工厂 构建方法 静态构建 （或工厂） 方法 简单工厂 工厂方法 抽象工厂  你可以在网上找到这些术语的参考信息。 尽管它们看上去相似， 但其含义都不一样。 许多人没有意识到这一点， 从而出现了混淆和误解。 因此让我们搞清楚其中的不同之处， 一劳永逸地解决这个问题。 1. 工厂工厂是一个含义模糊的术语， 表示可以创建一些东西的函数、 方法或类。 最常见的情况下， 工厂创建的是对象。 但是它们也可以创建文件和数据库记录等其他东西。 例如， 下面这些东西都可以非正式地被称为 “工厂”：  创建程序 GUI 的函数或方法； 创建用户的类； 以特定方式调用类构造函数的静态方法。 一种创建型设计模式。  当某人说到 “工厂” 这个词时， 其具体含义通常可以根据上下文来确定。 但如果你有疑问， 可以直接提问。 毕竟作者本人有时候也没有搞清楚。 2. 构建方法构建方法在 《重构与模式》 中被定义为 “创建对象的方法”...</div></div></div></a><a class="pagination-related" href="/posts/a951f0f7/" title="创建型模式-抽象工厂模式"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/40d08d3b2ae8dc4074a9f3a7942a0b5a.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-03</div><div class="info-item-2">创建型模式-抽象工厂模式</div></div><div class="info-2"><div class="info-item-1">  https://refactoringguru.cn/design-patterns/abstract-factory  创建型模式-抽象工厂模式亦称： Abstract Factory 意图抽象工厂模式是一种创建型设计模式， 它能创建一系列相关的对象， 而无需指定其具体类。  问题假设你正在开发一款家具商店模拟器。 你的代码中包括一些类， 用于表示：  一系列相关产品， 例如 椅子Chair 、  沙发Sofa和 咖啡桌Coffee­Table 。 系列产品的不同变体。 例如， 你可以使用 现代Modern 、  维多利亚Victorian 、  装饰风艺术Art­Deco等风格生成 椅子 、  沙发和 咖啡桌 。   你需要设法单独生成每件家具对象， 这样才能确保其风格一致。 如果顾客收到的家具风格不一样， 他们可不会开心。  此外， 你也不希望在添加新产品或新风格时修改已有代码。 家具供应商对于产品目录的更新非常频繁， 你不会想在每次更新时都去修改核心代码的。 解决方案首先， 抽象工厂模式建议为系列中的每件产品明确声明接口 （例如椅子、 沙发或咖啡桌）。 然后， 确保所...</div></div></div></a><a class="pagination-related" href="/posts/e59e3a52/" title="创建型模式-生成器模式"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/43a23affdea04c9c39e82f19a8ff21d8.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-03</div><div class="info-item-2">创建型模式-生成器模式</div></div><div class="info-2"><div class="info-item-1">  https://refactoringguru.cn/design-patterns/builder  创建型模式-生成器模式亦称： 建造者模式、Builder 意图生成器模式是一种创建型设计模式， 使你能够分步骤创建复杂对象。 该模式允许你使用相同的创建代码生成不同类型和形式的对象。  问题假设有这样一个复杂对象， 在对其进行构造时需要对诸多成员变量和嵌套对象进行繁复的初始化工作。 这些初始化代码通常深藏于一个包含众多参数且让人基本看不懂的构造函数中； 甚至还有更糟糕的情况， 那就是这些代码散落在客户端代码的多个位置。  例如， 我们来思考如何创建一个 房屋House对象。 建造一栋简单的房屋， 首先你需要建造四面墙和地板， 安装房门和一套窗户， 然后再建造一个屋顶。 但是如果你想要一栋更宽敞更明亮的房屋， 还要有院子和其他设施 （例如暖气、 排水和供电设备）， 那又该怎么办呢？ 最简单的方法是扩展 房屋基类， 然后创建一系列涵盖所有参数组合的子类。 但最终你将面对相当数量的子类。 任何新增的参数 （例如门廊类型） 都会让这个层次结构更加复杂。 另一种方法则无需生成子类。 ...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/theme/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Blank</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">352</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">46</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">58</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>主题 GitHub</span></a><div class="card-info-social-icons"><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fas fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A1%8C%E4%B8%BA%E6%A8%A1%E5%BC%8F-%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.</span> <span class="toc-text">行为模式-观察者模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%84%8F%E5%9B%BE"><span class="toc-number">1.1.</span> <span class="toc-text">意图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98"><span class="toc-number">1.2.</span> <span class="toc-text">问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">1.3.</span> <span class="toc-text">解决方案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9C%9F%E5%AE%9E%E4%B8%96%E7%95%8C%E7%B1%BB%E6%AF%94"><span class="toc-number">1.4.</span> <span class="toc-text">真实世界类比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F%E7%BB%93%E6%9E%84"><span class="toc-number">1.5.</span> <span class="toc-text">观察者模式结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%AA%E4%BB%A3%E7%A0%81"><span class="toc-number">1.6.</span> <span class="toc-text">伪代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F%E9%80%82%E5%90%88%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.7.</span> <span class="toc-text">观察者模式适合应用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F"><span class="toc-number">1.8.</span> <span class="toc-text">实现方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-number">1.9.</span> <span class="toc-text">观察者模式优缺点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8E%E5%85%B6%E4%BB%96%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">1.10.</span> <span class="toc-text">与其他模式的关系</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.11.</span> <span class="toc-text">代码示例</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/d14168d/" title="虚拟机问题合集"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/hexo/090cfe4e9e60b0ad0de05db822f3ae97.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="虚拟机问题合集"/></a><div class="content"><a class="title" href="/posts/d14168d/" title="虚拟机问题合集">虚拟机问题合集</a><time datetime="2022-07-16T13:30:36.000Z" title="发表于 2022-07-16 21:30:36">2022-07-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/f540045f/" title="用go语言编写移动端sdk和app开发"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/golang/941ed1ec2925719a0c92e76f4f786b6a.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="用go语言编写移动端sdk和app开发"/></a><div class="content"><a class="title" href="/posts/f540045f/" title="用go语言编写移动端sdk和app开发">用go语言编写移动端sdk和app开发</a><time datetime="2022-07-04T12:14:21.000Z" title="发表于 2022-07-04 20:14:21">2022-07-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/5faac006/" title="在线编程IDE"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/hexo/090cfe4e9e60b0ad0de05db822f3ae97.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="在线编程IDE"/></a><div class="content"><a class="title" href="/posts/5faac006/" title="在线编程IDE">在线编程IDE</a><time datetime="2022-06-12T13:30:36.000Z" title="发表于 2022-06-12 21:30:36">2022-06-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/7594185d/" title="即时性能分析工具Pyroscope"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/golang/3bfb3279740bc9a5b5ef436fa887ef07.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="即时性能分析工具Pyroscope"/></a><div class="content"><a class="title" href="/posts/7594185d/" title="即时性能分析工具Pyroscope">即时性能分析工具Pyroscope</a><time datetime="2022-06-12T08:07:36.000Z" title="发表于 2022-06-12 16:07:36">2022-06-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/82a7aa7c/" title="golang性能调试优化方法"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="golang性能调试优化方法"/></a><div class="content"><a class="title" href="/posts/82a7aa7c/" title="golang性能调试优化方法">golang性能调试优化方法</a><time datetime="2022-06-12T03:00:36.000Z" title="发表于 2022-06-12 11:00:36">2022-06-12</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By Blank</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 5.4.2</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.3</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = {"placeholder":"说些什么吧"}

  const initValine = (el, path) => {
    if (isShuoshuo) {
      window.shuoshuoComment.destroyValine = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    const valineConfig = {
      el: '#vcomment',
      appId: 'BSfgwCPLOvPHVPaSoBCGSENf-MdYXbMMI',
      appKey: '2Q8qq5060qxycL6FPL26LnMG',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      visitor: false,
      ...option,
      path: isShuoshuo ? path : (option && option.path) || window.location.pathname
    }

    new Valine(valineConfig)
  }

  const loadValine = async (el, path) => {
    if (typeof Valine === 'function') {
      initValine(el, path)
    } else {
      await btf.getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js')
      initValine(el, path)
    }
  }

  if (isShuoshuo) {
    'Valine' === 'Valine'
      ? window.shuoshuoComment = { loadComment: loadValine }
      : window.loadOtherComment = loadValine
    return
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>