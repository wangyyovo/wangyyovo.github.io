<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>创建型模式-原型模式 | Blank</title><meta name="keywords" content="pattern"><meta name="author" content="Blank"><meta name="copyright" content="Blank"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="https:&#x2F;&#x2F;refactoringguru.cn&#x2F;design-patterns&#x2F;prototype  创建型模式-原型模式亦称： 克隆、Clone、Prototype 意图原型模式是一种创建型设计模式， 使你能够复制已有对象， 而又无需使代码依赖它们所属的类。  问题如果你有一个对象， 并希望生成与其完全相同的一个复制品， 你该如何实现呢？ 首先， 你必须新建一个属于相同类的对象。 然后">
<meta property="og:type" content="article">
<meta property="og:title" content="创建型模式-原型模式">
<meta property="og:url" content="https://wangyyovo.github.io/posts/63b28d52/">
<meta property="og:site_name" content="Blank">
<meta property="og:description" content="https:&#x2F;&#x2F;refactoringguru.cn&#x2F;design-patterns&#x2F;prototype  创建型模式-原型模式亦称： 克隆、Clone、Prototype 意图原型模式是一种创建型设计模式， 使你能够复制已有对象， 而又无需使代码依赖它们所属的类。  问题如果你有一个对象， 并希望生成与其完全相同的一个复制品， 你该如何实现呢？ 首先， 你必须新建一个属于相同类的对象。 然后">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/01b549d5aec9f475e74b2781486eed2d.jpg">
<meta property="article:published_time" content="2021-05-03T07:49:44.000Z">
<meta property="article:modified_time" content="2021-05-03T07:49:44.000Z">
<meta property="article:author" content="Blank">
<meta property="article:tag" content="pattern">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/01b549d5aec9f475e74b2781486eed2d.jpg"><link rel="shortcut icon" href="https://raw.githubusercontents.com/wangyyovo/CDN/master/theme/favicon.ico"><link rel="canonical" href="https://wangyyovo.github.io/posts/63b28d52/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '创建型模式-原型模式',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-05-03 15:49:44'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="alternate" href="/atom.xml" title="Blank" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://raw.githubusercontents.com/wangyyovo/CDN/master/theme/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">356</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">36</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">54</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-coffee"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-image"></i><span> 相册</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> 教程</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/posts/21cfbf15/"><span> 🚀 快速開始</span></a></li><li><a class="site-page child" href="/posts/dc584b87/"><span> 📑 主題頁面</span></a></li><li><a class="site-page child" href="/posts/4aa8abbe/"><span> 🛠 主題配置-1</span></a></li><li><a class="site-page child" href="/posts/ceeb73f/"><span> ⚔️ 主題配置-2</span></a></li><li><a class="site-page child" href="/posts/98d20436/"><span> ❓ 主題問答</span></a></li><li><a class="site-page child" href="/posts/4073eda/"><span> ⚡️ 進階教程</span></a></li><li><a class="site-page child" href="/posts/198a4240/"><span> ✨ 更新日誌</span></a></li><li><a class="site-page child" href="/posts/507c070f/"><span> 📑 Aplayer教程</span></a></li><li><a class="site-page child" href="/posts/2df239ce/"><span> 📑 標籤外掛</span></a></li><li><a class="site-page child" href="/posts/b37b5fe3/"><span> 📑 自定義代碼配色</span></a></li><li><a class="site-page child" href="/posts/ea33ab97/"><span> 📑 自定義側邊欄</span></a></li><li><a class="site-page child" href="/posts/89757140/"><span> 📑 Markdown</span></a></li><li><a class="site-page child" href="/posts/9db656e5/"><span> 📑 代码高亮测试</span></a></li><li><a class="site-page child" href="/posts/c9711c19/"><span> 📑 當設置top_img為false時</span></a></li><li><a class="site-page child" href="/posts/39b121ef/"><span> 📑 Hexo內置標籤外掛</span></a></li><li><a class="site-page child" href="/posts/7670b080/"><span> 📑 Butterfly 美化/優化/魔改 教程合集</span></a></li><li><a class="site-page child" href="/posts/913b2502/"><span> 📑 没有封面</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/01b549d5aec9f475e74b2781486eed2d.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Blank</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-coffee"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-image"></i><span> 相册</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> 教程</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/posts/21cfbf15/"><span> 🚀 快速開始</span></a></li><li><a class="site-page child" href="/posts/dc584b87/"><span> 📑 主題頁面</span></a></li><li><a class="site-page child" href="/posts/4aa8abbe/"><span> 🛠 主題配置-1</span></a></li><li><a class="site-page child" href="/posts/ceeb73f/"><span> ⚔️ 主題配置-2</span></a></li><li><a class="site-page child" href="/posts/98d20436/"><span> ❓ 主題問答</span></a></li><li><a class="site-page child" href="/posts/4073eda/"><span> ⚡️ 進階教程</span></a></li><li><a class="site-page child" href="/posts/198a4240/"><span> ✨ 更新日誌</span></a></li><li><a class="site-page child" href="/posts/507c070f/"><span> 📑 Aplayer教程</span></a></li><li><a class="site-page child" href="/posts/2df239ce/"><span> 📑 標籤外掛</span></a></li><li><a class="site-page child" href="/posts/b37b5fe3/"><span> 📑 自定義代碼配色</span></a></li><li><a class="site-page child" href="/posts/ea33ab97/"><span> 📑 自定義側邊欄</span></a></li><li><a class="site-page child" href="/posts/89757140/"><span> 📑 Markdown</span></a></li><li><a class="site-page child" href="/posts/9db656e5/"><span> 📑 代码高亮测试</span></a></li><li><a class="site-page child" href="/posts/c9711c19/"><span> 📑 當設置top_img為false時</span></a></li><li><a class="site-page child" href="/posts/39b121ef/"><span> 📑 Hexo內置標籤外掛</span></a></li><li><a class="site-page child" href="/posts/7670b080/"><span> 📑 Butterfly 美化/優化/魔改 教程合集</span></a></li><li><a class="site-page child" href="/posts/913b2502/"><span> 📑 没有封面</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">创建型模式-原型模式</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-05-03T07:49:44.000Z" title="发表于 2021-05-03 15:49:44">2021-05-03</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-05-03T07:49:44.000Z" title="更新于 2021-05-03 15:49:44">2021-05-03</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/pattern/">pattern</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">9.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>45分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="创建型模式-原型模式"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><script src="\assets\js\APlayer.min.js"> </script><blockquote>
<p><a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/prototype">https://refactoringguru.cn/design-patterns/prototype</a></p>
</blockquote>
<h1 id="创建型模式-原型模式"><a href="#创建型模式-原型模式" class="headerlink" title="创建型模式-原型模式"></a>创建型模式-原型模式</h1><p><strong>亦称：</strong> 克隆、Clone、Prototype</p>
<h2 id="意图"><a href="#意图" class="headerlink" title="意图"></a>意图</h2><p><strong>原型模式</strong>是一种创建型设计模式， 使你能够复制已有对象， 而又无需使代码依赖它们所属的类。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/blog/pattern/prototype.png"></p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>如果你有一个对象， 并希望生成与其完全相同的一个复制品， 你该如何实现呢？ 首先， 你必须新建一个属于相同类的对象。 然后， 你必须遍历原始对象的所有成员变量， 并将成员变量值复制到新对象中。</p>
<p>不错！ 但有个小问题。 并非所有对象都能通过这种方式进行复制， 因为有些对象可能拥有私有成员变量， 它们在对象本身以外是不可见的。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/blog/pattern/prototype-comic-1-zh.png" alt="“从外部”复制对象并非总是可行。"></p>
<p>直接复制还有另外一个问题。 因为你必须知道对象所属的类才能创建复制品， 所以代码必须依赖该类。 即使你可以接受额外的依赖性， 那还有另外一个问题： 有时你只知道对象所实现的接口， 而不知道其所属的具体类， 比如可向方法的某个参数传入实现了某个接口的任何对象。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>原型模式将克隆过程委派给被克隆的实际对象。 模式为所有支持克隆的对象声明了一个通用接口， 该接口让你能够克隆对象， 同时又无需将代码和对象所属类耦合。 通常情况下， 这样的接口中仅包含一个 <code>克隆</code>方法。</p>
<p>所有的类对 <code>克隆</code>方法的实现都非常相似。 该方法会创建一个当前类的对象， 然后将原始对象所有的成员变量值复制到新建的类中。 你甚至可以复制私有成员变量， 因为绝大部分编程语言都允许对象访问其同类对象的私有成员变量。</p>
<p>支持克隆的对象即为<em>原型</em>。 当你的对象有几十个成员变量和几百种类型时， 对其进行克隆甚至可以代替子类的构造。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/blog/pattern/prototype-comic-2-zh.png" alt="预生成原型可以代替子类的构造"></p>
<p>其运作方式如下： 创建一系列不同类型的对象并不同的方式对其进行配置。 如果所需对象与预先配置的对象相同， 那么你只需克隆原型即可， 无需新建一个对象。</p>
<h2 id="真实世界类比"><a href="#真实世界类比" class="headerlink" title="真实世界类比"></a>真实世界类比</h2><p>现实生活中， 产品在得到大规模生产前会使用原型进行各种测试。 但在这种情况下， 原型只是一种被动的工具， 不参与任何真正的生产活动。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/blog/pattern/prototype-comic-3-zh.png" alt="一个细胞的分裂"></p>
<p>由于工业原型并不是真正意义上的自我复制， 因此细胞有丝分裂 （还记得生物学知识吗？） 或许是更恰当的类比。 有丝分裂会产生一对完全相同的细胞。 原始细胞就是一个原型， 它在复制体的生成过程中起到了推动作用。</p>
<h2 id="原型模式结构"><a href="#原型模式结构" class="headerlink" title="原型模式结构"></a>原型模式结构</h2><h4 id="基本实现"><a href="#基本实现" class="headerlink" title="基本实现"></a>基本实现</h4><p><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/blog/pattern/structure-indexed-3.png"></p>
<ol>
<li><strong>原型</strong> （Prototype） 接口将对克隆方法进行声明。 在绝大多数情况下， 其中只会有一个名为 <code>clone</code>克隆的方法。</li>
<li><strong>具体原型</strong> （Concrete Prototype） 类将实现克隆方法。 除了将原始对象的数据复制到克隆体中之外， 该方法有时还需处理克隆过程中的极端情况， 例如克隆关联对象和梳理递归依赖等等。</li>
<li><strong>客户端</strong> （Client） 可以复制实现了原型接口的任何对象。</li>
</ol>
<h4 id="原型注册表实现"><a href="#原型注册表实现" class="headerlink" title="原型注册表实现"></a>原型注册表实现</h4><p><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/blog/pattern/structure-prototype-cache-indexed.png"></p>
<ol>
<li><strong>原型注册表</strong> （Prototype Registry） 提供了一种访问常用原型的简单方法， 其中存储了一系列可供随时复制的预生成对象。 最简单的注册表原型是一个 <code>名称 → 原型</code>的哈希表。 但如果需要使用名称以外的条件进行搜索， 你可以创建更加完善的注册表版本。</li>
</ol>
<h2 id="伪代码"><a href="#伪代码" class="headerlink" title="伪代码"></a>伪代码</h2><p>在本例中， <strong>原型</strong>模式能让你生成完全相同的几何对象副本， 同时无需代码与对象所属类耦合。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/blog/pattern/example-prototype.png" alt="克隆一系列位于同一类层次结构中的对象"></p>
<p>所有形状类都遵循同一个提供克隆方法的接口。 在复制自身成员变量值到结果对象前， 子类可调用其父类的克隆方法。</p>
<figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 基础原型。</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> Shape <span class="keyword">is</span></span><br><span class="line">    field X: int</span><br><span class="line">    field Y: int</span><br><span class="line">    field color: <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 常规构造函数。</span></span><br><span class="line">    <span class="function"><span class="keyword">constructor</span> <span class="title">Shape</span><span class="params">()</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="comment">// ...</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="comment">// 原型构造函数。使用已有对象的数值来初始化一个新对象。</span></span></span><br><span class="line"><span class="function">    <span class="title">constructor</span> <span class="title">Shape</span><span class="params">(source: Shape)</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">this</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        <span class="title">this</span>.<span class="title">X</span> = <span class="title">source</span>.<span class="title">X</span></span></span><br><span class="line"><span class="function">        <span class="title">this</span>.<span class="title">Y</span> = <span class="title">source</span>.<span class="title">Y</span></span></span><br><span class="line"><span class="function">        <span class="title">this</span>.<span class="title">color</span> = <span class="title">source</span>.<span class="title">color</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="comment">// clone（克隆）操作会返回一个形状子类。</span></span></span><br><span class="line"><span class="function">    <span class="title">abstract</span> <span class="title">method</span> <span class="title">clone</span><span class="params">()</span>:</span>Shape</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体原型。克隆方法会创建一个新对象并将其传递给构造函数。直到构造函数运</span></span><br><span class="line"><span class="comment">// 行完成前，它都拥有指向新克隆对象的引用。因此，任何人都无法访问未完全生</span></span><br><span class="line"><span class="comment">// 成的克隆对象。这可以保持克隆结果的一致。</span></span><br><span class="line"><span class="keyword">class</span> Rectangle extends Shape <span class="keyword">is</span></span><br><span class="line">    field width: int</span><br><span class="line">    field height: int</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">constructor</span> <span class="title">Rectangle</span><span class="params">(source: Rectangle)</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="comment">// 需要调用父构造函数来复制父类中定义的私有成员变量。</span></span></span><br><span class="line"><span class="function">        <span class="title">super</span><span class="params">(source)</span></span></span><br><span class="line"><span class="function">        <span class="title">this</span>.<span class="title">width</span> = <span class="title">source</span>.<span class="title">width</span></span></span><br><span class="line"><span class="function">        <span class="title">this</span>.<span class="title">height</span> = <span class="title">source</span>.<span class="title">height</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">clone</span><span class="params">()</span>:</span>Shape <span class="keyword">is</span></span><br><span class="line">        return new Rectangle(this)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Circle extends Shape <span class="keyword">is</span></span><br><span class="line">    field radius: int</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">constructor</span> <span class="title">Circle</span><span class="params">(source: Circle)</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">super</span><span class="params">(source)</span></span></span><br><span class="line"><span class="function">        <span class="title">this</span>.<span class="title">radius</span> = <span class="title">source</span>.<span class="title">radius</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">clone</span><span class="params">()</span>:</span>Shape <span class="keyword">is</span></span><br><span class="line">        return new Circle(this)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码中的某个位置。</span></span><br><span class="line"><span class="keyword">class</span> Application <span class="keyword">is</span></span><br><span class="line">    field shapes: <span class="keyword">array</span> <span class="keyword">of</span> Shape</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">constructor</span> <span class="title">Application</span><span class="params">()</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">Circle</span> <span class="title">circle</span> = <span class="title">new</span> <span class="title">Circle</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        <span class="title">circle</span>.<span class="title">X</span> = 10</span></span><br><span class="line"><span class="function">        <span class="title">circle</span>.<span class="title">Y</span> = 10</span></span><br><span class="line"><span class="function">        <span class="title">circle</span>.<span class="title">radius</span> = 20</span></span><br><span class="line"><span class="function">        <span class="title">shapes</span>.<span class="title">add</span><span class="params">(circle)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">        <span class="title">Circle</span> <span class="title">anotherCircle</span> = <span class="title">circle</span>.<span class="title">clone</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        <span class="title">shapes</span>.<span class="title">add</span><span class="params">(anotherCircle)</span></span></span><br><span class="line"><span class="function">        <span class="comment">// 变量 `anotherCircle（另一个圆）`与 `circle（圆）`对象的内</span></span></span><br><span class="line"><span class="function">        <span class="comment">// 容完全一样。</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">        <span class="title">Rectangle</span> <span class="title">rectangle</span> = <span class="title">new</span> <span class="title">Rectangle</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        <span class="title">rectangle</span>.<span class="title">width</span> = 10</span></span><br><span class="line"><span class="function">        <span class="title">rectangle</span>.<span class="title">height</span> = 20</span></span><br><span class="line"><span class="function">        <span class="title">shapes</span>.<span class="title">add</span><span class="params">(rectangle)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">businessLogic</span><span class="params">()</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="comment">// 原型是很强大的东西，因为它能在不知晓对象类型的情况下生成一个与</span></span></span><br><span class="line"><span class="function">        <span class="comment">// 其完全相同的复制品。</span></span></span><br><span class="line"><span class="function">        <span class="title">Array</span> <span class="title">shapesCopy</span> = <span class="title">new</span> <span class="title">Array</span> <span class="title">of</span> <span class="title">Shapes</span>.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">        <span class="comment">// 例如，我们不知晓形状数组中元素的具体类型，只知道它们都是形状。</span></span></span><br><span class="line"><span class="function">        <span class="comment">// 但在多态机制的帮助下，当我们在某个形状上调用 `clone（克隆）`</span></span></span><br><span class="line"><span class="function">        <span class="comment">// 方法时，程序会检查其所属的类并调用其中所定义的克隆方法。这样，</span></span></span><br><span class="line"><span class="function">        <span class="comment">// 我们将获得一个正确的复制品，而不是一组简单的形状对象。</span></span></span><br><span class="line"><span class="function">        <span class="title">foreach</span> <span class="params">(s <span class="keyword">in</span> shapes)</span> <span class="title">do</span></span></span><br><span class="line"><span class="function">            <span class="title">shapesCopy</span>.<span class="title">add</span><span class="params">(s.clone()</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">        <span class="comment">// `shapesCopy（形状副本）`数组中包含 `shape（形状）`数组所有</span></span></span><br><span class="line"><span class="function">        <span class="comment">// 子元素的复制品。</span></span></span><br></pre></td></tr></table></figure>

<h2 id="原型模式适合应用场景"><a href="#原型模式适合应用场景" class="headerlink" title="原型模式适合应用场景"></a>原型模式适合应用场景</h2><p><strong>如果你需要复制一些对象，同时又希望代码独立于这些对象所属的具体类，可以使用原型模式。</strong></p>
<p>这一点考量通常出现在代码需要处理第三方代码通过接口传递过来的对象时。 即使不考虑代码耦合的情况， 你的代码也不能依赖这些对象所属的具体类， 因为你不知道它们的具体信息。</p>
<p>原型模式为客户端代码提供一个通用接口， 客户端代码可通过这一接口与所有实现了克隆的对象进行交互， 它也使得客户端代码与其所克隆的对象具体类独立开来。</p>
<p><strong>如果子类的区别仅在于其对象的初始化方式，那么你可以使用该模式来减少子类的数量。别人创建这些子类的目的可能是为了创建特定类型的对象。</strong></p>
<p>在原型模式中， 你可以使用一系列预生成的、 各种类型的对象作为原型。</p>
<p>客户端不必根据需求对子类进行实例化， 只需找到合适的原型并对其进行克隆即可。</p>
<h2 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h2><ol>
<li><p>创建原型接口， 并在其中声明 <code>克隆</code>方法。 如果你已有类层次结构， 则只需在其所有类中添加该方法即可。</p>
</li>
<li><p>原型类必须另行定义一个以该类对象为参数的构造函数。 构造函数必须复制参数对象中的所有成员变量值到新建实体中。 如果你需要修改子类， 则必须调用父类构造函数， 让父类复制其私有成员变量值。</p>
<p>如果编程语言不支持方法重载， 那么你可能需要定义一个特殊方法来复制对象数据。 在构造函数中进行此类处理比较方便， 因为它在调用 <code>new</code>运算符后会马上返回结果对象。</p>
</li>
<li><p>克隆方法通常只有一行代码： 使用 <code>new</code>运算符调用原型版本的构造函数。 注意， 每个类都必须显式重写克隆方法并使用自身类名调用 <code>new</code>运算符。 否则， 克隆方法可能会生成父类的对象。</p>
</li>
<li><p>你还可以创建一个中心化原型注册表， 用于存储常用原型。</p>
<p>你可以新建一个工厂类来实现注册表， 或者在原型基类中添加一个获取原型的静态方法。 该方法必须能够根据客户端代码设定的条件进行搜索。 搜索条件可以是简单的字符串， 或者是一组复杂的搜索参数。 找到合适的原型后， 注册表应对原型进行克隆， 并将复制生成的对象返回给客户端。</p>
<p>最后还要将对子类构造函数的直接调用替换为对原型注册表工厂方法的调用。</p>
</li>
</ol>
<h2 id="原型模式优缺点"><a href="#原型模式优缺点" class="headerlink" title="原型模式优缺点"></a>原型模式优缺点</h2><p>优点</p>
<ul>
<li>你可以克隆对象， 而无需与它们所属的具体类相耦合。</li>
<li>你可以克隆预生成原型， 避免反复运行初始化代码。</li>
<li>你可以更方便地生成复杂对象。</li>
<li>你可以用继承以外的方式来处理复杂对象的不同配置。</li>
</ul>
<p>缺点</p>
<ul>
<li>克隆包含循环引用的复杂对象可能会非常麻烦。</li>
</ul>
<h2 id="与其他模式的关系"><a href="#与其他模式的关系" class="headerlink" title="与其他模式的关系"></a>与其他模式的关系</h2><ul>
<li>在许多设计工作的初期都会使用<a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/factory-method">工厂方法模式</a> （较为简单， 而且可以更方便地通过子类进行定制）， 随后演化为使用<a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/abstract-factory">抽象工厂模式</a>、 <a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/prototype">原型模式</a>或<a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/builder">生成器模式</a> （更灵活但更加复杂）。</li>
<li><a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/abstract-factory">抽象工厂模式</a>通常基于一组<a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/factory-method">工厂方法</a>， 但你也可以使用<a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/prototype">原型模式</a>来生成这些类的方法。</li>
<li><a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/prototype">原型</a>可用于保存<a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/command">命令模式</a>的历史记录。</li>
<li>大量使用<a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/composite">组合模式</a>和<a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/decorator">装饰模式</a>的设计通常可从对于<a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/prototype">原型</a>的使用中获益。 你可以通过该模式来复制复杂结构， 而非从零开始重新构造。</li>
<li><a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/prototype">原型</a>并不基于继承， 因此没有继承的缺点。 另一方面， <em>原型</em>需要对被复制对象进行复杂的初始化。 <a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/factory-method">工厂方法</a>基于继承， 但是它不需要初始化步骤。</li>
<li>有时候<a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/prototype">原型</a>可以作为<a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/memento">备忘录模式</a>的一个简化版本， 其条件是你需要在历史记录中存储的对象的状态比较简单， 不需要链接其他外部资源， 或者链接可以方便地重建。</li>
<li><a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/abstract-factory">抽象工厂</a>、 <a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/builder">生成器</a>和<a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/prototype">原型</a>都可以用<a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/singleton">单例模式</a>来实现。</li>
</ul>
<h2 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h2><p><strong>原型</strong>是一种创建型设计模式， 使你能够复制对象， 甚至是复杂对象， 而又无需使代码依赖它们所属的类。</p>
<p>所有的原型类都必须有一个通用的接口， 使得即使在对象所属的具体类未知的情况下也能复制对象。 原型对象可以生成自身的完整副本， 因为相同类的对象可以相互访问对方的私有成员变量。</p>
<div class="tabs" id="tags"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#tags-1">C#</button></li><li class="tab"><button type="button" data-href="#tags-2">C++</button></li><li class="tab"><button type="button" data-href="#tags-3">JAVA</button></li><li class="tab"><button type="button" data-href="#tags-4">PHP</button></li><li class="tab"><button type="button" data-href="#tags-5">Python</button></li><li class="tab"><button type="button" data-href="#tags-6">Ruby</button></li><li class="tab"><button type="button" data-href="#tags-7">Swift</button></li><li class="tab"><button type="button" data-href="#tags-8">TypeScrit</button></li><li class="tab"><button type="button" data-href="#tags-9">Golang</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="tags-1"><p><strong>在 C# 中使用模式</strong></p>
<p><strong>复杂度：</strong> ★☆☆</p>
<p><strong>流行度：</strong> ★★☆</p>
<p><strong>使用示例：</strong> C# 的 <code>Cloneable</code> （克隆） 接口就是立即可用的原型模式。</p>
<p><strong>识别方法：</strong> 原型可以简单地通过 <code>clone</code>或 <code>copy</code>等方法来识别。</p>
<p><strong>概念示例</strong></p>
<p>本例说明了<strong>原型</strong>设计模式的结构并重点回答了下面的问题：</p>
<ul>
<li>它由哪些类组成？</li>
<li>这些类扮演了哪些角色？</li>
<li>模式中的各个元素会以何种方式相互关联？</li>
</ul>
<p> <strong>Program.cs:</strong> 概念示例</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">RefactoringGuru.DesignPatterns.Prototype.Conceptual</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Person</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> Age;</span><br><span class="line">        <span class="keyword">public</span> DateTime BirthDate;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Name;</span><br><span class="line">        <span class="keyword">public</span> IdInfo IdInfo;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Person <span class="title">ShallowCopy</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> (Person) <span class="keyword">this</span>.MemberwiseClone();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Person <span class="title">DeepCopy</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            Person clone = (Person) <span class="keyword">this</span>.MemberwiseClone();</span><br><span class="line">            clone.IdInfo = <span class="keyword">new</span> IdInfo(IdInfo.IdNumber);</span><br><span class="line">            clone.Name = String.Copy(Name);</span><br><span class="line">            <span class="keyword">return</span> clone;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">IdInfo</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> IdNumber;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">IdInfo</span>(<span class="params"><span class="built_in">int</span> idNumber</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">this</span>.IdNumber = idNumber;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            Person p1 = <span class="keyword">new</span> Person();</span><br><span class="line">            p1.Age = <span class="number">42</span>;</span><br><span class="line">            p1.BirthDate = Convert.ToDateTime(<span class="string">&quot;1977-01-01&quot;</span>);</span><br><span class="line">            p1.Name = <span class="string">&quot;Jack Daniels&quot;</span>;</span><br><span class="line">            p1.IdInfo = <span class="keyword">new</span> IdInfo(<span class="number">666</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Perform a shallow copy of p1 and assign it to p2.</span></span><br><span class="line">            Person p2 = p1.ShallowCopy();</span><br><span class="line">            <span class="comment">// Make a deep copy of p1 and assign it to p3.</span></span><br><span class="line">            Person p3 = p1.DeepCopy();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Display values of p1, p2 and p3.</span></span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Original values of p1, p2, p3:&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;   p1 instance values: &quot;</span>);</span><br><span class="line">            DisplayValues(p1);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;   p2 instance values:&quot;</span>);</span><br><span class="line">            DisplayValues(p2);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;   p3 instance values:&quot;</span>);</span><br><span class="line">            DisplayValues(p3);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Change the value of p1 properties and display the values of p1,</span></span><br><span class="line">            <span class="comment">// p2 and p3.</span></span><br><span class="line">            p1.Age = <span class="number">32</span>;</span><br><span class="line">            p1.BirthDate = Convert.ToDateTime(<span class="string">&quot;1900-01-01&quot;</span>);</span><br><span class="line">            p1.Name = <span class="string">&quot;Frank&quot;</span>;</span><br><span class="line">            p1.IdInfo.IdNumber = <span class="number">7878</span>;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;\nValues of p1, p2 and p3 after changes to p1:&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;   p1 instance values: &quot;</span>);</span><br><span class="line">            DisplayValues(p1);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;   p2 instance values (reference values have changed):&quot;</span>);</span><br><span class="line">            DisplayValues(p2);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;   p3 instance values (everything was kept the same):&quot;</span>);</span><br><span class="line">            DisplayValues(p3);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">DisplayValues</span>(<span class="params">Person p</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;      Name: &#123;0:s&#125;, Age: &#123;1:d&#125;, BirthDate: &#123;2:MM/dd/yy&#125;&quot;</span>,</span><br><span class="line">                p.Name, p.Age, p.BirthDate);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;      ID#: &#123;0:d&#125;&quot;</span>, p.IdInfo.IdNumber);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> <strong>Output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Original values of p1, p2, p3:</span><br><span class="line">   p1 instance values: </span><br><span class="line">      Name: Jack Daniels, Age: 42, BirthDate: 01/01/77</span><br><span class="line">      ID#: 666</span><br><span class="line">   p2 instance values:</span><br><span class="line">      Name: Jack Daniels, Age: 42, BirthDate: 01/01/77</span><br><span class="line">      ID#: 666</span><br><span class="line">   p3 instance values:</span><br><span class="line">      Name: Jack Daniels, Age: 42, BirthDate: 01/01/77</span><br><span class="line">      ID#: 666</span><br><span class="line"></span><br><span class="line">Values of p1, p2 and p3 after changes to p1:</span><br><span class="line">   p1 instance values: </span><br><span class="line">      Name: Frank, Age: 32, BirthDate: 01/01/00</span><br><span class="line">      ID#: 7878</span><br><span class="line">   p2 instance values (reference values have changed):</span><br><span class="line">      Name: Jack Daniels, Age: 42, BirthDate: 01/01/77</span><br><span class="line">      ID#: 7878</span><br><span class="line">   p3 instance values (everything was kept the same):</span><br><span class="line">      Name: Jack Daniels, Age: 42, BirthDate: 01/01/77</span><br><span class="line">      ID#: 666</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-2"><p><strong>在 C++ 中使用模式</strong></p>
<p><strong>复杂度：</strong> ★☆☆</p>
<p><strong>流行度：</strong> ★★☆</p>
<p><strong>使用示例：</strong> C++ 的 <code>Cloneable</code> （克隆） 接口就是立即可用的原型模式。</p>
<p><strong>识别方法：</strong> 原型可以简单地通过 <code>clone</code>或 <code>copy</code>等方法来识别。</p>
<p><strong>概念示例</strong></p>
<p>本例说明了<strong>原型</strong>设计模式的结构并重点回答了下面的问题：</p>
<ul>
<li>它由哪些类组成？</li>
<li>这些类扮演了哪些角色？</li>
<li>模式中的各个元素会以何种方式相互关联？</li>
</ul>
<p> <strong>main.cc:</strong> 概念示例</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> std::string;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Prototype Design Pattern</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Intent: Lets you copy existing objects without making your code dependent on</span></span><br><span class="line"><span class="comment">// their classes.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Type</span> &#123;</span><br><span class="line">  PROTOTYPE_1 = <span class="number">0</span>,</span><br><span class="line">  PROTOTYPE_2</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The example class that has cloning ability. We&#x27;ll see how the values of field</span></span><br><span class="line"><span class="comment"> * with different types will be cloned.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Prototype</span> &#123;</span><br><span class="line"> <span class="keyword">protected</span>:</span><br><span class="line">  string prototype_name_;</span><br><span class="line">  <span class="type">float</span> prototype_field_;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">Prototype</span>() &#123;&#125;</span><br><span class="line">  <span class="built_in">Prototype</span>(string prototype_name)</span><br><span class="line">      : <span class="built_in">prototype_name_</span>(prototype_name) &#123;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">virtual</span> ~<span class="built_in">Prototype</span>() &#123;&#125;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> Prototype *<span class="title">Clone</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Method</span><span class="params">(<span class="type">float</span> prototype_field)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;prototype_field_ = prototype_field;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Call Method from &quot;</span> &lt;&lt; prototype_name_ &lt;&lt; <span class="string">&quot; with field : &quot;</span> &lt;&lt; prototype_field &lt;&lt; std::endl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ConcretePrototype1 is a Sub-Class of Prototype and implement the Clone Method</span></span><br><span class="line"><span class="comment"> * In this example all data members of Prototype Class are in the Stack. If you</span></span><br><span class="line"><span class="comment"> * have pointers in your properties for ex: String* name_ ,you will need to</span></span><br><span class="line"><span class="comment"> * implement the Copy-Constructor to make sure you have a deep copy from the</span></span><br><span class="line"><span class="comment"> * clone method</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcretePrototype1</span> : <span class="keyword">public</span> Prototype &#123;</span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">  <span class="type">float</span> concrete_prototype_field1_;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">ConcretePrototype1</span>(string prototype_name, <span class="type">float</span> concrete_prototype_field)</span><br><span class="line">      : <span class="built_in">Prototype</span>(prototype_name), <span class="built_in">concrete_prototype_field1_</span>(concrete_prototype_field) &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Notice that Clone method return a Pointer to a new ConcretePrototype1</span></span><br><span class="line"><span class="comment">   * replica. so, the client (who call the clone method) has the responsability</span></span><br><span class="line"><span class="comment">   * to free that memory. I you have smart pointer knowledge you may prefer to</span></span><br><span class="line"><span class="comment">   * use unique_pointer here.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function">Prototype *<span class="title">Clone</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">ConcretePrototype1</span>(*<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcretePrototype2</span> : <span class="keyword">public</span> Prototype &#123;</span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">  <span class="type">float</span> concrete_prototype_field2_;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">ConcretePrototype2</span>(string prototype_name, <span class="type">float</span> concrete_prototype_field)</span><br><span class="line">      : <span class="built_in">Prototype</span>(prototype_name), <span class="built_in">concrete_prototype_field2_</span>(concrete_prototype_field) &#123;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function">Prototype *<span class="title">Clone</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">ConcretePrototype2</span>(*<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * In PrototypeFactory you have two concrete prototypes, one for each concrete</span></span><br><span class="line"><span class="comment"> * prototype class, so each time you want to create a bullet , you can use the</span></span><br><span class="line"><span class="comment"> * existing ones and clone those.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PrototypeFactory</span> &#123;</span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">  std::unordered_map&lt;Type, Prototype *, std::hash&lt;<span class="type">int</span>&gt;&gt; prototypes_;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">PrototypeFactory</span>() &#123;</span><br><span class="line">    prototypes_[Type::PROTOTYPE_1] = <span class="keyword">new</span> <span class="built_in">ConcretePrototype1</span>(<span class="string">&quot;PROTOTYPE_1 &quot;</span>, <span class="number">50.f</span>);</span><br><span class="line">    prototypes_[Type::PROTOTYPE_2] = <span class="keyword">new</span> <span class="built_in">ConcretePrototype2</span>(<span class="string">&quot;PROTOTYPE_2 &quot;</span>, <span class="number">60.f</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Be carefull of free all memory allocated. Again, if you have smart pointers</span></span><br><span class="line"><span class="comment">   * knowelege will be better to use it here.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  ~<span class="built_in">PrototypeFactory</span>() &#123;</span><br><span class="line">    <span class="keyword">delete</span> prototypes_[Type::PROTOTYPE_1];</span><br><span class="line">    <span class="keyword">delete</span> prototypes_[Type::PROTOTYPE_2];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Notice here that you just need to specify the type of the prototype you</span></span><br><span class="line"><span class="comment">   * want and the method will create from the object with this type.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function">Prototype *<span class="title">CreatePrototype</span><span class="params">(Type type)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> prototypes_[type]-&gt;<span class="built_in">Clone</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Client</span><span class="params">(PrototypeFactory &amp;prototype_factory)</span> </span>&#123;</span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;Let&#x27;s create a Prototype 1\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">  Prototype *prototype = prototype_factory.<span class="built_in">CreatePrototype</span>(Type::PROTOTYPE_1);</span><br><span class="line">  prototype-&gt;<span class="built_in">Method</span>(<span class="number">90</span>);</span><br><span class="line">  <span class="keyword">delete</span> prototype;</span><br><span class="line"></span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;Let&#x27;s create a Prototype 2 \n&quot;</span>;</span><br><span class="line"></span><br><span class="line">  prototype = prototype_factory.<span class="built_in">CreatePrototype</span>(Type::PROTOTYPE_2);</span><br><span class="line">  prototype-&gt;<span class="built_in">Method</span>(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">delete</span> prototype;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  PrototypeFactory *prototype_factory = <span class="keyword">new</span> <span class="built_in">PrototypeFactory</span>();</span><br><span class="line">  <span class="built_in">Client</span>(*prototype_factory);</span><br><span class="line">  <span class="keyword">delete</span> prototype_factory;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> <strong>Output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Let&#x27;s create a Prototype 1</span><br><span class="line">Call Method from PROTOTYPE_1  with field : 90</span><br><span class="line"></span><br><span class="line">Let&#x27;s create a Prototype 2 </span><br><span class="line">Call Method from PROTOTYPE_2  with field : 10</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-3"><p><strong>在 Java 中使用模式</strong></p>
<p><strong>复杂度：</strong> ★☆☆</p>
<p><strong>流行度：</strong> ★★☆</p>
<p><strong>使用示例：</strong> Java 的 <code>Cloneable</code> （可克隆） 接口就是立即可用的原型模式。</p>
<p>任何类都可通过实现该接口来实现可被克隆的性质。</p>
<p><a target="_blank" rel="noopener" href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#clone--"><code>java.lang.Object#clone()</code></a> （类必须实现 <a target="_blank" rel="noopener" href="http://docs.oracle.com/javase/8/docs/api/java/lang/Cloneable.html"><code>java.lang.Cloneable</code></a> 接口）</p>
<p><strong>识别方法：</strong> 原型可以简单地通过 <code>clone</code>或 <code>copy</code>等方法来识别。</p>
<p><strong>复制图形</strong></p>
<p>让我们来看看在不使用标准 <code>Cloneable</code>接口的情况下如何实现原型模式。</p>
<p> <strong>shapes:</strong> 形状列表</p>
<p> <strong>shapes&#x2F;Shape.java:</strong> 通用形状接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.prototype.example.shapes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> x;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> y;</span><br><span class="line">    <span class="keyword">public</span> String color;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Shape</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Shape</span><span class="params">(Shape target)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (target != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.x = target.x;</span><br><span class="line">            <span class="built_in">this</span>.y = target.y;</span><br><span class="line">            <span class="built_in">this</span>.color = target.color;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> Shape <span class="title function_">clone</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object object2)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!(object2 <span class="keyword">instanceof</span> Shape)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">Shape</span> <span class="variable">shape2</span> <span class="operator">=</span> (Shape) object2;</span><br><span class="line">        <span class="keyword">return</span> shape2.x == x &amp;&amp; shape2.y == y &amp;&amp; Objects.equals(shape2.color, color);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>shapes&#x2F;Circle.java:</strong> 简单形状</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.prototype.example.shapes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Circle</span> <span class="keyword">extends</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> radius;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Circle</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Circle</span><span class="params">(Circle target)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(target);</span><br><span class="line">        <span class="keyword">if</span> (target != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.radius = target.radius;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Shape <span class="title function_">clone</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Circle</span>(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object object2)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!(object2 <span class="keyword">instanceof</span> Circle) || !<span class="built_in">super</span>.equals(object2)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">Circle</span> <span class="variable">shape2</span> <span class="operator">=</span> (Circle) object2;</span><br><span class="line">        <span class="keyword">return</span> shape2.radius == radius;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>shapes&#x2F;Rectangle.java:</strong> 另一个形状</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.prototype.example.shapes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Rectangle</span> <span class="keyword">extends</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> width;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> height;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Rectangle</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Rectangle</span><span class="params">(Rectangle target)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(target);</span><br><span class="line">        <span class="keyword">if</span> (target != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.width = target.width;</span><br><span class="line">            <span class="built_in">this</span>.height = target.height;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Shape <span class="title function_">clone</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Rectangle</span>(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object object2)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!(object2 <span class="keyword">instanceof</span> Rectangle) || !<span class="built_in">super</span>.equals(object2)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">Rectangle</span> <span class="variable">shape2</span> <span class="operator">=</span> (Rectangle) object2;</span><br><span class="line">        <span class="keyword">return</span> shape2.width == width &amp;&amp; shape2.height == height;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> <strong>Demo.java:</strong> 克隆示例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.prototype.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.prototype.example.shapes.Circle;</span><br><span class="line"><span class="keyword">import</span> refactoring_guru.prototype.example.shapes.Rectangle;</span><br><span class="line"><span class="keyword">import</span> refactoring_guru.prototype.example.shapes.Shape;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Shape&gt; shapes = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        List&lt;Shape&gt; shapesCopy = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="type">Circle</span> <span class="variable">circle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Circle</span>();</span><br><span class="line">        circle.x = <span class="number">10</span>;</span><br><span class="line">        circle.y = <span class="number">20</span>;</span><br><span class="line">        circle.radius = <span class="number">15</span>;</span><br><span class="line">        circle.color = <span class="string">&quot;red&quot;</span>;</span><br><span class="line">        shapes.add(circle);</span><br><span class="line"></span><br><span class="line">        <span class="type">Circle</span> <span class="variable">anotherCircle</span> <span class="operator">=</span> (Circle) circle.clone();</span><br><span class="line">        shapes.add(anotherCircle);</span><br><span class="line"></span><br><span class="line">        <span class="type">Rectangle</span> <span class="variable">rectangle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Rectangle</span>();</span><br><span class="line">        rectangle.width = <span class="number">10</span>;</span><br><span class="line">        rectangle.height = <span class="number">20</span>;</span><br><span class="line">        rectangle.color = <span class="string">&quot;blue&quot;</span>;</span><br><span class="line">        shapes.add(rectangle);</span><br><span class="line"></span><br><span class="line">        cloneAndCompare(shapes, shapesCopy);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">cloneAndCompare</span><span class="params">(List&lt;Shape&gt; shapes, List&lt;Shape&gt; shapesCopy)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (Shape shape : shapes) &#123;</span><br><span class="line">            shapesCopy.add(shape.clone());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; shapes.size(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (shapes.get(i) != shapesCopy.get(i)) &#123;</span><br><span class="line">                System.out.println(i + <span class="string">&quot;: Shapes are different objects (yay!)&quot;</span>);</span><br><span class="line">                <span class="keyword">if</span> (shapes.get(i).equals(shapesCopy.get(i))) &#123;</span><br><span class="line">                    System.out.println(i + <span class="string">&quot;: And they are identical (yay!)&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    System.out.println(i + <span class="string">&quot;: But they are not identical (booo!)&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(i + <span class="string">&quot;: Shape objects are the same (booo!)&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>OutputDemo.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">0: Shapes are different objects (yay!)</span><br><span class="line">0: And they are identical (yay!)</span><br><span class="line">1: Shapes are different objects (yay!)</span><br><span class="line">1: And they are identical (yay!)</span><br><span class="line">2: Shapes are different objects (yay!)</span><br><span class="line">2: And they are identical (yay!)</span><br></pre></td></tr></table></figure>

<p><strong>原型注册站</strong></p>
<p>你可以实现中心化的原型注册站 （或工厂）， 其中包含一系列预定义的原型对象。 这样一来， 你就可以通过传递对象名称或其他参数的方式从工厂处获得新的对象。 工厂将搜索合适的原型， 然后对其进行克隆复制， 最后将副本返回给你。</p>
<p><strong>cache</strong></p>
<p><strong>cache&#x2F;BundledShapeCache.java:</strong> 原型工厂</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.prototype.caching.cache;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.prototype.example.shapes.Circle;</span><br><span class="line"><span class="keyword">import</span> refactoring_guru.prototype.example.shapes.Rectangle;</span><br><span class="line"><span class="keyword">import</span> refactoring_guru.prototype.example.shapes.Shape;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BundledShapeCache</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Shape&gt; cache = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BundledShapeCache</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Circle</span> <span class="variable">circle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Circle</span>();</span><br><span class="line">        circle.x = <span class="number">5</span>;</span><br><span class="line">        circle.y = <span class="number">7</span>;</span><br><span class="line">        circle.radius = <span class="number">45</span>;</span><br><span class="line">        circle.color = <span class="string">&quot;Green&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">Rectangle</span> <span class="variable">rectangle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Rectangle</span>();</span><br><span class="line">        rectangle.x = <span class="number">6</span>;</span><br><span class="line">        rectangle.y = <span class="number">9</span>;</span><br><span class="line">        rectangle.width = <span class="number">8</span>;</span><br><span class="line">        rectangle.height = <span class="number">10</span>;</span><br><span class="line">        rectangle.color = <span class="string">&quot;Blue&quot;</span>;</span><br><span class="line"></span><br><span class="line">        cache.put(<span class="string">&quot;Big green circle&quot;</span>, circle);</span><br><span class="line">        cache.put(<span class="string">&quot;Medium blue rectangle&quot;</span>, rectangle);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Shape <span class="title function_">put</span><span class="params">(String key, Shape shape)</span> &#123;</span><br><span class="line">        cache.put(key, shape);</span><br><span class="line">        <span class="keyword">return</span> shape;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Shape <span class="title function_">get</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> cache.get(key).clone();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Demo.java:</strong> 克隆示例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.prototype.caching;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.prototype.caching.cache.BundledShapeCache;</span><br><span class="line"><span class="keyword">import</span> refactoring_guru.prototype.example.shapes.Shape;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">BundledShapeCache</span> <span class="variable">cache</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BundledShapeCache</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">Shape</span> <span class="variable">shape1</span> <span class="operator">=</span> cache.get(<span class="string">&quot;Big green circle&quot;</span>);</span><br><span class="line">        <span class="type">Shape</span> <span class="variable">shape2</span> <span class="operator">=</span> cache.get(<span class="string">&quot;Medium blue rectangle&quot;</span>);</span><br><span class="line">        <span class="type">Shape</span> <span class="variable">shape3</span> <span class="operator">=</span> cache.get(<span class="string">&quot;Medium blue rectangle&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (shape1 != shape2 &amp;&amp; !shape1.equals(shape2)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Big green circle != Medium blue rectangle (yay!)&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Big green circle == Medium blue rectangle (booo!)&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (shape2 != shape3) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Medium blue rectangles are two different objects (yay!)&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (shape2.equals(shape3)) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;And they are identical (yay!)&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;But they are not identical (booo!)&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Rectangle objects are the same (booo!)&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>OutputDemo.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Big green circle != Medium blue rectangle (yay!)</span><br><span class="line">Medium blue rectangles are two different objects (yay!)</span><br><span class="line">And they are identical (yay!)</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-4"><p><strong>在 PHP 中使用模式</strong></p>
<p><strong>复杂度：</strong> ★☆☆</p>
<p><strong>流行度：</strong> ★★☆</p>
<p><strong>使用示例：</strong> PHP 中提供<a target="_blank" rel="noopener" href="http://php.net/manual/en/language.oop5.cloning.php">立即可用</a>的原型模式。 你可以使用 <code>clone</code>关键字创建一个对象的完整副本。 如果想要某个类支持克隆功能， 你需要实现 <code>__clone</code>方法。</p>
<p><strong>识别方法：</strong> 原型可以简单地通过 <code>clone</code>或 <code>copy</code>等方法来识别。</p>
<div class="tabs" id="php"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#php-1">概念示例</button></li><li class="tab"><button type="button" data-href="#php-2">真实世界示例</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="php-1"><p><strong>概念示例</strong></p>
<p>本例说明了<strong>原型</strong>设计模式的结构并重点回答了下面的问题：</p>
<ul>
<li>它由哪些类组成？</li>
<li>这些类扮演了哪些角色？</li>
<li>模式中的各个元素会以何种方式相互关联？</li>
</ul>
<p>了解该模式的结构后， 你可以更容易地理解下面基于真实世界的 PHP 应用案例。</p>
<p><strong>index.php:</strong> 概念示例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">RefactoringGuru</span>\<span class="title class_">Prototype</span>\<span class="title class_">Conceptual</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The example class that has cloning ability. We&#x27;ll see how the values of field</span></span><br><span class="line"><span class="comment"> * with different types will be cloned.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Prototype</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$primitive</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$component</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$circularReference</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * PHP has built-in cloning support. You can `clone` an object without</span></span><br><span class="line"><span class="comment">     * defining any special methods as long as it has fields of primitive types.</span></span><br><span class="line"><span class="comment">     * Fields containing objects retain their references in a cloned object.</span></span><br><span class="line"><span class="comment">     * Therefore, in some cases, you might want to clone those referenced</span></span><br><span class="line"><span class="comment">     * objects as well. You can do this in a special `__clone()` method.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__clone</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;component = <span class="keyword">clone</span> <span class="variable language_">$this</span>-&gt;component;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Cloning an object that has a nested object with backreference</span></span><br><span class="line">        <span class="comment">// requires special treatment. After the cloning is completed, the</span></span><br><span class="line">        <span class="comment">// nested object should point to the cloned object, instead of the</span></span><br><span class="line">        <span class="comment">// original object.</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;circularReference = <span class="keyword">clone</span> <span class="variable language_">$this</span>-&gt;circularReference;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;circularReference-&gt;prototype = <span class="variable language_">$this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ComponentWithBackReference</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$prototype</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Note that the constructor won&#x27;t be executed during cloning. If you have</span></span><br><span class="line"><span class="comment">     * complex logic inside the constructor, you may need to execute it in the</span></span><br><span class="line"><span class="comment">     * `__clone` method as well.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">Prototype <span class="variable">$prototype</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;prototype = <span class="variable">$prototype</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The client code.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clientCode</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$p1</span> = <span class="keyword">new</span> <span class="title class_">Prototype</span>();</span><br><span class="line">    <span class="variable">$p1</span>-&gt;primitive = <span class="number">245</span>;</span><br><span class="line">    <span class="variable">$p1</span>-&gt;component = <span class="keyword">new</span> <span class="title class_">\DateTime</span>();</span><br><span class="line">    <span class="variable">$p1</span>-&gt;circularReference = <span class="keyword">new</span> <span class="title class_">ComponentWithBackReference</span>(<span class="variable">$p1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$p2</span> = <span class="keyword">clone</span> <span class="variable">$p1</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$p1</span>-&gt;primitive === <span class="variable">$p2</span>-&gt;primitive) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Primitive field values have been carried over to a clone. Yay!\n&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Primitive field values have not been copied. Booo!\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$p1</span>-&gt;component === <span class="variable">$p2</span>-&gt;component) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Simple component has not been cloned. Booo!\n&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Simple component has been cloned. Yay!\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$p1</span>-&gt;circularReference === <span class="variable">$p2</span>-&gt;circularReference) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Component with back reference has not been cloned. Booo!\n&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Component with back reference has been cloned. Yay!\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$p1</span>-&gt;circularReference-&gt;prototype === <span class="variable">$p2</span>-&gt;circularReference-&gt;prototype) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Component with back reference is linked to original object. Booo!\n&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Component with back reference is linked to the clone. Yay!\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">clientCode</span>();</span><br></pre></td></tr></table></figure>

<p><strong>Output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Primitive field values have been carried over to a clone. Yay!</span><br><span class="line">Simple component has been cloned. Yay!</span><br><span class="line">Component with back reference has been cloned. Yay!</span><br><span class="line">Component with back reference is linked to the clone. Yay!</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="php-2"><p><strong>真实世界示例</strong></p>
<p><strong>原型</strong>模式提供了一种复制已有对象的简便方式， 可代替直接复制对象的所有成员变量来对对象进行重构的方法。 直接复制的方式不仅让你与被克隆类所属的对象相耦合， 还不允许你复制私有成员变量的内容。 原型模式让你能够在被克隆类的内部进行克隆工作， 因此可以不受限制地访问类的私有成员变量。</p>
<p>本例说明了如何使用原型模式克隆复杂的页面对象。 页面类拥有许多私有成员变量， 但它们都通过原型模式被复制到了克隆对象中。</p>
<p><strong>index.php:</strong> 真实世界示例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">RefactoringGuru</span>\<span class="title class_">Prototype</span>\<span class="title class_">RealWorld</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Prototype.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Page</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$title</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$body</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> Author</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$author</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$comments</span> = [];</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> \DateTime</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$date</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// +100 private fields.</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$title</span>, <span class="keyword">string</span> <span class="variable">$body</span>, Author <span class="variable">$author</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;title = <span class="variable">$title</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;body = <span class="variable">$body</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;author = <span class="variable">$author</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;author-&gt;<span class="title function_ invoke__">addToPage</span>(<span class="variable">$this</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;date = <span class="keyword">new</span> <span class="title class_">\DateTime</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">addComment</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$comment</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;comments[] = <span class="variable">$comment</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * You can control what data you want to carry over to the cloned object.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * For instance, when a page is cloned:</span></span><br><span class="line"><span class="comment">     * - It gets a new &quot;Copy of ...&quot; title.</span></span><br><span class="line"><span class="comment">     * - The author of the page remains the same. Therefore we leave the</span></span><br><span class="line"><span class="comment">     * reference to the existing object while adding the cloned page to the list</span></span><br><span class="line"><span class="comment">     * of the author&#x27;s pages.</span></span><br><span class="line"><span class="comment">     * - We don&#x27;t carry over the comments from the old page.</span></span><br><span class="line"><span class="comment">     * - We also attach a new date object to the page.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__clone</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;title = <span class="string">&quot;Copy of &quot;</span> . <span class="variable language_">$this</span>-&gt;title;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;author-&gt;<span class="title function_ invoke__">addToPage</span>(<span class="variable">$this</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;comments = [];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;date = <span class="keyword">new</span> <span class="title class_">\DateTime</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Author</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$name</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> Page[]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$pages</span> = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">addToPage</span>(<span class="params">Page <span class="variable">$page</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;pages[] = <span class="variable">$page</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The client code.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clientCode</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$author</span> = <span class="keyword">new</span> <span class="title class_">Author</span>(<span class="string">&quot;John Smith&quot;</span>);</span><br><span class="line">    <span class="variable">$page</span> = <span class="keyword">new</span> <span class="title class_">Page</span>(<span class="string">&quot;Tip of the day&quot;</span>, <span class="string">&quot;Keep calm and carry on.&quot;</span>, <span class="variable">$author</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="variable">$page</span>-&gt;<span class="title function_ invoke__">addComment</span>(<span class="string">&quot;Nice tip, thanks!&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="variable">$draft</span> = <span class="keyword">clone</span> <span class="variable">$page</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Dump of the clone. Note that the author is now referencing two objects.\n\n&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">print_r</span>(<span class="variable">$draft</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">clientCode</span>();</span><br></pre></td></tr></table></figure>

<p><strong>Output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">Dump of the clone. Note that the author is now referencing two objects.</span><br><span class="line"></span><br><span class="line">RefactoringGuru\Prototype\RealWorld\Page Object</span><br><span class="line">(</span><br><span class="line">    [title:RefactoringGuru\Prototype\RealWorld\Page:private] =&gt; Copy of Tip of the day</span><br><span class="line">    [body:RefactoringGuru\Prototype\RealWorld\Page:private] =&gt; Keep calm and carry on.</span><br><span class="line">    [author:RefactoringGuru\Prototype\RealWorld\Page:private] =&gt; RefactoringGuru\Prototype\RealWorld\Author Object</span><br><span class="line">        (</span><br><span class="line">            [name:RefactoringGuru\Prototype\RealWorld\Author:private] =&gt; John Smith</span><br><span class="line">            [pages:RefactoringGuru\Prototype\RealWorld\Author:private] =&gt; Array</span><br><span class="line">                (</span><br><span class="line">                    [0] =&gt; RefactoringGuru\Prototype\RealWorld\Page Object</span><br><span class="line">                        (</span><br><span class="line">                            [title:RefactoringGuru\Prototype\RealWorld\Page:private] =&gt; Tip of the day</span><br><span class="line">                            [body:RefactoringGuru\Prototype\RealWorld\Page:private] =&gt; Keep calm and carry on.</span><br><span class="line">                            [author:RefactoringGuru\Prototype\RealWorld\Page:private] =&gt; RefactoringGuru\Prototype\RealWorld\Author Object</span><br><span class="line"> *RECURSION*</span><br><span class="line">                            [comments:RefactoringGuru\Prototype\RealWorld\Page:private] =&gt; Array</span><br><span class="line">                                (</span><br><span class="line">                                    [0] =&gt; Nice tip, thanks!</span><br><span class="line">                                )</span><br><span class="line"></span><br><span class="line">                            [date:RefactoringGuru\Prototype\RealWorld\Page:private] =&gt; DateTime Object</span><br><span class="line">                                (</span><br><span class="line">                                    [date] =&gt; 2018-06-04 14:50:39.306237</span><br><span class="line">                                    [timezone_type] =&gt; 3</span><br><span class="line">                                    [timezone] =&gt; UTC</span><br><span class="line">                                )</span><br><span class="line"></span><br><span class="line">                        )</span><br><span class="line"></span><br><span class="line">                    [1] =&gt; RefactoringGuru\Prototype\RealWorld\Page Object</span><br><span class="line"> *RECURSION*</span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    [comments:RefactoringGuru\Prototype\RealWorld\Page:private] =&gt; Array</span><br><span class="line">        (</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    [date:RefactoringGuru\Prototype\RealWorld\Page:private] =&gt; DateTime Object</span><br><span class="line">        (</span><br><span class="line">            [date] =&gt; 2018-06-04 14:50:39.306272</span><br><span class="line">            [timezone_type] =&gt; 3</span><br><span class="line">            [timezone] =&gt; UTC</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">)</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-5"><p><strong>在 Python 中使用模式</strong></p>
<p><strong>复杂度：</strong> ★☆☆</p>
<p><strong>流行度：</strong> ★★☆</p>
<p><strong>使用示例：</strong> Python 的 <code>Cloneable</code> （克隆） 接口就是立即可用的原型模式。</p>
<p><strong>识别方法：</strong> 原型可以简单地通过 <code>clone</code>或 <code>copy</code>等方法来识别。</p>
<p><strong>概念示例</strong></p>
<p>本例说明了<strong>原型</strong>设计模式的结构并重点回答了下面的问题：</p>
<ul>
<li>它由哪些类组成？</li>
<li>这些类扮演了哪些角色？</li>
<li>模式中的各个元素会以何种方式相互关联？</li>
</ul>
<p><strong>main.py:</strong> 概念示例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SelfReferencingEntity</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.parent = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_parent</span>(<span class="params">self, parent</span>):</span><br><span class="line">        self.parent = parent</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SomeComponent</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Python provides its own interface of Prototype via `copy.copy` and</span></span><br><span class="line"><span class="string">    `copy.deepcopy` functions. And any class that wants to implement custom</span></span><br><span class="line"><span class="string">    implementations have to override `__copy__` and `__deepcopy__` member</span></span><br><span class="line"><span class="string">    functions.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, some_int, some_list_of_objects, some_circular_ref</span>):</span><br><span class="line">        self.some_int = some_int</span><br><span class="line">        self.some_list_of_objects = some_list_of_objects</span><br><span class="line">        self.some_circular_ref = some_circular_ref</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__copy__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Create a shallow copy. This method will be called whenever someone calls</span></span><br><span class="line"><span class="string">        `copy.copy` with this object and the returned value is returned as the</span></span><br><span class="line"><span class="string">        new shallow copy.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># First, let&#x27;s create copies of the nested objects.</span></span><br><span class="line">        some_list_of_objects = copy.copy(self.some_list_of_objects)</span><br><span class="line">        some_circular_ref = copy.copy(self.some_circular_ref)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Then, let&#x27;s clone the object itself, using the prepared clones of the</span></span><br><span class="line">        <span class="comment"># nested objects.</span></span><br><span class="line">        new = self.__class__(</span><br><span class="line">            self.some_int, some_list_of_objects, some_circular_ref</span><br><span class="line">        )</span><br><span class="line">        new.__dict__.update(self.__dict__)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> new</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__deepcopy__</span>(<span class="params">self, memo=&#123;&#125;</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Create a deep copy. This method will be called whenever someone calls</span></span><br><span class="line"><span class="string">        `copy.deepcopy` with this object and the returned value is returned as</span></span><br><span class="line"><span class="string">        the new deep copy.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        What is the use of the argument `memo`? Memo is the dictionary that is</span></span><br><span class="line"><span class="string">        used by the `deepcopy` library to prevent infinite recursive copies in</span></span><br><span class="line"><span class="string">        instances of circular references. Pass it to all the `deepcopy` calls</span></span><br><span class="line"><span class="string">        you make in the `__deepcopy__` implementation to prevent infinite</span></span><br><span class="line"><span class="string">        recursions.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># First, let&#x27;s create copies of the nested objects.</span></span><br><span class="line">        some_list_of_objects = copy.deepcopy(self.some_list_of_objects, memo)</span><br><span class="line">        some_circular_ref = copy.deepcopy(self.some_circular_ref, memo)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Then, let&#x27;s clone the object itself, using the prepared clones of the</span></span><br><span class="line">        <span class="comment"># nested objects.</span></span><br><span class="line">        new = self.__class__(</span><br><span class="line">            self.some_int, some_list_of_objects, some_circular_ref</span><br><span class="line">        )</span><br><span class="line">        new.__dict__ = copy.deepcopy(self.__dict__, memo)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> new</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line"></span><br><span class="line">    list_of_objects = [<span class="number">1</span>, &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]]</span><br><span class="line">    circular_ref = SelfReferencingEntity()</span><br><span class="line">    component = SomeComponent(<span class="number">23</span>, list_of_objects, circular_ref)</span><br><span class="line">    circular_ref.set_parent(component)</span><br><span class="line"></span><br><span class="line">    shallow_copied_component = copy.copy(component)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Let&#x27;s change the list in shallow_copied_component and see if it changes in</span></span><br><span class="line">    <span class="comment"># component.</span></span><br><span class="line">    shallow_copied_component.some_list_of_objects.append(<span class="string">&quot;another object&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> component.some_list_of_objects[-<span class="number">1</span>] == <span class="string">&quot;another object&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span>(</span><br><span class="line">            <span class="string">&quot;Adding elements to `shallow_copied_component`&#x27;s &quot;</span></span><br><span class="line">            <span class="string">&quot;some_list_of_objects adds it to `component`&#x27;s &quot;</span></span><br><span class="line">            <span class="string">&quot;some_list_of_objects.&quot;</span></span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(</span><br><span class="line">            <span class="string">&quot;Adding elements to `shallow_copied_component`&#x27;s &quot;</span></span><br><span class="line">            <span class="string">&quot;some_list_of_objects doesn&#x27;t add it to `component`&#x27;s &quot;</span></span><br><span class="line">            <span class="string">&quot;some_list_of_objects.&quot;</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Let&#x27;s change the set in the list of objects.</span></span><br><span class="line">    component.some_list_of_objects[<span class="number">1</span>].add(<span class="number">4</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="number">4</span> <span class="keyword">in</span> shallow_copied_component.some_list_of_objects[<span class="number">1</span>]:</span><br><span class="line">        <span class="built_in">print</span>(</span><br><span class="line">            <span class="string">&quot;Changing objects in the `component`&#x27;s some_list_of_objects &quot;</span></span><br><span class="line">            <span class="string">&quot;changes that object in `shallow_copied_component`&#x27;s &quot;</span></span><br><span class="line">            <span class="string">&quot;some_list_of_objects.&quot;</span></span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(</span><br><span class="line">            <span class="string">&quot;Changing objects in the `component`&#x27;s some_list_of_objects &quot;</span></span><br><span class="line">            <span class="string">&quot;doesn&#x27;t change that object in `shallow_copied_component`&#x27;s &quot;</span></span><br><span class="line">            <span class="string">&quot;some_list_of_objects.&quot;</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    deep_copied_component = copy.deepcopy(component)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Let&#x27;s change the list in deep_copied_component and see if it changes in</span></span><br><span class="line">    <span class="comment"># component.</span></span><br><span class="line">    deep_copied_component.some_list_of_objects.append(<span class="string">&quot;one more object&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> component.some_list_of_objects[-<span class="number">1</span>] == <span class="string">&quot;one more object&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span>(</span><br><span class="line">            <span class="string">&quot;Adding elements to `deep_copied_component`&#x27;s &quot;</span></span><br><span class="line">            <span class="string">&quot;some_list_of_objects adds it to `component`&#x27;s &quot;</span></span><br><span class="line">            <span class="string">&quot;some_list_of_objects.&quot;</span></span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(</span><br><span class="line">            <span class="string">&quot;Adding elements to `deep_copied_component`&#x27;s &quot;</span></span><br><span class="line">            <span class="string">&quot;some_list_of_objects doesn&#x27;t add it to `component`&#x27;s &quot;</span></span><br><span class="line">            <span class="string">&quot;some_list_of_objects.&quot;</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Let&#x27;s change the set in the list of objects.</span></span><br><span class="line">    component.some_list_of_objects[<span class="number">1</span>].add(<span class="number">10</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="number">10</span> <span class="keyword">in</span> deep_copied_component.some_list_of_objects[<span class="number">1</span>]:</span><br><span class="line">        <span class="built_in">print</span>(</span><br><span class="line">            <span class="string">&quot;Changing objects in the `component`&#x27;s some_list_of_objects &quot;</span></span><br><span class="line">            <span class="string">&quot;changes that object in `deep_copied_component`&#x27;s &quot;</span></span><br><span class="line">            <span class="string">&quot;some_list_of_objects.&quot;</span></span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(</span><br><span class="line">            <span class="string">&quot;Changing objects in the `component`&#x27;s some_list_of_objects &quot;</span></span><br><span class="line">            <span class="string">&quot;doesn&#x27;t change that object in `deep_copied_component`&#x27;s &quot;</span></span><br><span class="line">            <span class="string">&quot;some_list_of_objects.&quot;</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(</span><br><span class="line">        <span class="string">f&quot;id(deep_copied_component.some_circular_ref.parent): &quot;</span></span><br><span class="line">        <span class="string">f&quot;<span class="subst">&#123;<span class="built_in">id</span>(deep_copied_component.some_circular_ref.parent)&#125;</span>&quot;</span></span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(</span><br><span class="line">        <span class="string">f&quot;id(deep_copied_component.some_circular_ref.parent.some_circular_ref.parent): &quot;</span></span><br><span class="line">        <span class="string">f&quot;<span class="subst">&#123;<span class="built_in">id</span>(deep_copied_component.some_circular_ref.parent.some_circular_ref.parent)&#125;</span>&quot;</span></span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(</span><br><span class="line">        <span class="string">&quot;^^ This shows that deepcopied objects contain same reference, they &quot;</span></span><br><span class="line">        <span class="string">&quot;are not cloned repeatedly.&quot;</span></span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<p><strong>Output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Adding elements to `shallow_copied_component`&#x27;s some_list_of_objects adds it to `component`&#x27;s some_list_of_objects.</span><br><span class="line">Changing objects in the `component`&#x27;s some_list_of_objects changes that object in `shallow_copied_component`&#x27;s some_list_of_objects.</span><br><span class="line">Adding elements to `deep_copied_component`&#x27;s some_list_of_objects doesn&#x27;t add it to `component`&#x27;s some_list_of_objects.</span><br><span class="line">Changing objects in the `component`&#x27;s some_list_of_objects doesn&#x27;t change that object in `deep_copied_component`&#x27;s some_list_of_objects.</span><br><span class="line">id(deep_copied_component.some_circular_ref.parent): 4429472784</span><br><span class="line">id(deep_copied_component.some_circular_ref.parent.some_circular_ref.parent): 4429472784</span><br><span class="line">^^ This shows that deepcopied objects contain same reference, they are not cloned repeatedly.</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-6"><p><strong>在 Ruby 中使用模式</strong></p>
<p><strong>复杂度：</strong> ★☆☆</p>
<p><strong>流行度：</strong> ★★☆</p>
<p><strong>使用示例：</strong> Ruby 的 <code>Cloneable</code> （克隆） 接口就是立即可用的原型模式。</p>
<p><strong>识别方法：</strong> 原型可以简单地通过 <code>clone</code>或 <code>copy</code>等方法来识别。。</p>
<p><strong>概念示例</strong></p>
<p>本例说明了<strong>原型</strong>设计模式的结构并重点回答了下面的问题：</p>
<ul>
<li>它由哪些类组成？</li>
<li>这些类扮演了哪些角色？</li>
<li>模式中的各个元素会以何种方式相互关联？</li>
</ul>
<p><strong>main.rb:</strong> 概念示例</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The example class that has cloning ability. We&#x27;ll see how the values of field</span></span><br><span class="line"><span class="comment"># with different types will be cloned.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Prototype</span></span><br><span class="line">  <span class="keyword">attr_accessor</span> <span class="symbol">:primitive</span>, <span class="symbol">:component</span>, <span class="symbol">:circular_reference</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">initialize</span></span><br><span class="line">    <span class="variable">@primitive</span> = <span class="literal">nil</span></span><br><span class="line">    <span class="variable">@component</span> = <span class="literal">nil</span></span><br><span class="line">    <span class="variable">@circular_reference</span> = <span class="literal">nil</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># <span class="doctag">@return</span> [Prototype]</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">clone</span></span><br><span class="line">    <span class="variable">@component</span> = deep_copy(<span class="variable">@component</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Cloning an object that has a nested object with backreference requires</span></span><br><span class="line">    <span class="comment"># special treatment. After the cloning is completed, the nested object</span></span><br><span class="line">    <span class="comment"># should point to the cloned object, instead of the original object.</span></span><br><span class="line">    <span class="variable">@circular_reference</span> = deep_copy(<span class="variable">@circular_reference</span>)</span><br><span class="line">    <span class="variable">@circular_reference</span>.prototype = <span class="variable language_">self</span></span><br><span class="line">    deep_copy(<span class="variable language_">self</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># deep_copy is the usual Marshalling hack to make a deep copy. But it&#x27;s rather</span></span><br><span class="line">  <span class="comment"># slow and inefficient, therefore, in real applications, use a special gem</span></span><br><span class="line">  private <span class="keyword">def</span> <span class="title function_">deep_copy</span>(<span class="params">object</span>)</span><br><span class="line">    Marshal.load(Marshal.dump(object))</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ComponentWithBackReference</span></span><br><span class="line">  <span class="keyword">attr_accessor</span> <span class="symbol">:prototype</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># <span class="doctag">@param</span> [Prototype] prototype</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">initialize</span>(<span class="params">prototype</span>)</span><br><span class="line">    <span class="variable">@prototype</span> = prototype</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The client code.</span></span><br><span class="line">p1 = Prototype.new</span><br><span class="line">p1.primitive = <span class="number">245</span></span><br><span class="line">p1.component = Time.now</span><br><span class="line">p1.circular_reference = <span class="title class_">ComponentWithBackReference</span>.new(p1)</span><br><span class="line"></span><br><span class="line">p2 = p1.clone</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> p1.primitive == p2.primitive</span><br><span class="line">  puts <span class="string">&#x27;Primitive field values have been carried over to a clone. Yay!&#x27;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  puts <span class="string">&#x27;Primitive field values have not been copied. Booo!&#x27;</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> p1.component.equal?(p2.component)</span><br><span class="line">  puts <span class="string">&#x27;Simple component has not been cloned. Booo!&#x27;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  puts <span class="string">&#x27;Simple component has been cloned. Yay!&#x27;</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> p1.circular_reference.equal?(p2.circular_reference)</span><br><span class="line">  puts <span class="string">&#x27;Component with back reference has not been cloned. Booo!&#x27;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  puts <span class="string">&#x27;Component with back reference has been cloned. Yay!&#x27;</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> p1.circular_reference.prototype.equal?(p2.circular_reference.prototype)</span><br><span class="line">  print <span class="string">&#x27;Component with back reference is linked to original object. Booo!&#x27;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  print <span class="string">&#x27;Component with back reference is linked to the clone. Yay!&#x27;</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p> <strong>output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Primitive field values have been carried over to a clone. Yay!</span><br><span class="line">Simple component has been cloned. Yay!</span><br><span class="line">Component with back reference has been cloned. Yay!</span><br><span class="line">Component with back reference is linked to the clone. Yay!</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-7"><p><strong>在 Swift 中使用模式</strong></p>
<p><strong>复杂度：</strong> ★☆☆</p>
<p><strong>流行度：</strong> ★★☆</p>
<p><strong>使用示例：</strong> Swift 的 <code>Cloneable</code> （克隆） 接口就是立即可用的原型模式。</p>
<p><strong>识别方法：</strong> 原型可以简单地通过 <code>clone</code>或 <code>copy</code>等方法来识别。</p>
<div class="tabs" id="swift"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#swift-1">概念示例</button></li><li class="tab"><button type="button" data-href="#swift-2">真实世界示例</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="swift-1"><p><strong>概念示例</strong></p>
<p>本例说明了<strong>原型</strong>设计模式的结构并重点回答了下面的问题：</p>
<ul>
<li>它由哪些类组成？</li>
<li>这些类扮演了哪些角色？</li>
<li>模式中的各个元素会以何种方式相互关联？</li>
</ul>
<p>了解该模式的结构后， 你可以更容易地理解下面基于真实世界的 Swift 应用案例。</p>
<p><strong>Example.swift:</strong> 概念示例</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> XCTest</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Swift has built-in cloning support. To add cloning support to your class,</span></span><br><span class="line"><span class="comment">/// you need to implement the NSCopying protocol in that class and provide the</span></span><br><span class="line"><span class="comment">/// implementation for the `copy` method.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BaseClass</span>: <span class="title class_">NSCopying</span>, <span class="title class_">Equatable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> intValue <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> stringValue <span class="operator">=</span> <span class="string">&quot;Value&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">init</span>(<span class="params">intValue</span>: <span class="type">Int</span> <span class="operator">=</span> <span class="number">1</span>, <span class="params">stringValue</span>: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;Value&quot;</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">self</span>.intValue <span class="operator">=</span> intValue</span><br><span class="line">        <span class="keyword">self</span>.stringValue <span class="operator">=</span> stringValue</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// MARK: - NSCopying</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">copy</span>(<span class="params">with</span> <span class="params">zone</span>: <span class="type">NSZone</span>? <span class="operator">=</span> <span class="literal">nil</span>) -&gt; <span class="keyword">Any</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> prototype <span class="operator">=</span> <span class="built_in">type</span>(of: <span class="keyword">self</span>).<span class="keyword">init</span>()</span><br><span class="line">        prototype.intValue <span class="operator">=</span> intValue</span><br><span class="line">        prototype.stringValue <span class="operator">=</span> stringValue</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Values defined in BaseClass have been cloned!&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> prototype</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// MARK: - Equatable</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">func</span> <span class="title function_">==</span> (<span class="params">lhs</span>: <span class="type">BaseClass</span>, <span class="params">rhs</span>: <span class="type">BaseClass</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> lhs.intValue <span class="operator">==</span> rhs.intValue <span class="operator">&amp;&amp;</span> lhs.stringValue <span class="operator">==</span> rhs.stringValue</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Subclasses can override the base `copy` method to copy their own data into</span></span><br><span class="line"><span class="comment">/// the resulting object. But you should always call the base method first.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SubClass</span>: <span class="title class_">BaseClass</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> boolValue <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">copy</span>() -&gt; <span class="keyword">Any</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> copy(with: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">copy</span>(<span class="params">with</span> <span class="params">zone</span>: <span class="type">NSZone</span>?) -&gt; <span class="keyword">Any</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> prototype <span class="operator">=</span> <span class="keyword">super</span>.copy(with: zone) <span class="keyword">as?</span> <span class="type">SubClass</span> <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="type">SubClass</span>() <span class="comment">// oops</span></span><br><span class="line">        &#125;</span><br><span class="line">        prototype.boolValue <span class="operator">=</span> boolValue</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Values defined in SubClass have been cloned!&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> prototype</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// The client code.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">func</span> <span class="title function_">someClientCode</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> original <span class="operator">=</span> <span class="type">SubClass</span>(intValue: <span class="number">2</span>, stringValue: <span class="string">&quot;Value2&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> copy <span class="operator">=</span> original.copy() <span class="keyword">as?</span> <span class="type">SubClass</span> <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">XCTAssert</span>(<span class="literal">false</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/// See implementation of `Equatable` protocol for more details.</span></span><br><span class="line">        <span class="type">XCTAssert</span>(copy <span class="operator">==</span> original)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;The original object is equal to the copied object!&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Let&#x27;s see how it all works together.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PrototypeConceptual</span>: <span class="title class_">XCTestCase</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">testPrototype_NSCopying</span>() &#123;</span><br><span class="line">        <span class="type">Client</span>.someClientCode()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Values defined in BaseClass have been cloned!</span><br><span class="line">Values defined in SubClass have been cloned!</span><br><span class="line">The original object is equal to the copied object!</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="swift-2"><p><strong>真实世界示例</strong></p>
<p><strong>Example.swift:</strong> 真实世界示例</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> XCTest</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PrototypeRealWorld</span>: <span class="title class_">XCTestCase</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">testPrototypeRealWorld</span>() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> author <span class="operator">=</span> <span class="type">Author</span>(id: <span class="number">10</span>, username: <span class="string">&quot;Ivan_83&quot;</span>)</span><br><span class="line">        <span class="keyword">let</span> page <span class="operator">=</span> <span class="type">Page</span>(title: <span class="string">&quot;My First Page&quot;</span>, contents: <span class="string">&quot;Hello world!&quot;</span>, author: author)</span><br><span class="line"></span><br><span class="line">        page.add(comment: <span class="type">Comment</span>(message: <span class="string">&quot;Keep it up!&quot;</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment">/// Since NSCopying returns Any, the copied object should be unwrapped.</span></span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> anotherPage <span class="operator">=</span> page.copy() <span class="keyword">as?</span> <span class="type">Page</span> <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">XCTFail</span>(<span class="string">&quot;Page was not copied&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/// Comments should be empty as it is a new page.</span></span><br><span class="line">        <span class="type">XCTAssert</span>(anotherPage.comments.isEmpty)</span><br><span class="line"></span><br><span class="line">        <span class="comment">/// Note that the author is now referencing two objects.</span></span><br><span class="line">        <span class="type">XCTAssert</span>(author.pagesCount <span class="operator">==</span> <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Original title: &quot;</span> <span class="operator">+</span> page.title)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Copied title: &quot;</span> <span class="operator">+</span> anotherPage.title)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Count of pages: &quot;</span> <span class="operator">+</span> <span class="type">String</span>(author.pagesCount))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">Author</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> id: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> username: <span class="type">String</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> pages <span class="operator">=</span> [<span class="type">Page</span>]()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="params">id</span>: <span class="type">Int</span>, <span class="params">username</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.id <span class="operator">=</span> id</span><br><span class="line">        <span class="keyword">self</span>.username <span class="operator">=</span> username</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">add</span>(<span class="params">page</span>: <span class="type">Page</span>) &#123;</span><br><span class="line">        pages.append(page)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> pagesCount: <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> pages.count</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">Page</span>: <span class="title class_">NSCopying</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private(set)</span> <span class="keyword">var</span> title: <span class="type">String</span></span><br><span class="line">    <span class="keyword">private(set)</span> <span class="keyword">var</span> contents: <span class="type">String</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">weak</span> <span class="keyword">var</span> author: <span class="type">Author</span>?</span><br><span class="line">    <span class="keyword">private(set)</span> <span class="keyword">var</span> comments <span class="operator">=</span> [<span class="type">Comment</span>]()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="params">title</span>: <span class="type">String</span>, <span class="params">contents</span>: <span class="type">String</span>, <span class="params">author</span>: <span class="type">Author</span>?) &#123;</span><br><span class="line">        <span class="keyword">self</span>.title <span class="operator">=</span> title</span><br><span class="line">        <span class="keyword">self</span>.contents <span class="operator">=</span> contents</span><br><span class="line">        <span class="keyword">self</span>.author <span class="operator">=</span> author</span><br><span class="line">        author<span class="operator">?</span>.add(page: <span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">add</span>(<span class="params">comment</span>: <span class="type">Comment</span>) &#123;</span><br><span class="line">        comments.append(comment)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// MARK: - NSCopying</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">copy</span>(<span class="params">with</span> <span class="params">zone</span>: <span class="type">NSZone</span>? <span class="operator">=</span> <span class="literal">nil</span>) -&gt; <span class="keyword">Any</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Page</span>(title: <span class="string">&quot;Copy of &#x27;&quot;</span> <span class="operator">+</span> title <span class="operator">+</span> <span class="string">&quot;&#x27;&quot;</span>, contents: contents, author: author)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">struct</span> <span class="title class_">Comment</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> date <span class="operator">=</span> <span class="type">Date</span>()</span><br><span class="line">    <span class="keyword">let</span> message: <span class="type">String</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Original title: My First Page</span><br><span class="line">Copied title: Copy of &#x27;My First Page&#x27;</span><br><span class="line">Count of pages: 2</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-8"><p><strong>在 TypeScript 中使用模式</strong></p>
<p><strong>复杂度：</strong> ★☆☆</p>
<p><strong>流行度：</strong> ★★☆</p>
<p><strong>使用示例：</strong> TypeScript 的 <code>Cloneable</code> （克隆） 接口就是立即可用的原型模式。</p>
<p><strong>识别方法：</strong> 原型可以简单地通过 <code>clone</code>或 <code>copy</code>等方法来识别。</p>
<p><strong>概念示例</strong></p>
<p>本例说明了<strong>原型</strong>设计模式的结构并重点回答了下面的问题：</p>
<ul>
<li>它由哪些类组成？</li>
<li>这些类扮演了哪些角色？</li>
<li>模式中的各个元素会以何种方式相互关联？</li>
</ul>
<p><strong>index.ts:</strong> 概念示例</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The example class that has cloning ability. We&#x27;ll see how the values of field</span></span><br><span class="line"><span class="comment"> * with different types will be cloned.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Prototype</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="attr">primitive</span>: <span class="built_in">any</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="attr">component</span>: <span class="built_in">object</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="attr">circularReference</span>: <span class="title class_">ComponentWithBackReference</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">clone</span>(): <span class="variable language_">this</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> clone = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="variable language_">this</span>);</span><br><span class="line"></span><br><span class="line">        clone.<span class="property">component</span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="variable language_">this</span>.<span class="property">component</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Cloning an object that has a nested object with backreference</span></span><br><span class="line">        <span class="comment">// requires special treatment. After the cloning is completed, the</span></span><br><span class="line">        <span class="comment">// nested object should point to the cloned object, instead of the</span></span><br><span class="line">        <span class="comment">// original object. Spread operator can be handy for this case.</span></span><br><span class="line">        clone.<span class="property">circularReference</span> = &#123;</span><br><span class="line">            ...<span class="variable language_">this</span>.<span class="property">circularReference</span>,</span><br><span class="line">            <span class="attr">prototype</span>: &#123; ...<span class="variable language_">this</span> &#125;,</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> clone;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ComponentWithBackReference</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> prototype;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">prototype: Prototype</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property"><span class="keyword">prototype</span></span> = prototype;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The client code.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">clientCode</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="title class_">Prototype</span>();</span><br><span class="line">    p1.<span class="property">primitive</span> = <span class="number">245</span>;</span><br><span class="line">    p1.<span class="property">component</span> = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">    p1.<span class="property">circularReference</span> = <span class="keyword">new</span> <span class="title class_">ComponentWithBackReference</span>(p1);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> p2 = p1.<span class="title function_">clone</span>();</span><br><span class="line">    <span class="keyword">if</span> (p1.<span class="property">primitive</span> === p2.<span class="property">primitive</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Primitive field values have been carried over to a clone. Yay!&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Primitive field values have not been copied. Booo!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (p1.<span class="property">component</span> === p2.<span class="property">component</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Simple component has not been cloned. Booo!&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Simple component has been cloned. Yay!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (p1.<span class="property">circularReference</span> === p2.<span class="property">circularReference</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Component with back reference has not been cloned. Booo!&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Component with back reference has been cloned. Yay!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (p1.<span class="property">circularReference</span>.<span class="property"><span class="keyword">prototype</span></span> === p2.<span class="property">circularReference</span>.<span class="property"><span class="keyword">prototype</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Component with back reference is linked to original object. Booo!&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Component with back reference is linked to the clone. Yay!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">clientCode</span>();</span><br></pre></td></tr></table></figure>

<p> <strong>Output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Primitive field values have been carried over to a clone. Yay!</span><br><span class="line">Simple component has been cloned. Yay!</span><br><span class="line">Component with back reference has been cloned. Yay!</span><br><span class="line">Component with back reference is linked to the clone. Yay!</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="tags-9"><p><strong>概念示例</strong></p>
<p>让我们尝试通过基于操作系统文件系统的示例来理解原型模式。 操作系统的文件系统是递归的： 文件夹中包含文件和文件夹， 其中又包含文件和文件夹， 以此类推。</p>
<p>每个文件和文件夹都可用一个 <code>inode</code>接口来表示。  <code>inode</code>接口中同样也有 <code>clone</code>克隆功能。</p>
<p><code>file</code>文件和 <code>folder</code>文件夹结构体都实现了 <code>print</code>打印和 <code>clone</code>方法， 因为它们都是 <code>inode</code>类型。 同时， 注意 <code>file</code>和 <code>folder</code>中的 <code>clone</code>方法。 这两者的 <code>clone</code>方法都会返回相应文件或文件夹的副本。 同时在克隆过程中， 我们会在其名称后面添加 “_clone” 字样。</p>
<p><strong>inode.go:</strong> 原型接口</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> inode <span class="keyword">interface</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="type">string</span>)</span><br><span class="line">    clone() inode</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>file.go:</strong> 具体原型</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> file <span class="keyword">struct</span> &#123;</span><br><span class="line">    name <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *file)</span></span> <span class="built_in">print</span>(indentation <span class="type">string</span>) &#123;</span><br><span class="line">    fmt.Println(indentation + f.name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *file)</span></span> clone() inode &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;file&#123;name: f.name + <span class="string">&quot;_clone&quot;</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>folder.go:</strong> 具体原型</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> folder <span class="keyword">struct</span> &#123;</span><br><span class="line">    children []inode</span><br><span class="line">    name      <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *folder)</span></span> <span class="built_in">print</span>(indentation <span class="type">string</span>) &#123;</span><br><span class="line">    fmt.Println(indentation + f.name)</span><br><span class="line">    <span class="keyword">for</span> _, i := <span class="keyword">range</span> f.children &#123;</span><br><span class="line">        i.<span class="built_in">print</span>(indentation + indentation)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *folder)</span></span> clone() inode &#123;</span><br><span class="line">    cloneFolder := &amp;folder&#123;name: f.name + <span class="string">&quot;_clone&quot;</span>&#125;</span><br><span class="line">    <span class="keyword">var</span> tempChildren []inode</span><br><span class="line">    <span class="keyword">for</span> _, i := <span class="keyword">range</span> f.children &#123;</span><br><span class="line">        <span class="built_in">copy</span> := i.clone()</span><br><span class="line">        tempChildren = <span class="built_in">append</span>(tempChildren, <span class="built_in">copy</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    cloneFolder.children = tempChildren</span><br><span class="line">    <span class="keyword">return</span> cloneFolder</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>main.go:</strong> 客户端代码</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    file1 := &amp;file&#123;name: <span class="string">&quot;File1&quot;</span>&#125;</span><br><span class="line">    file2 := &amp;file&#123;name: <span class="string">&quot;File2&quot;</span>&#125;</span><br><span class="line">    file3 := &amp;file&#123;name: <span class="string">&quot;File3&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">    folder1 := &amp;folder&#123;</span><br><span class="line">        children: []inode&#123;file1&#125;,</span><br><span class="line">        name:      <span class="string">&quot;Folder1&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    folder2 := &amp;folder&#123;</span><br><span class="line">        children: []inode&#123;folder1, file2, file3&#125;,</span><br><span class="line">        name:      <span class="string">&quot;Folder2&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(<span class="string">&quot;\nPrinting hierarchy for Folder2&quot;</span>)</span><br><span class="line">    folder2.<span class="built_in">print</span>(<span class="string">&quot;  &quot;</span>)</span><br><span class="line"></span><br><span class="line">    cloneFolder := folder2.clone()</span><br><span class="line">    fmt.Println(<span class="string">&quot;\nPrinting hierarchy for clone Folder&quot;</span>)</span><br><span class="line">    cloneFolder.<span class="built_in">print</span>(<span class="string">&quot;  &quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Printing hierarchy for Folder2</span><br><span class="line">  Folder2</span><br><span class="line">    Folder1</span><br><span class="line">        File1</span><br><span class="line">    File2</span><br><span class="line">    File3</span><br><span class="line"></span><br><span class="line">Printing hierarchy for clone Folder</span><br><span class="line">  Folder2_clone</span><br><span class="line">    Folder1_clone</span><br><span class="line">        File1_clone</span><br><span class="line">    File2_clone</span><br><span class="line">    File3_clone</span><br></pre></td></tr></table></figure>

<p><em>根据： <a target="_blank" rel="noopener" href="https://golangbyexample.com/prototype-pattern-go/">Golang By Example</a></em></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://wangyyovo.github.io">Blank</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://wangyyovo.github.io/posts/63b28d52/">https://wangyyovo.github.io/posts/63b28d52/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://wangyyovo.github.io" target="_blank">Blank</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/pattern/">pattern</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/01b549d5aec9f475e74b2781486eed2d.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/ShareJS/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/ShareJS/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/37f0d8f/"><img class="prev-cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/6cc78f9be0372c0d330f2c7d326f7d9e.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">创建型模式-单例模式</div></div></a></div><div class="next-post pull-right"><a href="/posts/e59e3a52/"><img class="next-cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/43a23affdea04c9c39e82f19a8ff21d8.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">创建型模式-生成器模式</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/37f0d8f/" title="创建型模式-单例模式"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/6cc78f9be0372c0d330f2c7d326f7d9e.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-03</div><div class="title">创建型模式-单例模式</div></div></a></div><div><a href="/posts/7a751a0c/" title="创建型模式-工厂方法模式"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/2cc53835314eae7d55be8b341557ddb0.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-03</div><div class="title">创建型模式-工厂方法模式</div></div></a></div><div><a href="/posts/63b2a10f/" title="工厂模式比较"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/dd999ecec29f3590f23c26fbb79bb612.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-04</div><div class="title">工厂模式比较</div></div></a></div><div><a href="/posts/a951f0f7/" title="创建型模式-抽象工厂模式"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/40d08d3b2ae8dc4074a9f3a7942a0b5a.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-03</div><div class="title">创建型模式-抽象工厂模式</div></div></a></div><div><a href="/posts/e59e3a52/" title="创建型模式-生成器模式"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/43a23affdea04c9c39e82f19a8ff21d8.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-03</div><div class="title">创建型模式-生成器模式</div></div></a></div><div><a href="/posts/d935b798/" title="结构型模式-享元模式"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/fbe970a24a54e3fd90e6fbe3115b02ef.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-04</div><div class="title">结构型模式-享元模式</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://raw.githubusercontents.com/wangyyovo/CDN/master/theme/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Blank</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">356</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">36</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">54</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/wangyyovo" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:xxxxxx@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fas fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F-%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="toc-text">创建型模式-原型模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%84%8F%E5%9B%BE"><span class="toc-text">意图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98"><span class="toc-text">问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-text">解决方案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9C%9F%E5%AE%9E%E4%B8%96%E7%95%8C%E7%B1%BB%E6%AF%94"><span class="toc-text">真实世界类比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F%E7%BB%93%E6%9E%84"><span class="toc-text">原型模式结构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%AE%9E%E7%8E%B0"><span class="toc-text">基本实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E5%9E%8B%E6%B3%A8%E5%86%8C%E8%A1%A8%E5%AE%9E%E7%8E%B0"><span class="toc-text">原型注册表实现</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%AA%E4%BB%A3%E7%A0%81"><span class="toc-text">伪代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F%E9%80%82%E5%90%88%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-text">原型模式适合应用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F"><span class="toc-text">实现方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-text">原型模式优缺点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8E%E5%85%B6%E4%BB%96%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-text">与其他模式的关系</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-text">代码示例</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/d14168d/" title="虚拟机问题合集"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/hexo/090cfe4e9e60b0ad0de05db822f3ae97.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="虚拟机问题合集"/></a><div class="content"><a class="title" href="/posts/d14168d/" title="虚拟机问题合集">虚拟机问题合集</a><time datetime="2022-07-16T13:30:36.000Z" title="发表于 2022-07-16 21:30:36">2022-07-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/f540045f/" title="用go语言编写移动端sdk和app开发"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/golang/941ed1ec2925719a0c92e76f4f786b6a.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="用go语言编写移动端sdk和app开发"/></a><div class="content"><a class="title" href="/posts/f540045f/" title="用go语言编写移动端sdk和app开发">用go语言编写移动端sdk和app开发</a><time datetime="2022-07-04T12:14:21.000Z" title="发表于 2022-07-04 20:14:21">2022-07-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/5faac006/" title="在线编程IDE"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/hexo/090cfe4e9e60b0ad0de05db822f3ae97.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="在线编程IDE"/></a><div class="content"><a class="title" href="/posts/5faac006/" title="在线编程IDE">在线编程IDE</a><time datetime="2022-06-12T13:30:36.000Z" title="发表于 2022-06-12 21:30:36">2022-06-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/7594185d/" title="即时性能分析工具Pyroscope"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/golang/3bfb3279740bc9a5b5ef436fa887ef07.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="即时性能分析工具Pyroscope"/></a><div class="content"><a class="title" href="/posts/7594185d/" title="即时性能分析工具Pyroscope">即时性能分析工具Pyroscope</a><time datetime="2022-06-12T08:07:36.000Z" title="发表于 2022-06-12 16:07:36">2022-06-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/82a7aa7c/" title="golang性能调试优化方法"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="golang性能调试优化方法"/></a><div class="content"><a class="title" href="/posts/82a7aa7c/" title="golang性能调试优化方法">golang性能调试优化方法</a><time datetime="2022-06-12T03:00:36.000Z" title="发表于 2022-06-12 11:00:36">2022-06-12</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By Blank</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to my <a href="https://wangyyovo.github.io/">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5/instantpage.js" type="module"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '49gEIIGN7uRbL6vHhieSpBzM-MdYXbMMI',
      appKey: 'uqts0urLKwikYQ0fKmIkMHBE',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><div class="aplayer no-destroy" data-id="000PeZCQ1i4XVs" data-server="tencent" data-type="artist" data-fixed="true" data-mini="true" data-listFolded="false" data-order="random" data-preload="none" data-autoplay="false" muted></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="false"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/MetingJS/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>