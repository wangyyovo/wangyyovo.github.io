<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>grpc-安全认证 | Blank</title><meta name="author" content="Blank"><meta name="copyright" content="Blank"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="认证gRPC 被设计成可以利用插件的形式支持多种授权机制。本文档对多种支持的授权机制提供了一个概览，并且用例子来论述对应API，最后就其扩展性作了讨论。 马上将会推出更多文档和例子。 支持的授权机制SSL&#x2F;TLSgRP 集成 SSL&#x2F;TLS 并对服务端授权所使用的 SSL&#x2F;TLS 进行了改良，对客户端和服务端交换的所有数据进行了加密。对客户端来讲提供了可选的机制提供">
<meta property="og:type" content="article">
<meta property="og:title" content="grpc-安全认证">
<meta property="og:url" content="https://wangyyovo.github.io/posts/5527a6fb/">
<meta property="og:site_name" content="Blank">
<meta property="og:description" content="认证gRPC 被设计成可以利用插件的形式支持多种授权机制。本文档对多种支持的授权机制提供了一个概览，并且用例子来论述对应API，最后就其扩展性作了讨论。 马上将会推出更多文档和例子。 支持的授权机制SSL&#x2F;TLSgRP 集成 SSL&#x2F;TLS 并对服务端授权所使用的 SSL&#x2F;TLS 进行了改良，对客户端和服务端交换的所有数据进行了加密。对客户端来讲提供了可选的机制提供">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://jsd.012700.xyz/gh/wangyyovo/CDN@master/cover/grpc/7affa62bd4ccba7a9648054529de821e.jpg">
<meta property="article:published_time" content="2019-09-27T09:56:36.000Z">
<meta property="article:modified_time" content="2019-09-27T09:56:36.000Z">
<meta property="article:author" content="Blank">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://jsd.012700.xyz/gh/wangyyovo/CDN@master/cover/grpc/7affa62bd4ccba7a9648054529de821e.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "grpc-安全认证",
  "url": "https://wangyyovo.github.io/posts/5527a6fb/",
  "image": "https://jsd.012700.xyz/gh/wangyyovo/CDN@master/cover/grpc/7affa62bd4ccba7a9648054529de821e.jpg",
  "datePublished": "2019-09-27T09:56:36.000Z",
  "dateModified": "2019-09-27T09:56:36.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Blank",
      "url": "https://wangyyovo.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/theme/favicon.ico"><link rel="canonical" href="https://wangyyovo.github.io/posts/5527a6fb/"><link rel="preconnect" href="https://jsd.012700.xyz"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://jsd.012700.xyz/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400,"highlightFullpage":true,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":150,"languages":{"author":"作者: Blank","link":"链接: ","source":"来源: Blank","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://jsd.012700.xyz/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'grpc-安全认证',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="alternate" href="/atom.xml" title="Blank" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/theme/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">352</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">46</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">58</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-comment-dots"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-image"></i><span> 相册</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-book"></i><span> 教程</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/posts/21cfbf15/"><span> 🚀 快速開始</span></a></li><li><a class="site-page child" href="/posts/dc584b87/"><span> 📑 主題頁面</span></a></li><li><a class="site-page child" href="/posts/4aa8abbe/"><span> 🛠 主題配置</span></a></li><li><a class="site-page child" href="/posts/ceeb73f/"><span> ⚔️ 標簽外挂</span></a></li><li><a class="site-page child" href="/posts/98d20436/"><span> ❓ 主題問答</span></a></li><li><a class="site-page child" href="/posts/4073eda/"><span> ⚡️ 進階教程</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-language"></i><span> 语言</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/"><i class="fa-fw fas fa-c"></i><span> 中文</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://jsd.012700.xyz/gh/wangyyovo/CDN@master/cover/grpc/7affa62bd4ccba7a9648054529de821e.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Blank</span></a><a class="nav-page-title" href="/"><span class="site-name">grpc-安全认证</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-comment-dots"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-image"></i><span> 相册</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-book"></i><span> 教程</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/posts/21cfbf15/"><span> 🚀 快速開始</span></a></li><li><a class="site-page child" href="/posts/dc584b87/"><span> 📑 主題頁面</span></a></li><li><a class="site-page child" href="/posts/4aa8abbe/"><span> 🛠 主題配置</span></a></li><li><a class="site-page child" href="/posts/ceeb73f/"><span> ⚔️ 標簽外挂</span></a></li><li><a class="site-page child" href="/posts/98d20436/"><span> ❓ 主題問答</span></a></li><li><a class="site-page child" href="/posts/4073eda/"><span> ⚡️ 進階教程</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-language"></i><span> 语言</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/"><i class="fa-fw fas fa-c"></i><span> 中文</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">grpc-安全认证</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2019-09-27T09:56:36.000Z" title="发表于 2019-09-27 17:56:36">2019-09-27</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2019-09-27T09:56:36.000Z" title="更新于 2019-09-27 17:56:36">2019-09-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/grpc/">grpc</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>13分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/posts/5527a6fb/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count" data-xid="/posts/5527a6fb/" itemprop="commentCount"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><script src="\assets\js\APlayer.min.js"> </script><h1 id="认证"><a href="#认证" class="headerlink" title="认证"></a>认证</h1><p>gRPC 被设计成可以利用插件的形式支持多种授权机制。本文档对多种支持的授权机制提供了一个概览，并且用例子来论述对应API，最后就其扩展性作了讨论。 马上将会推出更多文档和例子。</p>
<h1 id="支持的授权机制"><a href="#支持的授权机制" class="headerlink" title="支持的授权机制"></a>支持的授权机制</h1><h2 id="SSL-TLS"><a href="#SSL-TLS" class="headerlink" title="SSL&#x2F;TLS"></a>SSL&#x2F;TLS</h2><p>gRP 集成 SSL&#x2F;TLS 并对服务端授权所使用的 SSL&#x2F;TLS 进行了改良，对客户端和服务端交换的所有数据进行了加密。对客户端来讲提供了可选的机制提供凭证来获得共同的授权。</p>
<h2 id="OAuth-2-0"><a href="#OAuth-2-0" class="headerlink" title="OAuth 2.0"></a>OAuth 2.0</h2><p>gRPC 提供通用的机制（后续进行描述）来对请求和应答附加基于元数据的凭证。当通过 gRPC 访问 Google API 时，会为一定的授权流程提供额外的获取访问令牌的支持，这将通过以下代码例子进行展示。 <em>警告</em>：Google OAuth2 凭证应该仅用于连接 Google 的服务。把 Google 对应的 OAuth2 令牌发往非 Google 的服务会导致令牌被窃取用作冒充客户端来访问 Google 的服务。</p>
<h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><p>为了减少复杂性和将混乱最小化， gRPC 以一个统一的凭证对象来进行工作。 凭证可以是以下两类：</p>
<ul>
<li><p><em>频道凭证</em>, 被附加在 <code>频道</code>上， 比如 SSL 凭证。</p>
</li>
<li><p><em>调用凭证</em>, 被附加在调用上(或者 C++ 里的 <code>客户端上下文</code>)。</p>
</li>
</ul>
<p>凭证可以用<code>组合频道凭证</code>来进行组合。一个<code>组合频道凭证</code>可以将一个<code>频道凭证</code>和一个<code>调用凭证</code>关联创建一个新的<code>频道凭证</code>。结果在这个频道上的每次调用会发送组合的<code>调用凭证</code>来作为授权数据。 </p>
<p>例如，一各<code>频道凭证</code>可以由一个<code>Ssl 凭证</code>和一个<code>访问令牌凭证</code>生成。结果是在这个频道上的每次调用都会发送对应的访问令牌。 </p>
<p><code>调用凭证</code>可以用 <code>组合凭证</code>来组装。组装后的 <code>调用凭证</code>应用到一个<code>客户端上下文</code>里，将触发发送这两个<code>调用凭证</code>的授权数据。</p>
<h3 id="服务端认证加密使用的-SSL-TLS"><a href="#服务端认证加密使用的-SSL-TLS" class="headerlink" title="服务端认证加密使用的 SSL&#x2F;TLS"></a>服务端认证加密使用的 SSL&#x2F;TLS</h3><p>这是个最简单的认证场景：一个客户端仅仅想认证服务器并且加密所有数据。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a default SSL ChannelCredentials object.</span></span><br><span class="line"><span class="keyword">auto</span> channel_creds = grpc::<span class="built_in">SslCredentials</span>(grpc::<span class="built_in">SslCredentialsOptions</span>());</span><br><span class="line"><span class="comment">// Create a channel using the credentials created in the previous step.</span></span><br><span class="line"><span class="keyword">auto</span> channel = grpc::<span class="built_in">CreateChannel</span>(server_name, creds);</span><br><span class="line"><span class="comment">// Create a stub on the channel.</span></span><br><span class="line"><span class="function">std::unique_ptr&lt;Greeter::Stub&gt; <span class="title">stub</span><span class="params">(Greeter::NewStub(channel))</span></span>;</span><br><span class="line"><span class="comment">// Make actual RPC calls on the stub.</span></span><br><span class="line">grpc::Status s = stub-&gt;<span class="built_in">sayHello</span>(&amp;context, *request, response);</span><br></pre></td></tr></table></figure>

<p>对于高级的用例比如改变根 CA 或使用客户端证书，可以在发送给工厂方法的 SslCredentialsOptions 参数里的相应选项进行设置。</p>
<h3 id="通过-Google-进行认证"><a href="#通过-Google-进行认证" class="headerlink" title="通过 Google 进行认证"></a>通过 Google 进行认证</h3><p>gRPC应用可以使用一个简单的API来创建一个可以工作在不同部署场景下的凭证。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> creds = grpc::<span class="built_in">GoogleDefaultCredentials</span>();</span><br><span class="line"><span class="comment">// Create a channel, stub and make RPC calls (same as in the previous example)</span></span><br><span class="line"><span class="keyword">auto</span> channel = grpc::<span class="built_in">CreateChannel</span>(server_name, creds);</span><br><span class="line"><span class="function">std::unique_ptr&lt;Greeter::Stub&gt; <span class="title">stub</span><span class="params">(Greeter::NewStub(channel))</span></span>;</span><br><span class="line">grpc::Status s = stub-&gt;<span class="built_in">sayHello</span>(&amp;context, *request, response);</span><br></pre></td></tr></table></figure>

<p>这个应用使用的频道凭证对象就像 <a target="_blank" rel="noopener" href="https://cloud.google.com/compute/">Google 计算引擎  (GCE)</a>里运行的应用一样使用服务账号。在前面的案例里，服务账号的密钥从环境变量 <code>GOOGLE_APPLICATION_CREDENTIALS</code> 对应的文件里加载。这些密钥被用来生成承载令牌附加在在相应频道的每次 RPC 调用里。 对于 GCE 里运行的应用，可以在虚拟机设置的时候为其配置一个默认的服务账号和相应的 OAuth2 范围。在运行时，这个凭证被用来与认证系统通讯来获取 OAuth2 访问令牌并且把令牌用作在相应的频道上的 RPC 调用。</p>
<h3 id="扩展-gRPC-支持其他的认证机制"><a href="#扩展-gRPC-支持其他的认证机制" class="headerlink" title="扩展 gRPC 支持其他的认证机制"></a>扩展 gRPC 支持其他的认证机制</h3><p>相应的凭证插件 API 允许开发者开发自己的凭证插件。</p>
<ul>
<li><code>MetadataCredentialsPlugin</code> 抽象类包含需要被开发者创建的子类实现的纯虚方法 <code>GetMetadata</code>。</li>
<li><code>MetadataCredentialsFromPlugin</code> 方法可以从 <code>MetadataCredentialsPlugin</code> 创建一个 <code>调用者凭证</code>。 这类有个简单的凭证插件例子，是通过在自定义头了设置一个认证票据。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyCustomAuthenticator</span> : <span class="keyword">public</span> grpc::MetadataCredentialsPlugin &#123;</span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">MyCustomAuthenticator</span>(<span class="type">const</span> grpc::string&amp; ticket) : <span class="built_in">ticket_</span>(ticket) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="function">grpc::Status <span class="title">GetMetadata</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">      grpc::string_ref service_url, grpc::string_ref method_name,</span></span></span><br><span class="line"><span class="params"><span class="function">      <span class="type">const</span> grpc::AuthContext&amp; channel_auth_context,</span></span></span><br><span class="line"><span class="params"><span class="function">      std::multimap&lt;grpc::string, grpc::string&gt;* metadata)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">    metadata-&gt;<span class="built_in">insert</span>(std::<span class="built_in">make_pair</span>(<span class="string">&quot;x-custom-auth-ticket&quot;</span>, ticket_));</span><br><span class="line">    <span class="keyword">return</span> grpc::Status::OK;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">  grpc::string ticket_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> call_creds = grpc::<span class="built_in">MetadataCredentialsFromPlugin</span>(</span><br><span class="line">    std::<span class="built_in">unique_ptr</span>&lt;grpc::MetadataCredentialsPlugin&gt;(</span><br><span class="line">        <span class="keyword">new</span> <span class="built_in">MyCustomAuthenticator</span>(<span class="string">&quot;super-secret-ticket&quot;</span>)));</span><br></pre></td></tr></table></figure>

<p>更深层次的集成可以通过在将 gRPC 的凭证实现以插件的形式集成进核心层。gRPC 内部也允许用其他加密机制来替换 SSL&#x2F;TLS 。</p>
<h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><p>这些授权机制将会在所有 gRPC 支持的语言里提供。以下的一些节里展示了上文提到的认证和授权在每种语言里如何实现：很快将会推出更多语言的支持。</p>
<h3 id="Go"><a href="#Go" class="headerlink" title="Go"></a>Go</h3><h4 id="基本情况-无加密或身份验证"><a href="#基本情况-无加密或身份验证" class="headerlink" title="基本情况 - 无加密或身份验证"></a>基本情况 - 无加密或身份验证</h4><p>客户端:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">conn, _ := grpc.Dial(<span class="string">&quot;localhost:50051&quot;</span>, grpc.WithInsecure())</span><br><span class="line"><span class="comment">// error handling omitted</span></span><br><span class="line">client := pb.NewGreeterClient(conn)</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<p>服务端:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">s := grpc.NewServer()</span><br><span class="line">lis, _ := net.Listen(<span class="string">&quot;tcp&quot;</span>, <span class="string">&quot;localhost:50051&quot;</span>)</span><br><span class="line"><span class="comment">// error handling omitted</span></span><br><span class="line">s.Serve(lis)</span><br></pre></td></tr></table></figure>

<h4 id="使用服务器身份验证SSL-TLS"><a href="#使用服务器身份验证SSL-TLS" class="headerlink" title="使用服务器身份验证SSL &#x2F; TLS"></a>使用服务器身份验证SSL &#x2F; TLS</h4><p>客户端:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">creds, _ := credentials.NewClientTLSFromFile(certFile, <span class="string">&quot;&quot;</span>)</span><br><span class="line">conn, _ := grpc.Dial(<span class="string">&quot;localhost:50051&quot;</span>, grpc.WithTransportCredentials(creds))</span><br><span class="line"><span class="comment">// error handling omitted</span></span><br><span class="line">client := pb.NewGreeterClient(conn)</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<p>服务端:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">creds, _ := credentials.NewServerTLSFromFile(certFile, keyFile)</span><br><span class="line">s := grpc.NewServer(grpc.Creds(creds))</span><br><span class="line">lis, _ := net.Listen(<span class="string">&quot;tcp&quot;</span>, <span class="string">&quot;localhost:50051&quot;</span>)</span><br><span class="line"><span class="comment">// error handling omitted</span></span><br><span class="line">s.Serve(lis)</span><br></pre></td></tr></table></figure>

<h4 id="通过Google验证"><a href="#通过Google验证" class="headerlink" title="通过Google验证"></a>通过Google验证</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">pool, _ := x509.SystemCertPool()</span><br><span class="line"><span class="comment">// error handling omitted</span></span><br><span class="line">creds := credentials.NewClientTLSFromCert(pool, <span class="string">&quot;&quot;</span>)</span><br><span class="line">perRPC, _ := oauth.NewServiceAccountFromFile(<span class="string">&quot;service-account.json&quot;</span>, scope)</span><br><span class="line">conn, _ := grpc.Dial(</span><br><span class="line">	<span class="string">&quot;greeter.googleapis.com&quot;</span>,</span><br><span class="line">	grpc.WithTransportCredentials(creds),</span><br><span class="line">	grpc.WithPerRPCCredentials(perRPC),</span><br><span class="line">)</span><br><span class="line"><span class="comment">// error handling omitted</span></span><br><span class="line">client := pb.NewGreeterClient(conn)</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<h3 id="Ruby"><a href="#Ruby" class="headerlink" title="Ruby"></a>Ruby</h3><h4 id="基本情况-无加密或身份验证-1"><a href="#基本情况-无加密或身份验证-1" class="headerlink" title="基本情况 - 无加密或身份验证"></a>基本情况 - 无加密或身份验证</h4><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">stub = <span class="title class_">Helloworld::Greeter::Stub</span>.new(<span class="string">&#x27;localhost:50051&#x27;</span>, <span class="symbol">:this_channel_is_insecure</span>)</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h4 id="使用服务器身份验证SSL-TLS-1"><a href="#使用服务器身份验证SSL-TLS-1" class="headerlink" title="使用服务器身份验证SSL &#x2F; TLS"></a>使用服务器身份验证SSL &#x2F; TLS</h4><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">creds = <span class="variable constant_">GRPC</span><span class="symbol">:</span><span class="symbol">:Core</span><span class="symbol">:</span><span class="symbol">:Credentials</span>.new(load_certs)  <span class="comment"># load_certs typically loads a CA roots file</span></span><br><span class="line">stub = <span class="title class_">Helloworld::Greeter::Stub</span>.new(<span class="string">&#x27;myservice.example.com&#x27;</span>, creds)</span><br></pre></td></tr></table></figure>

<h4 id="通过Google验证-1"><a href="#通过Google验证-1" class="headerlink" title="通过Google验证"></a>通过Google验证</h4><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">&#x27;googleauth&#x27;</span>  <span class="comment"># from http://www.rubydoc.info/gems/googleauth/0.1.0</span></span><br><span class="line">...</span><br><span class="line">ssl_creds = <span class="variable constant_">GRPC</span><span class="symbol">:</span><span class="symbol">:Core</span><span class="symbol">:</span><span class="symbol">:ChannelCredentials</span>.new(load_certs)  <span class="comment"># load_certs typically loads a CA roots file</span></span><br><span class="line">authentication = Google::Auth.get_application_default()</span><br><span class="line">call_creds = <span class="variable constant_">GRPC</span><span class="symbol">:</span><span class="symbol">:Core</span><span class="symbol">:</span><span class="symbol">:CallCredentials</span>.new(authentication.updater_proc)</span><br><span class="line">combined_creds = ssl_creds.compose(call_creds)</span><br><span class="line">stub = <span class="title class_">Helloworld::Greeter::Stub</span>.new(<span class="string">&#x27;greeter.googleapis.com&#x27;</span>, combined_creds)</span><br></pre></td></tr></table></figure>

<h3 id="C"><a href="#C" class="headerlink" title="C++"></a>C++</h3><h4 id="基本情况-无加密或身份验证-2"><a href="#基本情况-无加密或身份验证-2" class="headerlink" title="基本情况 - 无加密或身份验证"></a>基本情况 - 无加密或身份验证</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> channel = grpc::<span class="built_in">CreateChannel</span>(<span class="string">&quot;localhost:50051&quot;</span>, <span class="built_in">InsecureChannelCredentials</span>());</span><br><span class="line"><span class="function">std::unique_ptr&lt;Greeter::Stub&gt; <span class="title">stub</span><span class="params">(Greeter::NewStub(channel))</span></span>;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h4 id="使用服务器身份验证SSL-TLS-2"><a href="#使用服务器身份验证SSL-TLS-2" class="headerlink" title="使用服务器身份验证SSL &#x2F; TLS"></a>使用服务器身份验证SSL &#x2F; TLS</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> channel_creds = grpc::<span class="built_in">SslCredentials</span>(grpc::<span class="built_in">SslCredentialsOptions</span>());</span><br><span class="line"><span class="keyword">auto</span> channel = grpc::<span class="built_in">CreateChannel</span>(<span class="string">&quot;myservice.example.com&quot;</span>, channel_creds);</span><br><span class="line"><span class="function">std::unique_ptr&lt;Greeter::Stub&gt; <span class="title">stub</span><span class="params">(Greeter::NewStub(channel))</span></span>;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h4 id="A通过Google验证"><a href="#A通过Google验证" class="headerlink" title="A通过Google验证"></a>A通过Google验证</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> creds = grpc::<span class="built_in">GoogleDefaultCredentials</span>();</span><br><span class="line"><span class="keyword">auto</span> channel = grpc::<span class="built_in">CreateChannel</span>(<span class="string">&quot;greeter.googleapis.com&quot;</span>, creds);</span><br><span class="line"><span class="function">std::unique_ptr&lt;Greeter::Stub&gt; <span class="title">stub</span><span class="params">(Greeter::NewStub(channel))</span></span>;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="C-1"><a href="#C-1" class="headerlink" title="C#"></a>C#</h3><h4 id="基本情况-无加密或身份验证-3"><a href="#基本情况-无加密或身份验证-3" class="headerlink" title="基本情况 - 无加密或身份验证"></a>基本情况 - 无加密或身份验证</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> channel = <span class="keyword">new</span> Channel(<span class="string">&quot;localhost:50051&quot;</span>, ChannelCredentials.Insecure);</span><br><span class="line"><span class="keyword">var</span> client = <span class="keyword">new</span> Greeter.GreeterClient(channel);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h4 id="使用服务器身份验证SSL-TLS-3"><a href="#使用服务器身份验证SSL-TLS-3" class="headerlink" title="使用服务器身份验证SSL &#x2F; TLS"></a>使用服务器身份验证SSL &#x2F; TLS</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> channelCredentials = <span class="keyword">new</span> SslCredentials(File.ReadAllText(<span class="string">&quot;roots.pem&quot;</span>));  <span class="comment">// Load a custom roots file.</span></span><br><span class="line"><span class="keyword">var</span> channel = <span class="keyword">new</span> Channel(<span class="string">&quot;myservice.example.com&quot;</span>, channelCredentials);</span><br><span class="line"><span class="keyword">var</span> client = <span class="keyword">new</span> Greeter.GreeterClient(channel);</span><br></pre></td></tr></table></figure>

<h4 id="A通过Google验证-1"><a href="#A通过Google验证-1" class="headerlink" title="A通过Google验证"></a>A通过Google验证</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Grpc.Auth;  <span class="comment">// from Grpc.Auth NuGet package</span></span><br><span class="line">...</span><br><span class="line"><span class="comment">// Loads Google Application Default Credentials with publicly trusted roots.</span></span><br><span class="line"><span class="keyword">var</span> channelCredentials = <span class="keyword">await</span> GoogleGrpcCredentials.GetApplicationDefaultAsync();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> channel = <span class="keyword">new</span> Channel(<span class="string">&quot;greeter.googleapis.com&quot;</span>, channelCredentials);</span><br><span class="line"><span class="keyword">var</span> client = <span class="keyword">new</span> Greeter.GreeterClient(channel);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h4 id="验证单个RPC调用"><a href="#验证单个RPC调用" class="headerlink" title="验证单个RPC调用"></a>验证单个RPC调用</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> channel = <span class="keyword">new</span> Channel(<span class="string">&quot;greeter.googleapis.com&quot;</span>, <span class="keyword">new</span> SslCredentials());  <span class="comment">// Use publicly trusted roots.</span></span><br><span class="line"><span class="keyword">var</span> client = <span class="keyword">new</span> Greeter.GreeterClient(channel);</span><br><span class="line">...</span><br><span class="line"><span class="keyword">var</span> googleCredential = <span class="keyword">await</span> GoogleCredential.GetApplicationDefaultAsync();</span><br><span class="line"><span class="keyword">var</span> result = client.SayHello(request, <span class="keyword">new</span> CallOptions(credentials: googleCredential.ToCallCredentials()));</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h3><h4 id="基本情况-无加密或身份验证-4"><a href="#基本情况-无加密或身份验证-4" class="headerlink" title="基本情况 - 无加密或身份验证"></a>基本情况 - 无加密或身份验证</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> grpc</span><br><span class="line"><span class="keyword">import</span> helloworld_pb2</span><br><span class="line"></span><br><span class="line">channel = grpc.insecure_channel(<span class="string">&#x27;localhost:50051&#x27;</span>)</span><br><span class="line">stub = helloworld_pb2.GreeterStub(channel)</span><br></pre></td></tr></table></figure>

<h4 id="使用服务器身份验证SSL-TLS-4"><a href="#使用服务器身份验证SSL-TLS-4" class="headerlink" title="使用服务器身份验证SSL &#x2F; TLS"></a>使用服务器身份验证SSL &#x2F; TLS</h4><p>客户端:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> grpc</span><br><span class="line"><span class="keyword">import</span> helloworld_pb2</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;roots.pem&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    creds = grpc.ssl_channel_credentials(f.read())</span><br><span class="line">channel = grpc.secure_channel(<span class="string">&#x27;myservice.example.com:443&#x27;</span>, creds)</span><br><span class="line">stub = helloworld_pb2.GreeterStub(channel)</span><br></pre></td></tr></table></figure>

<p>服务端:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> grpc</span><br><span class="line"><span class="keyword">import</span> helloworld_pb2</span><br><span class="line"><span class="keyword">from</span> concurrent <span class="keyword">import</span> futures</span><br><span class="line"></span><br><span class="line">server = grpc.server(futures.ThreadPoolExecutor(max_workers=<span class="number">10</span>))</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;key.pem&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    private_key = f.read()</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;chain.pem&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    certificate_chain = f.read()</span><br><span class="line">server_credentials = grpc.ssl_server_credentials( ( (private_key, certificate_chain), ) )</span><br><span class="line"><span class="comment"># Adding GreeterServicer to server omitted</span></span><br><span class="line">server.add_secure_port(<span class="string">&#x27;myservice.example.com:443&#x27;</span>, server_credentials)</span><br><span class="line">server.start()</span><br><span class="line"><span class="comment"># Server sleep omitted</span></span><br></pre></td></tr></table></figure>

<h4 id="使用JWT与Google进行身份验证"><a href="#使用JWT与Google进行身份验证" class="headerlink" title="使用JWT与Google进行身份验证"></a>使用JWT与Google进行身份验证</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> grpc</span><br><span class="line"><span class="keyword">import</span> helloworld_pb2</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> google <span class="keyword">import</span> auth <span class="keyword">as</span> google_auth</span><br><span class="line"><span class="keyword">from</span> google.auth <span class="keyword">import</span> jwt <span class="keyword">as</span> google_auth_jwt</span><br><span class="line"><span class="keyword">from</span> google.auth.transport <span class="keyword">import</span> grpc <span class="keyword">as</span> google_auth_transport_grpc</span><br><span class="line"></span><br><span class="line">credentials, _ = google_auth.default()</span><br><span class="line">jwt_creds = google_auth_jwt.OnDemandCredentials.from_signing_credentials(</span><br><span class="line">    credentials)</span><br><span class="line">channel = google_auth_transport_grpc.secure_authorized_channel(</span><br><span class="line">    jwt_creds, <span class="literal">None</span>, <span class="string">&#x27;greeter.googleapis.com:443&#x27;</span>)</span><br><span class="line">stub = helloworld_pb2.GreeterStub(channel)</span><br></pre></td></tr></table></figure>

<h4 id="使用Oauth2令牌通过Google进行身份验证"><a href="#使用Oauth2令牌通过Google进行身份验证" class="headerlink" title="使用Oauth2令牌通过Google进行身份验证"></a>使用Oauth2令牌通过Google进行身份验证</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> grpc</span><br><span class="line"><span class="keyword">import</span> helloworld_pb2</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> google <span class="keyword">import</span> auth <span class="keyword">as</span> google_auth</span><br><span class="line"><span class="keyword">from</span> google.auth.transport <span class="keyword">import</span> grpc <span class="keyword">as</span> google_auth_transport_grpc</span><br><span class="line"><span class="keyword">from</span> google.auth.transport <span class="keyword">import</span> requests <span class="keyword">as</span> google_auth_transport_requests</span><br><span class="line"></span><br><span class="line">credentials, _ = google_auth.default(scopes=(scope,))</span><br><span class="line">request = google_auth_transport_requests.Request()</span><br><span class="line">channel = google_auth_transport_grpc.secure_authorized_channel(</span><br><span class="line">    credentials, request, <span class="string">&#x27;greeter.googleapis.com:443&#x27;</span>)</span><br><span class="line">stub = helloworld_pb2.GreeterStub(channel)</span><br></pre></td></tr></table></figure>

<h3 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h3><h4 id="基本情况-无加密或身份验证-5"><a href="#基本情况-无加密或身份验证-5" class="headerlink" title="基本情况 - 无加密或身份验证"></a>基本情况 - 无加密或身份验证</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ManagedChannel</span> <span class="variable">channel</span> <span class="operator">=</span> ManagedChannelBuilder.forAddress(<span class="string">&quot;localhost&quot;</span>, <span class="number">50051</span>)</span><br><span class="line">    .usePlaintext(<span class="literal">true</span>)</span><br><span class="line">    .build();</span><br><span class="line">GreeterGrpc.<span class="type">GreeterStub</span> <span class="variable">stub</span> <span class="operator">=</span> GreeterGrpc.newStub(channel);</span><br></pre></td></tr></table></figure>

<h4 id="使用服务器身份验证SSL-TLS-5"><a href="#使用服务器身份验证SSL-TLS-5" class="headerlink" title="使用服务器身份验证SSL &#x2F; TLS"></a>使用服务器身份验证SSL &#x2F; TLS</h4><p>在Java中，我们建议您在使用gRPC over TLS时使用OpenSSL。 您可以在gRPC Java中找到有关安装和使用OpenSSL以及Android和非Android Java所需的其他库的详细信息[安全]（<a target="_blank" rel="noopener" href="https://github.com/grpc/grpc-java/blob/master/SECURITY.md">https://github.com/grpc/grpc-java/blob/master/SECURITY.md</a> #transport-security-tls）文档。</p>
<p>要在服务器上启用TLS，需要以PEM格式指定证书链和私钥。 这样的私钥不应该使用密码。 链中的证书顺序很重要：更具体地说，顶部的证书必须是主机CA，而最底部的证书必须是根CA. 标准TLS端口是443，但我们使用下面的8443以避免需要操作系统的额外权限。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Server</span> <span class="variable">server</span> <span class="operator">=</span> ServerBuilder.forPort(<span class="number">8443</span>)</span><br><span class="line">    <span class="comment">// Enable TLS</span></span><br><span class="line">    .useTransportSecurity(certChainFile, privateKeyFile)</span><br><span class="line">    .addService(TestServiceGrpc.bindService(serviceImplementation))</span><br><span class="line">    .build();</span><br><span class="line">server.start();</span><br></pre></td></tr></table></figure>

<p>如果客户端不知道颁发证书颁发机构，则应分别向<code>NettyChannelBuilder</code>或<code>OkHttpChannelBuilder</code>提供正确配置的<code>SslContext</code>或<code>SSLSocketFactory</code>。</p>
<p>在客户端，使用SSL &#x2F; TLS的服务器身份验证如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// With server authentication SSL/TLS</span></span><br><span class="line"><span class="type">ManagedChannel</span> <span class="variable">channel</span> <span class="operator">=</span> ManagedChannelBuilder.forAddress(<span class="string">&quot;myservice.example.com&quot;</span>, <span class="number">443</span>)</span><br><span class="line">    .build();</span><br><span class="line">GreeterGrpc.<span class="type">GreeterStub</span> <span class="variable">stub</span> <span class="operator">=</span> GreeterGrpc.newStub(channel);</span><br><span class="line"></span><br><span class="line"><span class="comment">// With server authentication SSL/TLS; custom CA root certificates; not on Android</span></span><br><span class="line"><span class="type">ManagedChannel</span> <span class="variable">channel</span> <span class="operator">=</span> NettyChannelBuilder.forAddress(<span class="string">&quot;myservice.example.com&quot;</span>, <span class="number">443</span>)</span><br><span class="line">    .sslContext(GrpcSslContexts.forClient().trustManager(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;roots.pem&quot;</span>)).build())</span><br><span class="line">    .build();</span><br><span class="line">GreeterGrpc.<span class="type">GreeterStub</span> <span class="variable">stub</span> <span class="operator">=</span> GreeterGrpc.newStub(channel);</span><br></pre></td></tr></table></figure>

<h4 id="通过Google验证-2"><a href="#通过Google验证-2" class="headerlink" title="通过Google验证"></a>通过Google验证</h4><p>The following code snippet shows how you can call the <a target="_blank" rel="noopener" href="https://cloud.google.com/pubsub/overview">Google Cloud PubSub API</a> using gRPC with a service account. The credentials are loaded from a key stored in a well-known location or by detecting that the application is running in an environment that can provide one automatically, e.g. Google Compute Engine. While this example is specific to Google and its services, similar patterns can be followed for other service providers.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">GoogleCredentials</span> <span class="variable">creds</span> <span class="operator">=</span> GoogleCredentials.getApplicationDefault();</span><br><span class="line"><span class="type">ManagedChannel</span> <span class="variable">channel</span> <span class="operator">=</span> ManagedChannelBuilder.forTarget(<span class="string">&quot;greeter.googleapis.com&quot;</span>)</span><br><span class="line">    .build();</span><br><span class="line">GreeterGrpc.<span class="type">GreeterStub</span> <span class="variable">stub</span> <span class="operator">=</span> GreeterGrpc.newStub(channel)</span><br><span class="line">    .withCallCredentials(MoreCallCredentials.from(creds));</span><br></pre></td></tr></table></figure>

<h3 id="Node-js"><a href="#Node-js" class="headerlink" title="Node.js"></a>Node.js</h3><h4 id="基本情况-无加密或身份验证-6"><a href="#基本情况-无加密或身份验证-6" class="headerlink" title="基本情况 - 无加密或身份验证"></a>基本情况 - 无加密或身份验证</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> stub = <span class="keyword">new</span> helloworld.<span class="title class_">Greeter</span>(<span class="string">&#x27;localhost:50051&#x27;</span>, grpc.<span class="property">credentials</span>.<span class="title function_">createInsecure</span>());</span><br></pre></td></tr></table></figure>

<h4 id="使用服务器身份验证SSL-TLS-6"><a href="#使用服务器身份验证SSL-TLS-6" class="headerlink" title="使用服务器身份验证SSL &#x2F; TLS"></a>使用服务器身份验证SSL &#x2F; TLS</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ssl_creds = grpc.<span class="property">credentials</span>.<span class="title function_">createSsl</span>(root_certs);</span><br><span class="line"><span class="keyword">var</span> stub = <span class="keyword">new</span> helloworld.<span class="title class_">Greeter</span>(<span class="string">&#x27;myservice.example.com&#x27;</span>, ssl_creds);</span><br></pre></td></tr></table></figure>

<h4 id="通过Google验证-3"><a href="#通过Google验证-3" class="headerlink" title="通过Google验证"></a>通过Google验证</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Authenticating with Google</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">GoogleAuth</span> = <span class="built_in">require</span>(<span class="string">&#x27;google-auth-library&#x27;</span>); <span class="comment">// from https://www.npmjs.com/package/google-auth-library</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">var</span> ssl_creds = grpc.<span class="property">credentials</span>.<span class="title function_">createSsl</span>(root_certs);</span><br><span class="line">(<span class="keyword">new</span> <span class="title class_">GoogleAuth</span>()).<span class="title function_">getApplicationDefault</span>(<span class="keyword">function</span>(<span class="params">err, auth</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> call_creds = grpc.<span class="property">credentials</span>.<span class="title function_">createFromGoogleCredential</span>(auth);</span><br><span class="line">  <span class="keyword">var</span> combined_creds = grpc.<span class="property">credentials</span>.<span class="title function_">combineChannelCredentials</span>(ssl_creds, call_creds);</span><br><span class="line">  <span class="keyword">var</span> stub = <span class="keyword">new</span> helloworld.<span class="title class_">Greeter</span>(<span class="string">&#x27;greeter.googleapis.com&#x27;</span>, combined_credentials);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="使用Oauth2令牌使用Google进行身份验证（传统方法）"><a href="#使用Oauth2令牌使用Google进行身份验证（传统方法）" class="headerlink" title="使用Oauth2令牌使用Google进行身份验证（传统方法）"></a>使用Oauth2令牌使用Google进行身份验证（传统方法）</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">GoogleAuth</span> = <span class="built_in">require</span>(<span class="string">&#x27;google-auth-library&#x27;</span>); <span class="comment">// from https://www.npmjs.com/package/google-auth-library</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">var</span> ssl_creds = grpc.<span class="property">Credentials</span>.<span class="title function_">createSsl</span>(root_certs); <span class="comment">// load_certs typically loads a CA roots file</span></span><br><span class="line"><span class="keyword">var</span> scope = <span class="string">&#x27;https://www.googleapis.com/auth/grpc-testing&#x27;</span>;</span><br><span class="line">(<span class="keyword">new</span> <span class="title class_">GoogleAuth</span>()).<span class="title function_">getApplicationDefault</span>(<span class="keyword">function</span>(<span class="params">err, auth</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (auth.<span class="title function_">createScopeRequired</span>()) &#123;</span><br><span class="line">    auth = auth.<span class="title function_">createScoped</span>(scope);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> call_creds = grpc.<span class="property">credentials</span>.<span class="title function_">createFromGoogleCredential</span>(auth);</span><br><span class="line">  <span class="keyword">var</span> combined_creds = grpc.<span class="property">credentials</span>.<span class="title function_">combineChannelCredentials</span>(ssl_creds, call_creds);</span><br><span class="line">  <span class="keyword">var</span> stub = <span class="keyword">new</span> helloworld.<span class="title class_">Greeter</span>(<span class="string">&#x27;greeter.googleapis.com&#x27;</span>, combined_credentials);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h3><h4 id="基本情况-无加密或身份验证-7"><a href="#基本情况-无加密或身份验证-7" class="headerlink" title="基本情况 - 无加密或身份验证"></a>基本情况 - 无加密或身份验证</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$client</span> = <span class="keyword">new</span> helloworld\<span class="title function_ invoke__">GreeterClient</span>(<span class="string">&#x27;localhost:50051&#x27;</span>, [</span><br><span class="line">    <span class="string">&#x27;credentials&#x27;</span> =&gt; <span class="title class_">Grpc\ChannelCredentials</span>::<span class="title function_ invoke__">createInsecure</span>(),</span><br><span class="line">]);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h4 id="通过Google验证-4"><a href="#通过Google验证-4" class="headerlink" title="通过Google验证"></a>通过Google验证</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateAuthMetadataCallback</span>(<span class="params"><span class="variable">$context</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$auth_credentials</span> = <span class="title class_">ApplicationDefaultCredentials</span>::<span class="title function_ invoke__">getCredentials</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$auth_credentials</span>-&gt;<span class="title function_ invoke__">updateMetadata</span>(<span class="variable">$metadata</span> = [], <span class="variable">$context</span>-&gt;service_url);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$channel_credentials</span> = <span class="title class_">Grpc\ChannelCredentials</span>::<span class="title function_ invoke__">createComposite</span>(</span><br><span class="line">    <span class="title class_">Grpc\ChannelCredentials</span>::<span class="title function_ invoke__">createSsl</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;roots.pem&#x27;</span>)),</span><br><span class="line">    <span class="title class_">Grpc\CallCredentials</span>::<span class="title function_ invoke__">createFromPlugin</span>(<span class="string">&#x27;updateAuthMetadataCallback&#x27;</span>)</span><br><span class="line">);</span><br><span class="line"><span class="variable">$opts</span> = [</span><br><span class="line">  <span class="string">&#x27;credentials&#x27;</span> =&gt; <span class="variable">$channel_credentials</span></span><br><span class="line">];</span><br><span class="line"><span class="variable">$client</span> = <span class="keyword">new</span> helloworld\<span class="title function_ invoke__">GreeterClient</span>(<span class="string">&#x27;greeter.googleapis.com&#x27;</span>, <span class="variable">$opts</span>);</span><br></pre></td></tr></table></figure>

<h4 id="使用Oauth2令牌使用Google进行身份验证（传统方法）-1"><a href="#使用Oauth2令牌使用Google进行身份验证（传统方法）-1" class="headerlink" title="使用Oauth2令牌使用Google进行身份验证（传统方法）"></a>使用Oauth2令牌使用Google进行身份验证（传统方法）</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// the environment variable &quot;GOOGLE_APPLICATION_CREDENTIALS&quot; needs to be set</span></span><br><span class="line"><span class="variable">$scope</span> = <span class="string">&quot;https://www.googleapis.com/auth/grpc-testing&quot;</span>;</span><br><span class="line"><span class="variable">$auth</span> = <span class="title class_">Google\Auth\ApplicationDefaultCredentials</span>::<span class="title function_ invoke__">getCredentials</span>(<span class="variable">$scope</span>);</span><br><span class="line"><span class="variable">$opts</span> = [</span><br><span class="line">  <span class="string">&#x27;credentials&#x27;</span> =&gt; <span class="title class_">Grpc\Credentials</span>::<span class="title function_ invoke__">createSsl</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;roots.pem&#x27;</span>));</span><br><span class="line">  <span class="string">&#x27;update_metadata&#x27;</span> =&gt; <span class="variable">$auth</span>-&gt;<span class="title function_ invoke__">getUpdateMetadataFunc</span>(),</span><br><span class="line">];</span><br><span class="line"><span class="variable">$client</span> = <span class="keyword">new</span> helloworld\<span class="title function_ invoke__">GreeterClient</span>(<span class="string">&#x27;greeter.googleapis.com&#x27;</span>, <span class="variable">$opts</span>);</span><br></pre></td></tr></table></figure>

<h3 id="Dart"><a href="#Dart" class="headerlink" title="Dart"></a>Dart</h3><h4 id="基本情况-无加密或身份验证-8"><a href="#基本情况-无加密或身份验证-8" class="headerlink" title="基本情况 - 无加密或身份验证"></a>基本情况 - 无加密或身份验证</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> channel = <span class="keyword">new</span> ClientChannel(<span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">      port: <span class="number">50051</span>,</span><br><span class="line">      options: <span class="keyword">const</span> ChannelOptions(</span><br><span class="line">          credentials: <span class="keyword">const</span> ChannelCredentials.insecure()));</span><br><span class="line"><span class="keyword">final</span> stub = <span class="keyword">new</span> GreeterClient(channel);</span><br></pre></td></tr></table></figure>

<h4 id="使用服务器身份验证SSL-TLS-7"><a href="#使用服务器身份验证SSL-TLS-7" class="headerlink" title="使用服务器身份验证SSL &#x2F; TLS"></a>使用服务器身份验证SSL &#x2F; TLS</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Load a custom roots file.</span></span><br><span class="line"><span class="keyword">final</span> trustedRoot = <span class="keyword">new</span> File(<span class="string">&#x27;roots.pem&#x27;</span>).readAsBytesSync();</span><br><span class="line"><span class="keyword">final</span> channelCredentials =</span><br><span class="line">    <span class="keyword">new</span> ChannelCredentials.secure(certificates: trustedRoot);</span><br><span class="line"><span class="keyword">final</span> channelOptions = <span class="keyword">new</span> ChannelOptions(credentials: channelCredentials);</span><br><span class="line"><span class="keyword">final</span> channel = <span class="keyword">new</span> ClientChannel(<span class="string">&#x27;myservice.example.com&#x27;</span>,</span><br><span class="line">    options: channelOptions);</span><br><span class="line"><span class="keyword">final</span> client = <span class="keyword">new</span> GreeterClient(channel);</span><br></pre></td></tr></table></figure>

<h4 id="通过Google验证-5"><a href="#通过Google验证-5" class="headerlink" title="通过Google验证"></a>通过Google验证</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Uses publicly trusted roots by default.</span></span><br><span class="line"><span class="keyword">final</span> channel = <span class="keyword">new</span> ClientChannel(<span class="string">&#x27;greeter.googleapis.com&#x27;</span>);</span><br><span class="line"><span class="keyword">final</span> serviceAccountJson =</span><br><span class="line">     <span class="keyword">new</span> File(<span class="string">&#x27;service-account.json&#x27;</span>).readAsStringSync();</span><br><span class="line"><span class="keyword">final</span> credentials = <span class="keyword">new</span> JwtServiceAccountAuthenticator(serviceAccountJson);</span><br><span class="line"><span class="keyword">final</span> client =</span><br><span class="line">    <span class="keyword">new</span> GreeterClient(channel, options: credentials.toCallOptions);</span><br></pre></td></tr></table></figure>

<h4 id="验证单个RPC调用-1"><a href="#验证单个RPC调用-1" class="headerlink" title="验证单个RPC调用"></a>验证单个RPC调用</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Uses publicly trusted roots by default.</span></span><br><span class="line"><span class="keyword">final</span> channel = <span class="keyword">new</span> ClientChannel(<span class="string">&#x27;greeter.googleapis.com&#x27;</span>);</span><br><span class="line"><span class="keyword">final</span> client = <span class="keyword">new</span> GreeterClient(channel);</span><br><span class="line">...</span><br><span class="line"><span class="keyword">final</span> serviceAccountJson =</span><br><span class="line">     <span class="keyword">new</span> File(<span class="string">&#x27;service-account.json&#x27;</span>).readAsStringSync();</span><br><span class="line"><span class="keyword">final</span> credentials = <span class="keyword">new</span> JwtServiceAccountAuthenticator(serviceAccountJson);</span><br><span class="line"><span class="keyword">final</span> response =</span><br><span class="line">    <span class="keyword">await</span> client.sayHello(request, options: credentials.toCallOptions);</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://wangyyovo.github.io">Blank</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://wangyyovo.github.io/posts/5527a6fb/">https://wangyyovo.github.io/posts/5527a6fb/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://wangyyovo.github.io" target="_blank">Blank</a>！</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="https://jsd.012700.xyz/gh/wangyyovo/CDN@master/cover/grpc/7affa62bd4ccba7a9648054529de821e.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://jsd.012700.xyz/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://jsd.012700.xyz/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/ac726f9b/" title="grpc-错误处理和调试"><img class="cover" src="https://jsd.012700.xyz/gh/wangyyovo/CDN@master/cover/grpc/e176d51922d5f883ec368af51ca6ec9b.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">grpc-错误处理和调试</div></div><div class="info-2"><div class="info-item-1"> 错误处理和调试错误处理此页面描述了gRPC如何处理错误，包括gRPC的内置错误代码。 可以在此处找到不同语言的示例代码。 错误模型正如您在我们的概念文档和示例中所看到的，当gRPC调用成功完成时，服务器会向客户端返回OK状态（取决于语言，OK状态可能会或可能不会直接在您的代码中使用）。 但如果通话不成功会怎样？ 如果发生错误，gRPC会返回其错误状态代码之一，并带有可选的字符串错误消息，该消息提供有关所发生情况的更多详细信息。 所有支持的语言中的gRPC客户端都可以使用错误信息。错误状态代码 gRPC在各种情况下引发错误，从网络故障到未经认证的连接，每个连接都与特定的状态代码相关联。 所有gRPC语言都支持以下错误状态代码。 一般错误GRPC_STATUS_CANCELLED 客户端应用程序取消了请求 GRPC_STATUS_DEADLINE_EXCEEDED 截止日期在服务器返回状态之前到期 GRPC_STATUS_UNIMPLEMENTED 在服务器上找不到方法 GRPC_STATUS_UNAVAILABLE 服务器关闭 GRPC_STATUS_UNKNOWN 服务器抛出异...</div></div></div></a><a class="pagination-related" href="/posts/ef2c5005/" title="grpc-概念"><img class="cover" src="https://jsd.012700.xyz/gh/wangyyovo/CDN@master/cover/grpc/69a889d02bd1240d25ce8ba4d8ea084a.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">grpc-概念</div></div><div class="info-2"><div class="info-item-1"> gRPC 概念本文档通过对于 gRPC 的架构和 RPC 生命周期的概览来介绍 gRPC 的主要概念。本文是在假设你已经读过文档部分的前提下展开的。针对具体语言细节请查看对应语言的快速开始、教程和参考文档（很快就会有完整的文档）。 概览服务定义正如其他 RPC 系统，gRPC 基于如下思想：定义一个服务， 指定其可以被远程调用的方法及其参数和返回类型。gRPC 默认使用 protocol buffers 作为接口定义语言，来描述服务接口和有效载荷消息结构。如果有需要的话，可以使用其他替代方案。 1234567891011service HelloService &#123;  rpc SayHello (HelloRequest) returns (HelloResponse);&#125;message HelloRequest &#123;  required string greeting = 1;&#125;message HelloResponse &#123;  required string reply = 1;&#125;  gRPC 允许你定义四类服务方法： ...</div></div></div></a></nav><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/theme/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Blank</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">352</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">46</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">58</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>主题 GitHub</span></a><div class="card-info-social-icons"><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fas fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%A4%E8%AF%81"><span class="toc-number">1.</span> <span class="toc-text">认证</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%94%AF%E6%8C%81%E7%9A%84%E6%8E%88%E6%9D%83%E6%9C%BA%E5%88%B6"><span class="toc-number">2.</span> <span class="toc-text">支持的授权机制</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SSL-TLS"><span class="toc-number">2.1.</span> <span class="toc-text">SSL&#x2F;TLS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OAuth-2-0"><span class="toc-number">2.2.</span> <span class="toc-text">OAuth 2.0</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#API"><span class="toc-number">2.3.</span> <span class="toc-text">API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%AE%A4%E8%AF%81%E5%8A%A0%E5%AF%86%E4%BD%BF%E7%94%A8%E7%9A%84-SSL-TLS"><span class="toc-number">2.3.1.</span> <span class="toc-text">服务端认证加密使用的 SSL&#x2F;TLS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87-Google-%E8%BF%9B%E8%A1%8C%E8%AE%A4%E8%AF%81"><span class="toc-number">2.3.2.</span> <span class="toc-text">通过 Google 进行认证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A9%E5%B1%95-gRPC-%E6%94%AF%E6%8C%81%E5%85%B6%E4%BB%96%E7%9A%84%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6"><span class="toc-number">2.3.3.</span> <span class="toc-text">扩展 gRPC 支持其他的认证机制</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90"><span class="toc-number">2.4.</span> <span class="toc-text">例子</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Go"><span class="toc-number">2.4.1.</span> <span class="toc-text">Go</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%83%85%E5%86%B5-%E6%97%A0%E5%8A%A0%E5%AF%86%E6%88%96%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81"><span class="toc-number">2.4.1.1.</span> <span class="toc-text">基本情况 - 无加密或身份验证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81SSL-TLS"><span class="toc-number">2.4.1.2.</span> <span class="toc-text">使用服务器身份验证SSL &#x2F; TLS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87Google%E9%AA%8C%E8%AF%81"><span class="toc-number">2.4.1.3.</span> <span class="toc-text">通过Google验证</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ruby"><span class="toc-number">2.4.2.</span> <span class="toc-text">Ruby</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%83%85%E5%86%B5-%E6%97%A0%E5%8A%A0%E5%AF%86%E6%88%96%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81-1"><span class="toc-number">2.4.2.1.</span> <span class="toc-text">基本情况 - 无加密或身份验证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81SSL-TLS-1"><span class="toc-number">2.4.2.2.</span> <span class="toc-text">使用服务器身份验证SSL &#x2F; TLS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87Google%E9%AA%8C%E8%AF%81-1"><span class="toc-number">2.4.2.3.</span> <span class="toc-text">通过Google验证</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#C"><span class="toc-number">2.4.3.</span> <span class="toc-text">C++</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%83%85%E5%86%B5-%E6%97%A0%E5%8A%A0%E5%AF%86%E6%88%96%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81-2"><span class="toc-number">2.4.3.1.</span> <span class="toc-text">基本情况 - 无加密或身份验证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81SSL-TLS-2"><span class="toc-number">2.4.3.2.</span> <span class="toc-text">使用服务器身份验证SSL &#x2F; TLS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#A%E9%80%9A%E8%BF%87Google%E9%AA%8C%E8%AF%81"><span class="toc-number">2.4.3.3.</span> <span class="toc-text">A通过Google验证</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#C-1"><span class="toc-number">2.4.4.</span> <span class="toc-text">C#</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%83%85%E5%86%B5-%E6%97%A0%E5%8A%A0%E5%AF%86%E6%88%96%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81-3"><span class="toc-number">2.4.4.1.</span> <span class="toc-text">基本情况 - 无加密或身份验证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81SSL-TLS-3"><span class="toc-number">2.4.4.2.</span> <span class="toc-text">使用服务器身份验证SSL &#x2F; TLS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#A%E9%80%9A%E8%BF%87Google%E9%AA%8C%E8%AF%81-1"><span class="toc-number">2.4.4.3.</span> <span class="toc-text">A通过Google验证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E5%8D%95%E4%B8%AARPC%E8%B0%83%E7%94%A8"><span class="toc-number">2.4.4.4.</span> <span class="toc-text">验证单个RPC调用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Python"><span class="toc-number">2.4.5.</span> <span class="toc-text">Python</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%83%85%E5%86%B5-%E6%97%A0%E5%8A%A0%E5%AF%86%E6%88%96%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81-4"><span class="toc-number">2.4.5.1.</span> <span class="toc-text">基本情况 - 无加密或身份验证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81SSL-TLS-4"><span class="toc-number">2.4.5.2.</span> <span class="toc-text">使用服务器身份验证SSL &#x2F; TLS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8JWT%E4%B8%8EGoogle%E8%BF%9B%E8%A1%8C%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81"><span class="toc-number">2.4.5.3.</span> <span class="toc-text">使用JWT与Google进行身份验证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Oauth2%E4%BB%A4%E7%89%8C%E9%80%9A%E8%BF%87Google%E8%BF%9B%E8%A1%8C%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81"><span class="toc-number">2.4.5.4.</span> <span class="toc-text">使用Oauth2令牌通过Google进行身份验证</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Java"><span class="toc-number">2.4.6.</span> <span class="toc-text">Java</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%83%85%E5%86%B5-%E6%97%A0%E5%8A%A0%E5%AF%86%E6%88%96%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81-5"><span class="toc-number">2.4.6.1.</span> <span class="toc-text">基本情况 - 无加密或身份验证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81SSL-TLS-5"><span class="toc-number">2.4.6.2.</span> <span class="toc-text">使用服务器身份验证SSL &#x2F; TLS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87Google%E9%AA%8C%E8%AF%81-2"><span class="toc-number">2.4.6.3.</span> <span class="toc-text">通过Google验证</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Node-js"><span class="toc-number">2.4.7.</span> <span class="toc-text">Node.js</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%83%85%E5%86%B5-%E6%97%A0%E5%8A%A0%E5%AF%86%E6%88%96%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81-6"><span class="toc-number">2.4.7.1.</span> <span class="toc-text">基本情况 - 无加密或身份验证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81SSL-TLS-6"><span class="toc-number">2.4.7.2.</span> <span class="toc-text">使用服务器身份验证SSL &#x2F; TLS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87Google%E9%AA%8C%E8%AF%81-3"><span class="toc-number">2.4.7.3.</span> <span class="toc-text">通过Google验证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Oauth2%E4%BB%A4%E7%89%8C%E4%BD%BF%E7%94%A8Google%E8%BF%9B%E8%A1%8C%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81%EF%BC%88%E4%BC%A0%E7%BB%9F%E6%96%B9%E6%B3%95%EF%BC%89"><span class="toc-number">2.4.7.4.</span> <span class="toc-text">使用Oauth2令牌使用Google进行身份验证（传统方法）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PHP"><span class="toc-number">2.4.8.</span> <span class="toc-text">PHP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%83%85%E5%86%B5-%E6%97%A0%E5%8A%A0%E5%AF%86%E6%88%96%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81-7"><span class="toc-number">2.4.8.1.</span> <span class="toc-text">基本情况 - 无加密或身份验证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87Google%E9%AA%8C%E8%AF%81-4"><span class="toc-number">2.4.8.2.</span> <span class="toc-text">通过Google验证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Oauth2%E4%BB%A4%E7%89%8C%E4%BD%BF%E7%94%A8Google%E8%BF%9B%E8%A1%8C%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81%EF%BC%88%E4%BC%A0%E7%BB%9F%E6%96%B9%E6%B3%95%EF%BC%89-1"><span class="toc-number">2.4.8.3.</span> <span class="toc-text">使用Oauth2令牌使用Google进行身份验证（传统方法）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dart"><span class="toc-number">2.4.9.</span> <span class="toc-text">Dart</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%83%85%E5%86%B5-%E6%97%A0%E5%8A%A0%E5%AF%86%E6%88%96%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81-8"><span class="toc-number">2.4.9.1.</span> <span class="toc-text">基本情况 - 无加密或身份验证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81SSL-TLS-7"><span class="toc-number">2.4.9.2.</span> <span class="toc-text">使用服务器身份验证SSL &#x2F; TLS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87Google%E9%AA%8C%E8%AF%81-5"><span class="toc-number">2.4.9.3.</span> <span class="toc-text">通过Google验证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E5%8D%95%E4%B8%AARPC%E8%B0%83%E7%94%A8-1"><span class="toc-number">2.4.9.4.</span> <span class="toc-text">验证单个RPC调用</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/d14168d/" title="虚拟机问题合集"><img src="https://jsd.012700.xyz/gh/wangyyovo/CDN@master/cover/hexo/090cfe4e9e60b0ad0de05db822f3ae97.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="虚拟机问题合集"/></a><div class="content"><a class="title" href="/posts/d14168d/" title="虚拟机问题合集">虚拟机问题合集</a><time datetime="2022-07-16T13:30:36.000Z" title="发表于 2022-07-16 21:30:36">2022-07-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/f540045f/" title="用go语言编写移动端sdk和app开发"><img src="https://jsd.012700.xyz/gh/wangyyovo/CDN@master/cover/golang/941ed1ec2925719a0c92e76f4f786b6a.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="用go语言编写移动端sdk和app开发"/></a><div class="content"><a class="title" href="/posts/f540045f/" title="用go语言编写移动端sdk和app开发">用go语言编写移动端sdk和app开发</a><time datetime="2022-07-04T12:14:21.000Z" title="发表于 2022-07-04 20:14:21">2022-07-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/5faac006/" title="在线编程IDE"><img src="https://jsd.012700.xyz/gh/wangyyovo/CDN@master/cover/hexo/090cfe4e9e60b0ad0de05db822f3ae97.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="在线编程IDE"/></a><div class="content"><a class="title" href="/posts/5faac006/" title="在线编程IDE">在线编程IDE</a><time datetime="2022-06-12T13:30:36.000Z" title="发表于 2022-06-12 21:30:36">2022-06-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/7594185d/" title="即时性能分析工具Pyroscope"><img src="https://jsd.012700.xyz/gh/wangyyovo/CDN@master/cover/golang/3bfb3279740bc9a5b5ef436fa887ef07.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="即时性能分析工具Pyroscope"/></a><div class="content"><a class="title" href="/posts/7594185d/" title="即时性能分析工具Pyroscope">即时性能分析工具Pyroscope</a><time datetime="2022-06-12T08:07:36.000Z" title="发表于 2022-06-12 16:07:36">2022-06-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/82a7aa7c/" title="golang性能调试优化方法"><img src="https://jsd.012700.xyz/gh/wangyyovo/CDN@master/cover/common/3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="golang性能调试优化方法"/></a><div class="content"><a class="title" href="/posts/82a7aa7c/" title="golang性能调试优化方法">golang性能调试优化方法</a><time datetime="2022-06-12T03:00:36.000Z" title="发表于 2022-06-12 11:00:36">2022-06-12</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By Blank</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 5.4.2</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.3</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="https://jsd.012700.xyz/npm/hexo-theme-butterfly/source/js/utils.min.js"></script><script src="https://jsd.012700.xyz/npm/hexo-theme-butterfly/source/js/main.min.js"></script><script src="https://jsd.012700.xyz/npm/hexo-theme-butterfly/source/js/tw_cn.min.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = {"placeholder":"请留下你的脚印","pageSize":10,"lang":"zh-CN","requiredFields":["nick","mail","link"]}

  const initValine = (el, path) => {
    if (isShuoshuo) {
      window.shuoshuoComment.destroyValine = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    const valineConfig = {
      el: '#vcomment',
      appId: 'BSfgwCPLOvPHVPaSoBCGSENf-MdYXbMMI',
      appKey: '2Q8qq5060qxycL6FPL26LnMG',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      visitor: false,
      ...option,
      path: isShuoshuo ? path : (option && option.path) || window.location.pathname
    }

    new Valine(valineConfig)
  }

  const loadValine = async (el, path) => {
    if (typeof Valine === 'function') {
      initValine(el, path)
    } else {
      await btf.getScript('https://jsd.012700.xyz/npm/valine/dist/Valine.min.js')
      initValine(el, path)
    }
  }

  if (isShuoshuo) {
    'Valine' === 'Valine'
      ? window.shuoshuoComment = { loadComment: loadValine }
      : window.loadOtherComment = loadValine
    return
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="https://jsd.012700.xyz/npm/hexo-theme-butterfly/source/js/search/local-search.min.js"></script></div></div></body></html>