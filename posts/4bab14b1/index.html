<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>行为模式-中介者模式 | Blank</title><meta name="author" content="Blank"><meta name="copyright" content="Blank"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="https:&#x2F;&#x2F;refactoringguru.cn&#x2F;design-patterns&#x2F;mediator  行为模式-中介者模式亦称： 调解人、控制器、Intermediary、Controller、Mediator 意图中介者模式是一种行为设计模式， 能让你减少对象之间混乱无序的依赖关系。 该模式会限制对象之间的直接交互， 迫使它们通过一个中介者对象进行合作。  问题假如你有一个创建和修改客户">
<meta property="og:type" content="article">
<meta property="og:title" content="行为模式-中介者模式">
<meta property="og:url" content="https://wangyyovo.github.io/posts/4bab14b1/">
<meta property="og:site_name" content="Blank">
<meta property="og:description" content="https:&#x2F;&#x2F;refactoringguru.cn&#x2F;design-patterns&#x2F;mediator  行为模式-中介者模式亦称： 调解人、控制器、Intermediary、Controller、Mediator 意图中介者模式是一种行为设计模式， 能让你减少对象之间混乱无序的依赖关系。 该模式会限制对象之间的直接交互， 迫使它们通过一个中介者对象进行合作。  问题假如你有一个创建和修改客户">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/ef8794f0f84662e28855cf10532c1682.jpg">
<meta property="article:published_time" content="2021-05-04T10:54:25.000Z">
<meta property="article:modified_time" content="2021-05-04T10:54:25.000Z">
<meta property="article:author" content="Blank">
<meta property="article:tag" content="pattern">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/ef8794f0f84662e28855cf10532c1682.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "行为模式-中介者模式",
  "url": "https://wangyyovo.github.io/posts/4bab14b1/",
  "image": "https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/ef8794f0f84662e28855cf10532c1682.jpg",
  "datePublished": "2021-05-04T10:54:25.000Z",
  "dateModified": "2021-05-04T10:54:25.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Blank",
      "url": "https://wangyyovo.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/theme/favicon.ico"><link rel="canonical" href="https://wangyyovo.github.io/posts/4bab14b1/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400,"highlightFullpage":true,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":150,"languages":{"author":"作者: Blank","link":"链接: ","source":"来源: Blank","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '行为模式-中介者模式',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="alternate" href="/atom.xml" title="Blank" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/theme/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">352</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">46</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">58</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-comment-dots"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-image"></i><span> 相册</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-book"></i><span> 教程</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/posts/21cfbf15/"><span> 🚀 快速開始</span></a></li><li><a class="site-page child" href="/posts/dc584b87/"><span> 📑 主題頁面</span></a></li><li><a class="site-page child" href="/posts/4aa8abbe/"><span> 🛠 主題配置</span></a></li><li><a class="site-page child" href="/posts/ceeb73f/"><span> ⚔️ 標簽外挂</span></a></li><li><a class="site-page child" href="/posts/98d20436/"><span> ❓ 主題問答</span></a></li><li><a class="site-page child" href="/posts/4073eda/"><span> ⚡️ 進階教程</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-language"></i><span> 语言</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/"><i class="fa-fw fas fa-c"></i><span> 中文</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/ef8794f0f84662e28855cf10532c1682.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Blank</span></a><a class="nav-page-title" href="/"><span class="site-name">行为模式-中介者模式</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-comment-dots"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-image"></i><span> 相册</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-book"></i><span> 教程</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/posts/21cfbf15/"><span> 🚀 快速開始</span></a></li><li><a class="site-page child" href="/posts/dc584b87/"><span> 📑 主題頁面</span></a></li><li><a class="site-page child" href="/posts/4aa8abbe/"><span> 🛠 主題配置</span></a></li><li><a class="site-page child" href="/posts/ceeb73f/"><span> ⚔️ 標簽外挂</span></a></li><li><a class="site-page child" href="/posts/98d20436/"><span> ❓ 主題問答</span></a></li><li><a class="site-page child" href="/posts/4073eda/"><span> ⚡️ 進階教程</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-language"></i><span> 语言</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/"><i class="fa-fw fas fa-c"></i><span> 中文</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">行为模式-中介者模式</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-05-04T10:54:25.000Z" title="发表于 2021-05-04 18:54:25">2021-05-04</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-05-04T10:54:25.000Z" title="更新于 2021-05-04 18:54:25">2021-05-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/pattern/">pattern</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">11.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>56分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><script src="\assets\js\APlayer.min.js"> </script><blockquote>
<p><a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/mediator">https://refactoringguru.cn/design-patterns/mediator</a></p>
</blockquote>
<h1 id="行为模式-中介者模式"><a href="#行为模式-中介者模式" class="headerlink" title="行为模式-中介者模式"></a>行为模式-中介者模式</h1><p><strong>亦称：</strong> 调解人、控制器、Intermediary、Controller、Mediator</p>
<h2 id="意图"><a href="#意图" class="headerlink" title="意图"></a>意图</h2><p><strong>中介者模式</strong>是一种行为设计模式， 能让你减少对象之间混乱无序的依赖关系。 该模式会限制对象之间的直接交互， 迫使它们通过一个中介者对象进行合作。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/blog/pattern/mediator.png"></p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>假如你有一个创建和修改客户资料的对话框， 它由各种控件组成， 例如文本框 （Text­Field）、 复选框 （Checkbox） 和按钮 （Button） 等。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/blog/pattern/problem1-zh-mediator.png" alt="用户界面中各元素间的关系会随程序发展而变得混乱。"></p>
<p>某些表单元素可能会直接进行互动。 例如， 选中 “我有一只狗” 复选框后可能会显示一个隐藏文本框用于输入狗狗的名字。 另一个例子是提交按钮必须在保存数据前校验所有输入内容。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/blog/pattern/problem2-mediator.png" alt="元素间存在许多关联。 因此， 对某些元素进行修改可能会影响其他元素。"></p>
<p>如果直接在表单元素代码中实现业务逻辑， 你将很难在程序其他表单中复用这些元素类。 例如， 由于复选框类与狗狗的文本框相耦合， 所以将无法在其他表单中使用它。 你要么使用渲染资料表单时用到的所有类， 要么一个都不用。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>中介者模式建议你停止组件之间的直接交流并使其相互独立。 这些组件必须调用特殊的中介者对象， 通过中介者对象重定向调用行为， 以间接的方式进行合作。 最终， 组件仅依赖于一个中介者类， 无需与多个其他组件相耦合。</p>
<p>在资料编辑表单的例子中， 对话框 （Dialog） 类本身将作为中介者， 其很可能已知自己所有的子元素， 因此你甚至无需在该类中引入新的依赖关系。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/blog/pattern/solution1-zh-mediator.png" alt="UI 元素必须通过中介者对象进行间接沟通。"></p>
<p>绝大部分重要的修改都在实际表单元素中进行。 让我们想想提交按钮。 之前， 当用户点击按钮后， 它必须对所有表单元素数值进行校验。 而现在它的唯一工作是将点击事件通知给对话框。 收到通知后， 对话框可以自行校验数值或将任务委派给各元素。 这样一来， 按钮不再与多个表单元素相关联， 而仅依赖于对话框类。</p>
<p>你还可以为所有类型的对话框抽取通用接口， 进一步削弱其依赖性。 接口中将声明一个所有表单元素都能使用的通知方法， 可用于将元素中发生的事件通知给对话框。 这样一来， 所有实现了该接口的对话框都能使用这个提交按钮了。</p>
<p>采用这种方式， 中介者模式让你能在单个中介者对象中封装多个对象间的复杂关系网。 类所拥有的依赖关系越少， 就越易于修改、 扩展或复用。</p>
<h2 id="真实世界类比"><a href="#真实世界类比" class="headerlink" title="真实世界类比"></a>真实世界类比</h2><p><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/blog/pattern/live-example-mediator.png" alt="飞行器驾驶员之间不会通过相互沟通来决定下一架降落的飞机。 所有沟通都通过控制塔台进行。"></p>
<p>飞行器驾驶员们在靠近或离开空中管制区域时不会直接相互交流。 但他们会与飞机跑道附近， 塔台中的空管员通话。 如果没有空管员， 驾驶员就需要留意机场附近的所有飞机， 并与数十位飞行员组成的委员会讨论降落顺序。 那恐怕会让飞机坠毁的统计数据一飞冲天吧。</p>
<p>塔台无需管制飞行全程， 只需在航站区加强管控即可， 因为该区域的决策参与者数量对于飞行员来说实在太多了。</p>
<h2 id="中介者模式结构"><a href="#中介者模式结构" class="headerlink" title="中介者模式结构"></a>中介者模式结构</h2><p><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/blog/pattern/structure-indexed-mediator.png"></p>
<ol>
<li><p><strong>组件</strong> （Component） 是各种包含业务逻辑的类。 每个组件都有一个指向中介者的引用， 该引用被声明为中介者接口类型。 组件不知道中介者实际所属的类， 因此你可通过将其连接到不同的中介者以使其能在其他程序中复用。</p>
</li>
<li><p><strong>中介者</strong> （Mediator） 接口声明了与组件交流的方法， 但通常仅包括一个通知方法。 组件可将任意上下文 （包括自己的对象） 作为该方法的参数， 只有这样接收组件和发送者类之间才不会耦合。</p>
</li>
<li><p><strong>具体中介者</strong> （Concrete Mediator） 封装了多种组件间的关系。 具体中介者通常会保存所有组件的引用并对其进行管理， 甚至有时会对其生命周期进行管理。</p>
</li>
<li><p>组件并不知道其他组件的情况。 如果组件内发生了重要事件， 它只能通知中介者。 中介者收到通知后能轻易地确定发送者， 这或许已足以判断接下来需要触发的组件了。</p>
<p>对于组件来说， 中介者看上去完全就是一个黑箱。 发送者不知道最终会由谁来处理自己的请求， 接收者也不知道最初是谁发出了请求。</p>
</li>
</ol>
<h2 id="伪代码"><a href="#伪代码" class="headerlink" title="伪代码"></a>伪代码</h2><p>在本例中， <strong>中介者</strong>模式可帮助你减少各种 UI 类 （按钮、 复选框和文本标签） 之间的相互依赖关系。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/blog/pattern/example-mediator.png" alt="UI 对话框类的结构"></p>
<p>用户触发的元素不会直接与其他元素交流， 即使看上去它们应该这样做。 相反， 元素只需让中介者知晓事件即可， 并能在发出通知时同时传递任何上下文信息。</p>
<p>本例中的中介者是整个认证对话框。 对话框知道具体元素应如何进行合作并促进它们的间接交流。 当接收到事件通知后， 对话框会确定负责处理事件的元素并据此重定向请求。</p>
<figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 中介者接口声明了一个能让组件将各种事件通知给中介者的方法。中介者可对这</span></span><br><span class="line"><span class="comment">// 些事件做出响应并将执行工作传递给其他组件。</span></span><br><span class="line"><span class="keyword">interface</span> Mediator <span class="keyword">is</span></span><br><span class="line">    method notify(sender: Component, event: <span class="keyword">string</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体中介者类可解开各组件之间相互交叉的连接关系并将其转移到中介者中。</span></span><br><span class="line"><span class="keyword">class</span> AuthenticationDialog <span class="keyword">implements</span> Mediator <span class="keyword">is</span></span><br><span class="line">    <span class="keyword">private</span> field title: <span class="keyword">string</span></span><br><span class="line">    <span class="keyword">private</span> field loginOrRegisterChkBx: Checkbox</span><br><span class="line">    <span class="keyword">private</span> field loginUsername, loginPassword: Textbox</span><br><span class="line">    <span class="keyword">private</span> field registrationUsername, registrationPassword,</span><br><span class="line">                  registrationEmail: Textbox</span><br><span class="line">    <span class="keyword">private</span> field okBtn, cancelBtn: Button</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">constructor</span> <span class="title">AuthenticationDialog</span><span class="params">()</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="comment">// 创建所有组件对象并将当前中介者传递给其构造函数以建立连接。</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="comment">// 当组件中有事件发生时，它会通知中介者。中介者接收到通知后可自行处理，</span></span></span><br><span class="line"><span class="function">    <span class="comment">// 也可将请求传递给另一个组件。</span></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">notify</span><span class="params">(sender, event)</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">if</span> <span class="params">(sender == loginOrRegisterChkBx <span class="keyword">and</span> event == &quot;check&quot;)</span></span></span><br><span class="line"><span class="function">            <span class="title">if</span> <span class="params">(loginOrRegisterChkBx.checked)</span></span></span><br><span class="line"><span class="function">                <span class="title">title</span> = &quot;登录&quot;</span></span><br><span class="line"><span class="function">                <span class="comment">// 1. 显示登录表单组件。</span></span></span><br><span class="line"><span class="function">                <span class="comment">// 2. 隐藏注册表单组件。</span></span></span><br><span class="line"><span class="function">            <span class="title">else</span></span></span><br><span class="line"><span class="function">                <span class="title">title</span> = &quot;注册&quot;</span></span><br><span class="line"><span class="function">                <span class="comment">// 1. 显示注册表单组件。</span></span></span><br><span class="line"><span class="function">                <span class="comment">// 2. 隐藏登录表单组件。</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">        <span class="title">if</span> <span class="params">(sender == okBtn &amp;&amp; event == &quot;click&quot;)</span></span></span><br><span class="line"><span class="function">            <span class="title">if</span> <span class="params">(loginOrRegister.checked)</span></span></span><br><span class="line"><span class="function">                <span class="comment">// 尝试找到使用登录信息的用户。</span></span></span><br><span class="line"><span class="function">                <span class="title">if</span> <span class="params">(!found)</span></span></span><br><span class="line"><span class="function">                    <span class="comment">// 在登录字段上方显示错误信息。</span></span></span><br><span class="line"><span class="function">            <span class="title">else</span></span></span><br><span class="line"><span class="function">                <span class="comment">// 1. 使用注册字段中的数据创建用户账号。</span></span></span><br><span class="line"><span class="function">                <span class="comment">// 2. 完成用户登录工作。 …</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// 组件会使用中介者接口与中介者进行交互。因此只需将它们与不同的中介者连接</span></span></span><br><span class="line"><span class="function"><span class="comment">// 起来，你就能在其他情境中使用这些组件了。</span></span></span><br><span class="line"><span class="function"><span class="title">class</span> <span class="title">Component</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">    <span class="title">field</span> <span class="title">dialog</span>:</span> Mediator</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">constructor</span> <span class="title">Component</span><span class="params">(dialog)</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">this</span>.<span class="title">dialog</span> = <span class="title">dialog</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">click</span><span class="params">()</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">dialog</span>.<span class="title">notify</span><span class="params">(this, &quot;click&quot;)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">keypress</span><span class="params">()</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">dialog</span>.<span class="title">notify</span><span class="params">(this, &quot;keypress&quot;)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// 具体组件之间无法进行交流。它们只有一个交流渠道，那就是向中介者发送通知。</span></span></span><br><span class="line"><span class="function"><span class="title">class</span> <span class="title">Button</span> <span class="title">extends</span> <span class="title">Component</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">    <span class="comment">// ...</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">class</span> <span class="title">Textbox</span> <span class="title">extends</span> <span class="title">Component</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">    <span class="comment">// ...</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">class</span> <span class="title">Checkbox</span> <span class="title">extends</span> <span class="title">Component</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">    <span class="title">method</span> <span class="title">check</span><span class="params">()</span> <span class="title">is</span></span></span><br><span class="line"><span class="function">        <span class="title">dialog</span>.<span class="title">notify</span><span class="params">(this, &quot;check&quot;)</span></span></span><br><span class="line"><span class="function">    <span class="comment">// ...</span></span></span><br></pre></td></tr></table></figure>

<h2 id="中介者模式适合应用场景"><a href="#中介者模式适合应用场景" class="headerlink" title="中介者模式适合应用场景"></a>中介者模式适合应用场景</h2><p><strong>当一些对象和其他对象紧密耦合以致难以对其进行修改时，可使用中介者模式。</strong></p>
<p>该模式让你将对象间的所有关系抽取成为一个单独的类， 以使对于特定组件的修改工作独立于其他组件。</p>
<p><strong>当组件因过于依赖其他组件而无法在不同应用中复用时，可使用中介者模式。</strong></p>
<p>应用中介者模式后， 每个组件不再知晓其他组件的情况。 尽管这些组件无法直接交流， 但它们仍可通过中介者对象进行间接交流。 如果你希望在不同应用中复用一个组件， 则需要为其提供一个新的中介者类。</p>
<p><strong>如果为了能在不同情景下复用一些基本行为，导致你需要被迫创建大量组件子类时，可使用中介者模式。</strong></p>
<p>由于所有组件间关系都被包含在中介者中， 因此你无需修改组件就能方便地新建中介者类以定义新的组件合作方式。</p>
<h2 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h2><ol>
<li>找到一组当前紧密耦合， 且提供其独立性能带来更大好处的类 （例如更易于维护或更方便复用）。</li>
<li>声明中介者接口并描述中介者和各种组件之间所需的交流接口。 在绝大多数情况下， 一个接收组件通知的方法就足够了。 如果你希望在不同情景下复用组件类， 那么该接口将非常重要。 只要组件使用通用接口与其中介者合作， 你就能将该组件与不同实现中的中介者进行连接。</li>
<li>实现具体中介者类。 该类可从自行保存其下所有组件的引用中受益。</li>
<li>你可以更进一步， 让中介者负责组件对象的创建和销毁。 此后， 中介者可能会与<a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/abstract-factory">工厂</a>或<a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/facade">外观</a>类似。</li>
<li>组件必须保存对于中介者对象的引用。 该连接通常在组件的构造函数中建立， 该函数会将中介者对象作为参数传递。</li>
<li>修改组件代码， 使其可调用中介者的通知方法， 而非其他组件的方法。 然后将调用其他组件的代码抽取到中介者类中， 并在中介者接收到该组件通知时执行这些代码。</li>
</ol>
<h2 id="中介者模式优缺点"><a href="#中介者模式优缺点" class="headerlink" title="中介者模式优缺点"></a>中介者模式优缺点</h2><p>优点</p>
<ul>
<li><em>单一职责原则</em>。 你可以将多个组件间的交流抽取到同一位置， 使其更易于理解和维护。</li>
<li><em>开闭原则</em>。 你无需修改实际组件就能增加新的中介者。</li>
<li>你可以减轻应用中多个组件间的耦合情况。</li>
<li>你可以更方便地复用各个组件。</li>
</ul>
<p>缺点</p>
<ul>
<li>一段时间后， 中介者可能会演化成为<a target="_blank" rel="noopener" href="https://refactoringguru.cn/antipatterns/god-object">上帝对象</a>。</li>
</ul>
<h2 id="与其他模式的关系"><a href="#与其他模式的关系" class="headerlink" title="与其他模式的关系"></a>与其他模式的关系</h2><ul>
<li><p><a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/chain-of-responsibility">责任链模式</a>、 <a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/command">命令模式</a>、 <a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/mediator">中介者模式</a>和<a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/observer">观察者模式</a>用于处理请求发送者和接收者之间的不同连接方式：</p>
<ul>
<li><em>责任链</em>按照顺序将请求动态传递给一系列的潜在接收者， 直至其中一名接收者对请求进行处理。</li>
<li><em>命令</em>在发送者和请求者之间建立单向连接。</li>
<li><em>中介者</em>清除了发送者和请求者之间的直接连接， 强制它们通过一个中介对象进行间接沟通。</li>
<li><em>观察者</em>允许接收者动态地订阅或取消接收请求。</li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/facade">外观模式</a>和<a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/mediator">中介者</a>的职责类似： 它们都尝试在大量紧密耦合的类中组织起合作。</p>
<ul>
<li><em>外观</em>为子系统中的所有对象定义了一个简单接口， 但是它不提供任何新功能。 子系统本身不会意识到外观的存在。 子系统中的对象可以直接进行交流。</li>
<li><em>中介者</em>将系统中组件的沟通行为中心化。 各组件只知道中介者对象， 无法直接相互交流。</li>
</ul>
</li>
<li><p><a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/mediator">中介者</a>和<a target="_blank" rel="noopener" href="https://refactoringguru.cn/design-patterns/observer">观察者</a>之间的区别往往很难记住。 在大部分情况下， 你可以使用其中一种模式， 而有时可以同时使用。 让我们来看看如何做到这一点。</p>
<p><em>中介者</em>的主要目标是消除一系列系统组件之间的相互依赖。 这些组件将依赖于同一个中介者对象。 <em>观察者</em>的目标是在对象之间建立动态的单向连接， 使得部分对象可作为其他对象的附属发挥作用。</p>
<p>有一种流行的中介者模式实现方式依赖于<em>观察者</em>。 中介者对象担当发布者的角色， 其他组件则作为订阅者， 可以订阅中介者的事件或取消订阅。 当<em>中介者</em>以这种方式实现时， 它可能看上去与<em>观察者</em>非常相似。</p>
<p>当你感到疑惑时， 记住可以采用其他方式来实现中介者。 例如， 你可永久性地将所有组件链接到同一个中介者对象。 这种实现方式和<em>观察者</em>并不相同， 但这仍是一种中介者模式。</p>
<p>假设有一个程序， 其所有的组件都变成了发布者， 它们之间可以相互建立动态连接。 这样程序中就没有中心化的中介者对象， 而只有一些分布式的观察者。</p>
</li>
</ul>
<h2 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h2><p><strong>中介者</strong>是一种行为设计模式， 让程序组件通过特殊的中介者对象进行间接沟通， 达到减少组件之间依赖关系的目的。</p>
<p>中介者能使得程序更易于修改和扩展， 而且能更方便地对独立的组件进行复用， 因为它们不再依赖于很多其他的类。</p>
<div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">C#</button><button type="button" class="tab">C++</button><button type="button" class="tab">JAVA</button><button type="button" class="tab">PHP</button><button type="button" class="tab">Python</button><button type="button" class="tab">Ruby</button><button type="button" class="tab">Swift</button><button type="button" class="tab">TypeScrit</button><button type="button" class="tab">Golang</button></div><div class="tab-contents"><div class="tab-item-content active"><p><strong>在 C# 中使用模式</strong></p>
<p><strong>复杂度：</strong> ★★☆</p>
<p><strong>流行度：</strong> ★★☆</p>
<p><strong>使用示例：</strong> 中介者模式在 C# 代码中最常用于帮助程序 GUI 组件之间的通信。 在 MVC 模式中， 控制器是中介者的同义词。</p>
<p><strong>概念示例</strong></p>
<p>本例说明了<strong>中介者</strong>设计模式的结构并重点回答了下面的问题：</p>
<ul>
<li>它由哪些类组成？</li>
<li>这些类扮演了哪些角色？</li>
<li>模式中的各个元素会以何种方式相互关联？</li>
</ul>
<p><strong>Program.cs:</strong> 概念示例</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">RefactoringGuru.DesignPatterns.Mediator.Conceptual</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// The Mediator interface declares a method used by components to notify the</span></span><br><span class="line">    <span class="comment">// mediator about various events. The Mediator may react to these events and</span></span><br><span class="line">    <span class="comment">// pass the execution to other components.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IMediator</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Notify</span>(<span class="params"><span class="built_in">object</span> sender, <span class="built_in">string</span> ev</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Concrete Mediators implement cooperative behavior by coordinating several</span></span><br><span class="line">    <span class="comment">// components.</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title">ConcreteMediator</span> : <span class="title">IMediator</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> Component1 _component1;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> Component2 _component2;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ConcreteMediator</span>(<span class="params">Component1 component1, Component2 component2</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">this</span>._component1 = component1;</span><br><span class="line">            <span class="keyword">this</span>._component1.SetMediator(<span class="keyword">this</span>);</span><br><span class="line">            <span class="keyword">this</span>._component2 = component2;</span><br><span class="line">            <span class="keyword">this</span>._component2.SetMediator(<span class="keyword">this</span>);</span><br><span class="line">        &#125; </span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Notify</span>(<span class="params"><span class="built_in">object</span> sender, <span class="built_in">string</span> ev</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (ev == <span class="string">&quot;A&quot;</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(<span class="string">&quot;Mediator reacts on A and triggers folowing operations:&quot;</span>);</span><br><span class="line">                <span class="keyword">this</span>._component2.DoC();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (ev == <span class="string">&quot;D&quot;</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(<span class="string">&quot;Mediator reacts on D and triggers following operations:&quot;</span>);</span><br><span class="line">                <span class="keyword">this</span>._component1.DoB();</span><br><span class="line">                <span class="keyword">this</span>._component2.DoC();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The Base Component provides the basic functionality of storing a</span></span><br><span class="line">    <span class="comment">// mediator&#x27;s instance inside component objects.</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title">BaseComponent</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">protected</span> IMediator _mediator;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">BaseComponent</span>(<span class="params">IMediator mediator = <span class="literal">null</span></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">this</span>._mediator = mediator;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetMediator</span>(<span class="params">IMediator mediator</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">this</span>._mediator = mediator;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Concrete Components implement various functionality. They don&#x27;t depend on</span></span><br><span class="line">    <span class="comment">// other components. They also don&#x27;t depend on any concrete mediator</span></span><br><span class="line">    <span class="comment">// classes.</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title">Component1</span> : <span class="title">BaseComponent</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DoA</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Component 1 does A.&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">this</span>._mediator.Notify(<span class="keyword">this</span>, <span class="string">&quot;A&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DoB</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Component 1 does B.&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">this</span>._mediator.Notify(<span class="keyword">this</span>, <span class="string">&quot;B&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title">Component2</span> : <span class="title">BaseComponent</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DoC</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Component 2 does C.&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">this</span>._mediator.Notify(<span class="keyword">this</span>, <span class="string">&quot;C&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DoD</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Component 2 does D.&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">this</span>._mediator.Notify(<span class="keyword">this</span>, <span class="string">&quot;D&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// The client code.</span></span><br><span class="line">            Component1 component1 = <span class="keyword">new</span> Component1();</span><br><span class="line">            Component2 component2 = <span class="keyword">new</span> Component2();</span><br><span class="line">            <span class="keyword">new</span> ConcreteMediator(component1, component2);</span><br><span class="line"></span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Client triggets operation A.&quot;</span>);</span><br><span class="line">            component1.DoA();</span><br><span class="line"></span><br><span class="line">            Console.WriteLine();</span><br><span class="line"></span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Client triggers operation D.&quot;</span>);</span><br><span class="line">            component2.DoD();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Client triggers operation A.</span><br><span class="line">Component 1 does A.</span><br><span class="line">Mediator reacts on A and triggers following operations:</span><br><span class="line">Component 2 does C.</span><br><span class="line"></span><br><span class="line">Client triggers operation D.</span><br><span class="line">Component 2 does D.</span><br><span class="line">Mediator reacts on D and triggers following operations:</span><br><span class="line">Component 1 does B.</span><br><span class="line">Component 2 does C.</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><strong>在 C++ 中使用模式</strong></p>
<p><strong>复杂度：</strong> ★★☆</p>
<p><strong>流行度：</strong> ★★☆</p>
<p><strong>使用示例：</strong> 中介者模式在 C++ 代码中最常用于帮助程序 GUI 组件之间的通信。 在 MVC 模式中， 控制器是中介者的同义词。</p>
<p><strong>概念示例</strong></p>
<p>本例说明了<strong>中介者</strong>设计模式的结构并重点回答了下面的问题：</p>
<ul>
<li>它由哪些类组成？</li>
<li>这些类扮演了哪些角色？</li>
<li>模式中的各个元素会以何种方式相互关联？</li>
</ul>
<p><strong>main.cc:</strong> 概念示例</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Mediator interface declares a method used by components to notify the</span></span><br><span class="line"><span class="comment"> * mediator about various events. The Mediator may react to these events and</span></span><br><span class="line"><span class="comment"> * pass the execution to other components.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BaseComponent</span>;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mediator</span> &#123;</span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Notify</span><span class="params">(BaseComponent *sender, std::string event)</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Base Component provides the basic functionality of storing a mediator&#x27;s</span></span><br><span class="line"><span class="comment"> * instance inside component objects.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BaseComponent</span> &#123;</span><br><span class="line"> <span class="keyword">protected</span>:</span><br><span class="line">  Mediator *mediator_;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">BaseComponent</span>(Mediator *mediator = <span class="literal">nullptr</span>) : <span class="built_in">mediator_</span>(mediator) &#123;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">set_mediator</span><span class="params">(Mediator *mediator)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;mediator_ = mediator;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Concrete Components implement various functionality. They don&#x27;t depend on</span></span><br><span class="line"><span class="comment"> * other components. They also don&#x27;t depend on any concrete mediator classes.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Component1</span> : <span class="keyword">public</span> BaseComponent &#123;</span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">DoA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Component 1 does A.\n&quot;</span>;</span><br><span class="line">    <span class="keyword">this</span>-&gt;mediator_-&gt;<span class="built_in">Notify</span>(<span class="keyword">this</span>, <span class="string">&quot;A&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">DoB</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Component 1 does B.\n&quot;</span>;</span><br><span class="line">    <span class="keyword">this</span>-&gt;mediator_-&gt;<span class="built_in">Notify</span>(<span class="keyword">this</span>, <span class="string">&quot;B&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Component2</span> : <span class="keyword">public</span> BaseComponent &#123;</span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">DoC</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Component 2 does C.\n&quot;</span>;</span><br><span class="line">    <span class="keyword">this</span>-&gt;mediator_-&gt;<span class="built_in">Notify</span>(<span class="keyword">this</span>, <span class="string">&quot;C&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">DoD</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Component 2 does D.\n&quot;</span>;</span><br><span class="line">    <span class="keyword">this</span>-&gt;mediator_-&gt;<span class="built_in">Notify</span>(<span class="keyword">this</span>, <span class="string">&quot;D&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Concrete Mediators implement cooperative behavior by coordinating several</span></span><br><span class="line"><span class="comment"> * components.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteMediator</span> : <span class="keyword">public</span> Mediator &#123;</span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">  Component1 *component1_;</span><br><span class="line">  Component2 *component2_;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">ConcreteMediator</span>(Component1 *c1, Component2 *c2) : <span class="built_in">component1_</span>(c1), <span class="built_in">component2_</span>(c2) &#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;component1_-&gt;<span class="built_in">set_mediator</span>(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">this</span>-&gt;component2_-&gt;<span class="built_in">set_mediator</span>(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">Notify</span><span class="params">(BaseComponent *sender, std::string event)</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (event == <span class="string">&quot;A&quot;</span>) &#123;</span><br><span class="line">      std::cout &lt;&lt; <span class="string">&quot;Mediator reacts on A and triggers following operations:\n&quot;</span>;</span><br><span class="line">      <span class="keyword">this</span>-&gt;component2_-&gt;<span class="built_in">DoC</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (event == <span class="string">&quot;D&quot;</span>) &#123;</span><br><span class="line">      std::cout &lt;&lt; <span class="string">&quot;Mediator reacts on D and triggers following operations:\n&quot;</span>;</span><br><span class="line">      <span class="keyword">this</span>-&gt;component1_-&gt;<span class="built_in">DoB</span>();</span><br><span class="line">      <span class="keyword">this</span>-&gt;component2_-&gt;<span class="built_in">DoC</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The client code.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ClientCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  Component1 *c1 = <span class="keyword">new</span> Component1;</span><br><span class="line">  Component2 *c2 = <span class="keyword">new</span> Component2;</span><br><span class="line">  ConcreteMediator *mediator = <span class="keyword">new</span> <span class="built_in">ConcreteMediator</span>(c1, c2);</span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;Client triggers operation A.\n&quot;</span>;</span><br><span class="line">  c1-&gt;<span class="built_in">DoA</span>();</span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;Client triggers operation D.\n&quot;</span>;</span><br><span class="line">  c2-&gt;<span class="built_in">DoD</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">delete</span> c1;</span><br><span class="line">  <span class="keyword">delete</span> c2;</span><br><span class="line">  <span class="keyword">delete</span> mediator;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">ClientCode</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Client triggers operation A.</span><br><span class="line">Component 1 does A.</span><br><span class="line">Mediator reacts on A and triggers following operations:</span><br><span class="line">Component 2 does C.</span><br><span class="line"></span><br><span class="line">Client triggers operation D.</span><br><span class="line">Component 2 does D.</span><br><span class="line">Mediator reacts on D and triggers following operations:</span><br><span class="line">Component 1 does B.</span><br><span class="line">Component 2 does C.</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><strong>在 Java 中使用模式</strong></p>
<p><strong>复杂度：</strong> ★★☆</p>
<p><strong>流行度：</strong> ★★☆</p>
<p><strong>使用示例：</strong> 中介者模式在 Java 代码中最常用于帮助程序 GUI 组件之间的通信。 在 MVC 模式中， 控制器是中介者的同义词。</p>
<p>下面是核心 Java 程序库中该模式的一些示例：</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://docs.oracle.com/javase/8/docs/api/java/util/Timer.html"><code>java.util.Timer</code></a> （所有 <code>schedule­XXX()</code>方法）</li>
<li><a target="_blank" rel="noopener" href="http://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Executor.html#execute-java.lang.Runnable-"><code>java.util.concurrent.Executor#execute()</code></a></li>
<li><a target="_blank" rel="noopener" href="http://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ExecutorService.html"><code>java.util.concurrent.ExecutorService</code></a> （ <code>invoke­XXX()</code>和 <code>submit­()</code>方法）</li>
<li><a target="_blank" rel="noopener" href="http://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ScheduledExecutorService.html"><code>java.util.concurrent.ScheduledExecutorService</code></a> （所有 <code>schedule­XXX()</code>方法）</li>
<li><a target="_blank" rel="noopener" href="http://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Method.html#invoke-java.lang.Object-java.lang.Object...-"><code>java.lang.reflect.Method#invoke()</code></a></li>
</ul>
<p><strong>笔记程序</strong></p>
<p>本例展示了如何将许多 GUI 元素组织起来， 使其在中介者的帮助下无需相互依赖就能合作。</p>
<p><strong>components:</strong> Colleague classes</p>
<p><strong>components&#x2F;Component.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.mediator.example.components;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.mediator.example.mediator.Mediator;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Common component interface.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Component</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setMediator</span><span class="params">(Mediator mediator)</span>;</span><br><span class="line">    String <span class="title function_">getName</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>components&#x2F;AddButton.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.mediator.example.components;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.mediator.example.mediator.Mediator;</span><br><span class="line"><span class="keyword">import</span> refactoring_guru.mediator.example.mediator.Note;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionEvent;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Concrete components don&#x27;t talk with each other. They have only one</span></span><br><span class="line"><span class="comment"> * communication channel–sending requests to the mediator.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddButton</span> <span class="keyword">extends</span> <span class="title class_">JButton</span> <span class="keyword">implements</span> <span class="title class_">Component</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Mediator mediator;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AddButton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(<span class="string">&quot;Add&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMediator</span><span class="params">(Mediator mediator)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.mediator = mediator;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">fireActionPerformed</span><span class="params">(ActionEvent actionEvent)</span> &#123;</span><br><span class="line">        mediator.addNewNote(<span class="keyword">new</span> <span class="title class_">Note</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;AddButton&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>components&#x2F;DeleteButton.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.mediator.example.components;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.mediator.example.mediator.Mediator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionEvent;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Concrete components don&#x27;t talk with each other. They have only one</span></span><br><span class="line"><span class="comment"> * communication channel–sending requests to the mediator.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeleteButton</span> <span class="keyword">extends</span> <span class="title class_">JButton</span>  <span class="keyword">implements</span> <span class="title class_">Component</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Mediator mediator;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DeleteButton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(<span class="string">&quot;Del&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMediator</span><span class="params">(Mediator mediator)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.mediator = mediator;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">fireActionPerformed</span><span class="params">(ActionEvent actionEvent)</span> &#123;</span><br><span class="line">        mediator.deleteNote();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;DelButton&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>components&#x2F;Filter.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.mediator.example.components;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.mediator.example.mediator.Mediator;</span><br><span class="line"><span class="keyword">import</span> refactoring_guru.mediator.example.mediator.Note;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.KeyEvent;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Concrete components don&#x27;t talk with each other. They have only one</span></span><br><span class="line"><span class="comment"> * communication channel–sending requests to the mediator.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Filter</span> <span class="keyword">extends</span> <span class="title class_">JTextField</span> <span class="keyword">implements</span> <span class="title class_">Component</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Mediator mediator;</span><br><span class="line">    <span class="keyword">private</span> ListModel listModel;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Filter</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMediator</span><span class="params">(Mediator mediator)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.mediator = mediator;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">processComponentKeyEvent</span><span class="params">(KeyEvent keyEvent)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">start</span> <span class="operator">=</span> getText();</span><br><span class="line">        searchElements(start);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setList</span><span class="params">(ListModel listModel)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.listModel = listModel;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">searchElements</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (listModel == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (s.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">            mediator.setElementsList(listModel);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ArrayList&lt;Note&gt; notes = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; listModel.getSize(); i++) &#123;</span><br><span class="line">            notes.add((Note) listModel.getElementAt(i));</span><br><span class="line">        &#125;</span><br><span class="line">        DefaultListModel&lt;Note&gt; listModel = <span class="keyword">new</span> <span class="title class_">DefaultListModel</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Note note : notes) &#123;</span><br><span class="line">            <span class="keyword">if</span> (note.getName().contains(s)) &#123;</span><br><span class="line">                listModel.addElement(note);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        mediator.setElementsList(listModel);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Filter&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>components&#x2F;List.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.mediator.example.components;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.mediator.example.mediator.Mediator;</span><br><span class="line"><span class="keyword">import</span> refactoring_guru.mediator.example.mediator.Note;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Concrete components don&#x27;t talk with each other. They have only one</span></span><br><span class="line"><span class="comment"> * communication channel–sending requests to the mediator.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">List</span> <span class="keyword">extends</span> <span class="title class_">JList</span> <span class="keyword">implements</span> <span class="title class_">Component</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Mediator mediator;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DefaultListModel LIST_MODEL;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">List</span><span class="params">(DefaultListModel listModel)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(listModel);</span><br><span class="line">        <span class="built_in">this</span>.LIST_MODEL = listModel;</span><br><span class="line">        setModel(listModel);</span><br><span class="line">        <span class="built_in">this</span>.setLayoutOrientation(JList.VERTICAL);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Hide</span>(<span class="built_in">this</span>));</span><br><span class="line">        thread.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMediator</span><span class="params">(Mediator mediator)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.mediator = mediator;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addElement</span><span class="params">(Note note)</span> &#123;</span><br><span class="line">        LIST_MODEL.addElement(note);</span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> LIST_MODEL.size() - <span class="number">1</span>;</span><br><span class="line">        setSelectedIndex(index);</span><br><span class="line">        ensureIndexIsVisible(index);</span><br><span class="line">        mediator.sendToFilter(LIST_MODEL);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteElement</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="built_in">this</span>.getSelectedIndex();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            LIST_MODEL.remove(index);</span><br><span class="line">            mediator.sendToFilter(LIST_MODEL);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ArrayIndexOutOfBoundsException ignored) &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Note <span class="title function_">getCurrentElement</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (Note)getSelectedValue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;List&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">Hide</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> List list;</span><br><span class="line"></span><br><span class="line">        Hide(List list) &#123;</span><br><span class="line">            <span class="built_in">this</span>.list = list;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">300</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException ex) &#123;</span><br><span class="line">                    ex.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (list.isSelectionEmpty()) &#123;</span><br><span class="line">                    mediator.hideElements(<span class="literal">true</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    mediator.hideElements(<span class="literal">false</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>components&#x2F;SaveButton.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.mediator.example.components;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.mediator.example.mediator.Mediator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionEvent;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Concrete components don&#x27;t talk with each other. They have only one</span></span><br><span class="line"><span class="comment"> * communication channel–sending requests to the mediator.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SaveButton</span> <span class="keyword">extends</span> <span class="title class_">JButton</span> <span class="keyword">implements</span> <span class="title class_">Component</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Mediator mediator;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SaveButton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(<span class="string">&quot;Save&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMediator</span><span class="params">(Mediator mediator)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.mediator = mediator;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">fireActionPerformed</span><span class="params">(ActionEvent actionEvent)</span> &#123;</span><br><span class="line">        mediator.saveChanges();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;SaveButton&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>components&#x2F;TextBox.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.mediator.example.components;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.mediator.example.mediator.Mediator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.KeyEvent;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Concrete components don&#x27;t talk with each other. They have only one</span></span><br><span class="line"><span class="comment"> * communication channel–sending requests to the mediator.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TextBox</span> <span class="keyword">extends</span> <span class="title class_">JTextArea</span> <span class="keyword">implements</span> <span class="title class_">Component</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Mediator mediator;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMediator</span><span class="params">(Mediator mediator)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.mediator = mediator;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">processComponentKeyEvent</span><span class="params">(KeyEvent keyEvent)</span> &#123;</span><br><span class="line">        mediator.markNote();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;TextBox&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>components&#x2F;Title.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.mediator.example.components;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.mediator.example.mediator.Mediator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.KeyEvent;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Concrete components don&#x27;t talk with each other. They have only one</span></span><br><span class="line"><span class="comment"> * communication channel–sending requests to the mediator.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Title</span> <span class="keyword">extends</span> <span class="title class_">JTextField</span> <span class="keyword">implements</span> <span class="title class_">Component</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Mediator mediator;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMediator</span><span class="params">(Mediator mediator)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.mediator = mediator;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">processComponentKeyEvent</span><span class="params">(KeyEvent keyEvent)</span> &#123;</span><br><span class="line">        mediator.markNote();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Title&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>mediator</strong></p>
<p><strong>mediator&#x2F;Mediator.java:</strong> 定义通用的中介者接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.mediator.example.mediator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.mediator.example.components.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Common mediator interface.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Mediator</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addNewNote</span><span class="params">(Note note)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteNote</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">getInfoFromList</span><span class="params">(Note note)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">saveChanges</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">markNote</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">sendToFilter</span><span class="params">(ListModel listModel)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setElementsList</span><span class="params">(ListModel list)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">registerComponent</span><span class="params">(Component component)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">hideElements</span><span class="params">(<span class="type">boolean</span> flag)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">createGUI</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>mediator&#x2F;Editor.java:</strong> 具体中介者</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.mediator.example.mediator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.mediator.example.components.*;</span><br><span class="line"><span class="keyword">import</span> refactoring_guru.mediator.example.components.Component;</span><br><span class="line"><span class="keyword">import</span> refactoring_guru.mediator.example.components.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> javax.swing.border.LineBorder;</span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Concrete mediator. All chaotic communications between concrete components</span></span><br><span class="line"><span class="comment"> * have been extracted to the mediator. Now components only talk with the</span></span><br><span class="line"><span class="comment"> * mediator, which knows who has to handle a request.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Editor</span> <span class="keyword">implements</span> <span class="title class_">Mediator</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Title title;</span><br><span class="line">    <span class="keyword">private</span> TextBox textBox;</span><br><span class="line">    <span class="keyword">private</span> AddButton add;</span><br><span class="line">    <span class="keyword">private</span> DeleteButton del;</span><br><span class="line">    <span class="keyword">private</span> SaveButton save;</span><br><span class="line">    <span class="keyword">private</span> List list;</span><br><span class="line">    <span class="keyword">private</span> Filter filter;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">JLabel</span> <span class="variable">titleLabel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JLabel</span>(<span class="string">&quot;Title:&quot;</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="type">JLabel</span> <span class="variable">textLabel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JLabel</span>(<span class="string">&quot;Text:&quot;</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="type">JLabel</span> <span class="variable">label</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JLabel</span>(<span class="string">&quot;Add or select existing note to proceed...&quot;</span>);</span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Here the registration of components by the mediator.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerComponent</span><span class="params">(Component component)</span> &#123;</span><br><span class="line">        component.setMediator(<span class="built_in">this</span>);</span><br><span class="line">        <span class="keyword">switch</span> (component.getName()) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;AddButton&quot;</span>:</span><br><span class="line">                add = (AddButton)component;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;DelButton&quot;</span>:</span><br><span class="line">                del = (DeleteButton)component;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;Filter&quot;</span>:</span><br><span class="line">                filter = (Filter)component;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;List&quot;</span>:</span><br><span class="line">                list = (List)component;</span><br><span class="line">                <span class="built_in">this</span>.list.addListSelectionListener(listSelectionEvent -&gt; &#123;</span><br><span class="line">                    <span class="type">Note</span> <span class="variable">note</span> <span class="operator">=</span> (Note)list.getSelectedValue();</span><br><span class="line">                    <span class="keyword">if</span> (note != <span class="literal">null</span>) &#123;</span><br><span class="line">                        getInfoFromList(note);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        clear();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;SaveButton&quot;</span>:</span><br><span class="line">                save = (SaveButton)component;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;TextBox&quot;</span>:</span><br><span class="line">                textBox = (TextBox)component;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;Title&quot;</span>:</span><br><span class="line">                title = (Title)component;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Various methods to handle requests from particular components.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addNewNote</span><span class="params">(Note note)</span> &#123;</span><br><span class="line">        title.setText(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        textBox.setText(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        list.addElement(note);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteNote</span><span class="params">()</span> &#123;</span><br><span class="line">        list.deleteElement();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getInfoFromList</span><span class="params">(Note note)</span> &#123;</span><br><span class="line">        title.setText(note.getName().replace(<span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27; &#x27;</span>));</span><br><span class="line">        textBox.setText(note.getText());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveChanges</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Note</span> <span class="variable">note</span> <span class="operator">=</span> (Note) list.getSelectedValue();</span><br><span class="line">            note.setName(title.getText());</span><br><span class="line">            note.setText(textBox.getText());</span><br><span class="line">            list.repaint();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NullPointerException ignored) &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">markNote</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Note</span> <span class="variable">note</span> <span class="operator">=</span> list.getCurrentElement();</span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> note.getName();</span><br><span class="line">            <span class="keyword">if</span> (!name.endsWith(<span class="string">&quot;*&quot;</span>)) &#123;</span><br><span class="line">                note.setName(note.getName() + <span class="string">&quot;*&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            list.repaint();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NullPointerException ignored) &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span> &#123;</span><br><span class="line">        title.setText(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        textBox.setText(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendToFilter</span><span class="params">(ListModel listModel)</span> &#123;</span><br><span class="line">        filter.setList(listModel);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setElementsList</span><span class="params">(ListModel list)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.list.setModel(list);</span><br><span class="line">        <span class="built_in">this</span>.list.repaint();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hideElements</span><span class="params">(<span class="type">boolean</span> flag)</span> &#123;</span><br><span class="line">        titleLabel.setVisible(!flag);</span><br><span class="line">        textLabel.setVisible(!flag);</span><br><span class="line">        title.setVisible(!flag);</span><br><span class="line">        textBox.setVisible(!flag);</span><br><span class="line">        save.setVisible(!flag);</span><br><span class="line">        label.setVisible(flag);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createGUI</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">JFrame</span> <span class="variable">notes</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JFrame</span>(<span class="string">&quot;Notes&quot;</span>);</span><br><span class="line">        notes.setSize(<span class="number">960</span>, <span class="number">600</span>);</span><br><span class="line">        notes.setDefaultCloseOperation(WindowConstants.EXIT_ON_CLOSE);</span><br><span class="line">        <span class="type">JPanel</span> <span class="variable">left</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JPanel</span>();</span><br><span class="line">        left.setBorder(<span class="keyword">new</span> <span class="title class_">LineBorder</span>(Color.BLACK));</span><br><span class="line">        left.setSize(<span class="number">320</span>, <span class="number">600</span>);</span><br><span class="line">        left.setLayout(<span class="keyword">new</span> <span class="title class_">BoxLayout</span>(left, BoxLayout.Y_AXIS));</span><br><span class="line">        <span class="type">JPanel</span> <span class="variable">filterPanel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JPanel</span>();</span><br><span class="line">        filterPanel.add(<span class="keyword">new</span> <span class="title class_">JLabel</span>(<span class="string">&quot;Filter:&quot;</span>));</span><br><span class="line">        filter.setColumns(<span class="number">20</span>);</span><br><span class="line">        filterPanel.add(filter);</span><br><span class="line">        filterPanel.setPreferredSize(<span class="keyword">new</span> <span class="title class_">Dimension</span>(<span class="number">280</span>, <span class="number">40</span>));</span><br><span class="line">        <span class="type">JPanel</span> <span class="variable">listPanel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JPanel</span>();</span><br><span class="line">        list.setFixedCellWidth(<span class="number">260</span>);</span><br><span class="line">        listPanel.setSize(<span class="number">320</span>, <span class="number">470</span>);</span><br><span class="line">        <span class="type">JScrollPane</span> <span class="variable">scrollPane</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JScrollPane</span>(list);</span><br><span class="line">        scrollPane.setPreferredSize(<span class="keyword">new</span> <span class="title class_">Dimension</span>(<span class="number">275</span>, <span class="number">410</span>));</span><br><span class="line">        listPanel.add(scrollPane);</span><br><span class="line">        <span class="type">JPanel</span> <span class="variable">buttonPanel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JPanel</span>();</span><br><span class="line">        add.setPreferredSize(<span class="keyword">new</span> <span class="title class_">Dimension</span>(<span class="number">85</span>, <span class="number">25</span>));</span><br><span class="line">        buttonPanel.add(add);</span><br><span class="line">        del.setPreferredSize(<span class="keyword">new</span> <span class="title class_">Dimension</span>(<span class="number">85</span>, <span class="number">25</span>));</span><br><span class="line">        buttonPanel.add(del);</span><br><span class="line">        buttonPanel.setLayout(<span class="keyword">new</span> <span class="title class_">FlowLayout</span>());</span><br><span class="line">        left.add(filterPanel);</span><br><span class="line">        left.add(listPanel);</span><br><span class="line">        left.add(buttonPanel);</span><br><span class="line">        <span class="type">JPanel</span> <span class="variable">right</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JPanel</span>();</span><br><span class="line">        right.setLayout(<span class="literal">null</span>);</span><br><span class="line">        right.setSize(<span class="number">640</span>, <span class="number">600</span>);</span><br><span class="line">        right.setLocation(<span class="number">320</span>, <span class="number">0</span>);</span><br><span class="line">        right.setBorder(<span class="keyword">new</span> <span class="title class_">LineBorder</span>(Color.BLACK));</span><br><span class="line">        titleLabel.setBounds(<span class="number">20</span>, <span class="number">4</span>, <span class="number">50</span>, <span class="number">20</span>);</span><br><span class="line">        title.setBounds(<span class="number">60</span>, <span class="number">5</span>, <span class="number">555</span>, <span class="number">20</span>);</span><br><span class="line">        textLabel.setBounds(<span class="number">20</span>, <span class="number">4</span>, <span class="number">50</span>, <span class="number">130</span>);</span><br><span class="line">        textBox.setBorder(<span class="keyword">new</span> <span class="title class_">LineBorder</span>(Color.DARK_GRAY));</span><br><span class="line">        textBox.setBounds(<span class="number">20</span>, <span class="number">80</span>, <span class="number">595</span>, <span class="number">410</span>);</span><br><span class="line">        save.setBounds(<span class="number">270</span>, <span class="number">535</span>, <span class="number">80</span>, <span class="number">25</span>);</span><br><span class="line">        label.setFont(<span class="keyword">new</span> <span class="title class_">Font</span>(<span class="string">&quot;Verdana&quot;</span>, Font.PLAIN, <span class="number">22</span>));</span><br><span class="line">        label.setBounds(<span class="number">100</span>, <span class="number">240</span>, <span class="number">500</span>, <span class="number">100</span>);</span><br><span class="line">        right.add(label);</span><br><span class="line">        right.add(titleLabel);</span><br><span class="line">        right.add(title);</span><br><span class="line">        right.add(textLabel);</span><br><span class="line">        right.add(textBox);</span><br><span class="line">        right.add(save);</span><br><span class="line">        notes.setLayout(<span class="literal">null</span>);</span><br><span class="line">        notes.getContentPane().add(left);</span><br><span class="line">        notes.getContentPane().add(right);</span><br><span class="line">        notes.setResizable(<span class="literal">false</span>);</span><br><span class="line">        notes.setLocationRelativeTo(<span class="literal">null</span>);</span><br><span class="line">        notes.setVisible(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>mediator&#x2F;Note.java:</strong> 笔记类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.mediator.example.mediator;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Note class.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Note</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String text;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Note</span><span class="params">()</span> &#123;</span><br><span class="line">        name = <span class="string">&quot;New note&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setText</span><span class="params">(String text)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.text = text;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getText</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> text;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Demo.java:</strong> 初始化代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> refactoring_guru.mediator.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> refactoring_guru.mediator.example.components.*;</span><br><span class="line"><span class="keyword">import</span> refactoring_guru.mediator.example.mediator.Editor;</span><br><span class="line"><span class="keyword">import</span> refactoring_guru.mediator.example.mediator.Mediator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Demo class. Everything comes together here.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Mediator</span> <span class="variable">mediator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Editor</span>();</span><br><span class="line"></span><br><span class="line">        mediator.registerComponent(<span class="keyword">new</span> <span class="title class_">Title</span>());</span><br><span class="line">        mediator.registerComponent(<span class="keyword">new</span> <span class="title class_">TextBox</span>());</span><br><span class="line">        mediator.registerComponent(<span class="keyword">new</span> <span class="title class_">AddButton</span>());</span><br><span class="line">        mediator.registerComponent(<span class="keyword">new</span> <span class="title class_">DeleteButton</span>());</span><br><span class="line">        mediator.registerComponent(<span class="keyword">new</span> <span class="title class_">SaveButton</span>());</span><br><span class="line">        mediator.registerComponent(<span class="keyword">new</span> <span class="title class_">List</span>(<span class="keyword">new</span> <span class="title class_">DefaultListModel</span>()));</span><br><span class="line">        mediator.registerComponent(<span class="keyword">new</span> <span class="title class_">Filter</span>());</span><br><span class="line"></span><br><span class="line">        mediator.createGUI();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>OutputDemo.png:</strong> 执行结果</p>
<p><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/blog/pattern/OutputDemo-mediator1.png"></p></div><div class="tab-item-content"><p><strong>在 PHP 中使用模式</strong></p>
<p><strong>复杂度：</strong> ★★☆</p>
<p><strong>流行度：</strong> ★★☆</p>
<p><strong>使用示例：</strong> 纯粹的中介者模式实现在 PHP 中并不常见， 在其他语言 （例如 Java 或 C#） 中则专门在 GUI 上使用。 PHP 应用可能会包含数十个组件， 但是它们极少会在单次对话中直接通信。</p>
<p>但是， 许多 PHP 框架中的事件分发系统或 MVC 控制器的一些实现仍会使用中介者模式。</p>
<div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">概念示例</button><button type="button" class="tab">真实世界示例</button></div><div class="tab-contents"><div class="tab-item-content active"><p><strong>概念示例</strong></p>
<p>本例说明了<strong>中介者</strong>设计模式的结构并重点回答了下面的问题：</p>
<ul>
<li>它由哪些类组成？</li>
<li>这些类扮演了哪些角色？</li>
<li>模式中的各个元素会以何种方式相互关联？</li>
</ul>
<p>了解该模式的结构后， 你可以更容易地理解下面基于真实世界的 PHP 应用案例。</p>
<p><strong>index.php:</strong> 概念示例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">RefactoringGuru</span>\<span class="title class_">Mediator</span>\<span class="title class_">Conceptual</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Mediator interface declares a method used by components to notify the</span></span><br><span class="line"><span class="comment"> * mediator about various events. The Mediator may react to these events and</span></span><br><span class="line"><span class="comment"> * pass the execution to other components.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Mediator</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">notify</span>(<span class="params"><span class="keyword">object</span> <span class="variable">$sender</span>, <span class="keyword">string</span> <span class="variable">$event</span></span>): <span class="title">void</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Concrete Mediators implement cooperative behavior by coordinating several</span></span><br><span class="line"><span class="comment"> * components.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteMediator</span> <span class="keyword">implements</span> <span class="title">Mediator</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$component1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$component2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">Component1 <span class="variable">$c1</span>, Component2 <span class="variable">$c2</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;component1 = <span class="variable">$c1</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;component1-&gt;<span class="title function_ invoke__">setMediator</span>(<span class="variable">$this</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;component2 = <span class="variable">$c2</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;component2-&gt;<span class="title function_ invoke__">setMediator</span>(<span class="variable">$this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">notify</span>(<span class="params"><span class="keyword">object</span> <span class="variable">$sender</span>, <span class="keyword">string</span> <span class="variable">$event</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$event</span> == <span class="string">&quot;A&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Mediator reacts on A and triggers following operations:\n&quot;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;component2-&gt;<span class="title function_ invoke__">doC</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$event</span> == <span class="string">&quot;D&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Mediator reacts on D and triggers following operations:\n&quot;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;component1-&gt;<span class="title function_ invoke__">doB</span>();</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;component2-&gt;<span class="title function_ invoke__">doC</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Base Component provides the basic functionality of storing a mediator&#x27;s</span></span><br><span class="line"><span class="comment"> * instance inside component objects.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseComponent</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$mediator</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">Mediator <span class="variable">$mediator</span> = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;mediator = <span class="variable">$mediator</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setMediator</span>(<span class="params">Mediator <span class="variable">$mediator</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;mediator = <span class="variable">$mediator</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Concrete Components implement various functionality. They don&#x27;t depend on</span></span><br><span class="line"><span class="comment"> * other components. They also don&#x27;t depend on any concrete mediator classes.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Component1</span> <span class="keyword">extends</span> <span class="title">BaseComponent</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">doA</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Component 1 does A.\n&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;mediator-&gt;<span class="title function_ invoke__">notify</span>(<span class="variable">$this</span>, <span class="string">&quot;A&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">doB</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Component 1 does B.\n&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;mediator-&gt;<span class="title function_ invoke__">notify</span>(<span class="variable">$this</span>, <span class="string">&quot;B&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Component2</span> <span class="keyword">extends</span> <span class="title">BaseComponent</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">doC</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Component 2 does C.\n&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;mediator-&gt;<span class="title function_ invoke__">notify</span>(<span class="variable">$this</span>, <span class="string">&quot;C&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">doD</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Component 2 does D.\n&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;mediator-&gt;<span class="title function_ invoke__">notify</span>(<span class="variable">$this</span>, <span class="string">&quot;D&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The client code.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="variable">$c1</span> = <span class="keyword">new</span> <span class="title class_">Component1</span>();</span><br><span class="line"><span class="variable">$c2</span> = <span class="keyword">new</span> <span class="title class_">Component2</span>();</span><br><span class="line"><span class="variable">$mediator</span> = <span class="keyword">new</span> <span class="title class_">ConcreteMediator</span>(<span class="variable">$c1</span>, <span class="variable">$c2</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Client triggers operation A.\n&quot;</span>;</span><br><span class="line"><span class="variable">$c1</span>-&gt;<span class="title function_ invoke__">doA</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Client triggers operation D.\n&quot;</span>;</span><br><span class="line"><span class="variable">$c2</span>-&gt;<span class="title function_ invoke__">doD</span>();</span><br></pre></td></tr></table></figure>

<p><strong>Output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Client triggers operation A.</span><br><span class="line">Component 1 does A.</span><br><span class="line">Mediator reacts on A and triggers following operations:</span><br><span class="line">Component 2 does C.</span><br><span class="line"></span><br><span class="line">Client triggers operation D.</span><br><span class="line">Component 2 does D.</span><br><span class="line">Mediator reacts on D and triggers following operations:</span><br><span class="line">Component 1 does B.</span><br><span class="line">Component 2 does C.</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><strong>真实世界示例</strong></p>
<p>在本例中， <strong>中介者</strong>模式通过提供中心化的事件分发器来对观察者模式进行拓展。 它允许任何对象无需依赖另一个对象所属的类就能跟踪和触发其事件。</p>
<p><strong>index.php:</strong> 真实世界示例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">RefactoringGuru</span>\<span class="title class_">Mediator</span>\<span class="title class_">RealWorld</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Event Dispatcher class acts as a Mediator and contains the subscription</span></span><br><span class="line"><span class="comment"> * and notification logic. While a classic Mediator often depends on concrete</span></span><br><span class="line"><span class="comment"> * component classes, this one is only tied to their abstract interfaces.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * We are able to achieve this level of indirection thanks to the way the</span></span><br><span class="line"><span class="comment"> * connections between components are established. The components themselves may</span></span><br><span class="line"><span class="comment"> * subscribe to specific events that they are interested in via the Mediator&#x27;s</span></span><br><span class="line"><span class="comment"> * subscription interface.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Note, we can&#x27;t use the PHP&#x27;s built-in Subject/Observer interfaces here</span></span><br><span class="line"><span class="comment"> * because we&#x27;ll be stretching them too far from what they were designed for.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EventDispatcher</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$observers</span> = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// The special event group for observers that want to listen to all</span></span><br><span class="line">        <span class="comment">// events.</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;observers[<span class="string">&quot;*&quot;</span>] = [];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">initEventGroup</span>(<span class="params"><span class="keyword">string</span> &amp;<span class="variable">$event</span> = <span class="string">&quot;*&quot;</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;observers[<span class="variable">$event</span>])) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;observers[<span class="variable">$event</span>] = [];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">getEventObservers</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$event</span> = <span class="string">&quot;*&quot;</span></span>): <span class="title">array</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">initEventGroup</span>(<span class="variable">$event</span>);</span><br><span class="line">        <span class="variable">$group</span> = <span class="variable language_">$this</span>-&gt;observers[<span class="variable">$event</span>];</span><br><span class="line">        <span class="variable">$all</span> = <span class="variable language_">$this</span>-&gt;observers[<span class="string">&quot;*&quot;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">array_merge</span>(<span class="variable">$group</span>, <span class="variable">$all</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">attach</span>(<span class="params">Observer <span class="variable">$observer</span>, <span class="keyword">string</span> <span class="variable">$event</span> = <span class="string">&quot;*&quot;</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">initEventGroup</span>(<span class="variable">$event</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;observers[<span class="variable">$event</span>][] = <span class="variable">$observer</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">detach</span>(<span class="params">Observer <span class="variable">$observer</span>, <span class="keyword">string</span> <span class="variable">$event</span> = <span class="string">&quot;*&quot;</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getEventObservers</span>(<span class="variable">$event</span>) <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$s</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$s</span> === <span class="variable">$observer</span>) &#123;</span><br><span class="line">                <span class="keyword">unset</span>(<span class="variable language_">$this</span>-&gt;observers[<span class="variable">$event</span>][<span class="variable">$key</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">trigger</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$event</span>, <span class="keyword">object</span> <span class="variable">$emitter</span>, <span class="variable">$data</span> = <span class="literal">null</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;EventDispatcher: Broadcasting the &#x27;<span class="subst">$event</span>&#x27; event.\n&quot;</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getEventObservers</span>(<span class="variable">$event</span>) <span class="keyword">as</span> <span class="variable">$observer</span>) &#123;</span><br><span class="line">            <span class="variable">$observer</span>-&gt;<span class="title function_ invoke__">update</span>(<span class="variable">$event</span>, <span class="variable">$emitter</span>, <span class="variable">$data</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * A simple helper function to provide global access to the event dispatcher.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">events</span>(<span class="params"></span>): <span class="title">EventDispatcher</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">static</span> <span class="variable">$eventDispatcher</span>;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$eventDispatcher</span>) &#123;</span><br><span class="line">        <span class="variable">$eventDispatcher</span> = <span class="keyword">new</span> <span class="title class_">EventDispatcher</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$eventDispatcher</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Observer interface defines how components receive the event</span></span><br><span class="line"><span class="comment"> * notifications.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Observer</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$event</span>, <span class="keyword">object</span> <span class="variable">$emitter</span>, <span class="variable">$data</span> = <span class="literal">null</span></span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Unlike our Observer pattern example, this example makes the UserRepository</span></span><br><span class="line"><span class="comment"> * act as a regular component that doesn&#x27;t have any special event-related</span></span><br><span class="line"><span class="comment"> * methods. Like any other component, this class relies on the EventDispatcher</span></span><br><span class="line"><span class="comment"> * to broadcast its events and listen for the other ones.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> \RefactoringGuru\Observer\RealWorld\UserRepository</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserRepository</span> <span class="keyword">implements</span> <span class="title">Observer</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> array List of application&#x27;s users.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$users</span> = [];</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Components can subscribe to events by themselves or by client code.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">events</span>()-&gt;<span class="title function_ invoke__">attach</span>(<span class="variable">$this</span>, <span class="string">&quot;users:deleted&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Components can decide whether they&#x27;d like to process an event using its</span></span><br><span class="line"><span class="comment">     * name, emitter or any contextual data passed along with the event.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$event</span>, <span class="keyword">object</span> <span class="variable">$emitter</span>, <span class="variable">$data</span> = <span class="literal">null</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (<span class="variable">$event</span>) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;users:deleted&quot;</span>:</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$emitter</span> === <span class="variable language_">$this</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">deleteUser</span>(<span class="variable">$data</span>, <span class="literal">true</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// These methods represent the business logic of the class.</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">initialize</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$filename</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;UserRepository: Loading user records from a file.\n&quot;</span>;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="title function_ invoke__">events</span>()-&gt;<span class="title function_ invoke__">trigger</span>(<span class="string">&quot;users:init&quot;</span>, <span class="variable">$this</span>, <span class="variable">$filename</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">createUser</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$data</span>, <span class="keyword">bool</span> <span class="variable">$silent</span> = <span class="literal">false</span></span>): <span class="title">User</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;UserRepository: Creating a user.\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$user</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        <span class="variable">$user</span>-&gt;<span class="title function_ invoke__">update</span>(<span class="variable">$data</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$id</span> = <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">openssl_random_pseudo_bytes</span>(<span class="number">16</span>));</span><br><span class="line">        <span class="variable">$user</span>-&gt;<span class="title function_ invoke__">update</span>([<span class="string">&quot;id&quot;</span> =&gt; <span class="variable">$id</span>]);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;users[<span class="variable">$id</span>] = <span class="variable">$user</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable">$silent</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">events</span>()-&gt;<span class="title function_ invoke__">trigger</span>(<span class="string">&quot;users:created&quot;</span>, <span class="variable">$this</span>, <span class="variable">$user</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$user</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">updateUser</span>(<span class="params">User <span class="variable">$user</span>, <span class="keyword">array</span> <span class="variable">$data</span>, <span class="keyword">bool</span> <span class="variable">$silent</span> = <span class="literal">false</span></span>): ?<span class="title">User</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;UserRepository: Updating a user.\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$id</span> = <span class="variable">$user</span>-&gt;attributes[<span class="string">&quot;id&quot;</span>];</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;users[<span class="variable">$id</span>])) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$user</span> = <span class="variable language_">$this</span>-&gt;users[<span class="variable">$id</span>];</span><br><span class="line">        <span class="variable">$user</span>-&gt;<span class="title function_ invoke__">update</span>(<span class="variable">$data</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable">$silent</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">events</span>()-&gt;<span class="title function_ invoke__">trigger</span>(<span class="string">&quot;users:updated&quot;</span>, <span class="variable">$this</span>, <span class="variable">$user</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$user</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">deleteUser</span>(<span class="params">User <span class="variable">$user</span>, <span class="keyword">bool</span> <span class="variable">$silent</span> = <span class="literal">false</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;UserRepository: Deleting a user.\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$id</span> = <span class="variable">$user</span>-&gt;attributes[<span class="string">&quot;id&quot;</span>];</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;users[<span class="variable">$id</span>])) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">unset</span>(<span class="variable language_">$this</span>-&gt;users[<span class="variable">$id</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable">$silent</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">events</span>()-&gt;<span class="title function_ invoke__">trigger</span>(<span class="string">&quot;users:deleted&quot;</span>, <span class="variable">$this</span>, <span class="variable">$user</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Let&#x27;s keep the User class trivial since it&#x27;s not the focus of our example.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$attributes</span> = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params"><span class="variable">$data</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;attributes = <span class="title function_ invoke__">array_merge</span>(<span class="variable">$this</span>-&gt;attributes, <span class="variable">$data</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * All objects can trigger events.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">delete</span>(<span class="params"></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;User: I can now delete myself without worrying about the repository.\n&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">events</span>()-&gt;<span class="title function_ invoke__">trigger</span>(<span class="string">&quot;users:deleted&quot;</span>, <span class="variable">$this</span>, <span class="variable">$this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * This Concrete Component logs any events it&#x27;s subscribed to.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Logger</span> <span class="keyword">implements</span> <span class="title">Observer</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$filename</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$filename</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;filename = <span class="variable">$filename</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$this</span>-&gt;filename)) &#123;</span><br><span class="line">            <span class="title function_ invoke__">unlink</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$event</span>, <span class="keyword">object</span> <span class="variable">$emitter</span>, <span class="variable">$data</span> = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$entry</span> = <span class="title function_ invoke__">date</span>(<span class="string">&quot;Y-m-d H:i:s&quot;</span>) . <span class="string">&quot;: &#x27;<span class="subst">$event</span>&#x27; with data &#x27;&quot;</span> . <span class="title function_ invoke__">json_encode</span>(<span class="variable">$data</span>) . <span class="string">&quot;&#x27;\n&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$this</span>-&gt;filename, <span class="variable">$entry</span>, FILE_APPEND);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Logger: I&#x27;ve written &#x27;<span class="subst">$event</span>&#x27; entry to the log.\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * This Concrete Component sends initial instructions to new users. The client</span></span><br><span class="line"><span class="comment"> * is responsible for attaching this component to a proper user creation event.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OnboardingNotification</span> <span class="keyword">implements</span> <span class="title">Observer</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$adminEmail</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$adminEmail</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;adminEmail = <span class="variable">$adminEmail</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$event</span>, <span class="keyword">object</span> <span class="variable">$emitter</span>, <span class="variable">$data</span> = <span class="literal">null</span></span>): <span class="title">void</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// mail($this-&gt;adminEmail,</span></span><br><span class="line">        <span class="comment">//     &quot;Onboarding required&quot;,</span></span><br><span class="line">        <span class="comment">//     &quot;We have a new user. Here&#x27;s his info: &quot; .json_encode($data));</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;OnboardingNotification: The notification has been emailed!\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The client code.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$repository</span> = <span class="keyword">new</span> <span class="title class_">UserRepository</span>();</span><br><span class="line"><span class="title function_ invoke__">events</span>()-&gt;<span class="title function_ invoke__">attach</span>(<span class="variable">$repository</span>, <span class="string">&quot;facebook:update&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$logger</span> = <span class="keyword">new</span> <span class="title class_">Logger</span>(<span class="keyword">__DIR__</span> . <span class="string">&quot;/log.txt&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">events</span>()-&gt;<span class="title function_ invoke__">attach</span>(<span class="variable">$logger</span>, <span class="string">&quot;*&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$onboarding</span> = <span class="keyword">new</span> <span class="title class_">OnboardingNotification</span>(<span class="string">&quot;1@example.com&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">events</span>()-&gt;<span class="title function_ invoke__">attach</span>(<span class="variable">$onboarding</span>, <span class="string">&quot;users:created&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$repository</span>-&gt;<span class="title function_ invoke__">initialize</span>(<span class="keyword">__DIR__</span> . <span class="string">&quot;users.csv&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$user</span> = <span class="variable">$repository</span>-&gt;<span class="title function_ invoke__">createUser</span>([</span><br><span class="line">    <span class="string">&quot;name&quot;</span> =&gt; <span class="string">&quot;John Smith&quot;</span>,</span><br><span class="line">    <span class="string">&quot;email&quot;</span> =&gt; <span class="string">&quot;john99@example.com&quot;</span>,</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$user</span>-&gt;<span class="title function_ invoke__">delete</span>();</span><br></pre></td></tr></table></figure>

<p><strong>Output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">UserRepository: Loading user records from a file.</span><br><span class="line">EventDispatcher: Broadcasting the &#x27;users:init&#x27; event.</span><br><span class="line">Logger: I&#x27;ve written &#x27;users:init&#x27; entry to the log.</span><br><span class="line">UserRepository: Creating a user.</span><br><span class="line">EventDispatcher: Broadcasting the &#x27;users:created&#x27; event.</span><br><span class="line">OnboardingNotification: The notification has been emailed!</span><br><span class="line">Logger: I&#x27;ve written &#x27;users:created&#x27; entry to the log.</span><br><span class="line">User: I can now delete myself without worrying about the repository.</span><br><span class="line">EventDispatcher: Broadcasting the &#x27;users:deleted&#x27; event.</span><br><span class="line">UserRepository: Deleting a user.</span><br><span class="line">Logger: I&#x27;ve written &#x27;users:deleted&#x27; entry to the log.</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><div class="tab-item-content"><p><strong>在 Python 中使用模式</strong></p>
<p><strong>复杂度：</strong> ★★☆</p>
<p><strong>流行度：</strong> ★★☆</p>
<p><strong>使用示例：</strong> 中介者模式在 Python 代码中最常用于帮助程序 GUI 组件之间的通信。 在 MVC 模式中， 控制器是中介者的同义词。</p>
<p><strong>概念示例</strong></p>
<p>本例说明了<strong>中介者</strong>设计模式的结构并重点回答了下面的问题：</p>
<ul>
<li>它由哪些类组成？</li>
<li>这些类扮演了哪些角色？</li>
<li>模式中的各个元素会以何种方式相互关联？</li>
</ul>
<p><strong>main.py:</strong> 概念示例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> annotations</span><br><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mediator</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Mediator interface declares a method used by components to notify the</span></span><br><span class="line"><span class="string">    mediator about various events. The Mediator may react to these events and</span></span><br><span class="line"><span class="string">    pass the execution to other components.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">notify</span>(<span class="params">self, sender: <span class="built_in">object</span>, event: <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteMediator</span>(<span class="title class_ inherited__">Mediator</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, component1: Component1, component2: Component2</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self._component1 = component1</span><br><span class="line">        self._component1.mediator = self</span><br><span class="line">        self._component2 = component2</span><br><span class="line">        self._component2.mediator = self</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">notify</span>(<span class="params">self, sender: <span class="built_in">object</span>, event: <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">if</span> event == <span class="string">&quot;A&quot;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Mediator reacts on A and triggers following operations:&quot;</span>)</span><br><span class="line">            self._component2.do_c()</span><br><span class="line">        <span class="keyword">elif</span> event == <span class="string">&quot;D&quot;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Mediator reacts on D and triggers following operations:&quot;</span>)</span><br><span class="line">            self._component1.do_b()</span><br><span class="line">            self._component2.do_c()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BaseComponent</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    The Base Component provides the basic functionality of storing a mediator&#x27;s</span></span><br><span class="line"><span class="string">    instance inside component objects.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, mediator: Mediator = <span class="literal">None</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self._mediator = mediator</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mediator</span>(<span class="params">self</span>) -&gt; Mediator:</span><br><span class="line">        <span class="keyword">return</span> self._mediator</span><br><span class="line"></span><br><span class="line"><span class="meta">    @mediator.setter</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mediator</span>(<span class="params">self, mediator: Mediator</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self._mediator = mediator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Concrete Components implement various functionality. They don&#x27;t depend on other</span></span><br><span class="line"><span class="string">components. They also don&#x27;t depend on any concrete mediator classes.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Component1</span>(<span class="title class_ inherited__">BaseComponent</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">do_a</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Component 1 does A.&quot;</span>)</span><br><span class="line">        self.mediator.notify(self, <span class="string">&quot;A&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">do_b</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Component 1 does B.&quot;</span>)</span><br><span class="line">        self.mediator.notify(self, <span class="string">&quot;B&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Component2</span>(<span class="title class_ inherited__">BaseComponent</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">do_c</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Component 2 does C.&quot;</span>)</span><br><span class="line">        self.mediator.notify(self, <span class="string">&quot;C&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">do_d</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Component 2 does D.&quot;</span>)</span><br><span class="line">        self.mediator.notify(self, <span class="string">&quot;D&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># The client code.</span></span><br><span class="line">    c1 = Component1()</span><br><span class="line">    c2 = Component2()</span><br><span class="line">    mediator = ConcreteMediator(c1, c2)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Client triggers operation A.&quot;</span>)</span><br><span class="line">    c1.do_a()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Client triggers operation D.&quot;</span>)</span><br><span class="line">    c2.do_d()</span><br></pre></td></tr></table></figure>

<p><strong>Output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Client triggers operation A.</span><br><span class="line">Component 1 does A.</span><br><span class="line">Mediator reacts on A and triggers following operations:</span><br><span class="line">Component 2 does C.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Client triggers operation D.</span><br><span class="line">Component 2 does D.</span><br><span class="line">Mediator reacts on D and triggers following operations:</span><br><span class="line">Component 1 does B.</span><br><span class="line">Component 2 does C.</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><strong>在 Ruby 中使用模式</strong></p>
<p><strong>复杂度：</strong> ★★☆</p>
<p><strong>流行度：</strong> ★★☆</p>
<p><strong>使用示例：</strong> 中介者模式在 Ruby 代码中最常用于帮助程序 GUI 组件之间的通信。 在 MVC 模式中， 控制器是中介者的同义词。</p>
<p><strong>概念示例</strong></p>
<p>本例说明了<strong>中介者</strong>设计模式的结构并重点回答了下面的问题：</p>
<ul>
<li>它由哪些类组成？</li>
<li>这些类扮演了哪些角色？</li>
<li>模式中的各个元素会以何种方式相互关联？</li>
</ul>
<p><strong>main.rb:</strong> 概念示例</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The Mediator interface declares a method used by components to notify the</span></span><br><span class="line"><span class="comment"># mediator about various events. The Mediator may react to these events and pass</span></span><br><span class="line"><span class="comment"># the execution to other components.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mediator</span></span><br><span class="line">  <span class="comment"># <span class="doctag">@abstract</span></span></span><br><span class="line">  <span class="comment">#</span></span><br><span class="line">  <span class="comment"># <span class="doctag">@param</span> [Object] sender</span></span><br><span class="line">  <span class="comment"># <span class="doctag">@param</span> [String] event</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">notify</span>(<span class="params">_sender, _event</span>)</span><br><span class="line">    raise NotImplementedError, <span class="string">&quot;<span class="subst">#&#123;<span class="variable language_">self</span>.<span class="keyword">class</span>&#125;</span> has not implemented method &#x27;<span class="subst">#&#123;__method__&#125;</span>&#x27;&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteMediator</span> &lt; <span class="title class_ inherited__">Mediator</span></span><br><span class="line">  <span class="comment"># <span class="doctag">@param</span> [Component1] component1</span></span><br><span class="line">  <span class="comment"># <span class="doctag">@param</span> [Component2] component2</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">initialize</span>(<span class="params">component1, component2</span>)</span><br><span class="line">    <span class="variable">@component1</span> = component1</span><br><span class="line">    <span class="variable">@component1</span>.mediator = <span class="variable language_">self</span></span><br><span class="line">    <span class="variable">@component2</span> = component2</span><br><span class="line">    <span class="variable">@component2</span>.mediator = <span class="variable language_">self</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># <span class="doctag">@param</span> [Object] sender</span></span><br><span class="line">  <span class="comment"># <span class="doctag">@param</span> [String] event</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">notify</span>(<span class="params">_sender, event</span>)</span><br><span class="line">    <span class="keyword">if</span> event == <span class="string">&#x27;A&#x27;</span></span><br><span class="line">      puts <span class="string">&#x27;Mediator reacts on A and triggers following operations:&#x27;</span></span><br><span class="line">      <span class="variable">@component2</span>.do_c</span><br><span class="line">    <span class="keyword">elsif</span> event == <span class="string">&#x27;D&#x27;</span></span><br><span class="line">      puts <span class="string">&#x27;Mediator reacts on D and triggers following operations:&#x27;</span></span><br><span class="line">      <span class="variable">@component1</span>.do_b</span><br><span class="line">      <span class="variable">@component2</span>.do_c</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The Base Component provides the basic functionality of storing a mediator&#x27;s</span></span><br><span class="line"><span class="comment"># instance inside component objects.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BaseComponent</span></span><br><span class="line">  <span class="comment"># <span class="doctag">@return</span> [Mediator]</span></span><br><span class="line">  <span class="keyword">attr_accessor</span> <span class="symbol">:mediator</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># <span class="doctag">@param</span> [Mediator] mediator</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">initialize</span>(<span class="params">mediator = <span class="literal">nil</span></span>)</span><br><span class="line">    <span class="variable">@mediator</span> = mediator</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Concrete Components implement various functionality. They don&#x27;t depend on</span></span><br><span class="line"><span class="comment"># other components. They also don&#x27;t depend on any concrete mediator classes.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Component1</span> &lt; <span class="title class_ inherited__">BaseComponent</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">do_a</span></span><br><span class="line">    puts <span class="string">&#x27;Component 1 does A.&#x27;</span></span><br><span class="line">    <span class="variable">@mediator</span>.notify(<span class="variable language_">self</span>, <span class="string">&#x27;A&#x27;</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">do_b</span></span><br><span class="line">    puts <span class="string">&#x27;Component 1 does B.&#x27;</span></span><br><span class="line">    <span class="variable">@mediator</span>.notify(<span class="variable language_">self</span>, <span class="string">&#x27;B&#x27;</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Component2</span> &lt; <span class="title class_ inherited__">BaseComponent</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">do_c</span></span><br><span class="line">    puts <span class="string">&#x27;Component 2 does C.&#x27;</span></span><br><span class="line">    <span class="variable">@mediator</span>.notify(<span class="variable language_">self</span>, <span class="string">&#x27;C&#x27;</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">do_d</span></span><br><span class="line">    puts <span class="string">&#x27;Component 2 does D.&#x27;</span></span><br><span class="line">    <span class="variable">@mediator</span>.notify(<span class="variable language_">self</span>, <span class="string">&#x27;D&#x27;</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The client code.</span></span><br><span class="line">c1 = Component1.new</span><br><span class="line">c2 = Component2.new</span><br><span class="line"><span class="title class_">ConcreteMediator</span>.new(c1, c2)</span><br><span class="line"></span><br><span class="line">puts <span class="string">&#x27;Client triggers operation A.&#x27;</span></span><br><span class="line">c1.do_a</span><br><span class="line"></span><br><span class="line">puts <span class="string">&quot;\n&quot;</span></span><br><span class="line"></span><br><span class="line">puts <span class="string">&#x27;Client triggers operation D.&#x27;</span></span><br><span class="line">c2.do_d</span><br></pre></td></tr></table></figure>

<p><strong>output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Client triggers operation A.</span><br><span class="line">Component 1 does A.</span><br><span class="line">Mediator reacts on A and triggers following operations:</span><br><span class="line">Component 2 does C.</span><br><span class="line"></span><br><span class="line">Client triggers operation D.</span><br><span class="line">Component 2 does D.</span><br><span class="line">Mediator reacts on D and triggers following operations:</span><br><span class="line">Component 1 does B.</span><br><span class="line">Component 2 does C.</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><strong>在 Swift 中使用模式</strong></p>
<p><strong>复杂度：</strong> ★★☆</p>
<p><strong>流行度：</strong> ★★★</p>
<p><strong>使用示例：</strong> 中介者模式在 Swift 代码中最常用于帮助程序 GUI 组件之间的通信。 在 MVC 模式中， 控制器是中介者的同义词。</p>
<div class="tabs"><div class="nav-tabs"><button type="button" class="tab active">概念示例</button><button type="button" class="tab">真实世界示例</button></div><div class="tab-contents"><div class="tab-item-content active"><p><strong>概念示例</strong></p>
<p>本例说明了<strong>中介者</strong>设计模式的结构并重点回答了下面的问题：</p>
<ul>
<li>它由哪些类组成？</li>
<li>这些类扮演了哪些角色？</li>
<li>模式中的各个元素会以何种方式相互关联？</li>
</ul>
<p>了解该模式的结构后， 你可以更容易地理解下面基于真实世界的 Swift 应用案例。</p>
<p><strong>Example.swift:</strong> 概念示例</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> XCTest</span><br><span class="line"></span><br><span class="line"><span class="comment">/// The Mediator interface declares a method used by components to notify the</span></span><br><span class="line"><span class="comment">/// mediator about various events. The Mediator may react to these events and</span></span><br><span class="line"><span class="comment">/// pass the execution to other components.</span></span><br><span class="line"><span class="keyword">protocol</span> <span class="title class_">Mediator</span>: <span class="title class_">AnyObject</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">notify</span>(<span class="params">sender</span>: <span class="type">BaseComponent</span>, <span class="params">event</span>: <span class="type">String</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Concrete Mediators implement cooperative behavior by coordinating several</span></span><br><span class="line"><span class="comment">/// components.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteMediator</span>: <span class="title class_">Mediator</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> component1: <span class="type">Component1</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> component2: <span class="type">Component2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">component1</span>: <span class="type">Component1</span>, <span class="keyword">_</span> <span class="params">component2</span>: <span class="type">Component2</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.component1 <span class="operator">=</span> component1</span><br><span class="line">        <span class="keyword">self</span>.component2 <span class="operator">=</span> component2</span><br><span class="line"></span><br><span class="line">        component1.update(mediator: <span class="keyword">self</span>)</span><br><span class="line">        component2.update(mediator: <span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">notify</span>(<span class="params">sender</span>: <span class="type">BaseComponent</span>, <span class="params">event</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> event <span class="operator">==</span> <span class="string">&quot;A&quot;</span> &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Mediator reacts on A and triggers following operations:&quot;</span>)</span><br><span class="line">            <span class="keyword">self</span>.component2.doC()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (event <span class="operator">==</span> <span class="string">&quot;D&quot;</span>) &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Mediator reacts on D and triggers following operations:&quot;</span>)</span><br><span class="line">            <span class="keyword">self</span>.component1.doB()</span><br><span class="line">            <span class="keyword">self</span>.component2.doC()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// The Base Component provides the basic functionality of storing a mediator&#x27;s</span></span><br><span class="line"><span class="comment">/// instance inside component objects.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BaseComponent</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fileprivate</span> <span class="keyword">weak</span> <span class="keyword">var</span> mediator: <span class="type">Mediator</span>?</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="params">mediator</span>: <span class="type">Mediator</span>? <span class="operator">=</span> <span class="literal">nil</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.mediator <span class="operator">=</span> mediator</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">update</span>(<span class="params">mediator</span>: <span class="type">Mediator</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.mediator <span class="operator">=</span> mediator</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Concrete Components implement various functionality. They don&#x27;t depend on</span></span><br><span class="line"><span class="comment">/// other components. They also don&#x27;t depend on any concrete mediator classes.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Component1</span>: <span class="title class_">BaseComponent</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">doA</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Component 1 does A.&quot;</span>)</span><br><span class="line">        mediator<span class="operator">?</span>.notify(sender: <span class="keyword">self</span>, event: <span class="string">&quot;A&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">doB</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Component 1 does B.<span class="subst">\n</span>&quot;</span>)</span><br><span class="line">        mediator<span class="operator">?</span>.notify(sender: <span class="keyword">self</span>, event: <span class="string">&quot;B&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Component2</span>: <span class="title class_">BaseComponent</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">doC</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Component 2 does C.&quot;</span>)</span><br><span class="line">        mediator<span class="operator">?</span>.notify(sender: <span class="keyword">self</span>, event: <span class="string">&quot;C&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">doD</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Component 2 does D.&quot;</span>)</span><br><span class="line">        mediator<span class="operator">?</span>.notify(sender: <span class="keyword">self</span>, event: <span class="string">&quot;D&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Let&#x27;s see how it all works together.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MediatorConceptual</span>: <span class="title class_">XCTestCase</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">testMediatorConceptual</span>() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> component1 <span class="operator">=</span> <span class="type">Component1</span>()</span><br><span class="line">        <span class="keyword">let</span> component2 <span class="operator">=</span> <span class="type">Component2</span>()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> mediator <span class="operator">=</span> <span class="type">ConcreteMediator</span>(component1, component2)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Client triggers operation A.&quot;</span>)</span><br><span class="line">        component1.doA()</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\n</span>Client triggers operation D.&quot;</span>)</span><br><span class="line">        component2.doD()</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(mediator)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Client triggers operation A.</span><br><span class="line">Component 1 does A.</span><br><span class="line">Mediator reacts on A and triggers following operations:</span><br><span class="line">Component 2 does C.</span><br><span class="line"></span><br><span class="line">Client triggers operation D.</span><br><span class="line">Component 2 does D.</span><br><span class="line">Mediator reacts on D and triggers following operations:</span><br><span class="line">Component 1 does B.</span><br><span class="line"></span><br><span class="line">Component 2 does C.</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><strong>真实世界示例</strong></p>
<p><strong>Example.swift:</strong> 真实世界示例</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> XCTest</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MediatorRealWorld</span>: <span class="title class_">XCTestCase</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">test</span>() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> newsArray <span class="operator">=</span> [<span class="type">News</span>(id: <span class="number">1</span>, title: <span class="string">&quot;News1&quot;</span>, likesCount: <span class="number">1</span>),</span><br><span class="line">                         <span class="type">News</span>(id: <span class="number">2</span>, title: <span class="string">&quot;News2&quot;</span>, likesCount: <span class="number">2</span>)]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> numberOfGivenLikes <span class="operator">=</span> newsArray.reduce(<span class="number">0</span>, &#123; <span class="variable">$0</span> <span class="operator">+</span> <span class="variable">$1</span>.likesCount &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> mediator <span class="operator">=</span> <span class="type">ScreenMediator</span>()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> feedVC <span class="operator">=</span> <span class="type">NewsFeedViewController</span>(mediator, newsArray)</span><br><span class="line">        <span class="keyword">let</span> newsDetailVC <span class="operator">=</span> <span class="type">NewsDetailViewController</span>(mediator, newsArray.first<span class="operator">!</span>)</span><br><span class="line">        <span class="keyword">let</span> profileVC <span class="operator">=</span> <span class="type">ProfileViewController</span>(mediator, numberOfGivenLikes)</span><br><span class="line"></span><br><span class="line">        mediator.update([feedVC, newsDetailVC, profileVC])</span><br><span class="line"></span><br><span class="line">        feedVC.userLikedAllNews()</span><br><span class="line">        feedVC.userDislikedAllNews()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NewsFeedViewController</span>: <span class="title class_">ScreenUpdatable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> newsArray: [<span class="type">News</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">weak</span> <span class="keyword">var</span> mediator: <span class="type">ScreenUpdatable</span>?</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">mediator</span>: <span class="type">ScreenUpdatable</span>?, <span class="keyword">_</span> <span class="params">newsArray</span>: [<span class="type">News</span>]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.newsArray <span class="operator">=</span> newsArray</span><br><span class="line">        <span class="keyword">self</span>.mediator <span class="operator">=</span> mediator</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">likeAdded</span>(<span class="params">to</span> <span class="params">news</span>: <span class="type">News</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;News Feed: Received a liked news model with id <span class="subst">\(news.id)</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> <span class="keyword">var</span> item <span class="keyword">in</span> newsArray &#123;</span><br><span class="line">            <span class="keyword">if</span> item <span class="operator">==</span> news &#123;</span><br><span class="line">                item.likesCount <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">likeRemoved</span>(<span class="params">from</span> <span class="params">news</span>: <span class="type">News</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;News Feed: Received a disliked news model with id <span class="subst">\(news.id)</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> <span class="keyword">var</span> item <span class="keyword">in</span> newsArray &#123;</span><br><span class="line">            <span class="keyword">if</span> item <span class="operator">==</span> news &#123;</span><br><span class="line">                item.likesCount <span class="operator">-=</span> <span class="number">1</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">userLikedAllNews</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\n</span><span class="subst">\n</span>News Feed: User LIKED all news models&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;News Feed: I am telling to mediator about it...<span class="subst">\n</span>&quot;</span>)</span><br><span class="line">        newsArray.forEach(&#123; mediator<span class="operator">?</span>.likeAdded(to: <span class="variable">$0</span>) &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">userDislikedAllNews</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\n</span><span class="subst">\n</span>News Feed: User DISLIKED all news models&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;News Feed: I am telling to mediator about it...<span class="subst">\n</span>&quot;</span>)</span><br><span class="line">        newsArray.forEach(&#123; mediator<span class="operator">?</span>.likeRemoved(from: <span class="variable">$0</span>) &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NewsDetailViewController</span>: <span class="title class_">ScreenUpdatable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> news: <span class="type">News</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">weak</span> <span class="keyword">var</span> mediator: <span class="type">ScreenUpdatable</span>?</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">mediator</span>: <span class="type">ScreenUpdatable</span>?, <span class="keyword">_</span> <span class="params">news</span>: <span class="type">News</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.news <span class="operator">=</span> news</span><br><span class="line">        <span class="keyword">self</span>.mediator <span class="operator">=</span> mediator</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">likeAdded</span>(<span class="params">to</span> <span class="params">news</span>: <span class="type">News</span>) &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;News Detail: Received a liked news model with id <span class="subst">\(news.id)</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.news <span class="operator">==</span> news &#123;</span><br><span class="line">            <span class="keyword">self</span>.news.likesCount <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">likeRemoved</span>(<span class="params">from</span> <span class="params">news</span>: <span class="type">News</span>) &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;News Detail: Received a disliked news model with id <span class="subst">\(news.id)</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.news <span class="operator">==</span> news &#123;</span><br><span class="line">            <span class="keyword">self</span>.news.likesCount <span class="operator">-=</span> <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ProfileViewController</span>: <span class="title class_">ScreenUpdatable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> numberOfGivenLikes: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">weak</span> <span class="keyword">var</span> mediator: <span class="type">ScreenUpdatable</span>?</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="keyword">_</span> <span class="params">mediator</span>: <span class="type">ScreenUpdatable</span>?, <span class="keyword">_</span> <span class="params">numberOfGivenLikes</span>: <span class="type">Int</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.numberOfGivenLikes <span class="operator">=</span> numberOfGivenLikes</span><br><span class="line">        <span class="keyword">self</span>.mediator <span class="operator">=</span> mediator</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">likeAdded</span>(<span class="params">to</span> <span class="params">news</span>: <span class="type">News</span>) &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Profile: Received a liked news model with id <span class="subst">\(news.id)</span>&quot;</span>)</span><br><span class="line">        numberOfGivenLikes <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">likeRemoved</span>(<span class="params">from</span> <span class="params">news</span>: <span class="type">News</span>) &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Profile: Received a disliked news model with id <span class="subst">\(news.id)</span>&quot;</span>)</span><br><span class="line">        numberOfGivenLikes <span class="operator">-=</span> <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protocol</span> <span class="title class_">ScreenUpdatable</span>: <span class="title class_">class</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">likeAdded</span>(<span class="params">to</span> <span class="params">news</span>: <span class="type">News</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">likeRemoved</span>(<span class="params">from</span> <span class="params">news</span>: <span class="type">News</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ScreenMediator</span>: <span class="title class_">ScreenUpdatable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> screens: [<span class="type">ScreenUpdatable</span>]<span class="operator">?</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">update</span>(<span class="keyword">_</span> <span class="params">screens</span>: [<span class="type">ScreenUpdatable</span>]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.screens <span class="operator">=</span> screens</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">likeAdded</span>(<span class="params">to</span> <span class="params">news</span>: <span class="type">News</span>) &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Screen Mediator: Received a liked news model with id <span class="subst">\(news.id)</span>&quot;</span>)</span><br><span class="line">        screens<span class="operator">?</span>.forEach(&#123; <span class="variable">$0</span>.likeAdded(to: news) &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">likeRemoved</span>(<span class="params">from</span> <span class="params">news</span>: <span class="type">News</span>) &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ScreenMediator: Received a disliked news model with id <span class="subst">\(news.id)</span>&quot;</span>)</span><br><span class="line">        screens<span class="operator">?</span>.forEach(&#123; <span class="variable">$0</span>.likeRemoved(from: news) &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">News</span>: <span class="title class_">Equatable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> id: <span class="type">Int</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> title: <span class="type">String</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> likesCount: <span class="type">Int</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Other properties</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">func</span> <span class="title function_">==</span> (<span class="params">left</span>: <span class="type">News</span>, <span class="params">right</span>: <span class="type">News</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> left.id <span class="operator">==</span> right.id</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">News Feed: User LIKED all news models</span><br><span class="line">News Feed: I am telling to mediator about it...</span><br><span class="line"></span><br><span class="line">Screen Mediator: Received a liked news model with id 1</span><br><span class="line">News Feed: Received a liked news model with id 1</span><br><span class="line">News Detail: Received a liked news model with id 1</span><br><span class="line">Profile: Received a liked news model with id 1</span><br><span class="line">Screen Mediator: Received a liked news model with id 2</span><br><span class="line">News Feed: Received a liked news model with id 2</span><br><span class="line">News Detail: Received a liked news model with id 2</span><br><span class="line">Profile: Received a liked news model with id 2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">News Feed: User DISLIKED all news models</span><br><span class="line">News Feed: I am telling to mediator about it...</span><br><span class="line"></span><br><span class="line">ScreenMediator: Received a disliked news model with id 1</span><br><span class="line">News Feed: Received a disliked news model with id 1</span><br><span class="line">News Detail: Received a disliked news model with id 1</span><br><span class="line">Profile: Received a disliked news model with id 1</span><br><span class="line">ScreenMediator: Received a disliked news model with id 2</span><br><span class="line">News Feed: Received a disliked news model with id 2</span><br><span class="line">News Detail: Received a disliked news model with id 2</span><br><span class="line">Profile: Received a disliked news model with id 2</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><div class="tab-item-content"><p><strong>在 TypeScript 中使用模式</strong></p>
<p><strong>复杂度：</strong> ★★☆</p>
<p><strong>流行度：</strong> ★★☆</p>
<p><strong>使用示例：</strong> 中介者模式在 TypeScript 代码中最常用于帮助程序 GUI 组件之间的通信。 在 MVC 模式中， 控制器是中介者的同义词。</p>
<p><strong>概念示例</strong></p>
<p>本例说明了<strong>中介者</strong>设计模式的结构并重点回答了下面的问题：</p>
<ul>
<li>它由哪些类组成？</li>
<li>这些类扮演了哪些角色？</li>
<li>模式中的各个元素会以何种方式相互关联？</li>
</ul>
<p><strong>index.ts:</strong> 概念示例</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Mediator interface declares a method used by components to notify the</span></span><br><span class="line"><span class="comment"> * mediator about various events. The Mediator may react to these events and</span></span><br><span class="line"><span class="comment"> * pass the execution to other components.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Mediator</span> &#123;</span><br><span class="line">    <span class="title function_">notify</span>(<span class="attr">sender</span>: <span class="built_in">object</span>, <span class="attr">event</span>: <span class="built_in">string</span>): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Concrete Mediators implement cooperative behavior by coordinating several</span></span><br><span class="line"><span class="comment"> * components.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteMediator</span> <span class="keyword">implements</span> <span class="title class_">Mediator</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="attr">component1</span>: <span class="title class_">Component1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="attr">component2</span>: <span class="title class_">Component2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">c1: Component1, c2: Component2</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">component1</span> = c1;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">component1</span>.<span class="title function_">setMediator</span>(<span class="variable language_">this</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">component2</span> = c2;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">component2</span>.<span class="title function_">setMediator</span>(<span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">notify</span>(<span class="attr">sender</span>: <span class="built_in">object</span>, <span class="attr">event</span>: <span class="built_in">string</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (event === <span class="string">&#x27;A&#x27;</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Mediator reacts on A and triggers following operations:&#x27;</span>);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">component2</span>.<span class="title function_">doC</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (event === <span class="string">&#x27;D&#x27;</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Mediator reacts on D and triggers following operations:&#x27;</span>);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">component1</span>.<span class="title function_">doB</span>();</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">component2</span>.<span class="title function_">doC</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The Base Component provides the basic functionality of storing a mediator&#x27;s</span></span><br><span class="line"><span class="comment"> * instance inside component objects.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BaseComponent</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="attr">mediator</span>: <span class="title class_">Mediator</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">mediator: Mediator = <span class="literal">null</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">mediator</span> = mediator;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">setMediator</span>(<span class="attr">mediator</span>: <span class="title class_">Mediator</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">mediator</span> = mediator;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Concrete Components implement various functionality. They don&#x27;t depend on</span></span><br><span class="line"><span class="comment"> * other components. They also don&#x27;t depend on any concrete mediator classes.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Component1</span> <span class="keyword">extends</span> <span class="title class_ inherited__">BaseComponent</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">doA</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Component 1 does A.&#x27;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">mediator</span>.<span class="title function_">notify</span>(<span class="variable language_">this</span>, <span class="string">&#x27;A&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">doB</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Component 1 does B.&#x27;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">mediator</span>.<span class="title function_">notify</span>(<span class="variable language_">this</span>, <span class="string">&#x27;B&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Component2</span> <span class="keyword">extends</span> <span class="title class_ inherited__">BaseComponent</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">doC</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Component 2 does C.&#x27;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">mediator</span>.<span class="title function_">notify</span>(<span class="variable language_">this</span>, <span class="string">&#x27;C&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">doD</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Component 2 does D.&#x27;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">mediator</span>.<span class="title function_">notify</span>(<span class="variable language_">this</span>, <span class="string">&#x27;D&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The client code.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> c1 = <span class="keyword">new</span> <span class="title class_">Component1</span>();</span><br><span class="line"><span class="keyword">const</span> c2 = <span class="keyword">new</span> <span class="title class_">Component2</span>();</span><br><span class="line"><span class="keyword">const</span> mediator = <span class="keyword">new</span> <span class="title class_">ConcreteMediator</span>(c1, c2);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Client triggers operation A.&#x27;</span>);</span><br><span class="line">c1.<span class="title function_">doA</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Client triggers operation D.&#x27;</span>);</span><br><span class="line">c2.<span class="title function_">doD</span>();</span><br></pre></td></tr></table></figure>

<p><strong>Output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Client triggers operation A.</span><br><span class="line">Component 1 does A.</span><br><span class="line">Mediator reacts on A and triggers following operations:</span><br><span class="line">Component 2 does C.</span><br><span class="line"></span><br><span class="line">Client triggers operation D.</span><br><span class="line">Component 2 does D.</span><br><span class="line">Mediator reacts on D and triggers following operations:</span><br><span class="line">Component 1 does B.</span><br><span class="line">Component 2 does C.</span><br></pre></td></tr></table></figure></div><div class="tab-item-content"><p><strong>概念示例</strong></p>
<p>中介者模式的一个绝佳例子就是火车站交通系统。 两列火车互相之间从来不会就站台的空闲状态进行通信。  <code>station­Manager</code>车站经理可充当中介者， 让平台仅可由一列入场火车使用， 而将其他火车放入队列中等待。 离场火车会向车站发送通知， 便于队列中的下一列火车进站。</p>
<p><strong>train.go:</strong> 组件</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> train <span class="keyword">interface</span> &#123;</span><br><span class="line">    arrive()</span><br><span class="line">    depart()</span><br><span class="line">    permitArrival()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>passengerTrain.go:</strong> 具体组件</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> passengerTrain <span class="keyword">struct</span> &#123;</span><br><span class="line">    mediator mediator</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(g *passengerTrain)</span></span> arrive() &#123;</span><br><span class="line">    <span class="keyword">if</span> !g.mediator.canArrive(g) &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;PassengerTrain: Arrival blocked, waiting&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(<span class="string">&quot;PassengerTrain: Arrived&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(g *passengerTrain)</span></span> depart() &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;PassengerTrain: Leaving&quot;</span>)</span><br><span class="line">    g.mediator.notifyAboutDeparture()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(g *passengerTrain)</span></span> permitArrival() &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;PassengerTrain: Arrival permitted, arriving&quot;</span>)</span><br><span class="line">    g.arrive()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>freightTrain.go:</strong> 具体组件</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> freightTrain <span class="keyword">struct</span> &#123;</span><br><span class="line">    mediator mediator</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(g *freightTrain)</span></span> arrive() &#123;</span><br><span class="line">    <span class="keyword">if</span> !g.mediator.canArrive(g) &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;FreightTrain: Arrival blocked, waiting&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(<span class="string">&quot;FreightTrain: Arrived&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(g *freightTrain)</span></span> depart() &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;FreightTrain: Leaving&quot;</span>)</span><br><span class="line">    g.mediator.notifyAboutDeparture()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(g *freightTrain)</span></span> permitArrival() &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;FreightTrain: Arrival permitted&quot;</span>)</span><br><span class="line">    g.arrive()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>mediator.go:</strong> 中介者接口</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> mediator <span class="keyword">interface</span> &#123;</span><br><span class="line">    canArrive(train) <span class="type">bool</span></span><br><span class="line">    notifyAboutDeparture()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>stationManager.go:</strong> 具体中介者</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> stationManager <span class="keyword">struct</span> &#123;</span><br><span class="line">    isPlatformFree <span class="type">bool</span></span><br><span class="line">    trainQueue     []train</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newStationManger</span><span class="params">()</span></span> *stationManager &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;stationManager&#123;</span><br><span class="line">        isPlatformFree: <span class="literal">true</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *stationManager)</span></span> canArrive(t train) <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> s.isPlatformFree &#123;</span><br><span class="line">        s.isPlatformFree = <span class="literal">false</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    s.trainQueue = <span class="built_in">append</span>(s.trainQueue, t)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *stationManager)</span></span> notifyAboutDeparture() &#123;</span><br><span class="line">    <span class="keyword">if</span> !s.isPlatformFree &#123;</span><br><span class="line">        s.isPlatformFree = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(s.trainQueue) &gt; <span class="number">0</span> &#123;</span><br><span class="line">        firstTrainInQueue := s.trainQueue[<span class="number">0</span>]</span><br><span class="line">        s.trainQueue = s.trainQueue[<span class="number">1</span>:]</span><br><span class="line">        firstTrainInQueue.permitArrival()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>main.go:</strong> 客户端代码</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    stationManager := newStationManger()</span><br><span class="line"></span><br><span class="line">    passengerTrain := &amp;passengerTrain&#123;</span><br><span class="line">        mediator: stationManager,</span><br><span class="line">    &#125;</span><br><span class="line">    freightTrain := &amp;freightTrain&#123;</span><br><span class="line">        mediator: stationManager,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    passengerTrain.arrive()</span><br><span class="line">    freightTrain.arrive()</span><br><span class="line">    passengerTrain.depart()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>output.txt:</strong> 执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PassengerTrain: Arrived</span><br><span class="line">FreightTrain: Arrival blocked, waiting</span><br><span class="line">PassengerTrain: Leaving</span><br><span class="line">FreightTrain: Arrival permitted</span><br><span class="line">FreightTrain: Arrived</span><br></pre></td></tr></table></figure>

<p><em>根据： <a target="_blank" rel="noopener" href="https://golangbyexample.com/mediator-design-pattern-golang/">Golang By Example</a></em></p></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://wangyyovo.github.io">Blank</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://wangyyovo.github.io/posts/4bab14b1/">https://wangyyovo.github.io/posts/4bab14b1/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://wangyyovo.github.io" target="_blank">Blank</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/pattern/">pattern</a></div><div class="post-share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/ef8794f0f84662e28855cf10532c1682.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/588a77f8/" title="行为模式-备忘录模式"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/9f2a528ed3ddea6fa869c0c8343a9967.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">行为模式-备忘录模式</div></div><div class="info-2"><div class="info-item-1">  https://refactoringguru.cn/design-patterns/memento  行为模式-备忘录模式亦称： 快照、Snapshot、Memento 意图备忘录模式是一种行为设计模式， 允许在不暴露对象实现细节的情况下保存和恢复对象之前的状态。  问题假如你正在开发一款文字编辑器应用程序。 除了简单的文字编辑功能外， 编辑器中还要有设置文本格式和插入内嵌图片等功能。 后来， 你决定让用户能撤销施加在文本上的任何操作。 这项功能在过去几年里变得十分普遍， 因此用户期待任何程序都有这项功能。 你选择采用直接的方式来实现该功能： 程序在执行任何操作前会记录所有的对象状态， 并将其保存下来。 当用户此后需要撤销某个操作时， 程序将从历史记录中获取最近的快照， 然后使用它来恢复所有对象的状态。  让我们来思考一下这些状态快照。 首先， 到底该如何生成一个快照呢？ 很可能你会需要遍历对象的所有成员变量并将其数值复制保存。 但只有当对象对其内容没有严格访问权限限制的情况下， 你才能使用该方式。 不过很遗憾， 绝大部分对象会使用私有成员变量来存储重要数据， 这样别人就无...</div></div></div></a><a class="pagination-related" href="/posts/bc8c1ba/" title="行为模式-迭代器模式"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/148cd369e625b1aa204865cc8c48911b.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">行为模式-迭代器模式</div></div><div class="info-2"><div class="info-item-1">  https://refactoringguru.cn/design-patterns/iterator  行为模式-迭代器模式亦称： Iterator 意图迭代器模式是一种行为设计模式， 让你能在不暴露集合底层表现形式 （列表、 栈和树等） 的情况下遍历集合中所有的元素。  问题集合是编程中最常使用的数据类型之一。 尽管如此， 集合只是一组对象的容器而已。  大部分集合使用简单列表存储元素。 但有些集合还会使用栈、 树、 图和其他复杂的数据结构。 无论集合的构成方式如何， 它都必须提供某种访问元素的方式， 便于其他代码使用其中的元素。 集合应提供一种能够遍历元素的方式， 且保证它不会周而复始地访问同一个元素。 如果你的集合基于列表， 那么这项工作听上去仿佛很简单。 但如何遍历复杂数据结构 （例如树） 中的元素呢？ 例如， 今天你需要使用深度优先算法来遍历树结构， 明天可能会需要广度优先算法； 下周则可能会需要其他方式 （比如随机存取树中的元素）。  不断向集合中添加遍历算法会模糊其 “高效存储数据” 的主要职责。 此外， 有些算法可能是根据特定应用订制的， 将其加入泛型集合类...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/37f0d8f/" title="创建型模式-单例模式"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/6cc78f9be0372c0d330f2c7d326f7d9e.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-03</div><div class="info-item-2">创建型模式-单例模式</div></div><div class="info-2"><div class="info-item-1">  https://refactoringguru.cn/design-patterns/singleton  创建型模式-单例模式亦称： 单件模式、Singleton 意图单例模式是一种创建型设计模式， 让你能够保证一个类只有一个实例， 并提供一个访问该实例的全局节点。  问题单例模式同时解决了两个问题， 所以违反了_单一职责原则_：  保证一个类只有一个实例。 为什么会有人想要控制一个类所拥有的实例数量？ 最常见的原因是控制某些共享资源 （例如数据库或文件） 的访问权限。 它的运作方式是这样的： 如果你创建了一个对象， 同时过一会儿后你决定再创建一个新对象， 此时你会获得之前已创建的对象， 而不是一个新对象。 注意， 普通构造函数无法实现上述行为， 因为构造函数的设计决定了它必须总是返回一个新对象。   为该实例提供一个全局访问节点。 还记得你 （好吧， 其实是我自己） 用过的那些存储重要对象的全局变量吗？ 它们在使用上十分方便， 但同时也非常不安全， 因为任何代码都有可能覆盖掉那些变量的内容， 从而引发程序崩溃。 和全局变量一样， 单例模式也允许在程序的任何地方访问特定对象...</div></div></div></a><a class="pagination-related" href="/posts/63b28d52/" title="创建型模式-原型模式"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/01b549d5aec9f475e74b2781486eed2d.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-03</div><div class="info-item-2">创建型模式-原型模式</div></div><div class="info-2"><div class="info-item-1">  https://refactoringguru.cn/design-patterns/prototype  创建型模式-原型模式亦称： 克隆、Clone、Prototype 意图原型模式是一种创建型设计模式， 使你能够复制已有对象， 而又无需使代码依赖它们所属的类。  问题如果你有一个对象， 并希望生成与其完全相同的一个复制品， 你该如何实现呢？ 首先， 你必须新建一个属于相同类的对象。 然后， 你必须遍历原始对象的所有成员变量， 并将成员变量值复制到新对象中。 不错！ 但有个小问题。 并非所有对象都能通过这种方式进行复制， 因为有些对象可能拥有私有成员变量， 它们在对象本身以外是不可见的。  直接复制还有另外一个问题。 因为你必须知道对象所属的类才能创建复制品， 所以代码必须依赖该类。 即使你可以接受额外的依赖性， 那还有另外一个问题： 有时你只知道对象所实现的接口， 而不知道其所属的具体类， 比如可向方法的某个参数传入实现了某个接口的任何对象。 解决方案原型模式将克隆过程委派给被克隆的实际对象。 模式为所有支持克隆的对象声明了一个通用接口， 该接口让你能够克隆对象， 同时...</div></div></div></a><a class="pagination-related" href="/posts/a951f0f7/" title="创建型模式-抽象工厂模式"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/40d08d3b2ae8dc4074a9f3a7942a0b5a.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-03</div><div class="info-item-2">创建型模式-抽象工厂模式</div></div><div class="info-2"><div class="info-item-1">  https://refactoringguru.cn/design-patterns/abstract-factory  创建型模式-抽象工厂模式亦称： Abstract Factory 意图抽象工厂模式是一种创建型设计模式， 它能创建一系列相关的对象， 而无需指定其具体类。  问题假设你正在开发一款家具商店模拟器。 你的代码中包括一些类， 用于表示：  一系列相关产品， 例如 椅子Chair 、  沙发Sofa和 咖啡桌Coffee­Table 。 系列产品的不同变体。 例如， 你可以使用 现代Modern 、  维多利亚Victorian 、  装饰风艺术Art­Deco等风格生成 椅子 、  沙发和 咖啡桌 。   你需要设法单独生成每件家具对象， 这样才能确保其风格一致。 如果顾客收到的家具风格不一样， 他们可不会开心。  此外， 你也不希望在添加新产品或新风格时修改已有代码。 家具供应商对于产品目录的更新非常频繁， 你不会想在每次更新时都去修改核心代码的。 解决方案首先， 抽象工厂模式建议为系列中的每件产品明确声明接口 （例如椅子、 沙发或咖啡桌）。 然后， 确保所...</div></div></div></a><a class="pagination-related" href="/posts/63b2a10f/" title="工厂模式比较"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/dd999ecec29f3590f23c26fbb79bb612.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-04</div><div class="info-item-2">工厂模式比较</div></div><div class="info-2"><div class="info-item-1">  https://refactoringguru.cn/design-patterns/factory-comparison  工厂模式比较本文将对下列概念之间的差异进行说明：  工厂 构建方法 静态构建 （或工厂） 方法 简单工厂 工厂方法 抽象工厂  你可以在网上找到这些术语的参考信息。 尽管它们看上去相似， 但其含义都不一样。 许多人没有意识到这一点， 从而出现了混淆和误解。 因此让我们搞清楚其中的不同之处， 一劳永逸地解决这个问题。 1. 工厂工厂是一个含义模糊的术语， 表示可以创建一些东西的函数、 方法或类。 最常见的情况下， 工厂创建的是对象。 但是它们也可以创建文件和数据库记录等其他东西。 例如， 下面这些东西都可以非正式地被称为 “工厂”：  创建程序 GUI 的函数或方法； 创建用户的类； 以特定方式调用类构造函数的静态方法。 一种创建型设计模式。  当某人说到 “工厂” 这个词时， 其具体含义通常可以根据上下文来确定。 但如果你有疑问， 可以直接提问。 毕竟作者本人有时候也没有搞清楚。 2. 构建方法构建方法在 《重构与模式》 中被定义为 “创建对象的方法”...</div></div></div></a><a class="pagination-related" href="/posts/e59e3a52/" title="创建型模式-生成器模式"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/43a23affdea04c9c39e82f19a8ff21d8.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-03</div><div class="info-item-2">创建型模式-生成器模式</div></div><div class="info-2"><div class="info-item-1">  https://refactoringguru.cn/design-patterns/builder  创建型模式-生成器模式亦称： 建造者模式、Builder 意图生成器模式是一种创建型设计模式， 使你能够分步骤创建复杂对象。 该模式允许你使用相同的创建代码生成不同类型和形式的对象。  问题假设有这样一个复杂对象， 在对其进行构造时需要对诸多成员变量和嵌套对象进行繁复的初始化工作。 这些初始化代码通常深藏于一个包含众多参数且让人基本看不懂的构造函数中； 甚至还有更糟糕的情况， 那就是这些代码散落在客户端代码的多个位置。  例如， 我们来思考如何创建一个 房屋House对象。 建造一栋简单的房屋， 首先你需要建造四面墙和地板， 安装房门和一套窗户， 然后再建造一个屋顶。 但是如果你想要一栋更宽敞更明亮的房屋， 还要有院子和其他设施 （例如暖气、 排水和供电设备）， 那又该怎么办呢？ 最简单的方法是扩展 房屋基类， 然后创建一系列涵盖所有参数组合的子类。 但最终你将面对相当数量的子类。 任何新增的参数 （例如门廊类型） 都会让这个层次结构更加复杂。 另一种方法则无需生成子类。 ...</div></div></div></a><a class="pagination-related" href="/posts/7a751a0c/" title="创建型模式-工厂方法模式"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/2cc53835314eae7d55be8b341557ddb0.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-03</div><div class="info-item-2">创建型模式-工厂方法模式</div></div><div class="info-2"><div class="info-item-1">  https://refactoringguru.cn/design-patterns/factory-method  创建型模式-工厂方法模式**亦称：**虚拟构造函数、Virtual Constructor、Factory Method 意图工厂方法模式是一种创建型设计模式， 其在父类中提供一个创建对象的方法， 允许子类决定实例化对象的类型。  问题假设你正在开发一款物流管理应用。 最初版本只能处理卡车运输， 因此大部分代码都在位于名为 卡车的类中。 一段时间后， 这款应用变得极受欢迎。 你每天都能收到十几次来自海运公司的请求， 希望应用能够支持海上物流功能。  这可是个好消息。 但是代码问题该如何处理呢？ 目前， 大部分代码都与 卡车类相关。 在程序中添加 轮船类需要修改全部代码。 更糟糕的是， 如果你以后需要在程序中支持另外一种运输方式， 很可能需要再次对这些代码进行大幅修改。 最后， 你将不得不编写繁复的代码， 根据不同的运输对象类， 在应用中进行不同的处理。 解决方案工厂方法模式建议使用特殊的工厂方法代替对于对象构造函数的直接调用 （即使用 new运算符）。 不用担...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/theme/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Blank</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">352</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">46</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">58</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>主题 GitHub</span></a><div class="card-info-social-icons"><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fas fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A1%8C%E4%B8%BA%E6%A8%A1%E5%BC%8F-%E4%B8%AD%E4%BB%8B%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.</span> <span class="toc-text">行为模式-中介者模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%84%8F%E5%9B%BE"><span class="toc-number">1.1.</span> <span class="toc-text">意图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98"><span class="toc-number">1.2.</span> <span class="toc-text">问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">1.3.</span> <span class="toc-text">解决方案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9C%9F%E5%AE%9E%E4%B8%96%E7%95%8C%E7%B1%BB%E6%AF%94"><span class="toc-number">1.4.</span> <span class="toc-text">真实世界类比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E4%BB%8B%E8%80%85%E6%A8%A1%E5%BC%8F%E7%BB%93%E6%9E%84"><span class="toc-number">1.5.</span> <span class="toc-text">中介者模式结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%AA%E4%BB%A3%E7%A0%81"><span class="toc-number">1.6.</span> <span class="toc-text">伪代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E4%BB%8B%E8%80%85%E6%A8%A1%E5%BC%8F%E9%80%82%E5%90%88%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.7.</span> <span class="toc-text">中介者模式适合应用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F"><span class="toc-number">1.8.</span> <span class="toc-text">实现方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E4%BB%8B%E8%80%85%E6%A8%A1%E5%BC%8F%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-number">1.9.</span> <span class="toc-text">中介者模式优缺点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8E%E5%85%B6%E4%BB%96%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">1.10.</span> <span class="toc-text">与其他模式的关系</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.11.</span> <span class="toc-text">代码示例</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/d14168d/" title="虚拟机问题合集"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/hexo/090cfe4e9e60b0ad0de05db822f3ae97.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="虚拟机问题合集"/></a><div class="content"><a class="title" href="/posts/d14168d/" title="虚拟机问题合集">虚拟机问题合集</a><time datetime="2022-07-16T13:30:36.000Z" title="发表于 2022-07-16 21:30:36">2022-07-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/f540045f/" title="用go语言编写移动端sdk和app开发"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/golang/941ed1ec2925719a0c92e76f4f786b6a.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="用go语言编写移动端sdk和app开发"/></a><div class="content"><a class="title" href="/posts/f540045f/" title="用go语言编写移动端sdk和app开发">用go语言编写移动端sdk和app开发</a><time datetime="2022-07-04T12:14:21.000Z" title="发表于 2022-07-04 20:14:21">2022-07-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/5faac006/" title="在线编程IDE"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/hexo/090cfe4e9e60b0ad0de05db822f3ae97.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="在线编程IDE"/></a><div class="content"><a class="title" href="/posts/5faac006/" title="在线编程IDE">在线编程IDE</a><time datetime="2022-06-12T13:30:36.000Z" title="发表于 2022-06-12 21:30:36">2022-06-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/7594185d/" title="即时性能分析工具Pyroscope"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/golang/3bfb3279740bc9a5b5ef436fa887ef07.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="即时性能分析工具Pyroscope"/></a><div class="content"><a class="title" href="/posts/7594185d/" title="即时性能分析工具Pyroscope">即时性能分析工具Pyroscope</a><time datetime="2022-06-12T08:07:36.000Z" title="发表于 2022-06-12 16:07:36">2022-06-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/82a7aa7c/" title="golang性能调试优化方法"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="golang性能调试优化方法"/></a><div class="content"><a class="title" href="/posts/82a7aa7c/" title="golang性能调试优化方法">golang性能调试优化方法</a><time datetime="2022-06-12T03:00:36.000Z" title="发表于 2022-06-12 11:00:36">2022-06-12</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By Blank</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 5.4.2</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.3</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = {"placeholder":"请留下你的脚印","pageSize":10,"lang":"zh-CN","requiredFields":["nick","mail","link"]}

  const initValine = (el, path) => {
    if (isShuoshuo) {
      window.shuoshuoComment.destroyValine = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    const valineConfig = {
      el: '#vcomment',
      appId: 'BSfgwCPLOvPHVPaSoBCGSENf-MdYXbMMI',
      appKey: '2Q8qq5060qxycL6FPL26LnMG',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      visitor: false,
      ...option,
      path: isShuoshuo ? path : (option && option.path) || window.location.pathname
    }

    new Valine(valineConfig)
  }

  const loadValine = async (el, path) => {
    if (typeof Valine === 'function') {
      initValine(el, path)
    } else {
      await btf.getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js')
      initValine(el, path)
    }
  }

  if (isShuoshuo) {
    'Valine' === 'Valine'
      ? window.shuoshuoComment = { loadComment: loadValine }
      : window.loadOtherComment = loadValine
    return
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>