<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>ansible入门 | Blank</title><meta name="author" content="Blank"><meta name="copyright" content="Blank"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="中文教程：https:&#x2F;&#x2F;ansible-tran.readthedocs.io&#x2F;en&#x2F;latest&#x2F;index.html 模块：https:&#x2F;&#x2F;docs.ansible.com&#x2F;ansible&#x2F;latest&#x2F;modules&#x2F;list_of_all_modules.html  前言当下有许多的运维自动化工具( 配置管理 )，例如：Ansible、SaltStack、Puppet、Fabric">
<meta property="og:type" content="article">
<meta property="og:title" content="ansible入门">
<meta property="og:url" content="https://wangyyovo.github.io/posts/7e1b1e5f/">
<meta property="og:site_name" content="Blank">
<meta property="og:description" content="中文教程：https:&#x2F;&#x2F;ansible-tran.readthedocs.io&#x2F;en&#x2F;latest&#x2F;index.html 模块：https:&#x2F;&#x2F;docs.ansible.com&#x2F;ansible&#x2F;latest&#x2F;modules&#x2F;list_of_all_modules.html  前言当下有许多的运维自动化工具( 配置管理 )，例如：Ansible、SaltStack、Puppet、Fabric">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/ansible/5aa6a74dbc004c1186fe8099c325caf0.jpg">
<meta property="article:published_time" content="2019-10-20T02:10:22.000Z">
<meta property="article:modified_time" content="2019-10-20T02:10:22.000Z">
<meta property="article:author" content="Blank">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/ansible/5aa6a74dbc004c1186fe8099c325caf0.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "ansible入门",
  "url": "https://wangyyovo.github.io/posts/7e1b1e5f/",
  "image": "https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/ansible/5aa6a74dbc004c1186fe8099c325caf0.jpg",
  "datePublished": "2019-10-20T02:10:22.000Z",
  "dateModified": "2019-10-20T02:10:22.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Blank",
      "url": "https://wangyyovo.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/theme/favicon.ico"><link rel="canonical" href="https://wangyyovo.github.io/posts/7e1b1e5f/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400,"highlightFullpage":true,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":150,"languages":{"author":"作者: Blank","link":"链接: ","source":"来源: Blank","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ansible入门',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="alternate" href="/atom.xml" title="Blank" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/theme/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">352</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">46</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">58</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-comment-dots"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-image"></i><span> 相册</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-book"></i><span> 教程</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/posts/21cfbf15/"><span> 🚀 快速開始</span></a></li><li><a class="site-page child" href="/posts/dc584b87/"><span> 📑 主題頁面</span></a></li><li><a class="site-page child" href="/posts/4aa8abbe/"><span> 🛠 主題配置</span></a></li><li><a class="site-page child" href="/posts/ceeb73f/"><span> ⚔️ 標簽外挂</span></a></li><li><a class="site-page child" href="/posts/98d20436/"><span> ❓ 主題問答</span></a></li><li><a class="site-page child" href="/posts/4073eda/"><span> ⚡️ 進階教程</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-language"></i><span> 语言</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/"><i class="fa-fw fas fa-c"></i><span> 中文</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/ansible/5aa6a74dbc004c1186fe8099c325caf0.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Blank</span></a><a class="nav-page-title" href="/"><span class="site-name">ansible入门</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-comment-dots"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-image"></i><span> 相册</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-book"></i><span> 教程</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/posts/21cfbf15/"><span> 🚀 快速開始</span></a></li><li><a class="site-page child" href="/posts/dc584b87/"><span> 📑 主題頁面</span></a></li><li><a class="site-page child" href="/posts/4aa8abbe/"><span> 🛠 主題配置</span></a></li><li><a class="site-page child" href="/posts/ceeb73f/"><span> ⚔️ 標簽外挂</span></a></li><li><a class="site-page child" href="/posts/98d20436/"><span> ❓ 主題問答</span></a></li><li><a class="site-page child" href="/posts/4073eda/"><span> ⚡️ 進階教程</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-language"></i><span> 语言</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/"><i class="fa-fw fas fa-c"></i><span> 中文</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">ansible入门</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2019-10-20T02:10:22.000Z" title="发表于 2019-10-20 10:10:22">2019-10-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2019-10-20T02:10:22.000Z" title="更新于 2019-10-20 10:10:22">2019-10-20</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/ansible/">ansible</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">5.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>20分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><script src="\assets\js\APlayer.min.js"> </script><blockquote>
<p>中文教程：<a target="_blank" rel="noopener" href="https://ansible-tran.readthedocs.io/en/latest/index.html">https://ansible-tran.readthedocs.io/en/latest/index.html</a></p>
<p>模块：<a target="_blank" rel="noopener" href="https://docs.ansible.com/ansible/latest/modules/list_of_all_modules.html">https://docs.ansible.com/ansible/latest/modules/list_of_all_modules.html</a></p>
</blockquote>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>当下有许多的运维自动化工具( 配置管理 )，例如：Ansible、SaltStack、Puppet、Fabric 等。</p>
<p>Ansible 一种集成 IT 系统的配置管理、应用部署、执行特定任务的开源平台，是 AnsibleWorks 公司名下的项目，该公司由 Cobbler 及 Func 的作者于 2012 年创建成立。</p>
<p>Ansible 基于 Python 语言实现，由 Paramiko 和 PyYAML 两个关键模块构建。</p>
<p>Ansible 特点：</p>
<ul>
<li>部署简单，只需在主控端部署 Ansible 环境，被控端无需做任何操作。</li>
<li>默认使用 SSH（Secure Shell）协议对设备进行管理。</li>
<li>主从集中化管理。</li>
<li>配置简单、功能强大、扩展性强。</li>
<li>支持 API 及自定义模块，可通过 Python 轻松扩展。</li>
<li>通过 Playbooks 来定制强大的配置、状态管理。</li>
<li>对云计算平台、大数据都有很好的支持。</li>
<li>提供一个功能强大、操作性强的 Web 管理界面和 REST API 接口 —- AWX 平台。</li>
</ul>
<p>Ansible 与 SaltStack：</p>
<ul>
<li>最大的区别是 Ansible 无需在被监控主机部署任何客户端代理，默认通过 SSH 通道进行远程命令执行或下发配置。</li>
<li>相同点是都具备功能强大、灵活的系统管理、状态配置，都使用 YAML 格式来描述配置，两者都提供丰富的模板及 API，对云计算平台、大数据都有很好的支持</li>
</ul>
<h1 id="ansible-命令执行过程"><a href="#ansible-命令执行过程" class="headerlink" title="ansible 命令执行过程"></a>ansible 命令执行过程</h1><ul>
<li>加载自己的配置文件，默认<code>/etc/ansible/ansible.cfg</code>；</li>
<li>查找对应的主机配置文件，找到要执行的主机或者组；</li>
<li>加载自己对应的模块文件，如 command；</li>
<li>通过ansible将模块或命令生成对应的临时py文件(python脚本)， 并将该文件传输至远程服务器；</li>
<li>对应执行用户的家目录的<code>.ansible/tmp/XXX/XXX.PY</code>文件；</li>
<li>给文件 +x 执行权限；</li>
<li>执行并返回结果；</li>
<li>删除临时py文件，<code>sleep 0</code>退出；</li>
</ul>
<h1 id="ansible配置文件查找顺序"><a href="#ansible配置文件查找顺序" class="headerlink" title="ansible配置文件查找顺序"></a>ansible配置文件查找顺序</h1><p>ansible与我们其他的服务在这一点上有很大不同，这里的配置文件查找是从多个地方找的，顺序如下：</p>
<ul>
<li>检查环境变量<code>ANSIBLE_CONFIG</code>指向的路径文件(export ANSIBLE_CONFIG&#x3D;&#x2F;etc&#x2F;ansible.cfg)；</li>
<li><code>~/.ansible.cfg</code>，检查当前目录下的ansible.cfg配置文件；</li>
<li><code>/etc/ansible.cfg</code>检查etc目录的配置文件。</li>
</ul>
<h3 id="ansible配置文件"><a href="#ansible配置文件" class="headerlink" title="ansible配置文件"></a>ansible配置文件</h3><p>ansible 的配置文件为<code>/etc/ansible/ansible.cfg</code>，ansible 有许多参数，下面我们列出一些常见的参数：</p>
<ul>
<li>inventory &#x3D; &#x2F;etc&#x2F;ansible&#x2F;hosts：这个参数表示资源清单inventory文件的位置&#96;&#96;</li>
<li>library &#x3D; &#x2F;usr&#x2F;share&#x2F;ansible：指向存放Ansible模块的目录，支持多个目录方式，只要用冒号（：）隔开就可以</li>
<li>forks &#x3D; 5：并发连接数，默认为5</li>
<li>sudo_user &#x3D; root：设置默认执行命令的用户</li>
<li>remote_port &#x3D; 22：指定连接被管节点的管理端口，默认为22端口，建议修改，能够更加安全</li>
<li>host_key_checking &#x3D; False：设置是否检查SSH主机的密钥，值为True&#x2F;False。关闭后第一次连接不会提示配置实例</li>
<li>timeout &#x3D; 60：设置SSH连接的超时时间，单位为秒</li>
<li>log_path &#x3D; &#x2F;var&#x2F;log&#x2F;ansible.log：指定一个存储ansible日志的文件（默认不记录日志）</li>
</ul>
<h1 id="ansible-命令集"><a href="#ansible-命令集" class="headerlink" title="ansible 命令集"></a>ansible 命令集</h1><ul>
<li><code>/usr/bin/ansible</code>：Ansibe AD-Hoc 临时命令执行工具，常用于临时命令的执行</li>
<li><code>/usr/bin/ansible-doc</code>：Ansible 模块功能查看工具</li>
<li><code>/usr/bin/ansible-galaxy</code>：下载&#x2F;上传优秀代码或Roles模块 的官网平台，基于网络的</li>
<li><code>/usr/bin/ansible-playbook</code>：Ansible 定制自动化的任务集编排工具</li>
<li><code>/usr/bin/ansible-pull</code>：Ansible远程执行命令的工具，拉取配置而非推送配置（使用较少，海量机器时使用，对运维的架构能力要求较高）</li>
<li><code>/usr/bin/ansible-vault</code>：Ansible 文件加密工具</li>
<li><code>/usr/bin/ansible-console</code>：Ansible基于Linux Consoble界面可与用户交互的命令执行工具</li>
</ul>
<h3 id="ansible查看帮助文档"><a href="#ansible查看帮助文档" class="headerlink" title="ansible查看帮助文档"></a>ansible查看帮助文档</h3><p>ansible-doc 命令常用于获取模块信息及其使用帮助，一般用法如下：</p>
<ul>
<li><code>ansible-doc -l</code>：获取全部模块的信息</li>
<li><code>ansible-doc -s MOD_NAME</code>：获取指定模块的使用帮助</li>
</ul>
<h1 id="hosts文件"><a href="#hosts文件" class="headerlink" title="hosts文件"></a>hosts文件</h1><h2 id="远程主机定义"><a href="#远程主机定义" class="headerlink" title="远程主机定义"></a>远程主机定义</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"> # </span><span class="language-bash">定义域名</span></span><br><span class="line">www.abc.com</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"> # </span><span class="language-bash">定义 IP</span></span><br><span class="line">192.168.1.100</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">指定端口号</span></span><br><span class="line">192.168.1.150:37268</span><br></pre></td></tr></table></figure>

<h2 id="定义分组"><a href="#定义分组" class="headerlink" title="定义分组"></a>定义分组</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[group1]           # 定义分组</span><br><span class="line">192.168.1.10</span><br><span class="line">192.168.1.20</span><br><span class="line">192.168.1.30</span><br><span class="line"></span><br><span class="line">[group2]           # 定义分组</span><br><span class="line">192.168.1.40</span><br><span class="line">192.168.1.50</span><br></pre></td></tr></table></figure>

<h2 id="主机名支持正则描述"><a href="#主机名支持正则描述" class="headerlink" title="主机名支持正则描述"></a>主机名支持正则描述</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">www01.example.com-www50.example.com</span></span><br><span class="line">[webservers]</span><br><span class="line">www[01:50].example.com</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">db-a.example.com-db-f.example.com</span></span><br><span class="line">[dbservers]</span><br><span class="line">db-[a:f].example.com</span><br></pre></td></tr></table></figure>

<h2 id="定义别名"><a href="#定义别名" class="headerlink" title="定义别名"></a>定义别名</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Monitor是别名</span></span><br><span class="line">Monitor ansible_ssh_port=12378 ansible_ssh_host=192.168.1.200</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ansible_ssh_host 连接目标主机的地址</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ansible_ssh_port 连接目标主机的端口，默认 22 时无需指定</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ansible_ssh_user 连接目标主机默认用户</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ansible_ssh_pass 连接目标主机默认用户密码</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ansible_ssh_connection 目标主机连接类型，可以是 <span class="built_in">local</span> 、ssh 或 paramiko</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ansible_ssh_private_key_file 连接目标主机的 ssh 私钥</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ansible_*_interpreter 指定采用非 Python 的其他脚本语言，如 Ruby 、Perl 或其他类似 ansible_python_interpreter 解释器</span></span><br></pre></td></tr></table></figure>

<h2 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">vars底下为群组共同便变量，包括已定义变量和自定义变量</span></span><br><span class="line">[test1]</span><br><span class="line">name1 ansible_ssh_host=192.168.1.[20:50]</span><br><span class="line">[test1:vars]</span><br><span class="line">ansible_ssh_user=root</span><br><span class="line">ansible_ssh_pass=&quot;1234&quot;</span><br><span class="line">testvar=&quot;test&quot; #自定义</span><br></pre></td></tr></table></figure>

<h2 id="群组整合"><a href="#群组整合" class="headerlink" title="群组整合"></a>群组整合</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">children底下为父群组<span class="built_in">test</span>的子群组，调用方式为ansible <span class="built_in">test</span> -m ping：</span></span><br><span class="line">[dbtest]</span><br><span class="line">name1 ansible_ssh_host=192.168.1.[20:50] ansible_ssh_user=&quot;root&quot; ansible_ssh_pass=&quot;1234&quot; ansible_ssh_port=22</span><br><span class="line"></span><br><span class="line">[webtest]</span><br><span class="line">name2 ansible_ssh_host=192.168.2.[20:50] ansible_ssh_user=&quot;root&quot; ansible_ssh_pass=&quot;1234&quot; ansible_ssh_port=22</span><br><span class="line"></span><br><span class="line">[test:children]</span><br><span class="line">dbtest</span><br><span class="line">webtest</span><br><span class="line"></span><br><span class="line">[test:var]</span><br><span class="line">testvar=&quot;test&quot;</span><br></pre></td></tr></table></figure>

<h2 id="主机调用"><a href="#主机调用" class="headerlink" title="主机调用"></a>主机调用</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">win_ping模块  ping</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">调用两个主机组的写法，以下webservers和dbservers都会被调用：</span></span><br><span class="line">ansible webservers:dbservers -m win_ping</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在webservers组中但不在dbsersers中的调用：</span></span><br><span class="line">ansible webservers:!dbservers -m win_ping</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在webservers组中并且在dbservers组中的才会调用：</span></span><br><span class="line">ansible webservers:&amp;dbservers -m win_ping</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在调用前加~，代表正则表达式：</span></span><br><span class="line">ansible ~(web|db).*.91it.org -m win_ping</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">组合的例子：</span></span><br><span class="line">ansible webserver:dbservers:&amp;nginx:!ntp -m win_ping</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-m 		  指定执行 ping 模块</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-i          指定 hosts 文件位置</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-u username 指定 SSH 连接的用户名</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-k          指定远程用户密码</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-f          指定并发数</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-s          如需要 root 权限执行时使用 ( 连接用户不是 root 时 )</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-K          -s 时，-K 输入 root 密码</span></span><br></pre></td></tr></table></figure>





<h1 id="ansible-命令详解"><a href="#ansible-命令详解" class="headerlink" title="ansible 命令详解"></a>ansible 命令详解</h1><p>命令的具体格式如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible &lt;host-pattern&gt; [-f forks] [-m module_name] [-a args]</span><br></pre></td></tr></table></figure>

<p>也可以通过<code>ansible -h</code>来查看帮助，下面我们列出一些比较常用的选项，并解释其含义：</p>
<ul>
<li><code>-a MODULE_ARGS</code>：模块的参数，如果执行默认COMMAND的模块，即是命令参数，如： “date”，“pwd”等等</li>
<li><code>-k</code>，<code>--ask-pass</code>：ask for SSH password。登录密码，提示输入SSH密码而不是假设基于密钥的验证</li>
<li><code>--ask-su-pass</code>：ask for su password。su切换密码</li>
<li><code>-K</code>，<code>--ask-sudo-pass</code>：ask for sudo password。提示密码使用sudo，sudo表示提权操作</li>
<li><code>--ask-vault-pass</code>：ask for vault password。假设我们设定了加密的密码，则用该选项进行访问</li>
<li><code>-B SECONDS</code>：后台运行超时时间</li>
<li><code>-C</code>：模拟运行环境并进行预运行，可以进行查错测试</li>
<li><code>-c CONNECTION</code>：连接类型使用</li>
<li><code>-f FORKS</code>：并行任务数，默认为5</li>
<li><code>-i INVENTORY</code>：指定主机清单的路径，默认为<code>/etc/ansible/hosts</code></li>
<li><code>--list-hosts</code>：查看有哪些主机组</li>
<li><code>-m MODULE_NAME</code>：执行模块的名字，默认使用 command 模块，所以如果是只执行单一命令可以不用 -m参数</li>
<li><code>-o</code>：压缩输出，尝试将所有结果在一行输出，一般针对收集工具使用</li>
<li><code>-S</code>：用 su 命令</li>
<li><code>-R SU_USER</code>：指定 su 的用户，默认为 root 用户</li>
<li><code>-s</code>：用 sudo 命令</li>
<li><code>-U SUDO_USER</code>：指定 sudo 到哪个用户，默认为 root 用户</li>
<li><code>-T TIMEOUT</code>：指定 ssh 默认超时时间，默认为10s，也可在配置文件中修改</li>
<li><code>-u REMOTE_USER</code>：远程用户，默认为 root 用户</li>
<li><code>-v</code>：查看详细信息，同时支持<code>-vvv</code>，<code>-vvvv</code>可查看更详细信息</li>
</ul>
<h1 id="ansible-常用模块"><a href="#ansible-常用模块" class="headerlink" title="ansible 常用模块"></a>ansible 常用模块</h1><h2 id="1）ping模块"><a href="#1）ping模块" class="headerlink" title="1）ping模块"></a>1）ping模块</h2><p>检查指定节点机器是否还能连通，用法很简单，不涉及参数<br><code>ansible erp -m ping</code></p>
<h2 id="2）command-模块"><a href="#2）command-模块" class="headerlink" title="2）command 模块"></a>2）command 模块</h2><p>这个模块可以直接在远程主机上执行命令，并将结果返回本主机。</p>
<p>命令模块接受命令名称，后面是空格分隔的列表参数。给定的命令将在所有选定的节点上执行。它不会通过shell进行处理，比如$HOME和操作如&quot;&lt;&quot;，&quot;&gt;&quot;，&quot;|&quot;，&quot;;&quot;，&quot;&amp;&quot;  工作（需要使用（shell）模块实现这些功能）。注意，该命令不支持<code>| 管道命令</code>。</p>
<p>下面来看一看该模块下常用的几个命令：</p>
<ul>
<li><code>chdir</code>：在执行命令之前，先切换到该目录</li>
<li><code>executable</code>：切换shell来执行命令，需要使用命令的绝对路径</li>
<li><code>free_form</code>：要执行的Linux指令，一般使用<code>Ansible</code>的-a参数代替。</li>
<li><code>creates</code>：一个文件名，当这个文件存在，则该命令不执行,可以用来做判断</li>
<li><code>removes</code>：一个文件名，这个文件不存在，则该命令不执行</li>
<li><code>stdin</code>：将命令的<code>stdin</code>设置为指定的值</li>
<li><code>warn</code>：如果在<code>ansible.cfg</code>中存在告警，如果设定了false，不会告警该行</li>
</ul>
<p>示例</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ansible web -m command -a &#x27;ss -ntl&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">先切换到/data/ 目录，再执行“<span class="built_in">ls</span>”命令</span></span><br><span class="line">ansible web -m command -a &#x27;chdir=/data/ ls&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">如果/data/aaa.jpg存在，则不执行“<span class="built_in">ls</span>”命令</span></span><br><span class="line">ansible web -m command -a &#x27;creates=/data/aaa.jpg ls&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">如果/data/aaa.jpg存在，则执行“<span class="built_in">cat</span> /data/a”命令</span></span><br><span class="line">ansible web -m command -a &#x27;removes=/data/aaa.jpg cat /data/a&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="3）shell-模块"><a href="#3）shell-模块" class="headerlink" title="3）shell 模块"></a>3）shell 模块</h2><p>shell模块可以在远程主机上调用shell解释器运行命令，支持shell的各种功能，例如管道等。</p>
<ul>
<li>chdir：在运行命令之前，切换到此目录。 </li>
<li>executable：更改用于执行命令的shell（bash，sh）。 应该是可执行文件的绝对路径。</li>
</ul>
<p>示例</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible web -m shell -a &#x27;cat /etc/passwd |grep &quot;keer&quot;&#x27;</span><br></pre></td></tr></table></figure>



<h2 id="4）copy-模块"><a href="#4）copy-模块" class="headerlink" title="4）copy 模块"></a>4）copy 模块</h2><p>这个模块用于将文件复制到远程主机，同时支持给定内容生成文件和修改权限等。类似于 scp 功能<br>其相关选项如下：</p>
<ul>
<li><code>src</code>：被复制到远程主机的本地文件。可以是绝对路径，也可以是相对路径。如果路径是一个目录，则会递归复制，用法类似于&quot;rsync&quot;，空目录不复制</li>
<li><code>content</code>：用来替代src，用于将指定文件的内容复制到远程文件内</li>
<li><code>dest</code>：必选项，将源文件复制到的远程主机的绝对路径</li>
<li><code>backup</code>：当文件内容发生改变后，在覆盖之前把源文件备份，备份文件包含时间信息</li>
<li><code>directory_mode</code>：递归设定目录的权限，默认为系统默认权限</li>
<li><code>follow</code>：支持link文件复制</li>
<li><code>force</code>：当目标主机包含该文件，但内容不同时，设为&quot;yes&quot;，表示强制覆盖；设为&quot;no&quot;，表示目标主机的目标位置不存在该文件才复制。默认为&quot;yes&quot;</li>
<li><code>group</code>：设定远程主机目录的组名</li>
<li><code>mode</code>：设定远程主机文件及目录的权限</li>
<li><code>owner</code>：设定远程主机目录的用户名</li>
<li><code>others</code>：所有的 file 模块中的选项可以在这里使用</li>
</ul>
<p>示例</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">复制文件</span></span><br><span class="line">ansible web -m copy -a &#x27;src=~/hello dest=/data/hello&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">给定内容生成文件，并制定权限</span></span><br><span class="line">ansible web -m copy -a &#x27;content=&quot;I am keer\n&quot; dest=/data/name mode=666&#x27; </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看一下我们生成的文件及其权限</span></span><br><span class="line">ansible web -m shell -a &#x27;ls -l /data/&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">覆盖备份</span></span><br><span class="line">ansible web -m copy -a &#x27;content=&quot;I am keerya\n&quot; backup=yes dest=/data/name mode=666&#x27;</span><br></pre></td></tr></table></figure>



<h2 id="5）file-模块"><a href="#5）file-模块" class="headerlink" title="5）file 模块"></a>5）file 模块</h2><p>该模块主要用于设置文件的属性，比如创建文件、创建链接文件、删除文件等。<br>下面是一些常见的命令：</p>
<ul>
<li><code>force</code>：需要在两种情况下强制创建软链接，一种是源文件不存在，但之后会建立的情况下；另一种是目标软链接已存在，需要先取消之前的软链，然后创建新的软链，有两个选项：yes|no</li>
<li><code>group</code>：定义文件&#x2F;目录的属组。后面可以加上<code>mode</code>：定义文件&#x2F;目录的权限</li>
<li><code>owner</code>：定义文件&#x2F;目录的属主。后面必须跟上<code>path</code>：定义文件&#x2F;目录的路径</li>
<li><code>recurse</code>：递归设置文件的属性，只对目录有效，后面跟上<code>src</code>：被链接的源文件路径，只应用于<code>state=link</code>的情况</li>
<li><code>dest</code>：被链接到的路径，只应用于<code>state=link</code>的情况</li>
<li><code>state</code>：状态，有以下选项：<ul>
<li><code>directory</code>：如果目录不存在，就创建目录</li>
<li><code>file</code>：即使文件不存在，也不会被创建</li>
<li><code>link</code>：创建软链接</li>
<li><code>hard</code>：创建硬链接</li>
<li><code>touch</code>：如果文件不存在，则会创建一个新的文件，如果文件或目录已存在，则更新其最后修改时间</li>
<li><code>absent</code>：删除目录、文件或者取消链接文件</li>
</ul>
</li>
</ul>
<p>示例</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建目录</span></span><br><span class="line">ansible web -m file -a &#x27;path=/data/app state=directory&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建链接文件</span></span><br><span class="line">ansible web -m file -a &#x27;path=/data/bbb.jpg src=aaa.jpg state=link&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除文件</span></span><br><span class="line">ansible web -m file -a &#x27;path=/data/a state=absent&#x27;</span><br></pre></td></tr></table></figure>



<h2 id="6）fetch-模块"><a href="#6）fetch-模块" class="headerlink" title="6）fetch 模块"></a>6）fetch 模块</h2><p>该模块用于从远程某主机获取（复制）文件到本地。<br>有两个选项：</p>
<ul>
<li><code>dest</code>：用来存放文件的目录</li>
<li><code>src</code>：在远程拉取的文件，并且必须是一个file，不能是目录</li>
</ul>
<p>示例</p>
<ul>
<li><code>flat</code>：允许您覆盖将目标文件添加到主机名<code>/path/to/file</code>的默认行为。</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible web -m fetch -a &#x27;src=/data/hello dest=/data&#x27; </span><br></pre></td></tr></table></figure>



<h2 id="7）cron-模块"><a href="#7）cron-模块" class="headerlink" title="7）cron 模块"></a>7）cron 模块</h2><p>该模块适用于管理<code>cron</code>计划任务的。<br>其使用的语法跟我们的<code>crontab</code>文件中的语法一致，同时，可以指定以下选项：</p>
<ul>
<li><code>day</code>：日应该运行的工作( 1-31, , &#x2F;2, )</li>
<li><code>hour</code>：小时 ( 0-23, , &#x2F;2, )</li>
<li><code>minute</code>：分钟( 0-59, , &#x2F;2, )</li>
<li><code>month</code>：月( 1-12, *, &#x2F;2, )</li>
<li><code>weekday</code>：周 ( 0-6 for Sunday-Saturday,, )</li>
<li><code>job</code>：指明运行的命令是什么</li>
<li><code>name</code>：定时任务描述</li>
<li><code>reboot</code>： 任务在重启时运行，不建议使用，建议使用special_time</li>
<li><code>special_time</code>：#特殊的时间范围，参数：reboot（重启时），annually（每年），monthly（每月），weekly（每周），daily（每天），hourly（每小时）</li>
<li><code>state</code>：指定状态，present表示添加定时任务，也是默认设置，absent表示删除定时任务</li>
<li><code>user</code>：以哪个用户的身份执行</li>
</ul>
<p>示例</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加计划任务</span></span><br><span class="line">ansible web -m cron -a &#x27;name=&quot;ntp update every 5 min&quot; minute=*/5 job=&quot;/sbin/ntpdate 172.17.0.1 &amp;&gt; /dev/null&quot;&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看计划任务</span></span><br><span class="line">ansible web -m shell -a &#x27;crontab -l&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除计划任务</span></span><br><span class="line">ansible web -m cron -a &#x27;name=&quot;df everyday&quot; hour=15 job=&quot;df -lh &gt;&gt; /tmp/disk_total &amp;&gt; /dev/null&quot; state=absent&#x27;</span><br></pre></td></tr></table></figure>



<h2 id="8）yum-模块"><a href="#8）yum-模块" class="headerlink" title="8）yum 模块"></a>8）yum 模块</h2><p>该模块主要用于软件的安装。<br>其选项如下：</p>
<ul>
<li><code>name</code>：所安装的包的名称</li>
<li><code>state</code>：<code>present</code>---&gt;安装， <code>latest</code>---&gt;安装最新的, <code>absent</code>---&gt; 卸载软件。</li>
<li><code>update_cache</code>：强制更新yum的缓存</li>
<li><code>conf_file</code>：指定远程yum安装时所依赖的配置文件（安装本地已有的包）。</li>
<li><code>disable_pgp_check</code>：是否禁止GPG checking，只用于<code>present</code>or <code>latest</code>。</li>
<li><code>disablerepo</code>：临时禁止使用yum库。 只用于安装或更新时。</li>
<li><code>enablerepo</code>：临时使用的yum库。只用于安装或更新时。</li>
</ul>
<p>示例</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible web -m yum -a &#x27;name=htop state=present&#x27;</span><br></pre></td></tr></table></figure>



<h2 id="9）service-模块"><a href="#9）service-模块" class="headerlink" title="9）service 模块"></a>9）service 模块</h2><p>该模块用于服务程序的管理。<br>其主要选项如下：</p>
<ul>
<li><code>arguments</code>：命令行提供额外的参数</li>
<li><code>enabled</code>：设置开机启动。</li>
<li><code>name</code>：服务名称</li>
<li><code>runlevel</code>：开机启动的级别，一般不用指定。</li>
<li><code>sleep</code>：在重启服务的过程中，是否等待。如在服务关闭以后等待2秒再启动。(定义在剧本中。)</li>
<li><code>state</code>：有四种状态，分别为：<code>started</code>---&gt;启动服务， <code>stopped</code>---&gt;停止服务， <code>restarted</code>---&gt;重启服务， <code>reloaded</code>---&gt;重载配置</li>
</ul>
<p>示例</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">开启服务并设置自启动</span></span><br><span class="line">ansible web -m service -a &#x27;name=nginx state=started enabled=true&#x27; </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">关闭服务</span></span><br><span class="line">ansible web -m service -a &#x27;name=nginx state=stopped&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查端口</span></span><br><span class="line">ansible web -m shell -a &#x27;ss -ntl | grep 80&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="10）user-模块"><a href="#10）user-模块" class="headerlink" title="10）user 模块"></a>10）user 模块</h2><p>该模块主要是用来管理用户账号。<br>其主要选项如下：</p>
<ul>
<li><code>comment</code>：用户的描述信息</li>
<li><code>createhome</code>：是否创建家目录</li>
<li><code>force</code>：在使用state&#x3D;absent时, 行为与userdel –force一致.</li>
<li><code>group</code>：指定基本组</li>
<li><code>groups</code>：指定附加组，如果指定为(groups&#x3D;)表示删除所有组</li>
<li><code>home</code>：指定用户家目录</li>
<li><code>move_home</code>：如果设置为home&#x3D;时, 试图将用户主目录移动到指定的目录</li>
<li><code>name</code>：指定用户名</li>
<li><code>non_unique</code>：该选项允许改变非唯一的用户ID值</li>
<li><code>password</code>：指定用户密码</li>
<li><code>remove</code>：在使用state&#x3D;absent时, 行为是与userdel –remove一致</li>
<li><code>shell</code>：指定默认shell</li>
<li><code>state</code>：设置帐号状态，不指定为创建，指定值为absent表示删除</li>
<li><code>system</code>：当创建一个用户，设置这个用户是系统用户。这个设置不能更改现有用户</li>
<li><code>uid</code>：指定用户的uid</li>
</ul>
<p>示例</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加一个用户并指定其 uid</span></span><br><span class="line">ansible web -m user -a &#x27;name=keer uid=11111&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除用户</span></span><br><span class="line">ansible web -m user -a &#x27;name=keer state=absent&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查用户</span></span><br><span class="line">ansible web -m shell -a &#x27;cat /etc/passwd |grep keer&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="11）group-模块"><a href="#11）group-模块" class="headerlink" title="11）group 模块"></a>11）group 模块</h2><p>该模块主要用于添加或删除组。<br>常用的选项如下：</p>
<ul>
<li><code>gid=</code>：设置组的GID号</li>
<li><code>name</code>：指定组的名称</li>
<li><code>state</code>：指定组的状态，默认为创建，设置值为<code>absent</code>为删除</li>
<li><code>system</code>：设置值为<code>yes</code>，表示创建为系统组</li>
</ul>
<p>示例</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建组</span></span><br><span class="line">ansible web -m group -a &#x27;name=sanguo gid=12222&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除组</span></span><br><span class="line">ansible web -m group -a &#x27;name=sanguo state=absent&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查组</span></span><br><span class="line">ansible web -m shell -a &#x27;cat /etc/group | grep 12222&#x27;</span><br></pre></td></tr></table></figure>



<h2 id="12）script-模块"><a href="#12）script-模块" class="headerlink" title="12）script 模块"></a>12）script 模块</h2><p>该模块用于将本机的脚本在被管理端的机器上运行。<br>该模块直接指定脚本的路径即可，我们通过例子来看一看到底如何使用的：<br>首先，我们写一个脚本，并给其加上执行权限：</p>
<p>示例</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible web -m script -a &#x27;/tmp/df.sh&#x27;</span><br></pre></td></tr></table></figure>



<h2 id="13）setup-模块"><a href="#13）setup-模块" class="headerlink" title="13）setup 模块"></a>13）setup 模块</h2><p>该模块主要用于收集信息，是通过调用facts组件来实现的。<br>facts组件是Ansible用于采集被管机器设备信息的一个功能，我们可以使用setup模块查机器的所有facts信息，可以使用filter来查看指定信息。整个facts信息被包装在一个JSON格式的数据结构中，ansible_facts是最上层的值。</p>
<p>facts就是变量，内建变量  。每个主机的各种信息，cpu颗数、内存大小等。会存在facts中的某个变量中。调用后返回很多对应主机的信息，在后面的操作中可以根据不同的信息来做不同的操作。如redhat系列用yum安装，而debian系列用apt来安装软件。</p>
<p>示例</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看信息</span></span><br><span class="line">ansible web -m setup -a &#x27;filter=&quot;*mem*&quot;&#x27; #查看内存</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">保存信息</span></span><br><span class="line">ansible web -m setup -a &#x27;filter=&quot;*mem*&quot;&#x27; --tree /tmp/facts</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看一下内存的大小</span></span><br><span class="line">ansible web -m shell -a &#x27;free -m&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="14）stat-模块"><a href="#14）stat-模块" class="headerlink" title="14）stat 模块"></a>14）stat 模块</h2><p>获取远程文件状态信息，atime&#x2F;ctime&#x2F;mtime&#x2F;md5&#x2F;uid&#x2F;gid 等信息</p>
<p>示例</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible Client -m stat -a &quot;path=/etc/syctl.conf&quot;</span><br></pre></td></tr></table></figure>

<h2 id="15）get-url-模块"><a href="#15）get-url-模块" class="headerlink" title="15）get_url 模块"></a>15）get_url 模块</h2><p>实现在远程主机下载指定 URL 到本地，支持 sha256sum 文件校验，类似于wget</p>
<ul>
<li>sha256sum：下载完成后进行sha256 check； </li>
<li>timeout：下载超时时间，默认10s </li>
<li>url：下载的URL </li>
<li>url_password、url_username：主要用于需要用户名密码进行验证的情况 </li>
<li>dest：将文件下载到哪里的绝对路径。如果dest是目录，则使用服务器提供的文件名，或者如果没有提供，将使用远程服务器上的URL的基本名称。</li>
</ul>
<p>示例</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible Client -m get_url -a &quot;url=http://www.baidu.com dest=/tmp/index.html mode=0440 force=yes&quot;</span><br></pre></td></tr></table></figure>



<h2 id="16）-mount-模块"><a href="#16）-mount-模块" class="headerlink" title="16） mount 模块"></a>16） mount 模块</h2><p>远程主机分区挂载</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible Client -m mount -a &quot;name=/mnt/data src=/dev/sd0 fstype=ext4 opts=ro state=present&quot;</span><br></pre></td></tr></table></figure>



<h2 id="17）firewalld-模块"><a href="#17）firewalld-模块" class="headerlink" title="17）firewalld 模块"></a>17）firewalld 模块</h2><p>首先开启防火墙</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible db -m service -a &#x27;name=firewalld state=started enabled=true&#x27;</span><br></pre></td></tr></table></figure>

<p>把httpd服务加入防火墙白名单：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible db -m firewalld -a &#x27;service=http state=enabled permanent=yes immediate</span><br></pre></td></tr></table></figure>



<h2 id="18）unarchive-模块"><a href="#18）unarchive-模块" class="headerlink" title="18）unarchive 模块"></a>18）unarchive 模块</h2><p>用于解压文件，模块包含如下选项： </p>
<ul>
<li>copy：在解压文件之前，是否先将文件复制到远程主机，默认为yes。若为no，则要求目标主机上压缩包必须存在。 </li>
<li>creates：指定一个文件名，当该文件存在时，则解压指令不执行 </li>
<li>dest：远程主机上的一个路径，即文件解压的绝对路径。 </li>
<li>group：解压后的目录或文件的属组 </li>
<li>list_files：如果为yes，则会列出压缩包里的文件，默认为no，2.0版本新增的选项 </li>
<li>mode：解压后文件的权限 </li>
<li>src：如果copy为yes，则需要指定压缩文件的源路径 </li>
<li>owner：解压后文件或目录的属主</li>
</ul>
<h2 id="19）apt-模块"><a href="#19）apt-模块" class="headerlink" title="19）apt 模块"></a>19）apt 模块</h2><p>这个模块是ubuntu作为远端节点的OS的时候，用的最多的。Ubuntu&#x2F;Debian的包管理工具。 </p>
<ul>
<li>deb： 用于安装远程机器上的.deb后缀的软件包（optional） </li>
<li>install_recommends：这个参数可以控制远程电脑上是否只是下载软件包，还是下载后安装，默认参数为true,设置为false的时候只下载软件包，不安装 </li>
<li>update_cache： 当这个参数为yes的时候等于apt-get update（optional） </li>
<li>name： apt要下载的软件包名字，支持name&#x3D;git&#x3D;1.6 这种制定版本的模式 </li>
<li>state：状态（present，absent，latest），表示是安装还卸载 <ul>
<li>present:默认的，表示为安装 </li>
<li>lastest: 安装为最新的版本 </li>
<li>absent：表示删除</li>
</ul>
</li>
</ul>
<h2 id="20）raw-模块"><a href="#20）raw-模块" class="headerlink" title="20）raw 模块"></a>20）raw 模块</h2><p>模块 执行原始的命令，而不是通过模块子系统。在任何情况下，使用shell或命令模块是合适的。给定原始的参数直接通过配置的远程shell运行。可返回标准输出、错误输出和返回代码。此模块没有变更处理程序支持。<br>这个模块不需要远程系统上的Python，就像脚本模块一样。此模块也支持Windows目标。</p>
<h2 id="shell、command、script、raw模块的区别"><a href="#shell、command、script、raw模块的区别" class="headerlink" title="shell、command、script、raw模块的区别"></a>shell、command、script、raw模块的区别</h2><ul>
<li>command模块 [执行远程命令]</li>
<li>script模块 [在远程主机执行主控端的shell&#x2F;python脚本 ]  （使用相对路径）</li>
<li>shell模块 [执行远程主机的shell&#x2F;python脚本]</li>
<li>raw模块 [类似于command模块、支持管道传递]</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://wangyyovo.github.io">Blank</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://wangyyovo.github.io/posts/7e1b1e5f/">https://wangyyovo.github.io/posts/7e1b1e5f/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://wangyyovo.github.io" target="_blank">Blank</a>！</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/ansible/5aa6a74dbc004c1186fe8099c325caf0.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/ff3c3a83/" title="palybook详解"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/ansible/0bda24c88202f092e2844d4f68b3a0c4.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">palybook详解</div></div><div class="info-2"><div class="info-item-1">  模块：https://docs.ansible.com/ansible/latest/modules/list_of_all_modules.html  Playbook介绍playbooks是一个不同于使用Ansible命令行执行方式的模式，其功能更强大灵活。简单来说，playbook是一个非常简单的配置管理和多主机部署系统，不同于任何已经存在的模式，可作为一个适合部署复杂应用程序的基础。Playbook可以定制配置，可以按照指定的操作步骤有序执行，支持同步和异步方式。值得注意的是playbook是通过YAML格式来进行描述定义的。   核心元素 Tasks：任务，由模板定义的操作列表 Variables：变量 Templates：模板，即使用模板语法的文件 Handlers：处理器 ，当某条件满足时，触发执行的操作 Roles：角色  hosts和users介绍 在playbook中的每一个play都可以选择在哪些服务器和以什么用户完成，hosts一行可以是一个主机组、主机、多个主机，中间以冒号分隔，可使用通配模式。其中remote_user表示执行的用户账号。 123-...</div></div></div></a><a class="pagination-related" href="/posts/e0cae48c/" title="Nginx配置文件nginx.conf详解"><img class="cover" src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/nginx/bd4fea7f62faf11871b700687d60ba14.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Nginx配置文件nginx.conf详解</div></div><div class="info-2"><div class="info-item-1"> Nginx配置文件nginx.conf详解 http://nginx.org/en/books.html nginx可以平滑升级  server继承main，location继承server，upstream既不会继承其他设置也不会被继承。在这四个部分当中，每个部分都包含若干指令，这些指令主要包含Nginx的主模块指令、事件模块指令、HTTP核心模块指令，同时每个部分还可以使用其他HTTP模块指令，例如Http SSL模块、HttpGzip Static模块和Http Addition模块等。 1.公共模块1234567891011121314151617#定义nginx运行的用户和用户组user www www;#nginx进程数，不知道怎么设置就设为auto，由系统自动分配worker_processes auto;#一个nginx进程打开的最多文件描述符数目，建议与ulimit -n的值一致worker_rlimit_nofile 65535;#根据worker的数量自动配置cpu绑定位图，这个参数是tengine配置worker_cpu_affinity auto;#全...</div></div></div></a></nav><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/theme/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Blank</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">352</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">46</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">58</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>主题 GitHub</span></a><div class="card-info-social-icons"><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fas fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ansible-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B"><span class="toc-number">2.</span> <span class="toc-text">ansible 命令执行过程</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ansible%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%9F%A5%E6%89%BE%E9%A1%BA%E5%BA%8F"><span class="toc-number">3.</span> <span class="toc-text">ansible配置文件查找顺序</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ansible%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">3.0.1.</span> <span class="toc-text">ansible配置文件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ansible-%E5%91%BD%E4%BB%A4%E9%9B%86"><span class="toc-number">4.</span> <span class="toc-text">ansible 命令集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ansible%E6%9F%A5%E7%9C%8B%E5%B8%AE%E5%8A%A9%E6%96%87%E6%A1%A3"><span class="toc-number">4.0.1.</span> <span class="toc-text">ansible查看帮助文档</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#hosts%E6%96%87%E4%BB%B6"><span class="toc-number">5.</span> <span class="toc-text">hosts文件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9C%E7%A8%8B%E4%B8%BB%E6%9C%BA%E5%AE%9A%E4%B9%89"><span class="toc-number">5.1.</span> <span class="toc-text">远程主机定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E5%88%86%E7%BB%84"><span class="toc-number">5.2.</span> <span class="toc-text">定义分组</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E6%9C%BA%E5%90%8D%E6%94%AF%E6%8C%81%E6%AD%A3%E5%88%99%E6%8F%8F%E8%BF%B0"><span class="toc-number">5.3.</span> <span class="toc-text">主机名支持正则描述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E5%88%AB%E5%90%8D"><span class="toc-number">5.4.</span> <span class="toc-text">定义别名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E6%95%B0"><span class="toc-number">5.5.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BE%A4%E7%BB%84%E6%95%B4%E5%90%88"><span class="toc-number">5.6.</span> <span class="toc-text">群组整合</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E6%9C%BA%E8%B0%83%E7%94%A8"><span class="toc-number">5.7.</span> <span class="toc-text">主机调用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ansible-%E5%91%BD%E4%BB%A4%E8%AF%A6%E8%A7%A3"><span class="toc-number">6.</span> <span class="toc-text">ansible 命令详解</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ansible-%E5%B8%B8%E7%94%A8%E6%A8%A1%E5%9D%97"><span class="toc-number">7.</span> <span class="toc-text">ansible 常用模块</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%EF%BC%89ping%E6%A8%A1%E5%9D%97"><span class="toc-number">7.1.</span> <span class="toc-text">1）ping模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%EF%BC%89command-%E6%A8%A1%E5%9D%97"><span class="toc-number">7.2.</span> <span class="toc-text">2）command 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%EF%BC%89shell-%E6%A8%A1%E5%9D%97"><span class="toc-number">7.3.</span> <span class="toc-text">3）shell 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%EF%BC%89copy-%E6%A8%A1%E5%9D%97"><span class="toc-number">7.4.</span> <span class="toc-text">4）copy 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%EF%BC%89file-%E6%A8%A1%E5%9D%97"><span class="toc-number">7.5.</span> <span class="toc-text">5）file 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%EF%BC%89fetch-%E6%A8%A1%E5%9D%97"><span class="toc-number">7.6.</span> <span class="toc-text">6）fetch 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%EF%BC%89cron-%E6%A8%A1%E5%9D%97"><span class="toc-number">7.7.</span> <span class="toc-text">7）cron 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8%EF%BC%89yum-%E6%A8%A1%E5%9D%97"><span class="toc-number">7.8.</span> <span class="toc-text">8）yum 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9%EF%BC%89service-%E6%A8%A1%E5%9D%97"><span class="toc-number">7.9.</span> <span class="toc-text">9）service 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10%EF%BC%89user-%E6%A8%A1%E5%9D%97"><span class="toc-number">7.10.</span> <span class="toc-text">10）user 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11%EF%BC%89group-%E6%A8%A1%E5%9D%97"><span class="toc-number">7.11.</span> <span class="toc-text">11）group 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12%EF%BC%89script-%E6%A8%A1%E5%9D%97"><span class="toc-number">7.12.</span> <span class="toc-text">12）script 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13%EF%BC%89setup-%E6%A8%A1%E5%9D%97"><span class="toc-number">7.13.</span> <span class="toc-text">13）setup 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14%EF%BC%89stat-%E6%A8%A1%E5%9D%97"><span class="toc-number">7.14.</span> <span class="toc-text">14）stat 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15%EF%BC%89get-url-%E6%A8%A1%E5%9D%97"><span class="toc-number">7.15.</span> <span class="toc-text">15）get_url 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16%EF%BC%89-mount-%E6%A8%A1%E5%9D%97"><span class="toc-number">7.16.</span> <span class="toc-text">16） mount 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#17%EF%BC%89firewalld-%E6%A8%A1%E5%9D%97"><span class="toc-number">7.17.</span> <span class="toc-text">17）firewalld 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18%EF%BC%89unarchive-%E6%A8%A1%E5%9D%97"><span class="toc-number">7.18.</span> <span class="toc-text">18）unarchive 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#19%EF%BC%89apt-%E6%A8%A1%E5%9D%97"><span class="toc-number">7.19.</span> <span class="toc-text">19）apt 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#20%EF%BC%89raw-%E6%A8%A1%E5%9D%97"><span class="toc-number">7.20.</span> <span class="toc-text">20）raw 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#shell%E3%80%81command%E3%80%81script%E3%80%81raw%E6%A8%A1%E5%9D%97%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">7.21.</span> <span class="toc-text">shell、command、script、raw模块的区别</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/d14168d/" title="虚拟机问题合集"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/hexo/090cfe4e9e60b0ad0de05db822f3ae97.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="虚拟机问题合集"/></a><div class="content"><a class="title" href="/posts/d14168d/" title="虚拟机问题合集">虚拟机问题合集</a><time datetime="2022-07-16T13:30:36.000Z" title="发表于 2022-07-16 21:30:36">2022-07-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/f540045f/" title="用go语言编写移动端sdk和app开发"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/golang/941ed1ec2925719a0c92e76f4f786b6a.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="用go语言编写移动端sdk和app开发"/></a><div class="content"><a class="title" href="/posts/f540045f/" title="用go语言编写移动端sdk和app开发">用go语言编写移动端sdk和app开发</a><time datetime="2022-07-04T12:14:21.000Z" title="发表于 2022-07-04 20:14:21">2022-07-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/5faac006/" title="在线编程IDE"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/hexo/090cfe4e9e60b0ad0de05db822f3ae97.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="在线编程IDE"/></a><div class="content"><a class="title" href="/posts/5faac006/" title="在线编程IDE">在线编程IDE</a><time datetime="2022-06-12T13:30:36.000Z" title="发表于 2022-06-12 21:30:36">2022-06-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/7594185d/" title="即时性能分析工具Pyroscope"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/golang/3bfb3279740bc9a5b5ef436fa887ef07.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="即时性能分析工具Pyroscope"/></a><div class="content"><a class="title" href="/posts/7594185d/" title="即时性能分析工具Pyroscope">即时性能分析工具Pyroscope</a><time datetime="2022-06-12T08:07:36.000Z" title="发表于 2022-06-12 16:07:36">2022-06-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/82a7aa7c/" title="golang性能调试优化方法"><img src="https://cdn.jsdelivr.net/gh/wangyyovo/CDN@master/cover/common/3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="golang性能调试优化方法"/></a><div class="content"><a class="title" href="/posts/82a7aa7c/" title="golang性能调试优化方法">golang性能调试优化方法</a><time datetime="2022-06-12T03:00:36.000Z" title="发表于 2022-06-12 11:00:36">2022-06-12</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By Blank</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 5.4.2</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.3</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = {"placeholder":"请留下你的脚印","pageSize":10,"lang":"zh-CN","requiredFields":["nick","mail","link"]}

  const initValine = (el, path) => {
    if (isShuoshuo) {
      window.shuoshuoComment.destroyValine = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    const valineConfig = {
      el: '#vcomment',
      appId: 'BSfgwCPLOvPHVPaSoBCGSENf-MdYXbMMI',
      appKey: '2Q8qq5060qxycL6FPL26LnMG',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      visitor: false,
      ...option,
      path: isShuoshuo ? path : (option && option.path) || window.location.pathname
    }

    new Valine(valineConfig)
  }

  const loadValine = async (el, path) => {
    if (typeof Valine === 'function') {
      initValine(el, path)
    } else {
      await btf.getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js')
      initValine(el, path)
    }
  }

  if (isShuoshuo) {
    'Valine' === 'Valine'
      ? window.shuoshuoComment = { loadComment: loadValine }
      : window.loadOtherComment = loadValine
    return
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>